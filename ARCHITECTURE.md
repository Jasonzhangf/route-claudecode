# RCC v4.0 å®Œæ•´æ¶æ„è®¾è®¡æ–‡æ¡£

## 1. æ¦‚è¿°

RCC v4.0 æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€ä¸¥æ ¼æ¨¡å—åŒ–çš„å¤šAIæä¾›å•†è·¯ç”±è½¬æ¢ç³»ç»Ÿã€‚ç³»ç»Ÿé‡‡ç”¨å››æ¨¡å—æ¶æ„è®¾è®¡ï¼Œç¡®ä¿å„ç»„ä»¶èŒè´£æ¸…æ™°ã€æ¥å£æ ‡å‡†ã€æ¾è€¦åˆã€‚

## 2. æ ¸å¿ƒæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯æ¨¡å—     â”‚â”€â”€â”€â–¶â”‚   è·¯ç”±å™¨æ¨¡å—     â”‚â”€â”€â”€â–¶â”‚  æµæ°´çº¿Worker   â”‚
â”‚   (Client)      â”‚    â”‚   (Router)      â”‚    â”‚  (Pipeline)     â”‚
â”‚  CLI + HTTP     â”‚    â”‚ è·¯ç”± + æµæ§     â”‚    â”‚ 4å±‚å¤„ç†é“¾      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ”¯æ’‘ç³»ç»Ÿæ¨¡å— (Config + Debug + ErrorHandler)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ ¸å¿ƒç±»å‹å®šä¹‰   â”‚
                    â”‚   (Types)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. æ¨¡å—è¯¦ç»†è®¾è®¡

### 3.1 å®¢æˆ·ç«¯æ¨¡å— (Client)
**èŒè´£**: å¤„ç†CLIå‘½ä»¤ã€ç”¨æˆ·äº¤äº’å’Œé”™è¯¯å¤„ç†

**å­æ¨¡å—**:
- CLIå¤„ç†å­æ¨¡å—
- ä¼šè¯ç®¡ç†å­æ¨¡å—
- HTTPå®¢æˆ·ç«¯å­æ¨¡å—

**æ¥å£**:
```typescript
interface ClientInterface {
  initialize(): Promise<void>;
  executeCommand(command: string, options: any): Promise<void>;
  handleUserInput(input: string): Promise<void>;
}
```

### 3.2 è·¯ç”±å™¨æ¨¡å— (Router)
**èŒè´£**: è¯·æ±‚è·¯ç”±ã€é…ç½®ç®¡ç†å’Œè´Ÿè½½å‡è¡¡

**å­æ¨¡å—**:
- é…ç½®ç®¡ç†å­æ¨¡å—
- è·¯ç”±ç®¡ç†å­æ¨¡å—
- æµæ§ç®¡ç†å­æ¨¡å—
- è´Ÿè½½å‡è¡¡å­æ¨¡å—

**æ¥å£**:
```typescript
interface RouterInterface {
  initialize(): Promise<void>;
  routeRequest(request: any): Promise<RouteResult>;
  getConfig(): RouterConfig;
}
```

### 3.3 æµæ°´çº¿æ¨¡å— (Pipeline)
**èŒè´£**: å®ç°å››å±‚æ¶æ„çš„è¯·æ±‚å¤„ç†æµæ°´çº¿

**å­æ¨¡å—**:
- æµæ°´çº¿ç®¡ç†å™¨
- æµæ°´çº¿å·¥å‚
- æ¨¡å—æ³¨å†Œè¡¨
- å››å±‚å¤„ç†æ¨¡å— (Transformer, Protocol, Server-Compatibility, Server)

**æ¥å£**:
```typescript
interface PipelineFramework {
  execute(input: any, context?: ExecutionContext): Promise<ExecutionResult>;
  start(): Promise<void>;
  stop(): Promise<void>;
}
```

### 3.4 Debugç³»ç»Ÿæ¨¡å— (Debug)
**èŒè´£**: å…¨é“¾è·¯æ•°æ®è®°å½•ã€å›æ”¾æµ‹è¯•å’Œè°ƒè¯•æ”¯æŒ

**å­æ¨¡å—**:
- Debugç®¡ç†å™¨
- Debugè®°å½•å™¨
- å›æ”¾ç³»ç»Ÿ
- æ€§èƒ½åˆ†æå™¨

**æ¥å£**:
```typescript
interface DebugManagerInterface {
  startRecording(): void;
  stopRecording(): void;
  getRecordedData(filter?: DebugFilter): DebugRecord[];
}
```

### 3.5 CLIæ¨¡å— (CLI)
**èŒè´£**: å‘½ä»¤è¡Œæ¥å£å¤„ç†

**å­æ¨¡å—**:
- å‘½ä»¤è§£æå™¨
- å‚æ•°éªŒè¯å™¨
- å‘½ä»¤æ‰§è¡Œå™¨

**æ¥å£**:
```typescript
interface CLICommandsInterface {
  start(options: StartOptions): Promise<void>;
  stop(options: StopOptions): Promise<void>;
  code(options: CodeOptions): Promise<void>;
}
```

### 3.6 æœåŠ¡å™¨æ¨¡å— (Server)
**èŒè´£**: HTTPæœåŠ¡å™¨ç®¡ç†å’Œè¯·æ±‚å¤„ç†

**å­æ¨¡å—**:
- HTTPæœåŠ¡å™¨æ ¸å¿ƒ
- æµæ°´çº¿é›†æˆæœåŠ¡å™¨
- ä¸­é—´ä»¶ç®¡ç†å™¨
- å®‰å…¨å­æ¨¡å—
- ç›‘æ§å­æ¨¡å—

**æ¥å£**:
```typescript
interface HTTPServerInterface {
  start(): Promise<void>;
  stop(): Promise<void>;
  addRoute(method: string, path: string, handler: RouteHandler): void;
}
```

### 3.7 é…ç½®æ¨¡å— (Config)
**èŒè´£**: é…ç½®ç®¡ç†

**å­æ¨¡å—**:
- é…ç½®åŠ è½½å™¨
- é…ç½®éªŒè¯å™¨
- é…ç½®ç›‘å¬å™¨
- Provideré…ç½®å­æ¨¡å—
- è·¯ç”±é…ç½®å­æ¨¡å—

**æ¥å£**:
```typescript
interface ConfigManagerInterface {
  loadConfig(): Promise<RCCv4Config>;
  validateConfig(config: RCCv4Config): boolean;
}
```

### 3.8 ç±»å‹å®šä¹‰æ¨¡å— (Types)
**èŒè´£**: ç»Ÿä¸€ç±»å‹å®šä¹‰

**å­æ¨¡å—**:
- æ ¸å¿ƒç±»å‹å®šä¹‰
- è¯·æ±‚å“åº”ç±»å‹å®šä¹‰
- æµæ°´çº¿ç±»å‹å®šä¹‰
- é…ç½®ç±»å‹å®šä¹‰

### 3.9 å·¥å…·æ¨¡å— (Utils)
**èŒè´£**: é€šç”¨å·¥å…·å‡½æ•°

**å­æ¨¡å—**:
- å®‰å…¨æ—¥å¿—è®°å½•å™¨
- é…ç½®åŠ å¯†å·¥å…·
- æ•°æ®éªŒè¯å™¨
- æ€§èƒ½ç›‘æ§å™¨

### 3.10 ä¸­é—´ä»¶æ¨¡å— (Middleware)
**èŒè´£**: HTTPè¯·æ±‚å¤„ç†ä¸­é—´ä»¶

**å­æ¨¡å—**:
- è®¤è¯ä¸­é—´ä»¶
- CORSä¸­é—´ä»¶
- æ—¥å¿—ä¸­é—´ä»¶
- å®‰å…¨ä¸­é—´ä»¶
- é€Ÿç‡é™åˆ¶ä¸­é—´ä»¶

### 3.11 è·¯ç”±æ¨¡å— (Routes)
**èŒè´£**: HTTPè·¯ç”±å®šä¹‰å’Œç®¡ç†

**å­æ¨¡å—**:
- APIè·¯ç”±å®šä¹‰
- å¥åº·æ£€æŸ¥è·¯ç”±
- è°ƒè¯•è·¯ç”±
- ç®¡ç†è·¯ç”±

### 3.12 æ¨¡å—ç³»ç»Ÿ (Modules)
**èŒè´£**: æµæ°´çº¿å¤„ç†æ¨¡å—ç®¡ç†

**å­æ¨¡å—**:
- æ¨¡å—æ³¨å†Œè¡¨
- æµæ°´çº¿å¤„ç†æ¨¡å— (å››å±‚æ¶æ„)
- Provideræ¨¡å—
- éªŒè¯æ¨¡å—

## 4. å››å±‚æµæ°´çº¿æ¶æ„

### ğŸ”„ é‡è¦æ¶æ„æé†’ï¼šåŒå‘è½¬æ¢å¤„ç†
**æ ¸å¿ƒåŸç†**: æµæ°´çº¿å„å±‚éƒ½å®ç°åŒå‘è½¬æ¢æœºåˆ¶
- **è¯·æ±‚æ–¹å‘**: æ­£å‘è½¬æ¢ (Client â†’ Provider)
- **å“åº”æ–¹å‘**: é€†å‘è½¬æ¢ (Provider â†’ Client)
- **ä¿è¯ä¸€è‡´æ€§**: è¯·æ±‚-å“åº”é…å¯¹ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§å’Œæ ¼å¼ä¸€è‡´æ€§

### 4.1 Transformerå±‚
**èŒè´£**: æ ¼å¼è½¬æ¢ (Anthropic â†” OpenAI â†” Gemini)
- **æ­£å‘**: å°†å®¢æˆ·ç«¯æ ¼å¼è½¬æ¢ä¸ºç›®æ ‡Provideræ ¼å¼
- **é€†å‘**: å°†Providerå“åº”è½¬æ¢å›å®¢æˆ·ç«¯æœŸæœ›æ ¼å¼

### 4.2 Protocolå±‚
**èŒè´£**: åè®®æ§åˆ¶ (æµå¼ â†” éæµå¼)
- **æ­£å‘**: æ ¹æ®é…ç½®å¤„ç†æµå¼/éæµå¼è¯·æ±‚è½¬æ¢
- **é€†å‘**: å°†Providerå“åº”æŒ‰åè®®è¦æ±‚è¿”å›ç»™å®¢æˆ·ç«¯

### 4.3 Server-Compatibilityå±‚
**èŒè´£**: ç¬¬ä¸‰æ–¹æœåŠ¡å™¨å…¼å®¹å¤„ç†
- **æ­£å‘**: é€‚é…ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ç‰¹æ®Šè¦æ±‚å’Œé™åˆ¶
- **é€†å‘**: æ ‡å‡†åŒ–ç¬¬ä¸‰æ–¹æœåŠ¡å™¨å“åº”æ ¼å¼

### 4.4 Serverå±‚
**èŒè´£**: æ ‡å‡†æœåŠ¡å™¨åè®® (SDKä¼˜å…ˆ)
- **æ­£å‘**: æœ€ç»ˆè¯·æ±‚å‘é€å’Œè¿æ¥ç®¡ç†
- **é€†å‘**: åŸå§‹å“åº”æ¥æ”¶å’Œåˆæ­¥å¤„ç†

## 5. è®¾è®¡åŸåˆ™

### 5.1 æ¨¡å—åŒ–åŸåˆ™
- ä¸¥æ ¼æ¨¡å—åŒ–: 15ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œç‰©ç†éš”ç¦»ï¼Œæ ‡å‡†æ¥å£é€šä¿¡
- é›¶è·¨æ¨¡å—å¤„ç†: æ¨¡å—é—´åªèƒ½é€šè¿‡å®šä¹‰æ¥å£é€šä¿¡
- é›¶é‡å¤ä»£ç : æ¨¡å—é—´ä¸å…è®¸åŠŸèƒ½é‡å 

### 5.2 è´¨é‡æ ‡å‡†
- é›¶é™é»˜å¤±è´¥: æ‰€æœ‰é”™è¯¯å¿…é¡»é€šè¿‡ error handler æŠ¥å‘Š
- é›¶Mockupå“åº”: ä¸¥ç¦mockupï¼Œå¿…é¡»çœŸå®æµæ°´çº¿
- é›¶ç¡¬ç¼–ç : æ‰€æœ‰é…ç½®å¯åŠ¨æ€åŠ è½½
- 100%æ•°æ®æ ¡éªŒ: æ¯ä¸ªæ¨¡å—è¾“å…¥è¾“å‡ºæ ‡å‡†æ ¡éªŒ

### 5.3 æ¥å£æ ‡å‡†
- æ ‡å‡†æ¥å£é€šä¿¡: æ¨¡å—é—´åªèƒ½é€šè¿‡å®šä¹‰æ¥å£
- å®Œæ•´çš„é”™è¯¯å¤„ç†: ç¦æ­¢ try-catch ç©ºå¤„ç†
- æ ‡å‡†åŒ–çš„æ¥å£å®šä¹‰

## 6. ä¼šè¯æµæ§æ¶æ„

```
Client Request â†’ ä¼šè¯æå–å™¨ â†’ ä¼šè¯æµæ§ç®¡ç†å™¨ â†’ æµæ°´çº¿Workeræ± 

ä¼šè¯æµæ§å±‚çº§:
â”œâ”€â”€ Session Level (ç”¨æˆ·ä¼šè¯)
â”‚   â”œâ”€â”€ Conversation Level (å¯¹è¯)
â”‚   â”‚   â”œâ”€â”€ Request Queue (è¯·æ±‚é˜Ÿåˆ— - ä¸²è¡Œå¤„ç†)
â”‚   â”‚   â”‚   â”œâ”€â”€ requestID_001 (æŒ‰é¡ºåº)
â”‚   â”‚   â”‚   â”œâ”€â”€ requestID_002 
â”‚   â”‚   â”‚   â””â”€â”€ requestID_003
â”‚   â”‚   â””â”€â”€ Processing State (å¤„ç†çŠ¶æ€)
â”‚   â””â”€â”€ Resource Management (èµ„æºç®¡ç†)

ç‰¹ç‚¹: åŒä¸€å¯¹è¯å†…è¯·æ±‚ä¸¥æ ¼ä¸²è¡Œï¼Œä¸åŒä¼šè¯å’Œå¯¹è¯å¯å¹¶è¡Œ
```

## 7. æµ‹è¯•ç­–ç•¥

### 7.1 æµ‹è¯•å±‚çº§
- å•å…ƒæµ‹è¯•: è¦†ç›–ç‡ > 90%
- é›†æˆæµ‹è¯•: è¦†ç›–æ‰€æœ‰æ¨¡å—æ¥å£
- æµæ°´çº¿æµ‹è¯•: ç«¯åˆ°ç«¯å¤„ç†
- å›æ”¾æµ‹è¯•: Debugæ•°æ®å›æ”¾

### 7.2 æµ‹è¯•è¦æ±‚
- çœŸå®æµæ°´çº¿æµ‹è¯• (ç¦æ­¢ mockup)
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- ç«¯åˆ°ç«¯æµ‹è¯•è¦†ç›–ä¸»è¦ç”¨æˆ·åœºæ™¯

## 8. å®‰å…¨è€ƒè™‘

### 8.1 æ•°æ®å®‰å…¨
- APIå¯†é’¥åŠ å¯†å­˜å‚¨
- é”™è¯¯æ—¥å¿—æ•æ„Ÿä¿¡æ¯è¿‡æ»¤
- Debugè®°å½•æ•æ„Ÿä¿¡æ¯æ¸…ç†

### 8.2 ç½‘ç»œå®‰å…¨
- HTTPSä¼˜å…ˆ
- è¯ä¹¦éªŒè¯
- è¯·æ±‚å¤´éªŒè¯

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 æ€§èƒ½æŒ‡æ ‡
- è¯·æ±‚å¤„ç†å»¶è¿Ÿ < 100ms
- æ”¯æŒå¹¶å‘è¯·æ±‚ > 100 ä¸ª
- å†…å­˜ä½¿ç”¨ < 200MB (ç©ºè½½)

### 9.2 ä¼˜åŒ–ç­–ç•¥
- ç¼“å­˜æœºåˆ¶: é…ç½®æ–‡ä»¶ç¼“å­˜ï¼Œæµæ°´çº¿å®ä¾‹ç¼“å­˜
- å¼‚æ­¥å¤„ç†: æ‰€æœ‰I/Oæ“ä½œå¼‚æ­¥åŒ–
- å†…å­˜ç®¡ç†: åŠæ—¶æ¸…ç†æ— ç”¨èµ„æº

## 10. éƒ¨ç½²å’Œç»´æŠ¤

### 10.1 éƒ¨ç½²è¦æ±‚
- Node.js 18.0+ (LTSç‰ˆæœ¬)
- TypeScript 5.0+
- npm 9.0+ æˆ– pnpm 8.0+

### 10.2 ç»´æŠ¤è®¡åˆ’
- å®šæœŸä¾èµ–æ›´æ–°
- å®‰å…¨æ¼æ´ä¿®å¤
- æ€§èƒ½ä¼˜åŒ–
- æ–°AIæœåŠ¡æ”¯æŒ