# RCC v4.0 质量检查清单

## 🚨 P0级质量红线 (违反立即拒绝)

### ❌ 绝对禁止 (ABSOLUTE PROHIBITIONS)

每次代码提交前，必须确认以下项目**全部为否**：

- [ ] **硬编码检查**: 代码中是否包含硬编码的URL、端口、API密钥、模型名称？
- [ ] **静默失败检查**: 是否存在catch块不处理错误或只打印日志？
- [ ] **Mockup响应检查**: 是否有假数据、模拟响应或测试数据返回？
- [ ] **跨模块违规检查**: 是否有模块直接调用其他模块内部方法？
- [ ] **架构违反检查**: 是否违反了六层架构的依赖关系？

## ✅ P1级强制要求 (MANDATORY REQUIREMENTS)

### 📋 代码质量标准

每个模块开发完成后必须满足：

#### 基础代码要求
- [ ] **TypeScript严格检查**: 通过 `tsc --noEmit --strict`
- [ ] **ESLint规范检查**: 通过 `npm run lint`
- [ ] **代码格式化**: 通过 `npm run format:check`
- [ ] **导入导出规范**: 所有模块通过 `index.ts` 统一导出
- [ ] **命名约定遵循**: 符合 `.claude/rules/programming-rules.md` 规范

#### 文档要求
- [ ] **README文档**: 每个模块有对应的README.md
- [ ] **接口文档**: 所有导出接口有TSDoc注释
- [ ] **使用示例**: 复杂接口提供代码示例
- [ ] **变更日志**: 接口变更记录在模块文档中

#### 测试要求
- [ ] **单元测试**: 每个模块有对应的 `.test.ts` 文件
- [ ] **测试覆盖率**: 行覆盖率 ≥ 80%，分支覆盖率 ≥ 70%
- [ ] **真实流水线测试**: 严禁Mock，使用真实数据测试
- [ ] **集成测试**: 模块间协作功能有集成测试
- [ ] **错误处理测试**: 验证各种错误情况的处理

### 🏗️ 架构合规检查

#### 模块边界检查
- [ ] **单一职责**: 模块功能聚焦，职责边界清晰
- [ ] **依赖方向**: 只能依赖下层模块，不能反向依赖
- [ ] **接口通信**: 模块间只通过标准接口通信
- [ ] **数据校验**: 模块输入输出都有数据校验
- [ ] **错误传播**: 错误通过ErrorHandler统一处理

#### 流水线架构检查
- [ ] **流水线隔离**: 每个provider.model独立流水线
- [ ] **数据流标准**: 遵循标准的4层处理流程
- [ ] **会话流控**: 实现基于session.conversationID.requestID的流控
- [ ] **资源管理**: 流水线生命周期管理正确
- [ ] **性能指标**: 满足响应时间和内存使用要求

## 📊 P2级质量优化 (QUALITY OPTIMIZATION)

### ⚡ 性能要求

- [ ] **启动时间**: 应用启动时间 < 2秒
- [ ] **响应时间**: API响应时间 < 100ms (不含AI调用)
- [ ] **内存使用**: 峰值内存使用 < 200MB
- [ ] **并发处理**: 支持至少10个并发请求
- [ ] **资源释放**: 无内存泄漏，资源正确释放

### 🔍 代码质量指标

- [ ] **圈复杂度**: 函数圈复杂度 < 10
- [ ] **函数长度**: 函数行数 < 50行
- [ ] **文件大小**: 单文件行数 < 500行
- [ ] **注释覆盖**: 公开接口100%有TSDoc注释
- [ ] **技术债务**: 无TODO注释，无临时代码

## 🧪 测试质量标准

### 单元测试标准
- [ ] **测试命名**: 使用 `describe-test-expect` 结构
- [ ] **测试隔离**: 每个测试相互独立，可单独运行
- [ ] **测试数据**: 使用真实数据，不使用Mock
- [ ] **边界测试**: 覆盖正常、异常、边界情况
- [ ] **异步测试**: 正确处理异步操作和Promise

### 集成测试标准  
- [ ] **端到端测试**: 完整的请求响应链路测试
- [ ] **错误链路测试**: 验证错误在整个系统中的传播
- [ ] **性能基准测试**: 建立性能基线并持续监控
- [ ] **并发测试**: 验证系统在并发场景下的表现
- [ ] **回放测试**: 基于Debug数据的回放验证

## 📋 质量门禁检查流程

### 开发阶段检查 (每日)
1. **代码提交前**:
   ```bash
   npm run lint          # ESLint检查
   npm run type:check     # TypeScript检查  
   npm run test           # 单元测试
   npm run test:coverage  # 覆盖率检查
   ```

2. **功能完成后**:
   ```bash
   npm run test:integration  # 集成测试
   npm run test:e2e          # 端到端测试
   npm run build             # 构建验证
   npm run docs:validate     # 文档验证
   ```

### 里程碑检查 (每周)
1. **架构合规验证**: 运行架构合规检查脚本
2. **性能基准测试**: 执行性能测试套件  
3. **安全扫描**: npm audit + 代码安全扫描
4. **文档同步检查**: 确保文档与代码一致
5. **团队代码审查**: 至少1人审查所有变更

### 发布前检查 (Phase结束)
1. **完整测试套件**: 所有测试100%通过
2. **性能要求验证**: 所有性能指标达标
3. **安全合规检查**: 通过安全扫描和审计
4. **文档完整性**: 所有文档更新完整
5. **部署就绪验证**: 构建产物可正常部署

## 🔧 自动化检查脚本

### package.json 脚本配置
```json
{
  "scripts": {
    "lint": "eslint src --ext .ts",
    "lint:fix": "eslint src --ext .ts --fix",
    "type:check": "tsc --noEmit --strict",
    "test": "jest",
    "test:coverage": "jest --coverage",
    "test:integration": "jest --config jest.integration.config.js",
    "test:e2e": "jest --config jest.e2e.config.js", 
    "build": "tsc && npm run build:verify",
    "build:verify": "./scripts/verify-build.sh",
    "docs:validate": "./scripts/validate-docs.sh",
    "quality:check": "./scripts/quality-gate-check.sh"
  }
}
```

### Git Pre-commit Hook
```bash
#!/bin/bash
# .husky/pre-commit

echo "🔍 运行质量检查..."

# P0级检查
npm run lint || exit 1
npm run type:check || exit 1  
npm run test || exit 1

# P1级检查  
./scripts/check-hardcoding.sh || exit 1
./scripts/check-silent-failures.sh || exit 1
./scripts/check-mockup-responses.sh || exit 1

echo "✅ 质量检查通过"
```

## 📊 质量指标仪表板

### 日常监控指标
- **构建成功率**: 目标 100%
- **测试通过率**: 目标 100%  
- **代码覆盖率**: 目标 ≥ 80%
- **代码质量得分**: 目标 A级
- **技术债务**: 目标 < 5%

### 每周质量报告
- **模块完成度**: Phase进度跟踪
- **质量债务**: 未解决的质量问题
- **性能趋势**: 响应时间和内存使用趋势  
- **测试效果**: 测试发现的问题统计
- **架构健康度**: 模块依赖和耦合度分析

## ⚠️ 质量风险预警

### 红色警报 (立即停止开发)
- P0级质量红线被触发
- 关键模块测试失败
- 系统性能严重下降
- 架构原则重大违反

### 黄色预警 (需要关注)  
- 测试覆盖率下降
- 代码复杂度上升
- 技术债务增加
- 模块依赖混乱

### 绿色正常 (继续开发)
- 所有质量指标达标
- 测试持续通过
- 性能保持稳定
- 架构边界清晰

---
**质量负责人**: 开发团队全体成员  
**最后更新**: 2025-08-15 20:40  
**下次审查**: 每日质量检查