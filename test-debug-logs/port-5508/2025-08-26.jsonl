{"timestamp":"2025-08-26T01:52:34.849Z","level":"INFO","message":"启用文件日志记录","data":{"port":5508,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:52:34.856Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-v4-5508-test.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:52:34.870Z","level":"INFO","message":"📋 Using standard routing format, no expansion needed"}
{"timestamp":"2025-08-26T01:52:34.874Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":1,"routerRules":3}}
{"timestamp":"2025-08-26T01:52:34.880Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-v4-5508-test.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-26T01:52:34.886Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:52:34.892Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:52:34.896Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:52:34.902Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":1,"serverPort":5508,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:52:34.908Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:52:34.911Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:52:34.917Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:52:34.922Z","level":"INFO","message":"使用传统Provider配置生成流水线"}
{"timestamp":"2025-08-26T01:52:34.925Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":2,"categoriesCount":2,"categories":["claude-sonnet-4-20250514","claude-3-opus"],"hasExpandedRouting":false}}
{"timestamp":"2025-08-26T01:52:34.933Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":2,"virtualModels":["claude-sonnet-4-20250514","claude-3-opus"]}}
{"timestamp":"2025-08-26T01:52:34.939Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":2,"defaultRoute":"claude-sonnet-4-20250514"}}
{"timestamp":"2025-08-26T01:52:34.945Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":2,"defaultRoute":"claude-sonnet-4-20250514"}}
{"timestamp":"2025-08-26T01:52:34.952Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5508,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:52:34.959Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":48,"totalPipelines":2,"virtualModels":["claude-sonnet-4-20250514","claude-3-opus"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:52:34.964Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5508,"totalPipelines":2}}
{"timestamp":"2025-08-26T01:52:34.973Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"uptime":0}}
{"timestamp":"2025-08-26T01:52:34.980Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"initializationTime":48,"uptime":0}}
{"timestamp":"2025-08-26T01:52:34.985Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5508,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-v4-5508-test.json"}}
{"timestamp":"2025-08-26T01:52:34.992Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:52:34.998Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:11.546Z","level":"INFO","message":"启用文件日志记录","data":{"port":5508,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T02:05:11.553Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-v4-5508-test.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T02:05:11.564Z","level":"INFO","message":"📋 Using standard routing format, no expansion needed"}
{"timestamp":"2025-08-26T02:05:11.568Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":1,"routerRules":3}}
{"timestamp":"2025-08-26T02:05:11.575Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-v4-5508-test.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T02:05:11.583Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:11.589Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:11.592Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:11.599Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":1,"serverPort":5508,"modulesInitialized":true}}
{"timestamp":"2025-08-26T02:05:11.605Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T02:05:11.609Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:05:11.616Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:05:11.622Z","level":"INFO","message":"使用传统Provider配置生成流水线"}
{"timestamp":"2025-08-26T02:05:11.626Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":2,"categoriesCount":2,"categories":["claude-sonnet-4-20250514","claude-3-opus"],"hasExpandedRouting":false}}
{"timestamp":"2025-08-26T02:05:11.634Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":2,"virtualModels":["claude-sonnet-4-20250514","claude-3-opus"]}}
{"timestamp":"2025-08-26T02:05:11.641Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":2,"defaultRoute":"claude-sonnet-4-20250514"}}
{"timestamp":"2025-08-26T02:05:11.648Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":2,"defaultRoute":"claude-sonnet-4-20250514"}}
{"timestamp":"2025-08-26T02:05:11.656Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5508,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T02:05:11.663Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":54,"totalPipelines":2,"virtualModels":["claude-sonnet-4-20250514","claude-3-opus"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T02:05:11.670Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5508,"totalPipelines":2}}
{"timestamp":"2025-08-26T02:05:11.680Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"uptime":0}}
{"timestamp":"2025-08-26T02:05:11.687Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"initializationTime":54,"uptime":0}}
{"timestamp":"2025-08-26T02:05:11.692Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5508,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-v4-5508-test.json","debug":true}}
{"timestamp":"2025-08-26T02:05:11.700Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:11.708Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{
	"timestamp": "2025-08-26T08:06:58.395Z",
	"port": 5508,
	"requestId": "sim_1756195618395_abn6o1aqu",
	"input": {
		"model": "invalid-model",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Test error recording"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.399Z",
	"port": 5508,
	"requestId": "sim_1756195618395_abn6o1aqu",
	"output": {
		"id": "msg_sim_1756195618395_abn6o1aqu",
		"type": "message",
		"role": "assistant",
		"content": [
			{
				"type": "text",
				"text": "This is a mock response for your request with model invalid-model. Your message was: \"Test error recording\""
			}
		],
		"model": "invalid-model",
		"stop_reason": "end_turn",
		"usage": {
			"input_tokens": 13,
			"output_tokens": 50
		}
	},
	"processingTime": 4,
	"validation": {
		"inputValidation": {
			"success": true,
			"processingTime": 0.4
		},
		"outputValidation": {
			"success": true,
			"processingTime": 0.4
		}
	}
}
{"timestamp":"2025-08-26T10:20:35.722Z","level":"INFO","message":"接收到chat/completions请求","data":{"method":"POST","url":"/v1/chat/completions","hasBody":true}}
{"timestamp":"2025-08-26T10:20:35.729Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"openai","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:20:35.736Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T10:20:35.742Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:20:35.746Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:20:35.753Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203635752_jzgejptnq","protocol":"openai","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:20:35.782Z","level":"INFO","message":"Virtual model mapping completed","data":{"virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:20:35.789Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203635752_jzgejptnq","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:20:35.797Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203635752_jzgejptnq","selectedPipeline":"gemini-gemini-2.5-flash-key0","availablePipelines":["gemini-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-26T10:20:35.825Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203635752_jzgejptnq","providerType":"gemini","providerProtocol":"gemini","hasInput":true}}
{"timestamp":"2025-08-26T10:20:35.832Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203635752_jzgejptnq","direction":"passthrough","outputSize":3}}
{"timestamp":"2025-08-26T10:20:35.847Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203635752_jzgejptnq","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:20:35.854Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756203635752_jzgejptnq","errors":["缺少必需字段：model (string)","缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: choices。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: error。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: usage。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-26T10:20:35.861Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756203635752_jzgejptnq","errors":["缺少必需字段：model (string)","缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: choices。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: error。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: usage。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-26T10:20:35.872Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756203635752_jzgejptnq","error":"Transformer输出格式验证失败: 缺少必需字段：model (string), 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: choices。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: error。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: usage。严禁任何自定义字段，包括__internal等","stack":"Error: Transformer输出格式验证失败: 缺少必需字段：model (string), 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: choices。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: error。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: usage。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-request-processor.js:238:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:236:13)","layerTimings":{"router":57,"transformer":31},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 缺少必需字段：model (string), 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: choices。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: error。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: usage。严禁任何自定义字段，包括__internal等","timestamp":{}}]}}
{"timestamp":"2025-08-26T10:20:35.880Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756203635752_jzgejptnq","error":"Transformer输出格式验证失败: 缺少必需字段：model (string), 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: choices。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: error。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: usage。严禁任何自定义字段，包括__internal等"}}
{"timestamp":"2025-08-26T10:20:35.893Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"openai","error":"Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：model (string), 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: choices。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: error。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: usage。严禁任何自定义字段，包括__internal等","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：model (string), 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: choices。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: error。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: usage。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T10:20:35.902Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:20:35.908Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:20:59.644Z","level":"INFO","message":"接收到chat/completions请求","data":{"method":"POST","url":"/v1/chat/completions","hasBody":true}}
{"timestamp":"2025-08-26T10:20:59.651Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"openai","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:20:59.657Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T10:20:59.664Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:20:59.667Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:20:59.673Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203659673_4uxh9odyt","protocol":"openai","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:20:59.689Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:20:59.695Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203659673_4uxh9odyt","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:20:59.701Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203659673_4uxh9odyt","selectedPipeline":"gemini-gemini-2.5-flash-key0","availablePipelines":["gemini-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-26T10:20:59.725Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203659673_4uxh9odyt","providerType":"gemini","providerProtocol":"gemini","hasInput":true}}
{"timestamp":"2025-08-26T10:20:59.731Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203659673_4uxh9odyt","direction":"passthrough","outputSize":3}}
{"timestamp":"2025-08-26T10:20:59.746Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203659673_4uxh9odyt","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:20:59.752Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203659673_4uxh9odyt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-26T10:20:59.758Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203659673_4uxh9odyt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-26T10:20:59.781Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203659673_4uxh9odyt","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:20:59.796Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203659673_4uxh9odyt","providerType":"gemini","compatibilityTag":"gemini","hasOptions":false,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:20:59.802Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203659673_4uxh9odyt","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:20:59.808Z","level":"WARN","message":"未知的兼容性标签，使用passthrough模式","data":{"requestId":"req_1756203659673_4uxh9odyt","compatibilityTag":"gemini"}}
{"timestamp":"2025-08-26T10:20:59.814Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203659673_4uxh9odyt","compatibilityTag":"gemini","moduleType":"object"}}
{"timestamp":"2025-08-26T10:20:59.820Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203659673_4uxh9odyt","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:20:59.834Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203659673_4uxh9odyt","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:20:59.839Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203659673_4uxh9odyt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-26T10:20:59.845Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203659673_4uxh9odyt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-26T10:20:59.861Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://cloudcode-pa.googleapis.com/***","method":"POST","bodySize":167,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T10:20:59.874Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:20:59.879Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:21:01.061Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://cloudcode-pa.googleapis.com/***","statusCode":401,"responseSize":299,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:21:01.074Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756203659673_4uxh9odyt","status":401,"endpoint":"https://cloudcode-pa.googleapis.com/v1internal:streamGenerateContent","responsePreview":"[{\n  \"error\": {\n    \"code\": 401,\n    \"message\": \"Request had invalid authentication credentials. Expected OAuth 2 access token, login cookie or other valid authentication credential. See https://devel","extractedErrorMessage":"Client error: 401 Bad Request"}}
{"timestamp":"2025-08-26T10:21:01.080Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756203659673_4uxh9odyt","pipelineId":"gemini-gemini-2.5-flash-key0","errorMessage":"Client error: 401 Bad Request"}}
{"timestamp":"2025-08-26T10:21:01.087Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756203659673_4uxh9odyt","failedPipelineId":"gemini-gemini-2.5-flash-key0","retryCount":0,"errorMessage":"Client error: 401 Bad Request"}}
{"timestamp":"2025-08-26T10:21:01.093Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756203659673_4uxh9odyt","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T10:21:01.100Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756203659673_4uxh9odyt","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T10:21:01.106Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756203659673_4uxh9odyt","failedPipelineId":"gemini-gemini-2.5-flash-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":19,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T10:21:01.112Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756203659673_4uxh9odyt","success":false,"recoveryAction":"terminal","recoveryTime":19}}
{"timestamp":"2025-08-26T10:21:01.117Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756203659673_4uxh9odyt","failedPipeline":"gemini-gemini-2.5-flash-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T10:21:01.123Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756203659673_4uxh9odyt","pipelineId":"gemini-gemini-2.5-flash-key0","originalError":"Client error: 401 Bad Request","recoveryError":"Client error: 401 Bad Request"}}
{"timestamp":"2025-08-26T10:21:01.133Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756203659673_4uxh9odyt","error":"Client error: 401 Bad Request","stack":"Error: Client error: 401 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/modules/pipeline-layers.js:290:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:236:13)","layerTimings":{"router":36,"transformer":30,"protocol":17,"serverCompatibility":47},"errors":[{"layer":"pipeline","error":"Client error: 401 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T10:21:01.144Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756203659673_4uxh9odyt","error":"Client error: 401 Bad Request"}}
{"timestamp":"2025-08-26T10:21:01.156Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"openai","error":"Pipeline request processing failed: Client error: 401 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 401 Bad Request\n    at PipelineRequestProcessor.processRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:236:13)"}}
