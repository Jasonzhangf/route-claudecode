{"timestamp":"2025-08-27T00:37:14.846Z","level":"INFO","message":"启用文件日志记录","data":{"port":5508,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-27T00:37:14.852Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-27T00:37:14.863Z","level":"INFO","message":"📋 Using standard routing format, no expansion needed"}
{"timestamp":"2025-08-27T00:37:14.866Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":1,"routerRules":6}}
{"timestamp":"2025-08-27T00:37:14.872Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-27T00:37:14.878Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:37:14.882Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:37:14.885Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:37:14.891Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":1,"serverPort":5508,"modulesInitialized":true}}
{"timestamp":"2025-08-27T00:37:14.897Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-27T00:37:14.899Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:37:14.904Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:37:14.909Z","level":"INFO","message":"使用Router配置驱动生成流水线"}
{"timestamp":"2025-08-27T00:37:14.912Z","level":"INFO","message":"路由类别 default 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:37:14.915Z","level":"INFO","message":"路由类别 longContext 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:37:14.917Z","level":"INFO","message":"路由类别 background 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:37:14.920Z","level":"INFO","message":"路由类别 think 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:37:14.922Z","level":"INFO","message":"路由类别 webSearch 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:37:14.925Z","level":"INFO","message":"路由类别 coding 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:37:14.927Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":6,"categoriesCount":6,"categories":["default","longContext","background","think","webSearch","coding"],"hasExpandedRouting":false}}
{"timestamp":"2025-08-27T00:37:14.932Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"]}}
{"timestamp":"2025-08-27T00:37:14.936Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:37:14.941Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:37:14.946Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5508,"host":"0.0.0.0"}}
{"timestamp":"2025-08-27T00:37:14.950Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":51,"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-27T00:37:14.955Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5508,"totalPipelines":6}}
{"timestamp":"2025-08-27T00:37:14.963Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"uptime":0}}
{"timestamp":"2025-08-27T00:37:14.968Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"initializationTime":51,"uptime":0}}
{"timestamp":"2025-08-27T00:37:14.973Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5508,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json"}}
{"timestamp":"2025-08-27T00:37:14.981Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:37:14.986Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:37:31.756Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:37:31.760Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:37:31.765Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:37:31.770Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:37:31.774Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:37:31.777Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:37:31.782Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255051781_jl2dxb23o","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:37:31.802Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:37:31.807Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255051781_jl2dxb23o","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:37:31.812Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:37:31.817Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:37:31.821Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255051781_jl2dxb23o","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:37:31.837Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255051781_jl2dxb23o","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:37:31.841Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255051781_jl2dxb23o","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:37:31.851Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255051781_jl2dxb23o","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:37:31.855Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255051781_jl2dxb23o","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:37:31.860Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255051781_jl2dxb23o","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:37:31.865Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255051781_jl2dxb23o","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":46,"transformer":19},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:37:31.870Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255051781_jl2dxb23o","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:37:31.881Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:37:31.895Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:37:31.900Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:37:31.904Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:37:31.909Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:37:31.915Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:37:31.918Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:37:31.923Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255051923_iteqitbv5","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:37:31.974Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:37:31.979Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255051923_iteqitbv5","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:37:31.983Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:37:31.988Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:37:31.993Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255051923_iteqitbv5","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:37:32.013Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255051923_iteqitbv5","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:37:32.017Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255051923_iteqitbv5","direction":"passthrough","outputSize":8}}
{"timestamp":"2025-08-27T00:37:32.033Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255051923_iteqitbv5","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:37:32.039Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255051923_iteqitbv5","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:37:32.043Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255051923_iteqitbv5","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:37:32.048Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255051923_iteqitbv5","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":75,"transformer":31},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:37:32.054Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255051923_iteqitbv5","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:37:32.082Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:37:32.092Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:37:32.097Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:37:32.101Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:37:32.106Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:37:32.111Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:37:32.114Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:37:32.118Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255052118_inpf9spgn","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:37:32.127Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:37:32.132Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255052118_inpf9spgn","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:37:32.136Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:37:32.141Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:37:32.145Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255052118_inpf9spgn","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:37:32.159Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255052118_inpf9spgn","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:37:32.163Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255052118_inpf9spgn","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:37:32.174Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255052118_inpf9spgn","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:37:32.178Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255052118_inpf9spgn","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:37:32.183Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255052118_inpf9spgn","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:37:32.188Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255052118_inpf9spgn","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":31,"transformer":20},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:37:32.192Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255052118_inpf9spgn","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:37:32.204Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:37:32.218Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:37:32.222Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:37:32.227Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:37:32.231Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:37:32.235Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:37:32.238Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:37:32.243Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255052243_1aduemmli","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:37:32.294Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:37:32.299Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255052243_1aduemmli","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:37:32.303Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:37:32.307Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:37:32.312Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255052243_1aduemmli","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:37:32.333Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255052243_1aduemmli","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:37:32.338Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255052243_1aduemmli","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:37:32.355Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255052243_1aduemmli","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:37:32.360Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255052243_1aduemmli","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:37:32.364Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255052243_1aduemmli","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:37:32.369Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255052243_1aduemmli","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":74,"transformer":34},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:37:32.374Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255052243_1aduemmli","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:37:32.401Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:37:32.410Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:37:32.415Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:37:32.424Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:37:32.430Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:37:32.435Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:37:32.440Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:37:32.445Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:37:32.449Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:37:32.455Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255052455_3cius7890","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:37:32.466Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:37:32.470Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255052455_3cius7890","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:37:32.475Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:37:32.480Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:37:32.484Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255052455_3cius7890","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:37:32.501Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255052455_3cius7890","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:37:32.505Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255052455_3cius7890","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:37:32.515Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255052455_3cius7890","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:37:32.520Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255052455_3cius7890","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:37:32.525Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255052455_3cius7890","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:37:32.531Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255052455_3cius7890","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":35,"transformer":20},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:37:32.536Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255052455_3cius7890","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:37:32.548Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:37:32.558Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:37:32.563Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:37:32.570Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:37:32.575Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:37:32.583Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:37:32.588Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:37:32.594Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:37:32.599Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:38:14.441Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-27T00:38:14.445Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-27T00:38:14.447Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-27T00:38:14.450Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-27T00:38:14.453Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-27T00:38:14.456Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-27T00:38:14.459Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-27T00:38:14.461Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-27T00:38:14.464Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-27T00:38:14.466Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-27T00:38:14.469Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-27T00:38:14.472Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-27T00:38:15.476Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-27T00:38:24.198Z","level":"INFO","message":"启用文件日志记录","data":{"port":5508,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-27T00:38:24.204Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-27T00:38:24.215Z","level":"INFO","message":"📋 Using standard routing format, no expansion needed"}
{"timestamp":"2025-08-27T00:38:24.218Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":1,"routerRules":6}}
{"timestamp":"2025-08-27T00:38:24.223Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-27T00:38:24.230Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:38:24.236Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:38:24.240Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:38:24.246Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":1,"serverPort":5508,"modulesInitialized":true}}
{"timestamp":"2025-08-27T00:38:24.252Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-27T00:38:24.254Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:38:24.260Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:38:24.266Z","level":"INFO","message":"使用Router配置驱动生成流水线"}
{"timestamp":"2025-08-27T00:38:24.269Z","level":"INFO","message":"路由类别 default 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:38:24.272Z","level":"INFO","message":"路由类别 longContext 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:38:24.275Z","level":"INFO","message":"路由类别 background 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:38:24.277Z","level":"INFO","message":"路由类别 think 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:38:24.280Z","level":"INFO","message":"路由类别 webSearch 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:38:24.283Z","level":"INFO","message":"路由类别 coding 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:38:24.285Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":6,"categoriesCount":6,"categories":["default","longContext","background","think","webSearch","coding"],"hasExpandedRouting":false}}
{"timestamp":"2025-08-27T00:38:24.291Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"]}}
{"timestamp":"2025-08-27T00:38:24.296Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:38:24.301Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:38:24.307Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5508,"host":"0.0.0.0"}}
{"timestamp":"2025-08-27T00:38:24.312Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":58,"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-27T00:38:24.316Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5508,"totalPipelines":6}}
{"timestamp":"2025-08-27T00:38:24.325Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"uptime":0}}
{"timestamp":"2025-08-27T00:38:24.330Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"initializationTime":58,"uptime":0}}
{"timestamp":"2025-08-27T00:38:24.335Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5508,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json"}}
{"timestamp":"2025-08-27T00:38:24.343Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:38:24.348Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:38:35.996Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:38:36.002Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:38:36.007Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:38:36.012Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:38:36.017Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:38:36.019Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:38:36.024Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255116024_j2zadm4pj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:38:36.045Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:38:36.049Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255116024_j2zadm4pj","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:38:36.054Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:38:36.058Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:38:36.062Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255116024_j2zadm4pj","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:38:36.077Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255116024_j2zadm4pj","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:38:36.081Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255116024_j2zadm4pj","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:38:36.091Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255116024_j2zadm4pj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:38:36.095Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255116024_j2zadm4pj","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:38:36.100Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255116024_j2zadm4pj","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:38:36.105Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255116024_j2zadm4pj","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":43,"transformer":19},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:38:36.110Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255116024_j2zadm4pj","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:38:36.121Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:38:36.135Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:38:36.140Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:38:36.145Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:38:36.149Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:38:36.155Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:38:36.158Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:38:36.163Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255116163_fli88l16z","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:38:36.222Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:38:36.227Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255116163_fli88l16z","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:38:36.232Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:38:36.236Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:38:36.241Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255116163_fli88l16z","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:38:36.261Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255116163_fli88l16z","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:38:36.266Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255116163_fli88l16z","direction":"passthrough","outputSize":8}}
{"timestamp":"2025-08-27T00:38:36.282Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255116163_fli88l16z","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:38:36.287Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255116163_fli88l16z","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:38:36.291Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255116163_fli88l16z","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:38:36.296Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255116163_fli88l16z","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":83,"transformer":32},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:38:36.301Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255116163_fli88l16z","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:38:36.326Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:38:36.337Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:38:36.342Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:38:36.347Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:38:36.352Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:38:36.356Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:38:36.360Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:38:36.364Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255116364_b0d1k7epl","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:38:36.374Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:38:36.378Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255116364_b0d1k7epl","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:38:36.382Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:38:36.387Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:38:36.391Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255116364_b0d1k7epl","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:38:36.404Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255116364_b0d1k7epl","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:38:36.409Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255116364_b0d1k7epl","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:38:36.418Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255116364_b0d1k7epl","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:38:36.423Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255116364_b0d1k7epl","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:38:36.428Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255116364_b0d1k7epl","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:38:36.433Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255116364_b0d1k7epl","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":31,"transformer":18},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:38:36.437Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255116364_b0d1k7epl","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:38:36.448Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:38:36.462Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:38:36.467Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:38:36.472Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:38:36.476Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:38:36.481Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:38:36.484Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:38:36.489Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255116489_crgt1prrd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:38:36.539Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:38:36.543Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255116489_crgt1prrd","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:38:36.547Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:38:36.552Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:38:36.556Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255116489_crgt1prrd","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:38:36.578Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255116489_crgt1prrd","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:38:36.582Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255116489_crgt1prrd","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:38:36.599Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255116489_crgt1prrd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:38:36.604Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255116489_crgt1prrd","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:38:36.609Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255116489_crgt1prrd","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:38:36.614Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255116489_crgt1prrd","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":73,"transformer":33},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:38:36.618Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255116489_crgt1prrd","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:38:36.646Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:38:36.657Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:38:36.662Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:38:36.671Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:38:36.677Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:38:36.682Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:38:36.687Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:38:36.694Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:38:36.697Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:38:36.703Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255116703_o3do2xz7q","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:38:36.714Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:38:36.718Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255116703_o3do2xz7q","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:38:36.723Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:38:36.728Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:38:36.732Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255116703_o3do2xz7q","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:38:36.747Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255116703_o3do2xz7q","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:38:36.752Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255116703_o3do2xz7q","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:38:36.763Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255116703_o3do2xz7q","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:38:36.767Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255116703_o3do2xz7q","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:38:36.773Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255116703_o3do2xz7q","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:38:36.779Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255116703_o3do2xz7q","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":34,"transformer":21},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:38:36.784Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255116703_o3do2xz7q","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:38:36.797Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:38:36.809Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:38:36.813Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:38:36.820Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:38:36.825Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:38:36.833Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:38:36.837Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:38:36.844Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:38:36.849Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:43:23.760Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-27T00:43:23.764Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-27T00:43:23.766Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-27T00:43:23.769Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-27T00:43:23.771Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-27T00:43:23.774Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-27T00:43:23.776Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-27T00:43:23.779Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-27T00:43:23.781Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-27T00:43:23.784Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-27T00:43:23.786Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-27T00:43:23.788Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-27T00:43:24.792Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-27T00:43:33.613Z","level":"INFO","message":"启用文件日志记录","data":{"port":5508,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-27T00:43:33.619Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-27T00:43:33.630Z","level":"INFO","message":"📋 Using standard routing format, no expansion needed"}
{"timestamp":"2025-08-27T00:43:33.632Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":1,"routerRules":6}}
{"timestamp":"2025-08-27T00:43:33.637Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-27T00:43:33.643Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:43:33.648Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:43:33.651Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:43:33.656Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":1,"serverPort":5508,"modulesInitialized":true}}
{"timestamp":"2025-08-27T00:43:33.661Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-27T00:43:33.664Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:43:33.668Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:43:33.674Z","level":"INFO","message":"使用Router配置驱动生成流水线"}
{"timestamp":"2025-08-27T00:43:33.676Z","level":"INFO","message":"路由类别 default 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:43:33.679Z","level":"INFO","message":"路由类别 longContext 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:43:33.681Z","level":"INFO","message":"路由类别 background 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:43:33.683Z","level":"INFO","message":"路由类别 think 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:43:33.686Z","level":"INFO","message":"路由类别 webSearch 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:43:33.688Z","level":"INFO","message":"路由类别 coding 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:43:33.690Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":6,"categoriesCount":6,"categories":["default","longContext","background","think","webSearch","coding"],"hasExpandedRouting":false}}
{"timestamp":"2025-08-27T00:43:33.695Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"]}}
{"timestamp":"2025-08-27T00:43:33.699Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:43:33.704Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:43:33.708Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5508,"host":"0.0.0.0"}}
{"timestamp":"2025-08-27T00:43:33.713Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":49,"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-27T00:43:33.717Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5508,"totalPipelines":6}}
{"timestamp":"2025-08-27T00:43:33.725Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"uptime":0}}
{"timestamp":"2025-08-27T00:43:33.730Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"initializationTime":49,"uptime":0}}
{"timestamp":"2025-08-27T00:43:33.735Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5508,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json"}}
{"timestamp":"2025-08-27T00:43:33.742Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:43:33.748Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:43:46.384Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:43:46.390Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:43:46.395Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:43:46.400Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:43:46.405Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:43:46.408Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:43:46.413Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255426412_fs86t4oef","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:43:46.433Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:43:46.437Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255426412_fs86t4oef","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:43:46.442Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:43:46.447Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:43:46.451Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255426412_fs86t4oef","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:43:46.465Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255426412_fs86t4oef","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:43:46.470Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255426412_fs86t4oef","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:43:46.479Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255426412_fs86t4oef","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:43:46.484Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255426412_fs86t4oef","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:43:46.488Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255426412_fs86t4oef","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:43:46.493Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255426412_fs86t4oef","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":43,"transformer":19},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:43:46.498Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255426412_fs86t4oef","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:43:46.509Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:43:46.523Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:43:46.528Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:43:46.533Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:43:46.537Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:43:46.542Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:43:46.545Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:43:46.550Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255426550_ccqz0kd67","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:43:46.603Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:43:46.607Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255426550_ccqz0kd67","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:43:46.612Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:43:46.616Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:43:46.620Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255426550_ccqz0kd67","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:43:46.640Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255426550_ccqz0kd67","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:43:46.645Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255426550_ccqz0kd67","direction":"passthrough","outputSize":8}}
{"timestamp":"2025-08-27T00:43:46.661Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255426550_ccqz0kd67","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:43:46.666Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255426550_ccqz0kd67","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:43:46.670Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255426550_ccqz0kd67","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:43:46.675Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255426550_ccqz0kd67","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":74,"transformer":32},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:43:46.680Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255426550_ccqz0kd67","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:43:46.705Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:43:46.716Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:43:46.720Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:43:46.725Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:43:46.729Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:43:46.734Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:43:46.737Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:43:46.741Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255426741_yi92it6rt","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:43:46.751Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:43:46.755Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255426741_yi92it6rt","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:43:46.760Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:43:46.764Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:43:46.769Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255426741_yi92it6rt","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:43:46.783Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255426741_yi92it6rt","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:43:46.787Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255426741_yi92it6rt","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:43:46.796Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255426741_yi92it6rt","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:43:46.800Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255426741_yi92it6rt","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:43:46.805Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255426741_yi92it6rt","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:43:46.810Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255426741_yi92it6rt","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":31,"transformer":19},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:43:46.815Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255426741_yi92it6rt","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:43:46.826Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:43:46.839Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:43:46.844Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:43:46.848Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:43:46.853Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:43:46.857Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:43:46.860Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:43:46.865Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255426865_os8gct49v","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:43:46.916Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:43:46.920Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255426865_os8gct49v","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:43:46.924Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:43:46.929Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:43:46.933Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255426865_os8gct49v","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:43:46.954Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255426865_os8gct49v","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:43:46.958Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255426865_os8gct49v","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:43:46.974Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255426865_os8gct49v","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:43:46.978Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255426865_os8gct49v","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:43:46.983Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255426865_os8gct49v","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:43:46.988Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255426865_os8gct49v","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":73,"transformer":32},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:43:46.993Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255426865_os8gct49v","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:43:47.019Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:43:47.030Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:43:47.035Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:43:47.039Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:43:47.044Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:43:47.050Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:43:47.054Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:43:47.059Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255427059_3iilxcv2y","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:43:47.070Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:43:47.075Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255427059_3iilxcv2y","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:43:47.082Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:43:47.086Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:43:47.091Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255427059_3iilxcv2y","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:43:47.106Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255427059_3iilxcv2y","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:43:47.111Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255427059_3iilxcv2y","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:43:47.122Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255427059_3iilxcv2y","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:43:47.126Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255427059_3iilxcv2y","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:43:47.131Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255427059_3iilxcv2y","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:43:47.136Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255427059_3iilxcv2y","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":37,"transformer":21},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:43:47.141Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255427059_3iilxcv2y","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:43:47.153Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:43:47.163Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:43:47.168Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:43:47.176Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:43:47.181Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:43:47.188Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:43:47.193Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:43:47.200Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:43:47.204Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:43:47.211Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:43:47.215Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:51:05.992Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-27T00:51:05.996Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-27T00:51:05.999Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-27T00:51:06.002Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-27T00:51:06.006Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-27T00:51:06.009Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-27T00:51:06.011Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-27T00:51:06.014Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-27T00:51:06.017Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-27T00:51:06.020Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-27T00:51:06.022Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-27T00:51:06.025Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-27T00:51:07.029Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-27T00:51:08.589Z","level":"INFO","message":"启用文件日志记录","data":{"port":5508,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-27T00:51:08.603Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-27T00:51:08.626Z","level":"INFO","message":"📋 Using standard routing format, no expansion needed"}
{"timestamp":"2025-08-27T00:51:08.629Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":1,"routerRules":6}}
{"timestamp":"2025-08-27T00:51:08.634Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-27T00:51:08.639Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:51:08.644Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:51:08.647Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:51:08.653Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":1,"serverPort":5508,"modulesInitialized":true}}
{"timestamp":"2025-08-27T00:51:08.658Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-27T00:51:08.661Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:51:08.665Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:51:08.670Z","level":"INFO","message":"使用Router配置驱动生成流水线"}
{"timestamp":"2025-08-27T00:51:08.672Z","level":"INFO","message":"路由类别 default 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:51:08.675Z","level":"INFO","message":"路由类别 longContext 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:51:08.677Z","level":"INFO","message":"路由类别 background 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:51:08.679Z","level":"INFO","message":"路由类别 think 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:51:08.682Z","level":"INFO","message":"路由类别 webSearch 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:51:08.684Z","level":"INFO","message":"路由类别 coding 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:51:08.686Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":6,"categoriesCount":6,"categories":["default","longContext","background","think","webSearch","coding"],"hasExpandedRouting":false}}
{"timestamp":"2025-08-27T00:51:08.690Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"]}}
{"timestamp":"2025-08-27T00:51:08.695Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:51:08.699Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:51:08.704Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5508,"host":"0.0.0.0"}}
{"timestamp":"2025-08-27T00:51:08.708Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":47,"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-27T00:51:08.713Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5508,"totalPipelines":6}}
{"timestamp":"2025-08-27T00:51:08.720Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"uptime":0}}
{"timestamp":"2025-08-27T00:51:08.725Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"initializationTime":47,"uptime":0}}
{"timestamp":"2025-08-27T00:51:08.729Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5508,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json"}}
{"timestamp":"2025-08-27T00:51:08.738Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:51:08.743Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:51:24.300Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:51:24.305Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:51:24.311Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:51:24.316Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:51:24.321Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:51:24.324Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:51:24.329Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255884329_ypgkee1cu","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:51:24.351Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:51:24.355Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255884329_ypgkee1cu","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:51:24.359Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:51:24.364Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:51:24.368Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255884329_ypgkee1cu","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:51:24.382Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255884329_ypgkee1cu","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:51:24.387Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255884329_ypgkee1cu","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:51:24.396Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255884329_ypgkee1cu","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:51:24.401Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255884329_ypgkee1cu","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:51:24.405Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255884329_ypgkee1cu","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:51:24.411Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255884329_ypgkee1cu","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":43,"transformer":19},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:51:24.416Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255884329_ypgkee1cu","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:51:24.429Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:51:24.444Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:51:24.449Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:51:24.454Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:51:24.459Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:51:24.465Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:51:24.467Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:51:24.472Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255884472_szirn26oy","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:51:24.526Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:51:24.531Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255884472_szirn26oy","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:51:24.535Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:51:24.540Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:51:24.545Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255884472_szirn26oy","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:51:24.566Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255884472_szirn26oy","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:51:24.571Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255884472_szirn26oy","direction":"passthrough","outputSize":8}}
{"timestamp":"2025-08-27T00:51:24.587Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255884472_szirn26oy","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:51:24.591Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255884472_szirn26oy","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:51:24.596Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255884472_szirn26oy","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:51:24.601Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255884472_szirn26oy","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":78,"transformer":33},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:51:24.606Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255884472_szirn26oy","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:51:24.633Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:51:24.643Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:51:24.649Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:51:24.654Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:51:24.658Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:51:24.663Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:51:24.666Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:51:24.671Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255884671_yijulyvql","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:51:24.680Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:51:24.685Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255884671_yijulyvql","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:51:24.689Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:51:24.693Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:51:24.697Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255884671_yijulyvql","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:51:24.711Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255884671_yijulyvql","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:51:24.715Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255884671_yijulyvql","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:51:24.725Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255884671_yijulyvql","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:51:24.730Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255884671_yijulyvql","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:51:24.735Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255884671_yijulyvql","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:51:24.739Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255884671_yijulyvql","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":31,"transformer":19},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:51:24.744Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255884671_yijulyvql","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:51:24.755Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:51:24.769Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:51:24.774Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:51:24.778Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:51:24.782Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:51:24.787Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:51:24.790Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:51:24.794Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255884794_9n1jmrq9w","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:51:24.847Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:51:24.852Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255884794_9n1jmrq9w","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:51:24.857Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:51:24.861Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:51:24.866Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255884794_9n1jmrq9w","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:51:24.886Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255884794_9n1jmrq9w","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:51:24.891Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255884794_9n1jmrq9w","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:51:24.907Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255884794_9n1jmrq9w","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:51:24.912Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255884794_9n1jmrq9w","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:51:24.917Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255884794_9n1jmrq9w","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:51:24.922Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255884794_9n1jmrq9w","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":77,"transformer":32},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:51:24.926Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255884794_9n1jmrq9w","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:51:24.954Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:51:24.964Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:51:24.970Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:51:24.978Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:51:24.984Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:51:24.989Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:51:24.994Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:51:25.000Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:51:25.004Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:51:25.009Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255885009_k85xzu0ks","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:51:25.019Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:51:25.024Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255885009_k85xzu0ks","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:51:25.029Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:51:25.033Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:51:25.039Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255885009_k85xzu0ks","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:51:25.056Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255885009_k85xzu0ks","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:51:25.061Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255885009_k85xzu0ks","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:51:25.072Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255885009_k85xzu0ks","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:51:25.077Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255885009_k85xzu0ks","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:51:25.082Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255885009_k85xzu0ks","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:51:25.087Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255885009_k85xzu0ks","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":36,"transformer":22},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:51:25.092Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255885009_k85xzu0ks","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:51:25.105Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:51:25.115Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:51:25.120Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:51:25.127Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:51:25.132Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:51:25.139Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:51:25.143Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:51:25.150Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:51:25.155Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:52:55.691Z","level":"INFO","message":"启用文件日志记录","data":{"port":5508,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-27T00:52:55.697Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-27T00:52:55.708Z","level":"INFO","message":"📋 Using standard routing format, no expansion needed"}
{"timestamp":"2025-08-27T00:52:55.711Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":1,"routerRules":6}}
{"timestamp":"2025-08-27T00:52:55.716Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-27T00:52:55.723Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:52:55.729Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:52:55.732Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:52:55.739Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":1,"serverPort":5508,"modulesInitialized":true}}
{"timestamp":"2025-08-27T00:52:55.744Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-27T00:52:55.747Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:52:55.752Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:52:55.757Z","level":"INFO","message":"使用Router配置驱动生成流水线"}
{"timestamp":"2025-08-27T00:52:55.760Z","level":"INFO","message":"路由类别 default 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:52:55.763Z","level":"INFO","message":"路由类别 longContext 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:52:55.766Z","level":"INFO","message":"路由类别 background 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:52:55.768Z","level":"INFO","message":"路由类别 think 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:52:55.771Z","level":"INFO","message":"路由类别 webSearch 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:52:55.773Z","level":"INFO","message":"路由类别 coding 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:52:55.776Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":6,"categoriesCount":6,"categories":["default","longContext","background","think","webSearch","coding"],"hasExpandedRouting":false}}
{"timestamp":"2025-08-27T00:52:55.780Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"]}}
{"timestamp":"2025-08-27T00:52:55.785Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:52:55.790Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:52:55.796Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5508,"host":"0.0.0.0"}}
{"timestamp":"2025-08-27T00:52:55.802Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":55,"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-27T00:52:55.806Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5508,"totalPipelines":6}}
{"timestamp":"2025-08-27T00:52:55.814Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"uptime":0}}
{"timestamp":"2025-08-27T00:52:55.819Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"initializationTime":55,"uptime":0}}
{"timestamp":"2025-08-27T00:52:55.824Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5508,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json"}}
{"timestamp":"2025-08-27T00:52:55.833Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:52:55.837Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:53:07.684Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:53:07.690Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:53:07.694Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:53:07.699Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:53:07.703Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:53:07.705Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:53:07.710Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255987710_aaqgcq709","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:53:07.730Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:53:07.735Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255987710_aaqgcq709","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:53:07.740Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:53:07.745Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:53:07.749Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255987710_aaqgcq709","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:53:07.765Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255987710_aaqgcq709","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:53:07.770Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255987710_aaqgcq709","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:53:07.779Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255987710_aaqgcq709","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:53:07.784Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255987710_aaqgcq709","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:53:07.788Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255987710_aaqgcq709","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:53:07.793Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255987710_aaqgcq709","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":44,"transformer":20},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:53:07.798Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255987710_aaqgcq709","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:53:07.809Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:53:07.823Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:53:07.828Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:53:07.833Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:53:07.838Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:53:07.843Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:53:07.846Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:53:07.851Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255987851_7ekv1uoml","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:53:07.906Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:53:07.911Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255987851_7ekv1uoml","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:53:07.915Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:53:07.919Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:53:07.924Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255987851_7ekv1uoml","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:53:07.944Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255987851_7ekv1uoml","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:53:07.948Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255987851_7ekv1uoml","direction":"passthrough","outputSize":8}}
{"timestamp":"2025-08-27T00:53:07.965Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255987851_7ekv1uoml","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:53:07.970Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255987851_7ekv1uoml","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:53:07.975Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255987851_7ekv1uoml","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:53:07.981Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255987851_7ekv1uoml","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":77,"transformer":32},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:53:07.986Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255987851_7ekv1uoml","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:53:08.014Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:53:08.024Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:53:08.029Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:53:08.034Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:53:08.038Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:53:08.043Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:53:08.047Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:53:08.051Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255988051_3pm7dkbnv","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:53:08.061Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:53:08.066Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255988051_3pm7dkbnv","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:53:08.071Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:53:08.076Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:53:08.080Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255988051_3pm7dkbnv","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:53:08.096Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255988051_3pm7dkbnv","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:53:08.100Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255988051_3pm7dkbnv","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:53:08.110Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255988051_3pm7dkbnv","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:53:08.114Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255988051_3pm7dkbnv","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:53:08.118Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255988051_3pm7dkbnv","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:53:08.123Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255988051_3pm7dkbnv","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":34,"transformer":20},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:53:08.128Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255988051_3pm7dkbnv","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:53:08.139Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:53:08.153Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:53:08.158Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:53:08.163Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:53:08.168Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:53:08.173Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:53:08.176Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:53:08.182Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255988182_hrf8eue4h","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:53:08.236Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:53:08.240Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255988182_hrf8eue4h","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:53:08.245Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:53:08.250Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:53:08.254Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255988182_hrf8eue4h","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:53:08.275Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255988182_hrf8eue4h","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:53:08.280Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255988182_hrf8eue4h","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:53:08.297Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255988182_hrf8eue4h","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:53:08.302Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255988182_hrf8eue4h","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:53:08.307Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255988182_hrf8eue4h","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:53:08.312Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255988182_hrf8eue4h","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":77,"transformer":34},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:53:08.317Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255988182_hrf8eue4h","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:53:08.344Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:53:08.353Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:53:08.358Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:53:08.366Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:53:08.372Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:53:08.377Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:53:08.383Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:53:08.388Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:53:08.393Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:53:08.399Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756255988399_br3vxd7ro","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:53:08.410Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:53:08.415Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756255988399_br3vxd7ro","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:53:08.419Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:53:08.424Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:53:08.429Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756255988399_br3vxd7ro","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:53:08.445Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756255988399_br3vxd7ro","providerType":"gemini","hasInput":true}}
{"timestamp":"2025-08-27T00:53:08.449Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756255988399_br3vxd7ro","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:53:08.459Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756255988399_br3vxd7ro","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:53:08.464Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756255988399_br3vxd7ro","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:53:08.469Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756255988399_br3vxd7ro","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:53:08.474Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756255988399_br3vxd7ro","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":35,"transformer":20},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:53:08.479Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756255988399_br3vxd7ro","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:53:08.491Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:53:08.503Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:53:08.508Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:53:08.516Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:53:08.521Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:53:08.528Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:53:08.533Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:53:08.540Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:53:08.545Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:55:40.531Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-27T00:55:40.534Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-27T00:55:40.537Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-27T00:55:40.539Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-27T00:55:40.542Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-27T00:55:40.545Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-27T00:55:40.548Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-27T00:55:40.551Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-27T00:55:40.554Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-27T00:55:40.558Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-27T00:55:40.561Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-27T00:55:40.564Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-27T00:55:41.568Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-27T00:55:43.131Z","level":"INFO","message":"启用文件日志记录","data":{"port":5508,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-27T00:55:43.145Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-27T00:55:43.165Z","level":"INFO","message":"📋 Using standard routing format, no expansion needed"}
{"timestamp":"2025-08-27T00:55:43.168Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":1,"routerRules":6}}
{"timestamp":"2025-08-27T00:55:43.173Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-27T00:55:43.178Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:55:43.183Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:55:43.185Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:55:43.190Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":1,"serverPort":5508,"modulesInitialized":true}}
{"timestamp":"2025-08-27T00:55:43.194Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-27T00:55:43.196Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:55:43.201Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:55:43.205Z","level":"INFO","message":"使用Router配置驱动生成流水线"}
{"timestamp":"2025-08-27T00:55:43.207Z","level":"INFO","message":"路由类别 default 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:55:43.209Z","level":"INFO","message":"路由类别 longContext 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:55:43.212Z","level":"INFO","message":"路由类别 background 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:55:43.214Z","level":"INFO","message":"路由类别 think 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:55:43.216Z","level":"INFO","message":"路由类别 webSearch 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:55:43.219Z","level":"INFO","message":"路由类别 coding 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:55:43.221Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":6,"categoriesCount":6,"categories":["default","longContext","background","think","webSearch","coding"],"hasExpandedRouting":false}}
{"timestamp":"2025-08-27T00:55:43.225Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"]}}
{"timestamp":"2025-08-27T00:55:43.229Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:55:43.234Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:55:43.239Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5508,"host":"0.0.0.0"}}
{"timestamp":"2025-08-27T00:55:43.244Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":48,"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-27T00:55:43.249Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5508,"totalPipelines":6}}
{"timestamp":"2025-08-27T00:55:43.258Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"uptime":0}}
{"timestamp":"2025-08-27T00:55:43.263Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"initializationTime":48,"uptime":0}}
{"timestamp":"2025-08-27T00:55:43.267Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5508,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json"}}
{"timestamp":"2025-08-27T00:55:43.275Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:55:43.280Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:56:57.678Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:56:57.684Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:56:57.689Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:56:57.694Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:56:57.699Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:56:57.702Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:56:57.707Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756256217706_8im0we9ld","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:56:57.727Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:56:57.732Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756256217706_8im0we9ld","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:56:57.736Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:56:57.741Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:56:57.745Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756256217706_8im0we9ld","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:56:57.759Z","level":"INFO","message":"🔍 [TRANSFORMER LAYER] Detailed condition check","data":{"requestId":"req_1756256217706_8im0we9ld","selectedPipelineId":"gemini-cli-gemini-2.5-flash-key0","providerType":"gemini","geminiCondition1":"providerType === 'gemini-cli' → false","geminiCondition2":"serverCompatibility?.use === 'gemini-cli' → false","geminiCondition3":"protocol === 'gemini' → false","shouldUseGeminiTransformer":false,"matchingProvider":"NOT_FOUND","hasInput":true}}
{"timestamp":"2025-08-27T00:56:57.763Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756256217706_8im0we9ld","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:56:57.774Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756256217706_8im0we9ld","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:56:57.779Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756256217706_8im0we9ld","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:56:57.783Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756256217706_8im0we9ld","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:56:57.788Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756256217706_8im0we9ld","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":43,"transformer":20},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:56:57.794Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756256217706_8im0we9ld","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:56:57.805Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:56:57.819Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:56:57.823Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:56:57.828Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:56:57.833Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:56:57.839Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:56:57.841Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:56:57.846Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756256217846_5aa04tr98","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:56:57.901Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:56:57.906Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756256217846_5aa04tr98","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:56:57.910Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:56:57.914Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:56:57.919Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756256217846_5aa04tr98","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:56:57.940Z","level":"INFO","message":"🔍 [TRANSFORMER LAYER] Detailed condition check","data":{"requestId":"req_1756256217846_5aa04tr98","selectedPipelineId":"gemini-cli-gemini-2.5-flash-key0","providerType":"gemini","geminiCondition1":"providerType === 'gemini-cli' → false","geminiCondition2":"serverCompatibility?.use === 'gemini-cli' → false","geminiCondition3":"protocol === 'gemini' → false","shouldUseGeminiTransformer":false,"matchingProvider":"NOT_FOUND","hasInput":true}}
{"timestamp":"2025-08-27T00:56:57.945Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756256217846_5aa04tr98","direction":"passthrough","outputSize":8}}
{"timestamp":"2025-08-27T00:56:57.961Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756256217846_5aa04tr98","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:56:57.965Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756256217846_5aa04tr98","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:56:57.970Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756256217846_5aa04tr98","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":8}}}
{"timestamp":"2025-08-27T00:56:57.975Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756256217846_5aa04tr98","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":78,"transformer":33},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:56:57.980Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756256217846_5aa04tr98","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:56:58.008Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:56:58.019Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:56:58.023Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:56:58.028Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:56:58.033Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:56:58.037Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:56:58.040Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:56:58.045Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756256218045_es2q476h8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:56:58.054Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:56:58.059Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756256218045_es2q476h8","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:56:58.063Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:56:58.068Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:56:58.072Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756256218045_es2q476h8","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:56:58.086Z","level":"INFO","message":"🔍 [TRANSFORMER LAYER] Detailed condition check","data":{"requestId":"req_1756256218045_es2q476h8","selectedPipelineId":"gemini-cli-gemini-2.5-flash-key0","providerType":"gemini","geminiCondition1":"providerType === 'gemini-cli' → false","geminiCondition2":"serverCompatibility?.use === 'gemini-cli' → false","geminiCondition3":"protocol === 'gemini' → false","shouldUseGeminiTransformer":false,"matchingProvider":"NOT_FOUND","hasInput":true}}
{"timestamp":"2025-08-27T00:56:58.091Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756256218045_es2q476h8","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:56:58.101Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756256218045_es2q476h8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:56:58.106Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756256218045_es2q476h8","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:56:58.110Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756256218045_es2q476h8","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:56:58.116Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756256218045_es2q476h8","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":32,"transformer":20},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:56:58.122Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756256218045_es2q476h8","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:56:58.133Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:56:58.147Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:56:58.151Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:56:58.156Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:56:58.160Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:56:58.164Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:56:58.167Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:56:58.172Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756256218172_q28phjl0y","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:56:58.228Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:56:58.233Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756256218172_q28phjl0y","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:56:58.238Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:56:58.242Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:56:58.247Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756256218172_q28phjl0y","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:56:58.267Z","level":"INFO","message":"🔍 [TRANSFORMER LAYER] Detailed condition check","data":{"requestId":"req_1756256218172_q28phjl0y","selectedPipelineId":"gemini-cli-gemini-2.5-flash-key0","providerType":"gemini","geminiCondition1":"providerType === 'gemini-cli' → false","geminiCondition2":"serverCompatibility?.use === 'gemini-cli' → false","geminiCondition3":"protocol === 'gemini' → false","shouldUseGeminiTransformer":false,"matchingProvider":"NOT_FOUND","hasInput":true}}
{"timestamp":"2025-08-27T00:56:58.271Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756256218172_q28phjl0y","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:56:58.287Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756256218172_q28phjl0y","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:56:58.292Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756256218172_q28phjl0y","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:56:58.296Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756256218172_q28phjl0y","errors":["工具定义 0: 格式无效","工具定义 1: 格式无效","工具定义 2: 格式无效","工具定义 3: 格式无效","工具定义 4: 格式无效","工具定义 5: 格式无效","工具定义 6: 格式无效","工具定义 7: 格式无效","工具定义 8: 格式无效","工具定义 9: 格式无效","工具定义 10: 格式无效","工具定义 11: 格式无效","工具定义 12: 格式无效","工具定义 13: 格式无效","工具定义 14: 格式无效","工具定义 15: 格式无效","Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":false,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:56:58.301Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756256218172_q28phjl0y","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":80,"transformer":31},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:56:58.306Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756256218172_q28phjl0y","error":"Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:56:58.335Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 工具定义 0: 格式无效, 工具定义 1: 格式无效, 工具定义 2: 格式无效, 工具定义 3: 格式无效, 工具定义 4: 格式无效, 工具定义 5: 格式无效, 工具定义 6: 格式无效, 工具定义 7: 格式无效, 工具定义 8: 格式无效, 工具定义 9: 格式无效, 工具定义 10: 格式无效, 工具定义 11: 格式无效, 工具定义 12: 格式无效, 工具定义 13: 格式无效, 工具定义 14: 格式无效, 工具定义 15: 格式无效, Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:56:58.345Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:56:58.351Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:56:58.356Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:56:58.362Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:56:58.367Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:56:58.370Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:56:58.375Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756256218375_d210879a1","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:56:58.386Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:56:58.391Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756256218375_d210879a1","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:56:58.396Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:56:58.400Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:56:58.405Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756256218375_d210879a1","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:56:58.420Z","level":"INFO","message":"🔍 [TRANSFORMER LAYER] Detailed condition check","data":{"requestId":"req_1756256218375_d210879a1","selectedPipelineId":"gemini-cli-gemini-2.5-flash-key0","providerType":"gemini","geminiCondition1":"providerType === 'gemini-cli' → false","geminiCondition2":"serverCompatibility?.use === 'gemini-cli' → false","geminiCondition3":"protocol === 'gemini' → false","shouldUseGeminiTransformer":false,"matchingProvider":"NOT_FOUND","hasInput":true}}
{"timestamp":"2025-08-27T00:56:58.426Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756256218375_d210879a1","direction":"passthrough","outputSize":7}}
{"timestamp":"2025-08-27T00:56:58.437Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756256218375_d210879a1","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:56:58.442Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756256218375_d210879a1","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:56:58.447Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756256218375_d210879a1","errors":["Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等","检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"],"warnings":[],"summary":{"hasRequiredFields":true,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-27T00:56:58.452Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756256218375_d210879a1","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":34,"transformer":23},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:56:58.458Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756256218375_d210879a1","error":"Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式"}}
{"timestamp":"2025-08-27T00:56:58.470Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: Protocol层检测到非OpenAI标准字段: system。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: metadata。严禁任何自定义字段，包括__internal等, 检测到Anthropic特征字段: system，Protocol层必须是纯OpenAI格式\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:56:58.481Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:56:58.486Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:56:58.493Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:56:58.498Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:56:58.506Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:56:58.511Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:56:58.518Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:56:58.523Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:56:58.531Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:56:58.536Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:58:19.289Z","level":"INFO","message":"启用文件日志记录","data":{"port":5508,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-27T00:58:19.295Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-27T00:58:19.305Z","level":"INFO","message":"📋 Using standard routing format, no expansion needed"}
{"timestamp":"2025-08-27T00:58:19.308Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":1,"routerRules":6}}
{"timestamp":"2025-08-27T00:58:19.313Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-27T00:58:19.320Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:58:19.326Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:58:19.329Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:58:19.335Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":1,"serverPort":5508,"modulesInitialized":true}}
{"timestamp":"2025-08-27T00:58:19.341Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-27T00:58:19.344Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:58:19.349Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T00:58:19.355Z","level":"INFO","message":"使用Router配置驱动生成流水线"}
{"timestamp":"2025-08-27T00:58:19.358Z","level":"INFO","message":"路由类别 default 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:58:19.360Z","level":"INFO","message":"路由类别 longContext 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:58:19.363Z","level":"INFO","message":"路由类别 background 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:58:19.365Z","level":"INFO","message":"路由类别 think 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:58:19.367Z","level":"INFO","message":"路由类别 webSearch 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:58:19.369Z","level":"INFO","message":"路由类别 coding 生成了 1 个流水线"}
{"timestamp":"2025-08-27T00:58:19.372Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":6,"categoriesCount":6,"categories":["default","longContext","background","think","webSearch","coding"],"hasExpandedRouting":false}}
{"timestamp":"2025-08-27T00:58:19.376Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"]}}
{"timestamp":"2025-08-27T00:58:19.381Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:58:19.385Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T00:58:19.390Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5508,"host":"0.0.0.0"}}
{"timestamp":"2025-08-27T00:58:19.394Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":50,"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-27T00:58:19.399Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5508,"totalPipelines":6}}
{"timestamp":"2025-08-27T00:58:19.407Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"uptime":0}}
{"timestamp":"2025-08-27T00:58:19.411Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"initializationTime":50,"uptime":0}}
{"timestamp":"2025-08-27T00:58:19.416Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5508,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json"}}
{"timestamp":"2025-08-27T00:58:19.423Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:58:19.427Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:58:37.619Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:58:37.624Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:58:37.629Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:58:37.633Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:58:37.638Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:58:37.641Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:58:37.646Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756256317645_lrhpn6p6k","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:58:37.666Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:37.670Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756256317645_lrhpn6p6k","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:58:37.674Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:58:37.679Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:58:37.684Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756256317645_lrhpn6p6k","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:58:37.699Z","level":"INFO","message":"🔍 [TRANSFORMER LAYER] Detailed condition check","data":{"requestId":"req_1756256317645_lrhpn6p6k","selectedPipelineId":"gemini-cli-gemini-2.5-flash-key0","providerType":"gemini-cli","providerProtocol":"gemini","serverCompatibilityUse":"gemini-cli","geminiCondition1":"providerType === 'gemini-cli' → true","geminiCondition2":"serverCompatibility?.use === 'gemini-cli' → true","geminiCondition3":"protocol === 'gemini' → true","shouldUseGeminiTransformer":true,"matchingProvider":{"name":"gemini-cli","protocol":"gemini","serverCompatibility":{"use":"gemini-cli","options":{"maxTokens":"[REDACTED]","enhanceTool":true}}},"hasInput":true}}
{"timestamp":"2025-08-27T00:58:37.704Z","level":"INFO","message":"🔄 [TRANSFORMER LAYER] Using Gemini transformer","data":{"requestId":"req_1756256317645_lrhpn6p6k","providerType":"gemini-cli","reason":"providerType match"}}
{"timestamp":"2025-08-27T00:58:37.709Z","level":"INFO","message":"🔄 [TRANSFORMER LAYER] Calling SecureGeminiTransformer.process()","data":{"requestId":"req_1756256317645_lrhpn6p6k","inputType":"object","inputKeys":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:37.714Z","level":"INFO","message":"✅ [TRANSFORMER LAYER] Anthropic-to-Gemini transformation completed","data":{"requestId":"req_1756256317645_lrhpn6p6k","providerType":"gemini-cli","hasOutput":true,"outputType":"object","outputKeys":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:37.719Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756256317645_lrhpn6p6k","direction":"anthropic-to-gemini","outputSize":3}}
{"timestamp":"2025-08-27T00:58:37.729Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756256317645_lrhpn6p6k","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:58:37.734Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756256317645_lrhpn6p6k","errors":["缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-27T00:58:37.739Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756256317645_lrhpn6p6k","errors":["缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-27T00:58:37.744Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756256317645_lrhpn6p6k","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","stack":"Error: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":43,"transformer":36},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:58:37.748Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756256317645_lrhpn6p6k","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"}}
{"timestamp":"2025-08-27T00:58:37.759Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:58:37.774Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:58:37.778Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:58:37.783Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:58:37.788Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:58:37.794Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:58:37.797Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:58:37.802Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756256317802_9ypuhqgf9","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:58:37.857Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:37.862Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756256317802_9ypuhqgf9","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:58:37.867Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:58:37.871Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:58:37.875Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756256317802_9ypuhqgf9","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:58:37.896Z","level":"INFO","message":"🔍 [TRANSFORMER LAYER] Detailed condition check","data":{"requestId":"req_1756256317802_9ypuhqgf9","selectedPipelineId":"gemini-cli-gemini-2.5-flash-key0","providerType":"gemini-cli","providerProtocol":"gemini","serverCompatibilityUse":"gemini-cli","geminiCondition1":"providerType === 'gemini-cli' → true","geminiCondition2":"serverCompatibility?.use === 'gemini-cli' → true","geminiCondition3":"protocol === 'gemini' → true","shouldUseGeminiTransformer":true,"matchingProvider":{"name":"gemini-cli","protocol":"gemini","serverCompatibility":{"use":"gemini-cli","options":{"maxTokens":"[REDACTED]","enhanceTool":true}}},"hasInput":true}}
{"timestamp":"2025-08-27T00:58:37.901Z","level":"INFO","message":"🔄 [TRANSFORMER LAYER] Using Gemini transformer","data":{"requestId":"req_1756256317802_9ypuhqgf9","providerType":"gemini-cli","reason":"providerType match"}}
{"timestamp":"2025-08-27T00:58:37.906Z","level":"INFO","message":"🔄 [TRANSFORMER LAYER] Calling SecureGeminiTransformer.process()","data":{"requestId":"req_1756256317802_9ypuhqgf9","inputType":"object","inputKeys":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:37.911Z","level":"INFO","message":"✅ [TRANSFORMER LAYER] Anthropic-to-Gemini transformation completed","data":{"requestId":"req_1756256317802_9ypuhqgf9","providerType":"gemini-cli","hasOutput":true,"outputType":"object","outputKeys":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:37.915Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756256317802_9ypuhqgf9","direction":"anthropic-to-gemini","outputSize":3}}
{"timestamp":"2025-08-27T00:58:37.932Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756256317802_9ypuhqgf9","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:58:37.936Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756256317802_9ypuhqgf9","errors":["缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-27T00:58:37.941Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756256317802_9ypuhqgf9","errors":["缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-27T00:58:37.945Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756256317802_9ypuhqgf9","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","stack":"Error: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":77,"transformer":48},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:58:37.950Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756256317802_9ypuhqgf9","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"}}
{"timestamp":"2025-08-27T00:58:37.976Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:58:37.986Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:58:37.991Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:58:37.996Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:58:38.004Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:58:38.010Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:58:38.014Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:58:38.020Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756256318020_2qjib0qx4","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:58:38.030Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:38.035Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756256318020_2qjib0qx4","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:58:38.040Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:58:38.045Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:58:38.049Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756256318020_2qjib0qx4","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:58:38.064Z","level":"INFO","message":"🔍 [TRANSFORMER LAYER] Detailed condition check","data":{"requestId":"req_1756256318020_2qjib0qx4","selectedPipelineId":"gemini-cli-gemini-2.5-flash-key0","providerType":"gemini-cli","providerProtocol":"gemini","serverCompatibilityUse":"gemini-cli","geminiCondition1":"providerType === 'gemini-cli' → true","geminiCondition2":"serverCompatibility?.use === 'gemini-cli' → true","geminiCondition3":"protocol === 'gemini' → true","shouldUseGeminiTransformer":true,"matchingProvider":{"name":"gemini-cli","protocol":"gemini","serverCompatibility":{"use":"gemini-cli","options":{"maxTokens":"[REDACTED]","enhanceTool":true}}},"hasInput":true}}
{"timestamp":"2025-08-27T00:58:38.068Z","level":"INFO","message":"🔄 [TRANSFORMER LAYER] Using Gemini transformer","data":{"requestId":"req_1756256318020_2qjib0qx4","providerType":"gemini-cli","reason":"providerType match"}}
{"timestamp":"2025-08-27T00:58:38.073Z","level":"INFO","message":"🔄 [TRANSFORMER LAYER] Calling SecureGeminiTransformer.process()","data":{"requestId":"req_1756256318020_2qjib0qx4","inputType":"object","inputKeys":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:38.078Z","level":"INFO","message":"✅ [TRANSFORMER LAYER] Anthropic-to-Gemini transformation completed","data":{"requestId":"req_1756256318020_2qjib0qx4","providerType":"gemini-cli","hasOutput":true,"outputType":"object","outputKeys":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:38.083Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756256318020_2qjib0qx4","direction":"anthropic-to-gemini","outputSize":3}}
{"timestamp":"2025-08-27T00:58:38.092Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756256318020_2qjib0qx4","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:58:38.096Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756256318020_2qjib0qx4","errors":["缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-27T00:58:38.101Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756256318020_2qjib0qx4","errors":["缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-27T00:58:38.106Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756256318020_2qjib0qx4","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","stack":"Error: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":33,"transformer":34},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:58:38.111Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756256318020_2qjib0qx4","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"}}
{"timestamp":"2025-08-27T00:58:38.122Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:58:38.137Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:58:38.141Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:58:38.145Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:58:38.150Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:58:38.154Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:58:38.157Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:58:38.162Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756256318162_a1nmvtdgu","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:58:38.213Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:38.218Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756256318162_a1nmvtdgu","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:58:38.223Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:58:38.227Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:58:38.231Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756256318162_a1nmvtdgu","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:58:38.252Z","level":"INFO","message":"🔍 [TRANSFORMER LAYER] Detailed condition check","data":{"requestId":"req_1756256318162_a1nmvtdgu","selectedPipelineId":"gemini-cli-gemini-2.5-flash-key0","providerType":"gemini-cli","providerProtocol":"gemini","serverCompatibilityUse":"gemini-cli","geminiCondition1":"providerType === 'gemini-cli' → true","geminiCondition2":"serverCompatibility?.use === 'gemini-cli' → true","geminiCondition3":"protocol === 'gemini' → true","shouldUseGeminiTransformer":true,"matchingProvider":{"name":"gemini-cli","protocol":"gemini","serverCompatibility":{"use":"gemini-cli","options":{"maxTokens":"[REDACTED]","enhanceTool":true}}},"hasInput":true}}
{"timestamp":"2025-08-27T00:58:38.256Z","level":"INFO","message":"🔄 [TRANSFORMER LAYER] Using Gemini transformer","data":{"requestId":"req_1756256318162_a1nmvtdgu","providerType":"gemini-cli","reason":"providerType match"}}
{"timestamp":"2025-08-27T00:58:38.260Z","level":"INFO","message":"🔄 [TRANSFORMER LAYER] Calling SecureGeminiTransformer.process()","data":{"requestId":"req_1756256318162_a1nmvtdgu","inputType":"object","inputKeys":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:38.265Z","level":"INFO","message":"✅ [TRANSFORMER LAYER] Anthropic-to-Gemini transformation completed","data":{"requestId":"req_1756256318162_a1nmvtdgu","providerType":"gemini-cli","hasOutput":true,"outputType":"object","outputKeys":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:38.269Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756256318162_a1nmvtdgu","direction":"anthropic-to-gemini","outputSize":3}}
{"timestamp":"2025-08-27T00:58:38.285Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756256318162_a1nmvtdgu","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:58:38.290Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756256318162_a1nmvtdgu","errors":["缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-27T00:58:38.294Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756256318162_a1nmvtdgu","errors":["缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-27T00:58:38.298Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756256318162_a1nmvtdgu","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","stack":"Error: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":75,"transformer":44},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:58:38.303Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756256318162_a1nmvtdgu","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"}}
{"timestamp":"2025-08-27T00:58:38.329Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:58:38.339Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:58:38.344Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:58:38.353Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-27T00:58:38.358Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:58:38.363Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-27T00:58:38.368Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T00:58:38.373Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T00:58:38.376Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T00:58:38.381Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756256318381_q0mfav3m2","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-27T00:58:38.392Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:38.396Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756256318381_q0mfav3m2","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-27T00:58:38.401Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"gemini-cli,gemini-2.5-flash","allRoutes":["gemini-cli,gemini-2.5-flash"]}}
{"timestamp":"2025-08-27T00:58:38.405Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalCount":1}}
{"timestamp":"2025-08-27T00:58:38.410Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756256318381_q0mfav3m2","selectedPipeline":"gemini-cli-gemini-2.5-flash-key0","availablePipelines":["gemini-cli-gemini-2.5-flash-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-27T00:58:38.426Z","level":"INFO","message":"🔍 [TRANSFORMER LAYER] Detailed condition check","data":{"requestId":"req_1756256318381_q0mfav3m2","selectedPipelineId":"gemini-cli-gemini-2.5-flash-key0","providerType":"gemini-cli","providerProtocol":"gemini","serverCompatibilityUse":"gemini-cli","geminiCondition1":"providerType === 'gemini-cli' → true","geminiCondition2":"serverCompatibility?.use === 'gemini-cli' → true","geminiCondition3":"protocol === 'gemini' → true","shouldUseGeminiTransformer":true,"matchingProvider":{"name":"gemini-cli","protocol":"gemini","serverCompatibility":{"use":"gemini-cli","options":{"maxTokens":"[REDACTED]","enhanceTool":true}}},"hasInput":true}}
{"timestamp":"2025-08-27T00:58:38.431Z","level":"INFO","message":"🔄 [TRANSFORMER LAYER] Using Gemini transformer","data":{"requestId":"req_1756256318381_q0mfav3m2","providerType":"gemini-cli","reason":"providerType match"}}
{"timestamp":"2025-08-27T00:58:38.435Z","level":"INFO","message":"🔄 [TRANSFORMER LAYER] Calling SecureGeminiTransformer.process()","data":{"requestId":"req_1756256318381_q0mfav3m2","inputType":"object","inputKeys":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:38.441Z","level":"INFO","message":"✅ [TRANSFORMER LAYER] Anthropic-to-Gemini transformation completed","data":{"requestId":"req_1756256318381_q0mfav3m2","providerType":"gemini-cli","hasOutput":true,"outputType":"object","outputKeys":"[REDACTED]"}}
{"timestamp":"2025-08-27T00:58:38.446Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756256318381_q0mfav3m2","direction":"anthropic-to-gemini","outputSize":3}}
{"timestamp":"2025-08-27T00:58:38.456Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756256318381_q0mfav3m2","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-27T00:58:38.461Z","level":"ERROR","message":"❌ [格式验证] Transformer → Protocol 验证失败","data":{"requestId":"req_1756256318381_q0mfav3m2","errors":["缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-27T00:58:38.466Z","level":"ERROR","message":"❌ [Pipeline] Transformer输出格式验证失败","data":{"requestId":"req_1756256318381_q0mfav3m2","errors":["缺少必需字段：messages (array)","Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等","Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"],"warnings":[],"summary":{"hasRequiredFields":false,"hasValidStructure":false,"hasValidToolCalls":true,"fieldCount":3}}}
{"timestamp":"2025-08-27T00:58:38.471Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756256318381_q0mfav3m2","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","stack":"Error: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:233:23)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":33,"transformer":36},"errors":[{"layer":"pipeline","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","timestamp":{}}]}}
{"timestamp":"2025-08-27T00:58:38.476Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756256318381_q0mfav3m2","error":"Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等"}}
{"timestamp":"2025-08-27T00:58:38.488Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等","stack":"Error: Pipeline request processing failed: Transformer输出格式验证失败: 缺少必需字段：messages (array), Protocol层检测到非OpenAI标准字段: project。严禁任何自定义字段，包括__internal等, Protocol层检测到非OpenAI标准字段: request。严禁任何自定义字段，包括__internal等\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:460:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-27T00:58:38.498Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:58:38.502Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:58:38.509Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:58:38.513Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:58:38.520Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:58:38.525Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T00:58:38.532Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T00:58:38.536Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T01:26:00.306Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-27T01:26:00.309Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-27T01:26:00.312Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-27T01:26:00.315Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-27T01:26:00.318Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-27T01:26:00.321Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-27T01:26:00.324Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-27T01:26:00.326Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-27T01:26:00.329Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-27T01:26:00.332Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-27T01:26:00.334Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-27T01:26:00.337Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-27T01:26:01.341Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-27T01:26:02.905Z","level":"INFO","message":"启用文件日志记录","data":{"port":5508,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-27T01:26:02.920Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-27T01:26:02.937Z","level":"INFO","message":"📋 Using standard routing format, no expansion needed"}
{"timestamp":"2025-08-27T01:26:02.940Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":1,"routerRules":6}}
{"timestamp":"2025-08-27T01:26:02.946Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-27T01:26:02.953Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-27T01:26:02.958Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-27T01:26:02.961Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5508,"module":"console-capture"}}
{"timestamp":"2025-08-27T01:26:02.966Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":1,"serverPort":5508,"modulesInitialized":true}}
{"timestamp":"2025-08-27T01:26:02.971Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-27T01:26:02.974Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T01:26:02.979Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-27T01:26:02.984Z","level":"INFO","message":"使用Router配置驱动生成流水线"}
{"timestamp":"2025-08-27T01:26:02.986Z","level":"INFO","message":"路由类别 default 生成了 1 个流水线"}
{"timestamp":"2025-08-27T01:26:02.989Z","level":"INFO","message":"路由类别 longContext 生成了 1 个流水线"}
{"timestamp":"2025-08-27T01:26:02.991Z","level":"INFO","message":"路由类别 background 生成了 1 个流水线"}
{"timestamp":"2025-08-27T01:26:02.994Z","level":"INFO","message":"路由类别 think 生成了 1 个流水线"}
{"timestamp":"2025-08-27T01:26:02.996Z","level":"INFO","message":"路由类别 webSearch 生成了 1 个流水线"}
{"timestamp":"2025-08-27T01:26:02.999Z","level":"INFO","message":"路由类别 coding 生成了 1 个流水线"}
{"timestamp":"2025-08-27T01:26:03.001Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":6,"categoriesCount":6,"categories":["default","longContext","background","think","webSearch","coding"],"hasExpandedRouting":false}}
{"timestamp":"2025-08-27T01:26:03.006Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"]}}
{"timestamp":"2025-08-27T01:26:03.010Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T01:26:03.015Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-27T01:26:03.019Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5508,"host":"0.0.0.0"}}
{"timestamp":"2025-08-27T01:26:03.024Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":50,"totalPipelines":6,"virtualModels":["default","longContext","background","think","webSearch","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-27T01:26:03.028Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5508,"totalPipelines":6}}
{"timestamp":"2025-08-27T01:26:03.035Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"uptime":0}}
{"timestamp":"2025-08-27T01:26:03.040Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5508,"initializationTime":50,"uptime":0}}
{"timestamp":"2025-08-27T01:26:03.044Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5508,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/v4/single-provider/gemini-cli-v4-5508.json"}}
{"timestamp":"2025-08-27T01:26:03.052Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-27T01:26:03.056Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-27T04:47:23.291Z","level":"ERROR","message":"Uncaught exception","data":{"error":"write EPIPE"}}
