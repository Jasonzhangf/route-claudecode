{"timestamp":"2025-08-25T13:51:22.420Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-25T13:51:22.423Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-25T13:51:22.431Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-25T13:51:22.434Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-25T13:51:22.436Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-25T13:51:22.439Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-25T13:51:22.439Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-25T13:51:22.442Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-25T13:51:22.444Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-25T13:51:22.447Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-25T13:51:22.450Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T13:51:22.453Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-25T13:51:22.455Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-25T13:51:22.455Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-25T13:51:22.457Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-25T13:51:22.460Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-25T13:51:22.463Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-25T13:51:22.465Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-25T13:51:22.468Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-25T13:51:22.470Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-25T13:51:22.473Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-25T13:51:22.476Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":21,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-25T13:51:22.478Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-25T13:51:22.484Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-25T13:51:22.487Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":21,"uptime":0}}
{"timestamp":"2025-08-25T13:51:22.490Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-25T13:51:22.493Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T13:51:55.110Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-25T13:51:55.113Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:51:55.116Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:51:55.118Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T13:51:55.121Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756129915121_jv7p0cxnf","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-25T13:51:55.142Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:51:55.145Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756129915121_jv7p0cxnf","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-25T13:51:55.163Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756129915121_jv7p0cxnf","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-25T13:51:55.172Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756129915121_jv7p0cxnf","hasOutput":true}}
{"timestamp":"2025-08-25T13:51:55.174Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756129915121_jv7p0cxnf","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-25T13:51:55.184Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756129915121_jv7p0cxnf","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:51:55.186Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756129915121_jv7p0cxnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T13:51:55.188Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756129915121_jv7p0cxnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T13:51:55.205Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756129915121_jv7p0cxnf","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-25T13:51:55.215Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756129915121_jv7p0cxnf","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-25T13:51:55.217Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756129915121_jv7p0cxnf","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:51:55.231Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-25T13:51:55.234Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:51:55.236Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:51:55.238Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T13:51:55.240Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756129915240_kqti5vgbm","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-25T13:51:55.340Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:51:55.343Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756129915240_kqti5vgbm","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-25T13:51:55.375Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756129915240_kqti5vgbm","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-25T13:51:55.418Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756129915240_kqti5vgbm","hasOutput":true}}
{"timestamp":"2025-08-25T13:51:55.421Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756129915240_kqti5vgbm","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-25T13:51:55.446Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756129915240_kqti5vgbm","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:51:55.449Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756129915240_kqti5vgbm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:51:55.451Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756129915240_kqti5vgbm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:51:55.499Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756129915240_kqti5vgbm","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-25T13:51:55.525Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756129915240_kqti5vgbm","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-25T13:51:55.528Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756129915240_kqti5vgbm","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:51:55.531Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756129915240_kqti5vgbm","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-25T13:51:55.534Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756129915240_kqti5vgbm","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-25T13:51:55.558Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756129915240_kqti5vgbm","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:51:55.561Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756129915240_kqti5vgbm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:51:55.563Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756129915240_kqti5vgbm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:51:55.599Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":251522,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-25T13:51:55.604Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":251522,"timeout":30000}}
{"timestamp":"2025-08-25T13:51:55.607Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756129915121_jv7p0cxnf","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-25T13:51:55.610Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T13:51:55.613Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T13:51:55.617Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756129915121_jv7p0cxnf","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-25T13:51:55.619Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756129915121_jv7p0cxnf","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:51:55.622Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756129915121_jv7p0cxnf","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-25T13:51:55.624Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756129915121_jv7p0cxnf","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:51:55.626Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756129915121_jv7p0cxnf","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-25T13:51:55.629Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756129915121_jv7p0cxnf","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\"User-Agent\":\"google-api-nodejs-client/9.15.1\",\"X-Goog-Api-Client\":\"gl-node/22.17.0\",\"Client-Metadata\":\"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\"Accept\":\"application/json\"}"}}}
{"timestamp":"2025-08-25T13:51:55.631Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756129915121_jv7p0cxnf","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-25T13:51:55.634Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756129915121_jv7p0cxnf","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:51:55.636Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756129915121_jv7p0cxnf","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-25T13:51:55.646Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756129915121_jv7p0cxnf","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:51:55.648Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756129915121_jv7p0cxnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T13:51:55.651Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756129915121_jv7p0cxnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T13:51:55.662Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":543,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-25T13:51:56.485Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":450,"isLongTextRequest":false}}
{"timestamp":"2025-08-25T13:51:56.515Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756129915121_jv7p0cxnf","totalTime":1394,"layerTimings":{"router":31,"transformer":30,"protocol":15,"serverCompatibility":439,"server":847,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-25T13:51:56.525Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756129915121_jv7p0cxnf","executionId":"req_1756129915121_jv7p0cxnf","totalTime":1394,"success":true}}
{"timestamp":"2025-08-25T13:52:12.244Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":525,"isLongTextRequest":true}}
{"timestamp":"2025-08-25T13:52:12.288Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756129915240_kqti5vgbm","totalTime":17048,"layerTimings":{"router":109,"transformer":94,"protocol":46,"serverCompatibility":56,"server":16699,"responseTransform":23},"transformationCount":4}}
{"timestamp":"2025-08-25T13:52:12.337Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756129915240_kqti5vgbm","executionId":"req_1756129915240_kqti5vgbm","totalTime":17048,"success":true}}
{"timestamp":"2025-08-25T13:52:12.356Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-25T13:52:12.359Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:52:12.361Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:52:12.364Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T13:52:12.366Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756129932366_cyb8pcy7w","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-25T13:52:12.472Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:52:12.474Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756129932366_cyb8pcy7w","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-25T13:52:12.508Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756129932366_cyb8pcy7w","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-25T13:52:12.549Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756129932366_cyb8pcy7w","hasOutput":true}}
{"timestamp":"2025-08-25T13:52:12.552Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756129932366_cyb8pcy7w","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-25T13:52:12.576Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756129932366_cyb8pcy7w","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:52:12.579Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756129932366_cyb8pcy7w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:52:12.582Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756129932366_cyb8pcy7w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:52:12.630Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756129932366_cyb8pcy7w","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-25T13:52:12.656Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756129932366_cyb8pcy7w","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-25T13:52:12.658Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756129932366_cyb8pcy7w","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:52:12.661Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756129932366_cyb8pcy7w","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-25T13:52:12.664Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756129932366_cyb8pcy7w","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-25T13:52:12.690Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756129932366_cyb8pcy7w","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:52:12.692Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756129932366_cyb8pcy7w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:52:12.695Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756129932366_cyb8pcy7w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:52:12.732Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":251522,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-25T13:52:12.735Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":251522,"timeout":30000}}
{"timestamp":"2025-08-25T13:52:12.737Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T13:52:28.950Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":583,"isLongTextRequest":true}}
{"timestamp":"2025-08-25T13:52:29.005Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756129932366_cyb8pcy7w","totalTime":16639,"layerTimings":{"router":117,"transformer":91,"protocol":45,"serverCompatibility":57,"server":16281,"responseTransform":27},"transformationCount":4}}
{"timestamp":"2025-08-25T13:52:29.053Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756129932366_cyb8pcy7w","executionId":"req_1756129932366_cyb8pcy7w","totalTime":16639,"success":true}}
{"timestamp":"2025-08-25T13:52:59.237Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-25T13:52:59.240Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:52:59.242Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:52:59.245Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T13:52:59.248Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756129979248_7seilpe2d","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-25T13:52:59.348Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:52:59.350Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756129979248_7seilpe2d","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-25T13:52:59.383Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756129979248_7seilpe2d","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-25T13:52:59.427Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756129979248_7seilpe2d","hasOutput":true}}
{"timestamp":"2025-08-25T13:52:59.429Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756129979248_7seilpe2d","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-25T13:52:59.453Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756129979248_7seilpe2d","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:52:59.456Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756129979248_7seilpe2d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:52:59.459Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756129979248_7seilpe2d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:52:59.506Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756129979248_7seilpe2d","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-25T13:52:59.531Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756129979248_7seilpe2d","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-25T13:52:59.534Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756129979248_7seilpe2d","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:52:59.536Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756129979248_7seilpe2d","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-25T13:52:59.538Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756129979248_7seilpe2d","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-25T13:52:59.562Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756129979248_7seilpe2d","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:52:59.565Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756129979248_7seilpe2d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:52:59.567Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756129979248_7seilpe2d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:52:59.602Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":252044,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-25T13:52:59.605Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":252044,"timeout":30000}}
{"timestamp":"2025-08-25T13:52:59.608Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T13:53:07.524Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true}}
{"timestamp":"2025-08-25T13:53:07.576Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756129979248_7seilpe2d","totalTime":8328,"layerTimings":{"router":109,"transformer":94,"protocol":45,"serverCompatibility":53,"server":7986,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-25T13:53:07.625Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756129979248_7seilpe2d","executionId":"req_1756129979248_7seilpe2d","totalTime":8328,"success":true}}
{"timestamp":"2025-08-25T13:53:07.644Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-25T13:53:07.647Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:53:07.650Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:53:07.652Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T13:53:07.655Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756129987655_lpk6yo4v5","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-25T13:53:07.754Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:53:07.756Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756129987655_lpk6yo4v5","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-25T13:53:07.788Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756129987655_lpk6yo4v5","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-25T13:53:07.833Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756129987655_lpk6yo4v5","hasOutput":true}}
{"timestamp":"2025-08-25T13:53:07.836Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756129987655_lpk6yo4v5","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-25T13:53:07.861Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756129987655_lpk6yo4v5","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:53:07.863Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756129987655_lpk6yo4v5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:07.866Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756129987655_lpk6yo4v5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:07.911Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756129987655_lpk6yo4v5","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-25T13:53:07.936Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756129987655_lpk6yo4v5","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-25T13:53:07.938Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756129987655_lpk6yo4v5","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:53:07.940Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756129987655_lpk6yo4v5","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-25T13:53:07.943Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756129987655_lpk6yo4v5","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-25T13:53:07.968Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756129987655_lpk6yo4v5","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:53:07.971Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756129987655_lpk6yo4v5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:07.973Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756129987655_lpk6yo4v5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:08.010Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":252044,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-25T13:53:08.012Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":252044,"timeout":30000}}
{"timestamp":"2025-08-25T13:53:08.015Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T13:53:23.950Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":553,"isLongTextRequest":true}}
{"timestamp":"2025-08-25T13:53:23.997Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756129987655_lpk6yo4v5","totalTime":16342,"layerTimings":{"router":108,"transformer":96,"protocol":43,"serverCompatibility":54,"server":15999,"responseTransform":22},"transformationCount":4}}
{"timestamp":"2025-08-25T13:53:24.044Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756129987655_lpk6yo4v5","executionId":"req_1756129987655_lpk6yo4v5","totalTime":16342,"success":true}}
{"timestamp":"2025-08-25T13:53:29.517Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-25T13:53:29.520Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:53:29.523Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:53:29.525Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T13:53:29.528Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756130009528_m2nlrnxz8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-25T13:53:29.628Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:53:29.630Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756130009528_m2nlrnxz8","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-25T13:53:29.662Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756130009528_m2nlrnxz8","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-25T13:53:29.709Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756130009528_m2nlrnxz8","hasOutput":true}}
{"timestamp":"2025-08-25T13:53:29.711Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756130009528_m2nlrnxz8","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-25T13:53:29.735Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756130009528_m2nlrnxz8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:53:29.738Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756130009528_m2nlrnxz8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:29.740Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756130009528_m2nlrnxz8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:29.786Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756130009528_m2nlrnxz8","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-25T13:53:29.813Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756130009528_m2nlrnxz8","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-25T13:53:29.816Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756130009528_m2nlrnxz8","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:53:29.819Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756130009528_m2nlrnxz8","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-25T13:53:29.821Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756130009528_m2nlrnxz8","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-25T13:53:29.849Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756130009528_m2nlrnxz8","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:53:29.852Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756130009528_m2nlrnxz8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:29.855Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756130009528_m2nlrnxz8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:29.895Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":257662,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-25T13:53:29.898Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":257662,"timeout":30000}}
{"timestamp":"2025-08-25T13:53:29.902Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T13:53:44.641Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":611,"isLongTextRequest":true}}
{"timestamp":"2025-08-25T13:53:44.702Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756130009528_m2nlrnxz8","totalTime":15174,"layerTimings":{"router":110,"transformer":95,"protocol":43,"serverCompatibility":60,"server":14816,"responseTransform":29},"transformationCount":4}}
{"timestamp":"2025-08-25T13:53:44.752Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756130009528_m2nlrnxz8","executionId":"req_1756130009528_m2nlrnxz8","totalTime":15174,"success":true}}
{"timestamp":"2025-08-25T13:53:44.771Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-25T13:53:44.773Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:53:44.776Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T13:53:44.778Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T13:53:44.781Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756130024781_2ioiehmum","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-25T13:53:44.880Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:53:44.883Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756130024781_2ioiehmum","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-25T13:53:44.915Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756130024781_2ioiehmum","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-25T13:53:44.963Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756130024781_2ioiehmum","hasOutput":true}}
{"timestamp":"2025-08-25T13:53:44.965Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756130024781_2ioiehmum","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-25T13:53:44.990Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756130024781_2ioiehmum","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:53:44.992Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756130024781_2ioiehmum","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:44.994Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756130024781_2ioiehmum","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:45.040Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756130024781_2ioiehmum","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-25T13:53:45.067Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756130024781_2ioiehmum","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-25T13:53:45.070Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756130024781_2ioiehmum","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T13:53:45.072Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756130024781_2ioiehmum","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-25T13:53:45.075Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756130024781_2ioiehmum","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-25T13:53:45.099Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756130024781_2ioiehmum","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T13:53:45.102Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756130024781_2ioiehmum","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:45.104Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756130024781_2ioiehmum","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-25T13:53:45.140Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":257662,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-25T13:53:45.144Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":257662,"timeout":30000}}
{"timestamp":"2025-08-25T13:53:45.146Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T13:54:14.590Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true}}
{"timestamp":"2025-08-25T13:54:14.625Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756130024781_2ioiehmum","totalTime":29844,"layerTimings":{"router":109,"transformer":98,"protocol":43,"serverCompatibility":56,"server":29502,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-25T13:54:14.672Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756130024781_2ioiehmum","executionId":"req_1756130024781_2ioiehmum","totalTime":29844,"success":true}}
{"timestamp":"2025-08-25T14:39:56.370Z","level":"INFO","message":"Received SIGINT, exiting gracefully"}
{"timestamp":"2025-08-25T14:39:56.371Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-25T14:39:56.372Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-25T14:39:56.372Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-25T14:39:56.372Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-25T14:39:56.373Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-25T14:39:56.373Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-25T14:39:56.373Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-25T14:39:56.374Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-25T14:39:56.374Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-25T14:39:56.374Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-25T14:39:56.374Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-25T14:39:57.375Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-25T14:40:06.976Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-25T14:40:06.983Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-25T14:40:06.993Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-25T14:40:06.998Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-25T14:40:07.004Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-25T14:40:07.009Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-25T14:40:07.012Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-25T14:40:07.017Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-25T14:40:07.023Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-25T14:40:07.028Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-25T14:40:07.033Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T14:40:07.038Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-25T14:40:07.042Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-25T14:40:07.045Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-25T14:40:07.050Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-25T14:40:07.055Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-25T14:40:07.060Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-25T14:40:07.065Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-25T14:40:07.070Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-25T14:40:07.074Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-25T14:40:07.079Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-25T14:40:07.084Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":39,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-25T14:40:07.089Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-25T14:40:07.098Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-25T14:40:07.103Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":39,"uptime":0}}
{"timestamp":"2025-08-25T14:40:07.107Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-25T14:40:07.113Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T14:49:49.361Z","level":"INFO","message":"接收到chat/completions请求","data":{"method":"POST","url":"/v1/chat/completions","hasBody":true}}
{"timestamp":"2025-08-25T14:49:49.368Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"openai","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T14:49:49.374Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T14:49:49.381Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756133389381_xaszdzbw0","protocol":"openai","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-25T14:49:49.410Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-haiku","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-25T14:49:49.415Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756133389381_xaszdzbw0","inputModel":"claude-3-haiku","mappedModel":"default"}}
{"timestamp":"2025-08-25T14:49:49.439Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756133389381_xaszdzbw0","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-25T14:49:49.449Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756133389381_xaszdzbw0","hasOutput":true}}
{"timestamp":"2025-08-25T14:49:49.455Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756133389381_xaszdzbw0","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-25T14:49:49.469Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756133389381_xaszdzbw0","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T14:49:49.475Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756133389381_xaszdzbw0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T14:49:49.480Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756133389381_xaszdzbw0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T14:49:49.501Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756133389381_xaszdzbw0","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-25T14:49:49.514Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756133389381_xaszdzbw0","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-25T14:49:49.519Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756133389381_xaszdzbw0","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T14:49:49.525Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756133389381_xaszdzbw0","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-25T14:49:49.531Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T14:49:49.536Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756133389381_xaszdzbw0","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-25T14:49:49.541Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756133389381_xaszdzbw0","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T14:49:49.546Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756133389381_xaszdzbw0","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-25T14:49:49.552Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756133389381_xaszdzbw0","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-25T14:49:49.558Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756133389381_xaszdzbw0","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-25T14:49:49.564Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756133389381_xaszdzbw0","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\"User-Agent\":\"google-api-nodejs-client/9.15.1\",\"X-Goog-Api-Client\":\"gl-node/22.17.0\",\"Client-Metadata\":\"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\"Accept\":\"application/json\"}"}}}
{"timestamp":"2025-08-25T14:49:49.570Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756133389381_xaszdzbw0","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-25T14:49:49.575Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756133389381_xaszdzbw0","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T14:49:49.581Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756133389381_xaszdzbw0","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-25T14:49:49.595Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756133389381_xaszdzbw0","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T14:49:49.599Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756133389381_xaszdzbw0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T14:49:49.604Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756133389381_xaszdzbw0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T14:49:49.623Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":169,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-25T14:49:50.363Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":449,"isLongTextRequest":false}}
{"timestamp":"2025-08-25T14:49:50.399Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756133389381_xaszdzbw0","totalTime":1018,"layerTimings":{"router":42,"transformer":39,"protocol":15,"serverCompatibility":89,"server":774,"responseTransform":16},"transformationCount":3}}
{"timestamp":"2025-08-25T14:49:50.412Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756133389381_xaszdzbw0","executionId":"req_1756133389381_xaszdzbw0","totalTime":1018,"success":true}}
{"timestamp":"2025-08-25T14:52:14.813Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-25T14:52:14.817Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-25T14:52:14.820Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-25T14:52:14.824Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-25T14:52:14.827Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-25T14:52:14.831Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-25T14:52:14.834Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-25T14:52:14.838Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-25T14:52:14.841Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-25T14:52:14.844Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-25T14:52:14.846Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-25T14:52:14.849Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-25T14:52:15.853Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-25T14:55:14.279Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-25T14:55:14.285Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-25T14:55:14.297Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-25T14:55:14.302Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-25T14:55:14.307Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-25T14:55:14.312Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-25T14:55:14.314Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-25T14:55:14.319Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-25T14:55:14.325Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-25T14:55:14.331Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-25T14:55:14.338Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T14:55:14.344Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-25T14:55:14.349Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-25T14:55:14.351Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-25T14:55:14.356Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-25T14:55:14.360Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-25T14:55:14.366Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-25T14:55:14.370Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-25T14:55:14.375Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-25T14:55:14.380Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-25T14:55:14.385Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-25T14:55:14.390Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":39,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-25T14:55:14.395Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-25T14:55:14.402Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-25T14:55:14.407Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":39,"uptime":0}}
{"timestamp":"2025-08-25T14:55:14.412Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-25T14:55:14.417Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T14:56:07.723Z","level":"INFO","message":"接收到chat/completions请求","data":{"method":"POST","url":"/v1/chat/completions","hasBody":true}}
{"timestamp":"2025-08-25T14:56:07.730Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"openai","hasInput":true,"router":true}}
{"timestamp":"2025-08-25T14:56:07.736Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T14:56:07.743Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756133767743_7iw8f5vbo","protocol":"openai","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-25T14:56:07.769Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-haiku","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-25T14:56:07.775Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756133767743_7iw8f5vbo","inputModel":"claude-3-haiku","mappedModel":"default"}}
{"timestamp":"2025-08-25T14:56:07.798Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756133767743_7iw8f5vbo","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-25T14:56:07.807Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756133767743_7iw8f5vbo","hasOutput":true}}
{"timestamp":"2025-08-25T14:56:07.812Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756133767743_7iw8f5vbo","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-25T14:56:07.825Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756133767743_7iw8f5vbo","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T14:56:07.830Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756133767743_7iw8f5vbo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T14:56:07.835Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756133767743_7iw8f5vbo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T14:56:07.856Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756133767743_7iw8f5vbo","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-25T14:56:07.867Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756133767743_7iw8f5vbo","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-25T14:56:07.872Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756133767743_7iw8f5vbo","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T14:56:07.878Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756133767743_7iw8f5vbo","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-25T14:56:07.883Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-25T14:56:07.888Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756133767743_7iw8f5vbo","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-25T14:56:07.893Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756133767743_7iw8f5vbo","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T14:56:07.897Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756133767743_7iw8f5vbo","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-25T14:56:07.901Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756133767743_7iw8f5vbo","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-25T14:56:07.905Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756133767743_7iw8f5vbo","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-25T14:56:07.910Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756133767743_7iw8f5vbo","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\"User-Agent\":\"google-api-nodejs-client/9.15.1\",\"X-Goog-Api-Client\":\"gl-node/22.17.0\",\"Client-Metadata\":\"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\"Accept\":\"application/json\"}"}}}
{"timestamp":"2025-08-25T14:56:07.914Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756133767743_7iw8f5vbo","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-25T14:56:07.919Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756133767743_7iw8f5vbo","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-25T14:56:07.923Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756133767743_7iw8f5vbo","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-25T14:56:07.936Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756133767743_7iw8f5vbo","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-25T14:56:07.941Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756133767743_7iw8f5vbo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T14:56:07.945Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756133767743_7iw8f5vbo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-25T14:56:07.959Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":173,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-25T14:56:08.693Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":451,"isLongTextRequest":false}}
{"timestamp":"2025-08-25T14:56:08.744Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756133767743_7iw8f5vbo","totalTime":1001,"layerTimings":{"router":40,"transformer":36,"protocol":15,"serverCompatibility":76,"server":773,"responseTransform":21},"transformationCount":3}}
{"timestamp":"2025-08-25T14:56:08.755Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756133767743_7iw8f5vbo","executionId":"req_1756133767743_7iw8f5vbo","totalTime":1001,"success":true}}
{"timestamp":"2025-08-25T15:00:43.844Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-25T15:00:43.847Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-25T15:00:43.850Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-25T15:00:43.852Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-25T15:00:43.855Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-25T15:00:43.858Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-25T15:00:43.860Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-25T15:00:43.863Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-25T15:00:43.865Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-25T15:00:43.868Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-25T15:00:43.871Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-25T15:00:43.873Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-25T15:00:44.878Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-25T15:04:14.297Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-25T15:04:14.303Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-25T15:04:14.315Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-25T15:04:14.320Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-25T15:04:14.325Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-25T15:04:14.330Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-25T15:04:14.333Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-25T15:04:14.338Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-25T15:04:14.344Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-25T15:04:14.349Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-25T15:04:14.356Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-25T15:04:14.361Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-25T15:04:14.439Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-25T15:04:14.531Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-25T15:04:14.625Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-25T15:04:14.726Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-25T15:04:14.822Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-25T15:04:14.879Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-25T15:04:15.026Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-25T15:04:15.168Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-25T15:04:15.324Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-25T15:04:16.342Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-25T15:04:16.495Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":1870,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-25T15:04:16.646Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-25T15:04:17.698Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-25T15:04:17.864Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":1870,"uptime":0}}
{"timestamp":"2025-08-25T15:04:18.027Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-25T15:04:18.463Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:03:44.762Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T00:03:44.947Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T00:03:45.087Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T00:03:45.226Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T00:03:45.362Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T00:03:45.529Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T00:03:45.595Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T00:03:45.661Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T00:03:45.727Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T00:03:45.794Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T00:03:45.925Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T00:03:46.056Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T00:03:47.186Z","level":"INFO","message":"优雅关闭完成"}
