{"timestamp":"2025-08-26T00:03:47.377Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T00:03:47.383Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T00:03:47.395Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T00:03:47.401Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T00:03:47.406Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T00:03:47.411Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T00:03:47.414Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T00:03:47.418Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T00:03:47.423Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T00:03:47.428Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T00:03:47.433Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:03:47.438Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:03:47.444Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T00:03:47.450Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T00:03:47.452Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T00:03:47.458Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T00:03:47.463Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T00:03:47.469Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T00:03:47.474Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T00:03:47.480Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T00:03:47.485Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T00:03:47.491Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T00:03:47.497Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":45,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T00:03:47.502Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T00:03:47.512Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T00:03:47.518Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":45,"uptime":0}}
{"timestamp":"2025-08-26T00:03:47.524Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T00:03:47.530Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:08.208Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:08.215Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:08.221Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:08.227Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:08.234Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:08.240Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166648240_mjwx6kiuw","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:08.267Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:08.273Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166648240_mjwx6kiuw","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T00:04:08.296Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166648240_mjwx6kiuw","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:08.311Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166648240_mjwx6kiuw","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:08.317Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166648240_mjwx6kiuw","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T00:04:08.330Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166648240_mjwx6kiuw","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:08.336Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166648240_mjwx6kiuw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:08.340Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166648240_mjwx6kiuw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:08.363Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166648240_mjwx6kiuw","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:08.376Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166648240_mjwx6kiuw","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:08.382Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166648240_mjwx6kiuw","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:08.389Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166648240_mjwx6kiuw","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:08.394Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:08.400Z","level":"INFO","message":"Qwen token即将过期，开始刷新","data":{"authFileName":"[REDACTED]","expiresAt":"2025-08-25T17:49:46.295Z"}}
{"timestamp":"2025-08-26T00:04:08.937Z","level":"INFO","message":"Qwen token刷新成功","data":{"accountIndex":3,"newExpiresAt":"2025-08-26T06:04:08.937Z","hasNewResourceUrl":true}}
{"timestamp":"2025-08-26T00:04:08.948Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756166648240_mjwx6kiuw","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T00:04:08.954Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756166648240_mjwx6kiuw","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:08.961Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756166648240_mjwx6kiuw","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T00:04:08.966Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756166648240_mjwx6kiuw","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:08.977Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756166648240_mjwx6kiuw","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T00:04:08.986Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756166648240_mjwx6kiuw","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T00:04:08.993Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756166648240_mjwx6kiuw","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T00:04:08.999Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756166648240_mjwx6kiuw","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:09.006Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166648240_mjwx6kiuw","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:09.021Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166648240_mjwx6kiuw","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:09.027Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166648240_mjwx6kiuw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:09.033Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166648240_mjwx6kiuw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:09.051Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":1400,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T00:04:10.060Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":479,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T00:04:10.125Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166648240_mjwx6kiuw","totalTime":1885,"layerTimings":{"router":41,"transformer":43,"protocol":17,"serverCompatibility":653,"server":1061,"responseTransform":25},"transformationCount":4}}
{"timestamp":"2025-08-26T00:04:10.142Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166648240_mjwx6kiuw","executionId":"req_1756166648240_mjwx6kiuw","totalTime":1885,"success":true}}
{"timestamp":"2025-08-26T00:04:14.059Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:14.066Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:14.072Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:14.077Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:14.084Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:14.090Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166654090_vi8xgrhwg","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:14.106Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.112Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166654090_vi8xgrhwg","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T00:04:14.135Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166654090_vi8xgrhwg","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:14.148Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166654090_vi8xgrhwg","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:14.153Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166654090_vi8xgrhwg","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T00:04:14.165Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166654090_vi8xgrhwg","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:14.170Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166654090_vi8xgrhwg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:14.176Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166654090_vi8xgrhwg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:14.197Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166654090_vi8xgrhwg","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:14.209Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166654090_vi8xgrhwg","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:14.214Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166654090_vi8xgrhwg","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.220Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166654090_vi8xgrhwg","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:14.233Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:14.238Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:14.243Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:14.248Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:14.253Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:14.259Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166654259_1gn93pqml","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:14.356Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.361Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166654259_1gn93pqml","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:04:14.389Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166654259_1gn93pqml","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:14.410Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166654259_1gn93pqml","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:14.416Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166654259_1gn93pqml","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:04:14.440Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166654259_1gn93pqml","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:14.446Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166654259_1gn93pqml","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:14.450Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166654259_1gn93pqml","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:14.493Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166654259_1gn93pqml","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:14.515Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166654259_1gn93pqml","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:14.521Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166654259_1gn93pqml","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.526Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166654259_1gn93pqml","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:14.532Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166654259_1gn93pqml","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:14.553Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166654259_1gn93pqml","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:14.559Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166654259_1gn93pqml","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:14.565Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166654259_1gn93pqml","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:14.594Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":123733,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:14.600Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":123733,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:14.605Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:14.610Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:14.616Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756166654090_vi8xgrhwg","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T00:04:14.622Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756166654090_vi8xgrhwg","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.627Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756166654090_vi8xgrhwg","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T00:04:14.632Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756166654090_vi8xgrhwg","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.641Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756166654090_vi8xgrhwg","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T00:04:14.649Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756166654090_vi8xgrhwg","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T00:04:14.654Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756166654090_vi8xgrhwg","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T00:04:14.659Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756166654090_vi8xgrhwg","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.663Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166654090_vi8xgrhwg","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:14.676Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166654090_vi8xgrhwg","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:14.681Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166654090_vi8xgrhwg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:14.686Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166654090_vi8xgrhwg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:14.701Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":798,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T00:04:15.476Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":466,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T00:04:15.539Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166654090_vi8xgrhwg","totalTime":1449,"layerTimings":{"router":30,"transformer":38,"protocol":15,"serverCompatibility":474,"server":823,"responseTransform":25},"transformationCount":4}}
{"timestamp":"2025-08-26T00:04:15.554Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166654090_vi8xgrhwg","executionId":"req_1756166654090_vi8xgrhwg","totalTime":1449,"success":true}}
{"timestamp":"2025-08-26T00:04:24.946Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":943,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:04:24.988Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166654259_1gn93pqml","totalTime":10729,"layerTimings":{"router":108,"transformer":68,"protocol":37,"serverCompatibility":55,"server":10401,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:04:25.021Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166654259_1gn93pqml","executionId":"req_1756166654259_1gn93pqml","totalTime":10729,"success":true}}
{"timestamp":"2025-08-26T00:04:25.039Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:25.046Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:25.051Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:25.057Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:25.064Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:25.071Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166665071_g8a8ww4mo","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:25.187Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:25.193Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166665071_g8a8ww4mo","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:04:25.226Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166665071_g8a8ww4mo","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:25.249Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166665071_g8a8ww4mo","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:25.255Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166665071_g8a8ww4mo","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:04:25.280Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166665071_g8a8ww4mo","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:25.285Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166665071_g8a8ww4mo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:25.291Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166665071_g8a8ww4mo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:25.335Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166665071_g8a8ww4mo","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:25.360Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166665071_g8a8ww4mo","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:25.366Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166665071_g8a8ww4mo","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:25.372Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166665071_g8a8ww4mo","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:25.378Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166665071_g8a8ww4mo","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:25.403Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166665071_g8a8ww4mo","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:25.409Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166665071_g8a8ww4mo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:25.415Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166665071_g8a8ww4mo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:25.451Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":123733,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:25.457Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":123733,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:25.463Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:40.802Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":2793,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:04:40.843Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166665071_g8a8ww4mo","totalTime":15772,"layerTimings":{"router":131,"transformer":72,"protocol":38,"serverCompatibility":62,"server":15401,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T00:04:40.872Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166665071_g8a8ww4mo","executionId":"req_1756166665071_g8a8ww4mo","totalTime":15772,"success":true}}
{"timestamp":"2025-08-26T00:04:41.071Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:41.078Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:41.083Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:41.088Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:41.095Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:41.100Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166681100_zsdq3b4fb","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:41.206Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:41.211Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166681100_zsdq3b4fb","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:04:41.241Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166681100_zsdq3b4fb","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:41.269Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166681100_zsdq3b4fb","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:41.274Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166681100_zsdq3b4fb","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:04:41.296Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166681100_zsdq3b4fb","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:41.302Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166681100_zsdq3b4fb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:41.308Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166681100_zsdq3b4fb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:41.351Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166681100_zsdq3b4fb","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:41.375Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166681100_zsdq3b4fb","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:41.380Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166681100_zsdq3b4fb","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:41.385Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166681100_zsdq3b4fb","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:41.392Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166681100_zsdq3b4fb","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:41.415Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166681100_zsdq3b4fb","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:41.420Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166681100_zsdq3b4fb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:41.426Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166681100_zsdq3b4fb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:41.457Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":126062,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:41.463Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":126062,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:41.470Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:50.519Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1296,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:04:50.563Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166681100_zsdq3b4fb","totalTime":9463,"layerTimings":{"router":117,"transformer":73,"protocol":37,"serverCompatibility":58,"server":9113,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T00:04:50.594Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166681100_zsdq3b4fb","executionId":"req_1756166681100_zsdq3b4fb","totalTime":9463,"success":true}}
{"timestamp":"2025-08-26T00:04:50.612Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:50.618Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:50.623Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:50.629Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:50.636Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:50.642Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166690642_x8bawebdl","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:50.744Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:50.749Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166690642_x8bawebdl","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:04:50.782Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166690642_x8bawebdl","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:50.811Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166690642_x8bawebdl","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:50.816Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166690642_x8bawebdl","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:04:50.840Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166690642_x8bawebdl","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:50.846Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166690642_x8bawebdl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:50.851Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166690642_x8bawebdl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:50.893Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166690642_x8bawebdl","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:50.919Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166690642_x8bawebdl","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:50.925Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166690642_x8bawebdl","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:50.931Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166690642_x8bawebdl","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:50.938Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166690642_x8bawebdl","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:50.962Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166690642_x8bawebdl","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:50.967Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166690642_x8bawebdl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:50.972Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166690642_x8bawebdl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:51.003Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":126062,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:51.009Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":126062,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:51.015Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:05:00.304Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1310,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:05:00.343Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166690642_x8bawebdl","totalTime":9701,"layerTimings":{"router":116,"transformer":77,"protocol":36,"serverCompatibility":62,"server":9347,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:05:00.374Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166690642_x8bawebdl","executionId":"req_1756166690642_x8bawebdl","totalTime":9701,"success":true}}
{"timestamp":"2025-08-26T00:05:00.566Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:05:00.572Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:00.578Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:00.584Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:05:00.591Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:05:00.597Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166700597_gn3r1ms5l","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:05:00.705Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:00.711Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166700597_gn3r1ms5l","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:05:00.742Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166700597_gn3r1ms5l","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:05:00.778Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166700597_gn3r1ms5l","hasOutput":true}}
{"timestamp":"2025-08-26T00:05:00.783Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166700597_gn3r1ms5l","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:05:00.807Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166700597_gn3r1ms5l","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:00.813Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166700597_gn3r1ms5l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:00.818Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166700597_gn3r1ms5l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:00.859Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166700597_gn3r1ms5l","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:05:00.883Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166700597_gn3r1ms5l","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:05:00.889Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166700597_gn3r1ms5l","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:00.895Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166700597_gn3r1ms5l","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:05:00.902Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166700597_gn3r1ms5l","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:05:00.924Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166700597_gn3r1ms5l","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:00.930Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166700597_gn3r1ms5l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:00.935Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166700597_gn3r1ms5l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:00.966Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":128276,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:00.972Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":128276,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:00.977Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:05:07.469Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":530,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:05:07.509Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166700597_gn3r1ms5l","totalTime":6912,"layerTimings":{"router":121,"transformer":84,"protocol":36,"serverCompatibility":59,"server":6551,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:05:07.542Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166700597_gn3r1ms5l","executionId":"req_1756166700597_gn3r1ms5l","totalTime":6912,"success":true}}
{"timestamp":"2025-08-26T00:05:07.562Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:05:07.568Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:07.574Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:07.580Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:05:07.587Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:05:07.594Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166707594_yly06hvvd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:05:07.697Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:07.703Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166707594_yly06hvvd","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:05:07.734Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166707594_yly06hvvd","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:05:07.771Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166707594_yly06hvvd","hasOutput":true}}
{"timestamp":"2025-08-26T00:05:07.776Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166707594_yly06hvvd","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:05:07.799Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166707594_yly06hvvd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:07.805Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166707594_yly06hvvd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:07.810Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166707594_yly06hvvd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:07.852Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166707594_yly06hvvd","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:05:07.876Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166707594_yly06hvvd","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:05:07.881Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166707594_yly06hvvd","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:07.887Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166707594_yly06hvvd","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:05:07.895Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166707594_yly06hvvd","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:05:07.920Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166707594_yly06hvvd","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:07.926Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166707594_yly06hvvd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:07.931Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166707594_yly06hvvd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:07.963Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":128276,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:07.969Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":128276,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:07.976Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:05:12.578Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":533,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:05:12.621Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166707594_yly06hvvd","totalTime":5027,"layerTimings":{"router":117,"transformer":83,"protocol":37,"serverCompatibility":63,"server":4666,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:05:12.656Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166707594_yly06hvvd","executionId":"req_1756166707594_yly06hvvd","totalTime":5027,"success":true}}
{"timestamp":"2025-08-26T00:05:18.108Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:05:18.114Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:18.119Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:18.125Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:05:18.132Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:05:18.139Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166718139_9h57035ir","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:05:18.243Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:18.248Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166718139_9h57035ir","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:05:18.280Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166718139_9h57035ir","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:05:18.328Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166718139_9h57035ir","hasOutput":true}}
{"timestamp":"2025-08-26T00:05:18.334Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166718139_9h57035ir","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:05:18.359Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166718139_9h57035ir","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:18.365Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166718139_9h57035ir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:18.370Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166718139_9h57035ir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:18.414Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166718139_9h57035ir","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:05:18.440Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166718139_9h57035ir","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:05:18.445Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166718139_9h57035ir","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:18.451Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166718139_9h57035ir","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:05:18.459Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166718139_9h57035ir","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:05:18.484Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166718139_9h57035ir","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:18.490Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166718139_9h57035ir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:18.496Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166718139_9h57035ir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:18.530Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":133832,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:18.536Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":133832,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:18.542Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:05:27.485Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1405,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:05:27.532Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166718139_9h57035ir","totalTime":9393,"layerTimings":{"router":117,"transformer":98,"protocol":39,"serverCompatibility":64,"server":9013,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:05:27.564Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166718139_9h57035ir","executionId":"req_1756166718139_9h57035ir","totalTime":9393,"success":true}}
{"timestamp":"2025-08-26T00:05:27.582Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:05:27.587Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:27.594Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:27.600Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:05:27.607Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:05:27.613Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166727613_gegxan1t8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:05:27.720Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:27.726Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166727613_gegxan1t8","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:05:27.758Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166727613_gegxan1t8","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:05:27.805Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166727613_gegxan1t8","hasOutput":true}}
{"timestamp":"2025-08-26T00:05:27.811Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166727613_gegxan1t8","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:05:27.834Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166727613_gegxan1t8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:27.839Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166727613_gegxan1t8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:27.845Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166727613_gegxan1t8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:27.889Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166727613_gegxan1t8","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:05:27.914Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166727613_gegxan1t8","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:05:27.919Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166727613_gegxan1t8","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:27.925Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166727613_gegxan1t8","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:05:27.932Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166727613_gegxan1t8","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:05:27.956Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166727613_gegxan1t8","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:27.961Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166727613_gegxan1t8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:27.966Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166727613_gegxan1t8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:27.998Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":133832,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:28.004Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":133832,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:28.010Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:05:35.951Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":743,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:05:35.993Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166727613_gegxan1t8","totalTime":8380,"layerTimings":{"router":120,"transformer":95,"protocol":38,"serverCompatibility":61,"server":8003,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:05:36.026Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166727613_gegxan1t8","executionId":"req_1756166727613_gegxan1t8","totalTime":8380,"success":true}}
{"timestamp":"2025-08-26T00:05:36.702Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:05:36.709Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:36.715Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:36.721Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:05:36.730Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:05:36.737Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166736737_l5m5xvt5n","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:05:36.875Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:36.880Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166736737_l5m5xvt5n","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:05:36.937Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166736737_l5m5xvt5n","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:05:37.037Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166736737_l5m5xvt5n","hasOutput":true}}
{"timestamp":"2025-08-26T00:05:37.043Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166736737_l5m5xvt5n","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:05:37.088Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166736737_l5m5xvt5n","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:37.095Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166736737_l5m5xvt5n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:37.100Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166736737_l5m5xvt5n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:37.185Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166736737_l5m5xvt5n","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:05:37.232Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166736737_l5m5xvt5n","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:05:37.239Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166736737_l5m5xvt5n","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:37.245Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166736737_l5m5xvt5n","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:05:37.253Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166736737_l5m5xvt5n","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:05:37.300Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166736737_l5m5xvt5n","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:37.306Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166736737_l5m5xvt5n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:37.312Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166736737_l5m5xvt5n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:37.393Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":820722,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:37.400Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":820722,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:37.405Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:06:05.905Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:06:05.949Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166736737_l5m5xvt5n","totalTime":29212,"layerTimings":{"router":150,"transformer":195,"protocol":80,"serverCompatibility":108,"server":28617,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T00:06:06.073Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166736737_l5m5xvt5n","executionId":"req_1756166736737_l5m5xvt5n","totalTime":29212,"success":true}}
{"timestamp":"2025-08-26T00:06:06.120Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:06:06.127Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:06:06.133Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:06:06.139Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:06:06.146Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:06:06.152Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166766152_9c9iwg75q","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:06:06.289Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:06:06.296Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166766152_9c9iwg75q","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:06:06.361Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166766152_9c9iwg75q","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:06:06.471Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166766152_9c9iwg75q","hasOutput":true}}
{"timestamp":"2025-08-26T00:06:06.477Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166766152_9c9iwg75q","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:06:06.526Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166766152_9c9iwg75q","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:06:06.533Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166766152_9c9iwg75q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:06:06.540Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166766152_9c9iwg75q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:06:06.633Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166766152_9c9iwg75q","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:06:06.682Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166766152_9c9iwg75q","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:06:06.689Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166766152_9c9iwg75q","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:06:06.695Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166766152_9c9iwg75q","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:06:06.704Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166766152_9c9iwg75q","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:06:06.753Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166766152_9c9iwg75q","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:06:06.760Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166766152_9c9iwg75q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:06:06.766Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166766152_9c9iwg75q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:06:06.849Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":820722,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:06:06.855Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":820722,"timeout":30000}}
{"timestamp":"2025-08-26T00:06:06.862Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:06:37.145Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","timeout":30000,"bodySize":820722,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T00:06:37.158Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756166766152_9c9iwg75q","pipelineId":"default","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T00:06:37.165Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756166766152_9c9iwg75q","failedPipelineId":"default","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T00:06:37.172Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756166766152_9c9iwg75q","recoverability":"recoverable","matchedRule":"network-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T00:06:37.178Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756166766152_9c9iwg75q","fromPipeline":"default","toPipeline":"shuaihong-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T00:06:37.183Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756166766152_9c9iwg75q","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"default"}}
{"timestamp":"2025-08-26T00:06:37.222Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":820722,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:06:37.230Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":820722,"timeout":30000}}
{"timestamp":"2025-08-26T00:06:37.237Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","error":"socket hang up","bodySize":820722,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at Socket.socketCloseListener (node:_http_client:491:27)\n    at Socket.emit (node:events:519:35)\n    at TCP.<anonymous> (node:net:346:12)"}}
{"timestamp":"2025-08-26T00:07:06.748Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:07:06.754Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:07:06.759Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:07:06.765Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:07:06.772Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:07:06.778Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166826778_t0xibtnnf","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:07:06.920Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:07:06.927Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166826778_t0xibtnnf","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:07:06.988Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166826778_t0xibtnnf","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:07:07.093Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166826778_t0xibtnnf","hasOutput":true}}
{"timestamp":"2025-08-26T00:07:07.099Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166826778_t0xibtnnf","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:07:07.149Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166826778_t0xibtnnf","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:07:07.155Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166826778_t0xibtnnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:07:07.162Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166826778_t0xibtnnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:07:07.255Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166826778_t0xibtnnf","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:07:07.303Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166826778_t0xibtnnf","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:07:07.310Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166826778_t0xibtnnf","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:07:07.316Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166826778_t0xibtnnf","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:07:07.325Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166826778_t0xibtnnf","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:07:07.374Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166826778_t0xibtnnf","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:07:07.380Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166826778_t0xibtnnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:07:07.386Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166826778_t0xibtnnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:07:07.470Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":820722,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:07:07.477Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":820722,"timeout":30000}}
{"timestamp":"2025-08-26T00:07:07.483Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","timeout":30000,"bodySize":820722,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T00:07:07.488Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756166766152_9c9iwg75q","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T00:07:07.494Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756166766152_9c9iwg75q","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T00:07:07.499Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756166766152_9c9iwg75q","recoverability":"recoverable","matchedRule":"network-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T00:07:07.505Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756166766152_9c9iwg75q","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":10,"details":"无可用的健康流水线进行切换"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"network-timeout","statusCodes":[408,503,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网络超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网络超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T00:07:07.510Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756166766152_9c9iwg75q","success":false,"recoveryAction":"failed","recoveryTime":10}}
{"timestamp":"2025-08-26T00:07:07.516Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756166766152_9c9iwg75q","failedPipelineId":"default","result":{"success":false,"recoveryAction":"failed","recoveryTime":30351,"details":"无可用的健康流水线进行切换"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"network-timeout","statusCodes":[408,503,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网络超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网络超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T00:07:07.521Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756166766152_9c9iwg75q","success":false,"recoveryAction":"failed","recoveryTime":30351}}
{"timestamp":"2025-08-26T00:07:07.527Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756166766152_9c9iwg75q","failedPipeline":"default","recoveryAction":"failed","details":"无可用的健康流水线进行切换"}}
{"timestamp":"2025-08-26T00:07:07.532Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756166766152_9c9iwg75q","pipelineId":"default","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 无可用的健康流水线进行切换"}}
{"timestamp":"2025-08-26T00:07:07.541Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756166766152_9c9iwg75q","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:289:42)\n    at ClientRequest.emit (node:events:507:28)\n    at Socket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at Socket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":154,"transformer":214,"protocol":87,"serverCompatibility":114},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T00:07:07.547Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756166766152_9c9iwg75q","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T00:07:07.676Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:427:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T00:07:07.686Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","error":"socket hang up","bodySize":820722,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at Socket.socketCloseListener (node:_http_client:491:27)\n    at Socket.emit (node:events:519:35)\n    at TCP.<anonymous> (node:net:346:12)"}}
{"timestamp":"2025-08-26T00:07:07.695Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:07:11.971Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:07:12.016Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166826778_t0xibtnnf","totalTime":5238,"layerTimings":{"router":156,"transformer":209,"protocol":87,"serverCompatibility":113,"server":4607,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T00:07:12.137Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166826778_t0xibtnnf","executionId":"req_1756166826778_t0xibtnnf","totalTime":5238,"success":true}}
{"timestamp":"2025-08-26T01:15:41.690Z","level":"INFO","message":"Received SIGINT, exiting gracefully"}
{"timestamp":"2025-08-26T01:15:41.701Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T01:15:41.705Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T01:15:41.709Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T01:15:41.712Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T01:15:41.716Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:15:41.719Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:15:41.723Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:15:41.727Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:15:41.730Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T01:15:41.734Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:15:41.738Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:15:42.744Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T01:15:47.695Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:15:47.701Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:15:47.712Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:15:47.718Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:15:47.724Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:15:47.729Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:15:47.731Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:15:47.736Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:15:47.741Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:15:47.746Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:15:47.752Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:15:47.757Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:15:47.762Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:15:47.767Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:15:47.769Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:15:47.774Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:15:47.780Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:15:47.786Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:15:47.791Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:15:47.796Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:15:47.802Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:15:47.807Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:15:47.812Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":43,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:15:47.817Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:15:47.826Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:15:47.831Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":43,"uptime":0}}
{"timestamp":"2025-08-26T01:15:47.836Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:15:47.841Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:18:37.860Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:18:37.865Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:18:37.871Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:18:37.876Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:18:37.882Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:18:37.888Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756171117887_tpukwbyb4","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:18:37.913Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:37.918Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756171117887_tpukwbyb4","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:18:37.924Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756171117887_tpukwbyb4","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["qwen-qwen3-coder-plus-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-26T01:18:37.944Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756171117887_tpukwbyb4","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:18:37.958Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756171117887_tpukwbyb4","hasOutput":true}}
{"timestamp":"2025-08-26T01:18:37.963Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756171117887_tpukwbyb4","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:18:37.975Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171117887_tpukwbyb4","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:18:37.980Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171117887_tpukwbyb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:18:37.985Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756171117887_tpukwbyb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:18:38.005Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756171117887_tpukwbyb4","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:18:38.018Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756171117887_tpukwbyb4","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:18:38.022Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756171117887_tpukwbyb4","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.029Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756171117887_tpukwbyb4","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T01:18:38.064Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:18:38.070Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:18:38.075Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:18:38.081Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:18:38.087Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:18:38.094Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756171118094_0inaawvwn","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:18:38.223Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.228Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756171118094_0inaawvwn","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T01:18:38.232Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756171118094_0inaawvwn","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["shuaihong-glm-4.5-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-26T01:18:38.291Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756171118094_0inaawvwn","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:18:38.375Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756171118094_0inaawvwn","hasOutput":true}}
{"timestamp":"2025-08-26T01:18:38.380Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756171118094_0inaawvwn","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:18:38.423Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171118094_0inaawvwn","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:18:38.429Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171118094_0inaawvwn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:18:38.435Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756171118094_0inaawvwn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:18:38.517Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756171118094_0inaawvwn","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:18:38.563Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756171118094_0inaawvwn","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:18:38.568Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756171118094_0inaawvwn","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.574Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756171118094_0inaawvwn","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:18:38.580Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756171118094_0inaawvwn","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:18:38.627Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171118094_0inaawvwn","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:18:38.633Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171118094_0inaawvwn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:18:38.640Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756171118094_0inaawvwn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:18:38.720Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":821008,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:18:38.730Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":821008,"timeout":30000}}
{"timestamp":"2025-08-26T01:18:38.735Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:18:38.741Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:18:38.748Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756171117887_tpukwbyb4","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:18:38.753Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756171117887_tpukwbyb4","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.758Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756171117887_tpukwbyb4","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T01:18:38.763Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756171117887_tpukwbyb4","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.772Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756171117887_tpukwbyb4","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T01:18:38.779Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756171117887_tpukwbyb4","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T01:18:38.784Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756171117887_tpukwbyb4","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T01:18:38.789Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756171117887_tpukwbyb4","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.793Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756171117887_tpukwbyb4","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:18:38.806Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171117887_tpukwbyb4","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:18:38.812Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171117887_tpukwbyb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:18:38.816Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756171117887_tpukwbyb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:18:38.831Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":543,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T01:18:39.822Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":450,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T01:18:39.873Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756171117887_tpukwbyb4","totalTime":1985,"layerTimings":{"router":43,"transformer":38,"protocol":15,"serverCompatibility":796,"server":1032,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T01:18:39.889Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756171117887_tpukwbyb4","executionId":"req_1756171117887_tpukwbyb4","totalTime":1985,"success":true}}
{"timestamp":"2025-08-26T01:19:09.348Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","timeout":30000,"bodySize":821008,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T01:19:09.364Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756171118094_0inaawvwn","pipelineId":"shuaihong-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T01:19:09.373Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756171118094_0inaawvwn","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T01:19:09.381Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756171118094_0inaawvwn","recoverability":"recoverable","matchedRule":"network-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T01:19:09.389Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756171118094_0inaawvwn","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":16,"details":"无可用的健康流水线进行切换"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"network-timeout","statusCodes":[408,503,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网络超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网络超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:19:09.396Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756171118094_0inaawvwn","success":false,"recoveryAction":"failed","recoveryTime":16}}
{"timestamp":"2025-08-26T01:19:09.403Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756171118094_0inaawvwn","failedPipeline":"shuaihong-glm-4.5-key0","recoveryAction":"failed","details":"无可用的健康流水线进行切换"}}
{"timestamp":"2025-08-26T01:19:09.409Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756171118094_0inaawvwn","pipelineId":"shuaihong-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 无可用的健康流水线进行切换"}}
{"timestamp":"2025-08-26T01:19:09.420Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756171118094_0inaawvwn","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:328:42)\n    at ClientRequest.emit (node:events:507:28)\n    at Socket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at Socket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":145,"transformer":178,"protocol":77,"serverCompatibility":104},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:19:09.426Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756171118094_0inaawvwn","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T01:19:09.548Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:427:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:19:09.557Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","error":"socket hang up","bodySize":821008,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at Socket.socketCloseListener (node:_http_client:491:27)\n    at Socket.emit (node:events:519:35)\n    at TCP.<anonymous> (node:net:346:12)"}}
{"timestamp":"2025-08-26T01:19:09.591Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:19:09.597Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:19:09.602Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:19:09.607Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:19:09.613Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:19:09.618Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756171149618_ifo8a3t8m","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:19:09.742Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:19:09.747Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756171149618_ifo8a3t8m","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T01:19:09.752Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756171149618_ifo8a3t8m","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["shuaihong-glm-4.5-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-26T01:19:09.808Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756171149618_ifo8a3t8m","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:19:09.895Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756171149618_ifo8a3t8m","hasOutput":true}}
{"timestamp":"2025-08-26T01:19:09.900Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756171149618_ifo8a3t8m","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:19:09.944Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171149618_ifo8a3t8m","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:19:09.950Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171149618_ifo8a3t8m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:19:09.955Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756171149618_ifo8a3t8m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:19:10.040Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756171149618_ifo8a3t8m","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:19:10.085Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756171149618_ifo8a3t8m","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:19:10.090Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756171149618_ifo8a3t8m","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:19:10.096Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756171149618_ifo8a3t8m","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:19:10.102Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756171149618_ifo8a3t8m","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:19:10.144Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171149618_ifo8a3t8m","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:19:10.150Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171149618_ifo8a3t8m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:19:10.155Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756171149618_ifo8a3t8m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:19:10.231Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":821008,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:19:10.237Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":821008,"timeout":30000}}
{"timestamp":"2025-08-26T01:19:10.243Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:19:30.383Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:19:30.401Z","level":"ERROR","message":"Server error detected, throwing for retry","data":{"requestId":"req_1756171149618_ifo8a3t8m","status":504,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions","responsePreview":"{\"error\":{\"message\":\"bad response status code 504 (request id: 20250826091910535087592OTsddRKu)\",\"type\":\"openai_error\",\"param\":\"\",\"code\":\"bad_response_status_code\"}}"}}
{"timestamp":"2025-08-26T01:19:30.412Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756171149618_ifo8a3t8m","pipelineId":"shuaihong-glm-4.5-key0","errorMessage":"Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T01:19:30.421Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756171149618_ifo8a3t8m","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":0,"errorMessage":"Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T01:19:30.429Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756171149618_ifo8a3t8m","recoverability":"non_recoverable","matchedRule":"server-internal-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:19:30.437Z","level":"ERROR","message":"🚫 拉黑流水线","data":{"pipelineId":"shuaihong-glm-4.5-key0","reason":"服务器内部错误 - 需要拉黑流水线 (匹配度: 50%)","failureCount":0}}
{"timestamp":"2025-08-26T01:19:30.444Z","level":"ERROR","message":"💀 流水线销毁事件","data":{"pipelineId":"shuaihong-glm-4.5-key0","reason":"不可恢复错误: 服务器内部错误 - 需要拉黑流水线 (匹配度: 50%)","requestId":"req_1756171149618_ifo8a3t8m","timestamp":1756171170444}}
{"timestamp":"2025-08-26T01:19:30.451Z","level":"INFO","message":"Destroying pipeline data","data":{"pipelineId":"shuaihong-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:19:30.460Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756171149618_ifo8a3t8m","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"destroyed","recoveryTime":39,"details":"流水线已销毁，但无其他可用流水线"},"errorClassification":{"recoverability":"non_recoverable","matchedRule":{"name":"server-internal-error","statusCodes":[500],"messageKeywords":"[REDACTED]","recoverability":"non_recoverable","priority":3,"description":"服务器内部错误 - 需要拉黑流水线"},"confidence":0.5,"reason":"服务器内部错误 - 需要拉黑流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:19:30.465Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756171149618_ifo8a3t8m","success":false,"recoveryAction":"destroyed","recoveryTime":39}}
{"timestamp":"2025-08-26T01:19:30.471Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756171149618_ifo8a3t8m","failedPipeline":"shuaihong-glm-4.5-key0","recoveryAction":"destroyed","details":"流水线已销毁，但无其他可用流水线"}}
{"timestamp":"2025-08-26T01:19:30.476Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756171149618_ifo8a3t8m","pipelineId":"shuaihong-glm-4.5-key0","originalError":"Server error: 504 Internal Server Error","recoveryError":"流水线切换恢复失败: 流水线已销毁，但无其他可用流水线"}}
{"timestamp":"2025-08-26T01:19:30.484Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756171149618_ifo8a3t8m","error":"Server error: 504 Internal Server Error","stack":"Error: Server error: 504 Internal Server Error\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:40:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:263:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":141,"transformer":180,"protocol":79,"serverCompatibility":99},"errors":[{"layer":"pipeline","error":"Server error: 504 Internal Server Error","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:19:30.489Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756171149618_ifo8a3t8m","error":"Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T01:19:30.607Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Server error: 504 Internal Server Error","stack":"Error: Pipeline request processing failed: Server error: 504 Internal Server Error\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:427:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:25:06.618Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T01:25:06.621Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T01:25:06.623Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T01:25:06.626Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T01:25:06.628Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T01:25:06.631Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:25:06.634Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:25:06.637Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:25:06.639Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:25:06.642Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T01:25:06.645Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:25:06.647Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:25:07.652Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T01:25:09.222Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:25:09.238Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:25:09.256Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:25:09.262Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:25:09.268Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:25:09.275Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:25:09.277Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:25:09.283Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:25:09.289Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:25:09.294Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:25:09.301Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:25:09.307Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:25:09.312Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:25:09.318Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:25:09.320Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:25:09.327Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:25:09.332Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:25:09.338Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:25:09.344Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:25:09.350Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:25:09.355Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:25:09.361Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:25:09.366Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":46,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:25:09.371Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:25:09.379Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:25:09.385Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":46,"uptime":0}}
{"timestamp":"2025-08-26T01:25:09.390Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:25:09.396Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:25:09.401Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:28:44.965Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T01:28:44.968Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T01:28:44.971Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T01:28:44.974Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T01:28:44.976Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T01:28:44.979Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:28:44.982Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:28:44.984Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:28:44.987Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:28:44.989Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T01:28:44.992Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:28:44.995Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:28:45.998Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T01:28:47.563Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:28:47.578Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:28:47.595Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:28:47.603Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:28:47.609Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:28:47.616Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:28:47.619Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:28:47.624Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:28:47.630Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:28:47.635Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:28:47.641Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:28:47.646Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:28:47.651Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:28:47.656Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:28:47.658Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:28:47.663Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:28:47.668Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:28:47.673Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:28:47.678Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:28:47.683Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:28:47.688Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:28:47.693Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:28:47.697Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":39,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:28:47.703Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:28:47.711Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:28:47.717Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":39,"uptime":0}}
{"timestamp":"2025-08-26T01:28:47.721Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:28:47.727Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:28:47.732Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:32:26.817Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:32:26.823Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:32:26.835Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:32:26.840Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:32:26.845Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:32:26.850Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:32:26.853Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:32:26.858Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:32:26.863Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:32:26.868Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:32:26.873Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:32:26.878Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:32:26.881Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:32:26.885Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:32:26.890Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:32:26.892Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:32:26.897Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:32:26.902Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:32:26.907Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:32:26.911Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:32:26.916Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:32:26.921Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:32:26.925Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:32:26.930Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":38,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:32:26.934Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:32:26.943Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:32:26.947Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":38,"uptime":0}}
{"timestamp":"2025-08-26T01:32:26.952Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:32:26.957Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:32:26.963Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:40:00.556Z","level":"INFO","message":"接收到chat/completions请求","data":{"method":"POST","url":"/v1/chat/completions","hasBody":true}}
{"timestamp":"2025-08-26T01:40:00.563Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"openai","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:40:00.569Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:40:00.576Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:40:00.579Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:40:00.586Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756172400585_i61ajz5ei","protocol":"openai","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:40:00.613Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-sonnet-20241022","virtualModel":"coding","priority":4,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:40:00.619Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756172400585_i61ajz5ei","inputModel":"claude-3-5-sonnet-20241022","mappedModel":"coding"}}
{"timestamp":"2025-08-26T01:40:00.625Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756172400585_i61ajz5ei","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:40:00.650Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756172400585_i61ajz5ei","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:40:00.663Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756172400585_i61ajz5ei","hasOutput":true}}
{"timestamp":"2025-08-26T01:40:00.669Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756172400585_i61ajz5ei","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:40:00.682Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172400585_i61ajz5ei","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:40:00.687Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172400585_i61ajz5ei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:40:00.693Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756172400585_i61ajz5ei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:40:00.713Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756172400585_i61ajz5ei","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:40:00.727Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756172400585_i61ajz5ei","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:40:00.732Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756172400585_i61ajz5ei","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:40:00.738Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756172400585_i61ajz5ei","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:40:00.743Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756172400585_i61ajz5ei","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:40:00.755Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172400585_i61ajz5ei","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:40:00.760Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172400585_i61ajz5ei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:40:00.765Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756172400585_i61ajz5ei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:40:00.780Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":206,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T01:40:00.793Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:40:00.798Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:40:01.056Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":102,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T01:40:01.066Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756172400585_i61ajz5ei","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: glm-4.5\",\"request_id\":\"31618d49-8b14-4fc1-837e-e4e0f763d736\"}}"}}
{"timestamp":"2025-08-26T01:40:01.074Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756172400585_i61ajz5ei","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:40:01.080Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756172400585_i61ajz5ei","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:40:01.086Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756172400585_i61ajz5ei","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:40:01.092Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756172400585_i61ajz5ei","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:40:01.098Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756172400585_i61ajz5ei","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":18,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:40:01.103Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756172400585_i61ajz5ei","success":false,"recoveryAction":"terminal","recoveryTime":18}}
{"timestamp":"2025-08-26T01:40:01.110Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756172400585_i61ajz5ei","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:40:01.114Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756172400585_i61ajz5ei","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:40:01.122Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756172400585_i61ajz5ei","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":50,"transformer":41,"protocol":15,"serverCompatibility":37},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:40:01.128Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756172400585_i61ajz5ei","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:40:01.139Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"openai","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:41:29.158Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:41:29.164Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:41:29.177Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:41:29.182Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:41:29.187Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:41:29.191Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:41:29.193Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:41:29.198Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:41:29.203Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:41:29.209Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:41:29.214Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:41:29.219Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:41:29.221Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:41:29.226Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:41:29.230Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:41:29.233Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:41:29.237Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:41:29.242Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:41:29.247Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:41:29.252Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:41:29.257Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:41:29.261Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:41:29.266Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:41:29.272Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":39,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:41:29.276Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:41:29.285Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:41:29.290Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":39,"uptime":0}}
{"timestamp":"2025-08-26T01:41:29.295Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:41:29.301Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:41:29.306Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:41:55.718Z","level":"INFO","message":"接收到chat/completions请求","data":{"method":"POST","url":"/v1/chat/completions","hasBody":true}}
{"timestamp":"2025-08-26T01:41:55.725Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"openai","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:41:55.730Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:41:55.736Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:41:55.739Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:41:55.745Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756172515745_tmmfq1341","protocol":"openai","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:41:55.774Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-sonnet-20241022","virtualModel":"coding","priority":4,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:41:55.780Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756172515745_tmmfq1341","inputModel":"claude-3-5-sonnet-20241022","mappedModel":"coding"}}
{"timestamp":"2025-08-26T01:41:55.786Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756172515745_tmmfq1341","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:41:55.809Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756172515745_tmmfq1341","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:41:55.821Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756172515745_tmmfq1341","hasOutput":true}}
{"timestamp":"2025-08-26T01:41:55.826Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756172515745_tmmfq1341","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:41:55.840Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172515745_tmmfq1341","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:41:55.846Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172515745_tmmfq1341","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:41:55.852Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756172515745_tmmfq1341","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:41:55.871Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756172515745_tmmfq1341","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:41:55.884Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756172515745_tmmfq1341","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:41:55.888Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756172515745_tmmfq1341","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:41:55.894Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756172515745_tmmfq1341","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:41:55.899Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756172515745_tmmfq1341","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:41:55.911Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172515745_tmmfq1341","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:41:55.916Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172515745_tmmfq1341","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:41:55.920Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756172515745_tmmfq1341","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:41:55.936Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":206,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T01:41:55.949Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:41:55.954Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:41:56.180Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":102,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T01:41:56.187Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756172515745_tmmfq1341","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: glm-4.5\",\"request_id\":\"488fbdec-f095-4989-9f19-6ea1d80d9601\"}}"}}
{"timestamp":"2025-08-26T01:41:56.193Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756172515745_tmmfq1341","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:41:56.198Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756172515745_tmmfq1341","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:41:56.204Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756172515745_tmmfq1341","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:41:56.210Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756172515745_tmmfq1341","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:41:56.215Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756172515745_tmmfq1341","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":17,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:41:56.221Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756172515745_tmmfq1341","success":false,"recoveryAction":"terminal","recoveryTime":17}}
{"timestamp":"2025-08-26T01:41:56.226Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756172515745_tmmfq1341","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:41:56.231Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756172515745_tmmfq1341","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:41:56.239Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756172515745_tmmfq1341","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":49,"transformer":40,"protocol":14,"serverCompatibility":34},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:41:56.244Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756172515745_tmmfq1341","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:41:56.255Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"openai","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:44:06.045Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:44:06.051Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:44:06.064Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:44:06.070Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:44:06.075Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:44:06.080Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:44:06.083Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:44:06.088Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:44:06.093Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:44:06.097Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:44:06.102Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:44:06.107Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:44:06.109Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:44:06.114Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:44:06.119Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:44:06.122Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:44:06.126Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:44:06.131Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:44:06.136Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:44:06.141Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:44:06.145Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:44:06.150Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:44:06.155Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:44:06.160Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":38,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:44:06.165Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:44:06.173Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:44:06.178Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":38,"uptime":0}}
{"timestamp":"2025-08-26T01:44:06.183Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:44:06.189Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:44:06.194Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:46:19.585Z","level":"INFO","message":"接收到chat/completions请求","data":{"method":"POST","url":"/v1/chat/completions","hasBody":true}}
{"timestamp":"2025-08-26T01:46:19.592Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"openai","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:46:19.599Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:46:19.604Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:46:19.607Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:46:19.614Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756172779613_tm6x1z03d","protocol":"openai","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:46:19.640Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-sonnet-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:46:19.645Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756172779613_tm6x1z03d","inputModel":"claude-3-5-sonnet-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:46:19.650Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756172779613_tm6x1z03d","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:46:19.672Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756172779613_tm6x1z03d","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:46:19.684Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756172779613_tm6x1z03d","hasOutput":true}}
{"timestamp":"2025-08-26T01:46:19.690Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756172779613_tm6x1z03d","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:46:19.702Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172779613_tm6x1z03d","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:46:19.709Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172779613_tm6x1z03d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:46:19.714Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756172779613_tm6x1z03d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:46:19.734Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756172779613_tm6x1z03d","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:46:19.747Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756172779613_tm6x1z03d","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:46:19.753Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756172779613_tm6x1z03d","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:46:19.758Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756172779613_tm6x1z03d","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:46:19.763Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756172779613_tm6x1z03d","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:46:19.776Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172779613_tm6x1z03d","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:46:19.780Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172779613_tm6x1z03d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:46:19.786Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756172779613_tm6x1z03d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:46:19.801Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":195,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T01:46:19.813Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:46:19.818Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:46:20.144Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T01:46:20.152Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756172779613_tm6x1z03d","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"48de0a4d-6ac9-4b55-97f5-79521f2760a6\"}}"}}
{"timestamp":"2025-08-26T01:46:20.157Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756172779613_tm6x1z03d","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:46:20.162Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756172779613_tm6x1z03d","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:46:20.167Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756172779613_tm6x1z03d","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:46:20.173Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756172779613_tm6x1z03d","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:46:20.178Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756172779613_tm6x1z03d","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":16,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:46:20.184Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756172779613_tm6x1z03d","success":false,"recoveryAction":"terminal","recoveryTime":16}}
{"timestamp":"2025-08-26T01:46:20.189Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756172779613_tm6x1z03d","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:46:20.194Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756172779613_tm6x1z03d","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:46:20.202Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756172779613_tm6x1z03d","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":44,"transformer":38,"protocol":15,"serverCompatibility":36},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:46:20.207Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756172779613_tm6x1z03d","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:46:20.217Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"openai","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:53:42.672Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:53:42.678Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:42.684Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:42.690Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:53:42.695Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:53:42.698Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:53:42.704Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173222704_jnctytt3z","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:53:42.718Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:42.723Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173222704_jnctytt3z","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:53:42.728Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173222704_jnctytt3z","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:53:42.750Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173222704_jnctytt3z","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:53:42.767Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173222704_jnctytt3z","hasOutput":true}}
{"timestamp":"2025-08-26T01:53:42.772Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173222704_jnctytt3z","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:53:42.786Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173222704_jnctytt3z","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:42.792Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173222704_jnctytt3z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:53:42.797Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173222704_jnctytt3z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:53:42.819Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173222704_jnctytt3z","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:53:42.833Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173222704_jnctytt3z","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:53:42.839Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173222704_jnctytt3z","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:42.845Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173222704_jnctytt3z","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:53:42.851Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173222704_jnctytt3z","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:53:42.865Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173222704_jnctytt3z","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:42.870Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173222704_jnctytt3z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:53:42.875Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173222704_jnctytt3z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:53:42.893Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:42.899Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25324,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:42.913Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:53:42.919Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:42.925Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:42.931Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:53:42.936Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:53:42.940Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:53:42.946Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173222946_unwx8sv6m","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:53:43.017Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:43.023Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173222946_unwx8sv6m","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:53:43.028Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173222946_unwx8sv6m","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:53:43.059Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173222946_unwx8sv6m","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:53:43.080Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173222946_unwx8sv6m","hasOutput":true}}
{"timestamp":"2025-08-26T01:53:43.086Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173222946_unwx8sv6m","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:53:43.111Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173222946_unwx8sv6m","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:43.116Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173222946_unwx8sv6m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.121Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173222946_unwx8sv6m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.160Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173222946_unwx8sv6m","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:53:43.183Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173222946_unwx8sv6m","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:53:43.189Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173222946_unwx8sv6m","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:43.194Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173222946_unwx8sv6m","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:53:43.200Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173222946_unwx8sv6m","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:53:43.223Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173222946_unwx8sv6m","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:43.229Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173222946_unwx8sv6m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.234Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173222946_unwx8sv6m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.266Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123015,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:43.272Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123015,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:43.278Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:53:43.283Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:53:43.289Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:53:43.295Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:53:43.655Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:53:43.663Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173222946_unwx8sv6m","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"1559046c-f031-4020-b587-09c060187a7b\"}}"}}
{"timestamp":"2025-08-26T01:53:43.669Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173222946_unwx8sv6m","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:43.675Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173222946_unwx8sv6m","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:43.681Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173222946_unwx8sv6m","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:53:43.687Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756173222946_unwx8sv6m","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:43.692Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173222946_unwx8sv6m","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":17,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:53:43.697Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173222946_unwx8sv6m","success":false,"recoveryAction":"terminal","recoveryTime":17}}
{"timestamp":"2025-08-26T01:53:43.702Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173222946_unwx8sv6m","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:43.707Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173222946_unwx8sv6m","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:43.714Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173222946_unwx8sv6m","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":89,"transformer":70,"protocol":33,"serverCompatibility":57},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:53:43.718Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173222946_unwx8sv6m","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:43.745Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:53:43.764Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:53:43.770Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:43.774Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:43.780Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:53:43.784Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:53:43.788Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:53:43.793Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173223793_2e30vq4pk","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:53:43.852Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:43.856Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173223793_2e30vq4pk","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:53:43.861Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173223793_2e30vq4pk","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:53:43.888Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173223793_2e30vq4pk","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:53:43.906Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173223793_2e30vq4pk","hasOutput":true}}
{"timestamp":"2025-08-26T01:53:43.910Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173223793_2e30vq4pk","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:53:43.932Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173223793_2e30vq4pk","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:43.938Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173223793_2e30vq4pk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.943Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173223793_2e30vq4pk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.981Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173223793_2e30vq4pk","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:53:44.004Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173223793_2e30vq4pk","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:53:44.010Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173223793_2e30vq4pk","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:44.016Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173223793_2e30vq4pk","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:53:44.023Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173223793_2e30vq4pk","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:53:44.045Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173223793_2e30vq4pk","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:44.050Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173223793_2e30vq4pk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:44.056Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173223793_2e30vq4pk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:44.083Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123015,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:44.089Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123015,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:44.095Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:53:44.100Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:53:44.230Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:53:44.237Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173223793_2e30vq4pk","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"b710c35c-18d6-4e7f-8eaa-0d430443ba56\"}}"}}
{"timestamp":"2025-08-26T01:53:44.243Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173223793_2e30vq4pk","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.248Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173223793_2e30vq4pk","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.254Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173223793_2e30vq4pk","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:53:44.260Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756173223793_2e30vq4pk","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:44.265Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173223793_2e30vq4pk","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":17,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:53:44.271Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173223793_2e30vq4pk","success":false,"recoveryAction":"terminal","recoveryTime":17}}
{"timestamp":"2025-08-26T01:53:44.277Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173223793_2e30vq4pk","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:44.283Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173223793_2e30vq4pk","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.292Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173223793_2e30vq4pk","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":74,"transformer":60,"protocol":33,"serverCompatibility":58},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:53:44.297Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173223793_2e30vq4pk","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.327Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:53:44.335Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:53:44.340Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173222704_jnctytt3z","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"3552ecfc-7fb0-4a44-b3e1-48353465560d\"}}"}}
{"timestamp":"2025-08-26T01:53:44.346Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173222704_jnctytt3z","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.355Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173222704_jnctytt3z","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.360Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173222704_jnctytt3z","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:53:44.366Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756173222704_jnctytt3z","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:44.371Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173222704_jnctytt3z","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":16,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:53:44.377Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173222704_jnctytt3z","success":false,"recoveryAction":"terminal","recoveryTime":16}}
{"timestamp":"2025-08-26T01:53:44.384Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173222704_jnctytt3z","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:44.390Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173222704_jnctytt3z","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.399Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173222704_jnctytt3z","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":32,"transformer":45,"protocol":17,"serverCompatibility":40},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:53:44.404Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173222704_jnctytt3z","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.420Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:55:59.095Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:55:59.102Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:55:59.113Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:55:59.118Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:55:59.123Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:55:59.127Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:55:59.130Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:55:59.134Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:55:59.139Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:55:59.144Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:55:59.150Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:55:59.155Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:55:59.158Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:55:59.163Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:55:59.169Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:55:59.172Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:55:59.179Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:55:59.184Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:55:59.190Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:55:59.195Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:55:59.200Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:55:59.206Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:55:59.213Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:55:59.217Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":45,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:55:59.222Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:55:59.231Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:55:59.237Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":45,"uptime":0}}
{"timestamp":"2025-08-26T01:55:59.242Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:55:59.248Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:55:59.254Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:10.658Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:56:10.664Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:10.670Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:10.676Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:56:10.681Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:56:10.684Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:56:10.690Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173370690_1adhf2nva","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:56:10.714Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:10.719Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173370690_1adhf2nva","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:56:10.725Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173370690_1adhf2nva","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:56:10.745Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173370690_1adhf2nva","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:56:10.758Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173370690_1adhf2nva","hasOutput":true}}
{"timestamp":"2025-08-26T01:56:10.763Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173370690_1adhf2nva","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:56:10.776Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173370690_1adhf2nva","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:10.780Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173370690_1adhf2nva","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:10.785Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173370690_1adhf2nva","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:10.806Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173370690_1adhf2nva","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:56:10.818Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173370690_1adhf2nva","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:56:10.823Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173370690_1adhf2nva","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:10.828Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173370690_1adhf2nva","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:56:10.834Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173370690_1adhf2nva","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:56:10.846Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173370690_1adhf2nva","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:10.851Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173370690_1adhf2nva","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:10.856Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173370690_1adhf2nva","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:10.872Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:10.884Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25324,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:10.897Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:56:10.902Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:10.907Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:10.912Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:56:10.917Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:56:10.920Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:56:10.925Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173370925_5l36yx72a","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:56:10.984Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:10.989Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173370925_5l36yx72a","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:56:10.993Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173370925_5l36yx72a","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:56:11.021Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173370925_5l36yx72a","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:56:11.038Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173370925_5l36yx72a","hasOutput":true}}
{"timestamp":"2025-08-26T01:56:11.043Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173370925_5l36yx72a","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:56:11.064Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173370925_5l36yx72a","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:11.069Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173370925_5l36yx72a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:11.076Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173370925_5l36yx72a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:11.113Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173370925_5l36yx72a","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:56:11.134Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173370925_5l36yx72a","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:56:11.140Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173370925_5l36yx72a","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:11.145Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173370925_5l36yx72a","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:56:11.151Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173370925_5l36yx72a","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:56:11.175Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173370925_5l36yx72a","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:11.181Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173370925_5l36yx72a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:11.186Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173370925_5l36yx72a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:11.216Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.222Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.228Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:56:11.233Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:11.239Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:56:11.244Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:11.610Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:11.626Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173370925_5l36yx72a","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"e0a0ba29-1605-4ff6-bf25-2cc04051ee79\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.633Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173370925_5l36yx72a","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.640Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.648Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370925_5l36yx72a","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:11.654Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370925_5l36yx72a","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T01:56:11.660Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:11.673Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.679Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.774Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:11.784Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173370690_1adhf2nva","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"932b8743-9194-40fc-9451-92c14ff8b68c\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.790Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173370690_1adhf2nva","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.796Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.801Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370690_1adhf2nva","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:11.808Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370690_1adhf2nva","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T01:56:11.813Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:11.821Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.826Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25324,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.959Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:11.973Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173370690_1adhf2nva","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"3b6d3eb2-5af0-4f0f-9473-24fbdb24996a\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.981Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.987Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.993Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370690_1adhf2nva","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:11.999Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370690_1adhf2nva","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T01:56:12.004Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:12.013Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.018Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25324,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.110Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:12.125Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173370925_5l36yx72a","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"e0ef22a3-1048-4402-93ec-20f308eb8124\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.133Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.140Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.145Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370925_5l36yx72a","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:12.150Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370925_5l36yx72a","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T01:56:12.155Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:12.168Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.173Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.179Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:12.188Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173370690_1adhf2nva","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"d65ef5b7-0ed0-40e9-a937-a9858ebb75bd\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.192Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"shuaihong-glm-4.5-key0","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.197Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.202Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370690_1adhf2nva","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:12.207Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370690_1adhf2nva","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T01:56:12.211Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:12.218Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.223Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25324,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.306Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:12.315Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173370925_5l36yx72a","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"b5eaabce-47a0-464a-b5bb-c35d4667087c\"}}"}}
{"timestamp":"2025-08-26T01:56:12.321Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:12.327Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:12.333Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370925_5l36yx72a","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:12.338Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370925_5l36yx72a","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T01:56:12.343Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:12.355Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.361Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.562Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:12.577Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173370690_1adhf2nva","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"19afb982-7ff6-4f93-95cf-b9b25de01dda\"}}"}}
{"timestamp":"2025-08-26T01:56:12.586Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:12.594Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":397,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.602Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370690_1adhf2nva","success":false,"recoveryAction":"failed","recoveryTime":397}}
{"timestamp":"2025-08-26T01:56:12.610Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":623,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.617Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370690_1adhf2nva","success":false,"recoveryAction":"failed","recoveryTime":623}}
{"timestamp":"2025-08-26T01:56:12.625Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":829,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.632Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370690_1adhf2nva","success":false,"recoveryAction":"failed","recoveryTime":829}}
{"timestamp":"2025-08-26T01:56:12.639Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:12.645Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173370690_1adhf2nva","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Invalid model id: qwen3-coder-plus","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:12.656Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173370690_1adhf2nva","error":"Invalid model id: qwen3-coder-plus","stack":"Error: Invalid model id: qwen3-coder-plus\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":42,"transformer":39,"protocol":17,"serverCompatibility":35},"errors":[{"layer":"pipeline","error":"Invalid model id: qwen3-coder-plus","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:56:12.660Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173370690_1adhf2nva","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.674Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Invalid model id: qwen3-coder-plus","stack":"Error: Pipeline request processing failed: Invalid model id: qwen3-coder-plus\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:56:12.710Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:56:12.715Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:12.720Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:12.725Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:56:12.729Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:56:12.732Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:56:12.737Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173372737_luxumv4pr","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:56:12.749Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:12.753Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173372737_luxumv4pr","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:56:12.758Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173372737_luxumv4pr","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:56:12.776Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173372737_luxumv4pr","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:56:12.789Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173372737_luxumv4pr","hasOutput":true}}
{"timestamp":"2025-08-26T01:56:12.793Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173372737_luxumv4pr","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:56:12.805Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173372737_luxumv4pr","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:12.809Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173372737_luxumv4pr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:12.813Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173372737_luxumv4pr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:12.832Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173372737_luxumv4pr","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:56:12.844Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173372737_luxumv4pr","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:56:12.848Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173372737_luxumv4pr","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:12.853Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173372737_luxumv4pr","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:56:12.858Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173372737_luxumv4pr","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:56:12.870Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173372737_luxumv4pr","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:12.874Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173372737_luxumv4pr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:12.878Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173372737_luxumv4pr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:12.895Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19524,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.899Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19524,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.904Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:56:12.909Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:12.929Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:12.934Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173370925_5l36yx72a","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"bd3386af-007f-4a1b-8eeb-af92aec554f0\"}}"}}
{"timestamp":"2025-08-26T01:56:12.939Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:12.943Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":616,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.948Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370925_5l36yx72a","success":false,"recoveryAction":"failed","recoveryTime":616}}
{"timestamp":"2025-08-26T01:56:12.953Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":813,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.958Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370925_5l36yx72a","success":false,"recoveryAction":"failed","recoveryTime":813}}
{"timestamp":"2025-08-26T01:56:12.964Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":1324,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.970Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370925_5l36yx72a","success":false,"recoveryAction":"failed","recoveryTime":1324}}
{"timestamp":"2025-08-26T01:56:12.974Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:12.979Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173370925_5l36yx72a","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Invalid model id: qwen3-coder-plus","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:12.987Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173370925_5l36yx72a","error":"Invalid model id: qwen3-coder-plus","stack":"Error: Invalid model id: qwen3-coder-plus\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":75,"transformer":59,"protocol":32,"serverCompatibility":58},"errors":[{"layer":"pipeline","error":"Invalid model id: qwen3-coder-plus","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:56:12.992Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173370925_5l36yx72a","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:13.018Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Invalid model id: qwen3-coder-plus","stack":"Error: Pipeline request processing failed: Invalid model id: qwen3-coder-plus\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:56:13.025Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.030Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173372737_luxumv4pr","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"8e426519-18c7-4bf6-8b61-d563fe2c4967\"}}"}}
{"timestamp":"2025-08-26T01:56:13.035Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173372737_luxumv4pr","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.040Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.044Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173372737_luxumv4pr","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:13.049Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173372737_luxumv4pr","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T01:56:13.053Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:13.061Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19524,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.065Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19524,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.076Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:56:13.080Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:13.085Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:13.090Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:56:13.094Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:56:13.097Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:56:13.101Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173373101_4u1k9yabx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:56:13.157Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:13.161Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173373101_4u1k9yabx","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:56:13.166Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173373101_4u1k9yabx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:56:13.192Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173373101_4u1k9yabx","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:56:13.210Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173373101_4u1k9yabx","hasOutput":true}}
{"timestamp":"2025-08-26T01:56:13.214Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173373101_4u1k9yabx","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:56:13.234Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173373101_4u1k9yabx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:13.239Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173373101_4u1k9yabx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:13.243Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173373101_4u1k9yabx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:13.279Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173373101_4u1k9yabx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:56:13.298Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173373101_4u1k9yabx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:56:13.303Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173373101_4u1k9yabx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:13.308Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173373101_4u1k9yabx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:56:13.313Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173373101_4u1k9yabx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:56:13.334Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173373101_4u1k9yabx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:13.339Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173373101_4u1k9yabx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:13.343Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173373101_4u1k9yabx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:13.370Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.374Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.379Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.383Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173372737_luxumv4pr","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"d8381b2f-c25e-4a21-817a-9e3f93a9772f\"}}"}}
{"timestamp":"2025-08-26T01:56:13.389Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.394Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.398Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173372737_luxumv4pr","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:13.402Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173372737_luxumv4pr","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T01:56:13.407Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:13.414Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19524,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.418Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19524,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.423Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:56:13.428Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:13.502Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.509Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373101_4u1k9yabx","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"e279946e-e7f0-4200-ad67-2781b7e18ae8\"}}"}}
{"timestamp":"2025-08-26T01:56:13.514Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173373101_4u1k9yabx","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.520Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.525Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373101_4u1k9yabx","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:13.530Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373101_4u1k9yabx","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T01:56:13.535Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:13.547Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.552Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.557Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.562Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173372737_luxumv4pr","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"53bc04f7-b096-4982-98bf-204d68d1c57b\"}}"}}
{"timestamp":"2025-08-26T01:56:13.566Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.571Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.575Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173372737_luxumv4pr","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:13.580Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173372737_luxumv4pr","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T01:56:13.584Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:13.592Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19524,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.596Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19524,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.676Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.685Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373101_4u1k9yabx","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"6ec226fb-23ce-4350-9c46-3929c7a47bcd\"}}"}}
{"timestamp":"2025-08-26T01:56:13.693Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.701Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.708Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373101_4u1k9yabx","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:13.715Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373101_4u1k9yabx","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T01:56:13.722Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:13.735Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.741Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.746Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.751Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173372737_luxumv4pr","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"d409a56a-6c6c-4cd2-8f28-42444576b1b5\"}}"}}
{"timestamp":"2025-08-26T01:56:13.756Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.761Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":190,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:13.765Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173372737_luxumv4pr","success":false,"recoveryAction":"failed","recoveryTime":190}}
{"timestamp":"2025-08-26T01:56:13.770Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":376,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:13.775Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173372737_luxumv4pr","success":false,"recoveryAction":"failed","recoveryTime":376}}
{"timestamp":"2025-08-26T01:56:13.779Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":739,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:13.784Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173372737_luxumv4pr","success":false,"recoveryAction":"failed","recoveryTime":739}}
{"timestamp":"2025-08-26T01:56:13.789Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:13.794Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173372737_luxumv4pr","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:13.801Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173372737_luxumv4pr","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":27,"transformer":36,"protocol":14,"serverCompatibility":34},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:56:13.806Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173372737_luxumv4pr","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.818Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:56:13.830Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:56:13.835Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:13.839Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:13.844Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:56:13.848Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:56:13.852Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:56:13.857Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173373857_hdv9qa3ed","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:56:13.869Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:13.873Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173373857_hdv9qa3ed","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:56:13.878Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173373857_hdv9qa3ed","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:56:13.897Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173373857_hdv9qa3ed","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:56:13.911Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173373857_hdv9qa3ed","hasOutput":true}}
{"timestamp":"2025-08-26T01:56:13.915Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173373857_hdv9qa3ed","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:56:13.927Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173373857_hdv9qa3ed","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:13.931Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173373857_hdv9qa3ed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:13.936Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173373857_hdv9qa3ed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:13.956Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173373857_hdv9qa3ed","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:56:13.968Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173373857_hdv9qa3ed","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:56:13.973Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173373857_hdv9qa3ed","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:13.978Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173373857_hdv9qa3ed","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:56:13.983Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173373857_hdv9qa3ed","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:56:13.995Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173373857_hdv9qa3ed","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:14.000Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173373857_hdv9qa3ed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:14.004Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173373857_hdv9qa3ed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:14.019Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.023Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19424,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.028Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:14.032Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373101_4u1k9yabx","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"936d3e55-0b2d-4173-8c3c-c7c5802063c7\"}}"}}
{"timestamp":"2025-08-26T01:56:14.037Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.041Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.045Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373101_4u1k9yabx","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:14.050Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373101_4u1k9yabx","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T01:56:14.054Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:14.065Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.070Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.075Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:56:14.080Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:14.106Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:14.111Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373857_hdv9qa3ed","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"848f6e8b-242a-485d-88e2-b53cb61ce23f\"}}"}}
{"timestamp":"2025-08-26T01:56:14.116Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173373857_hdv9qa3ed","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.121Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.126Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:14.131Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373857_hdv9qa3ed","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T01:56:14.135Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:14.143Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.147Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19424,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.464Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:14.475Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373857_hdv9qa3ed","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"0f69d8ec-77f9-4981-9294-5c6f13b1ec7a\"}}"}}
{"timestamp":"2025-08-26T01:56:14.484Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.492Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.500Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:14.506Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373857_hdv9qa3ed","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T01:56:14.512Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:14.521Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.526Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19424,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.715Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:14.728Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373101_4u1k9yabx","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"4e5da423-c7a8-43f0-95c4-06e6633043a1\"}}"}}
{"timestamp":"2025-08-26T01:56:14.738Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.746Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":705,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:14.753Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373101_4u1k9yabx","success":false,"recoveryAction":"failed","recoveryTime":705}}
{"timestamp":"2025-08-26T01:56:14.761Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":1060,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:14.769Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373101_4u1k9yabx","success":false,"recoveryAction":"failed","recoveryTime":1060}}
{"timestamp":"2025-08-26T01:56:14.776Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":1256,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:14.782Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373101_4u1k9yabx","success":false,"recoveryAction":"failed","recoveryTime":1256}}
{"timestamp":"2025-08-26T01:56:14.788Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:14.793Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173373101_4u1k9yabx","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:14.801Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173373101_4u1k9yabx","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":70,"transformer":58,"protocol":31,"serverCompatibility":51},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:56:14.806Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173373101_4u1k9yabx","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.833Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:56:14.975Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:14.984Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173373857_hdv9qa3ed","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"571c5578-6131-4582-b36f-9c7cbb002e1d\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:14.990Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"shuaihong-glm-4.5-key0","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:14.995Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:15.000Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:15.006Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373857_hdv9qa3ed","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T01:56:15.011Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:15.019Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:15.024Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19424,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:15.182Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:15.194Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173373857_hdv9qa3ed","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"ad8ac0f8-eb68-4d77-962f-925d5b6264c2\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:15.201Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:15.207Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":212,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:15.214Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","success":false,"recoveryAction":"failed","recoveryTime":212}}
{"timestamp":"2025-08-26T01:56:15.220Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":728,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:15.225Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","success":false,"recoveryAction":"failed","recoveryTime":728}}
{"timestamp":"2025-08-26T01:56:15.231Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":1110,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:15.237Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","success":false,"recoveryAction":"failed","recoveryTime":1110}}
{"timestamp":"2025-08-26T01:56:15.242Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:15.246Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173373857_hdv9qa3ed","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:15.254Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173373857_hdv9qa3ed","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":28,"transformer":38,"protocol":15,"serverCompatibility":34},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:56:15.259Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173373857_hdv9qa3ed","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:15.272Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:04:53.798Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T02:04:53.801Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T02:04:53.804Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T02:04:53.806Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T02:04:53.808Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T02:04:53.812Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:04:53.815Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:04:53.818Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:04:53.821Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:04:53.824Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T02:04:53.826Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:04:53.829Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:04:54.832Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T02:04:56.382Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T02:04:56.389Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T02:04:56.402Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T02:04:56.408Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T02:04:56.413Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T02:04:56.418Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T02:04:56.421Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T02:04:56.426Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T02:04:56.431Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T02:04:56.437Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T02:04:56.443Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:04:56.448Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:04:56.451Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:04:56.456Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T02:04:56.461Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T02:04:56.464Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:04:56.469Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:04:56.474Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T02:04:56.481Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T02:04:56.486Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T02:04:56.492Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:04:56.497Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:04:56.504Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T02:04:56.509Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":45,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T02:04:56.515Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T02:04:56.524Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T02:04:56.530Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":45,"uptime":0}}
{"timestamp":"2025-08-26T02:04:56.536Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T02:04:56.543Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:04:56.549Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:12.837Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:12.842Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:12.847Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:12.852Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:12.857Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:12.860Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:12.866Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173912866_a9qrlt9yl","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:12.890Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:12.894Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173912866_a9qrlt9yl","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:12.899Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173912866_a9qrlt9yl","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:12.919Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173912866_a9qrlt9yl","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:12.933Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173912866_a9qrlt9yl","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:12.938Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173912866_a9qrlt9yl","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:12.950Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173912866_a9qrlt9yl","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:12.955Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173912866_a9qrlt9yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:12.960Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173912866_a9qrlt9yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:12.972Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173912866_a9qrlt9yl","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:12.984Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173912866_a9qrlt9yl","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:12.996Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173912866_a9qrlt9yl","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:13.000Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173912866_a9qrlt9yl","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:13.005Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173912866_a9qrlt9yl","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:13.010Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173912866_a9qrlt9yl","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:13.022Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173912866_a9qrlt9yl","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:13.026Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173912866_a9qrlt9yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:13.031Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173912866_a9qrlt9yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:13.046Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25323,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:13.058Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25323,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:13.070Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:13.075Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:13.079Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:13.084Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:13.088Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:13.091Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:13.095Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173913095_lxfkevsx1","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:13.152Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:13.157Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173913095_lxfkevsx1","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:13.161Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173913095_lxfkevsx1","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:13.188Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173913095_lxfkevsx1","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:13.205Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173913095_lxfkevsx1","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:13.210Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173913095_lxfkevsx1","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:05:13.230Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173913095_lxfkevsx1","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:13.235Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173913095_lxfkevsx1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:13.240Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173913095_lxfkevsx1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:13.261Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173913095_lxfkevsx1","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:13.281Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173913095_lxfkevsx1","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:13.303Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173913095_lxfkevsx1","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:13.309Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173913095_lxfkevsx1","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:13.314Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173913095_lxfkevsx1","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:13.320Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173913095_lxfkevsx1","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:13.341Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173913095_lxfkevsx1","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:13.346Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173913095_lxfkevsx1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:13.351Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173913095_lxfkevsx1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:13.379Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123198,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:13.385Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123198,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:13.391Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:13.396Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:13.403Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:13.407Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:15.411Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":491,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:15.456Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173912866_a9qrlt9yl","totalTime":2590,"layerTimings":{"router":39,"transformer":40,"protocol":20,"serverCompatibility":34,"server":2404,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:15.472Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173912866_a9qrlt9yl","executionId":"req_1756173912866_a9qrlt9yl","totalTime":2590,"success":true}}
{"timestamp":"2025-08-26T02:05:15.538Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:15.543Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:15.548Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:15.553Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:15.558Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:15.561Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:15.566Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173915566_p9uybiihz","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:15.578Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:15.584Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173915566_p9uybiihz","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:15.588Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173915566_p9uybiihz","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:15.607Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173915566_p9uybiihz","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:15.620Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173915566_p9uybiihz","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:15.625Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173915566_p9uybiihz","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:15.638Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173915566_p9uybiihz","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:15.643Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173915566_p9uybiihz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:15.648Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173915566_p9uybiihz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:15.661Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173915566_p9uybiihz","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:15.673Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173915566_p9uybiihz","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:15.686Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173915566_p9uybiihz","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:15.690Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173915566_p9uybiihz","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:15.695Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173915566_p9uybiihz","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:15.701Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173915566_p9uybiihz","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:15.713Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173915566_p9uybiihz","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:15.718Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173915566_p9uybiihz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:15.722Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173915566_p9uybiihz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:15.737Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19523,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:15.742Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19523,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:15.747Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:15.752Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:17.166Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":487,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:17.221Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173915566_p9uybiihz","totalTime":1655,"layerTimings":{"router":29,"transformer":38,"protocol":20,"serverCompatibility":35,"server":1471,"responseTransform":23},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:17.236Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173915566_p9uybiihz","executionId":"req_1756173915566_p9uybiihz","totalTime":1655,"success":true}}
{"timestamp":"2025-08-26T02:05:17.251Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:17.257Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:17.262Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:17.268Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:17.274Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:17.277Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:17.283Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173917283_mwceylgdn","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:17.298Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:17.303Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173917283_mwceylgdn","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:17.308Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173917283_mwceylgdn","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:17.330Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173917283_mwceylgdn","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:17.345Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173917283_mwceylgdn","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:17.350Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173917283_mwceylgdn","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:17.364Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173917283_mwceylgdn","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:17.370Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173917283_mwceylgdn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:17.376Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173917283_mwceylgdn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:17.388Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173917283_mwceylgdn","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:17.400Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173917283_mwceylgdn","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:17.413Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173917283_mwceylgdn","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:17.419Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173917283_mwceylgdn","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:17.424Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173917283_mwceylgdn","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:17.430Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173917283_mwceylgdn","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:17.444Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173917283_mwceylgdn","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:17.450Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173917283_mwceylgdn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:17.455Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173917283_mwceylgdn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:17.472Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19423,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:17.477Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19423,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:17.482Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:17.487Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:18.965Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":705,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:19.014Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173913095_lxfkevsx1","totalTime":5919,"layerTimings":{"router":73,"transformer":58,"protocol":36,"serverCompatibility":55,"server":5636,"responseTransform":22},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:19.045Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173913095_lxfkevsx1","executionId":"req_1756173913095_lxfkevsx1","totalTime":5919,"success":true}}
{"timestamp":"2025-08-26T02:05:19.063Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:19.068Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:19.073Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:19.078Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:19.083Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:19.086Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:19.091Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173919091_tyuqiirn8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:19.149Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:19.153Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173919091_tyuqiirn8","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:19.159Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173919091_tyuqiirn8","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:19.186Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173919091_tyuqiirn8","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:19.205Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173919091_tyuqiirn8","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:19.210Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173919091_tyuqiirn8","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:05:19.232Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173919091_tyuqiirn8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:19.237Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173919091_tyuqiirn8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:19.242Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173919091_tyuqiirn8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:19.263Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173919091_tyuqiirn8","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:19.283Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173919091_tyuqiirn8","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:19.304Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173919091_tyuqiirn8","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:19.309Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173919091_tyuqiirn8","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:19.314Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173919091_tyuqiirn8","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:19.321Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173919091_tyuqiirn8","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:19.342Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173919091_tyuqiirn8","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:19.347Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173919091_tyuqiirn8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:19.352Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173919091_tyuqiirn8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:19.380Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123198,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:19.385Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123198,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:19.390Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":493,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:19.418Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173917283_mwceylgdn","totalTime":2135,"layerTimings":{"router":33,"transformer":43,"protocol":20,"serverCompatibility":38,"server":1945,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:19.430Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173917283_mwceylgdn","executionId":"req_1756173917283_mwceylgdn","totalTime":2135,"success":true}}
{"timestamp":"2025-08-26T02:05:19.438Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:19.443Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:19.451Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:19.456Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:19.461Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:19.466Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:19.471Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:19.474Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:19.479Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173919479_u43c00069","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:19.491Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:19.496Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173919479_u43c00069","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:19.500Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173919479_u43c00069","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:19.519Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173919479_u43c00069","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:19.535Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173919479_u43c00069","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:19.539Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173919479_u43c00069","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:19.552Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173919479_u43c00069","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:19.557Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173919479_u43c00069","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:19.562Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173919479_u43c00069","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:19.575Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173919479_u43c00069","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:19.586Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173919479_u43c00069","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:19.599Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173919479_u43c00069","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:19.604Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173919479_u43c00069","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:19.609Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173919479_u43c00069","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:19.615Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173919479_u43c00069","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:19.626Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173919479_u43c00069","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:19.631Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173919479_u43c00069","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:19.635Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173919479_u43c00069","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:19.651Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":24955,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:19.655Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":24955,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:19.661Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:19.665Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:19.734Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:19.741Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173919479_u43c00069","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"5619cb90-eb64-467f-8a58-b2dcf92bfbac\"}}"}}
{"timestamp":"2025-08-26T02:05:19.749Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173919479_u43c00069","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:19.756Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173919479_u43c00069","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:19.763Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173919479_u43c00069","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:05:19.769Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173919479_u43c00069","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:05:19.775Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173919479_u43c00069","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:05:19.784Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":24955,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:19.789Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":24955,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:21.626Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":497,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:21.650Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173919479_u43c00069","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":true,"newPipelineId":"qwen-qwen3-coder-plus-key0","recoveryAction":"switched","response":{"id":"20250826100520d5c78787ffb84b5b","object":"","created":1756173921,"model":"ZhipuAI/GLM-4.5","system_fingerprint":"","choices":[{"index":0,"delta":{"role":null,"content":"","tool_calls":null,"function_calls":null,"reasoning_content":""},"finish_reason":"stop","message":{"role":"assistant","content":"JSON.stringify Replacement and Console Log Testing","tool_calls":null,"function_calls":null,"reasoning_content":""}}],"usage":{"prompt_tokens":"[REDACTED]","completion_tokens":"[REDACTED]","total_tokens":"[REDACTED]"}},"recoveryTime":1894,"details":"成功切换到流水线 qwen-qwen3-coder-plus-key0"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:05:21.660Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173919479_u43c00069","success":true,"recoveryAction":"switched","newPipelineId":"qwen-qwen3-coder-plus-key0","recoveryTime":1894}}
{"timestamp":"2025-08-26T02:05:21.669Z","level":"INFO","message":"✅ 流水线切换恢复成功","data":{"requestId":"req_1756173919479_u43c00069","originalPipeline":"modelscope-zhipuai-glm-4.5-key0","newPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"switched","recoveryTime":1894}}
{"timestamp":"2025-08-26T02:05:21.705Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173919479_u43c00069","totalTime":2226,"layerTimings":{"router":28,"transformer":40,"protocol":20,"serverCompatibility":35,"server":2046,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:21.721Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173919479_u43c00069","executionId":"req_1756173919479_u43c00069","totalTime":2226,"success":true}}
{"timestamp":"2025-08-26T02:05:21.735Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:21.741Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:21.746Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:21.752Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:21.758Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:21.762Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:21.768Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173921768_s3z1dafpz","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:21.782Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:21.787Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173921768_s3z1dafpz","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:21.792Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173921768_s3z1dafpz","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:21.812Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173921768_s3z1dafpz","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:21.829Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173921768_s3z1dafpz","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:21.835Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173921768_s3z1dafpz","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:21.848Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173921768_s3z1dafpz","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:21.853Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173921768_s3z1dafpz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:21.858Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173921768_s3z1dafpz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:21.870Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173921768_s3z1dafpz","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:21.884Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173921768_s3z1dafpz","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:21.897Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173921768_s3z1dafpz","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:21.902Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173921768_s3z1dafpz","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:21.907Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173921768_s3z1dafpz","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:21.913Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173921768_s3z1dafpz","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:21.925Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173921768_s3z1dafpz","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:21.930Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173921768_s3z1dafpz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:21.935Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173921768_s3z1dafpz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:21.950Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":18401,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:21.956Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":18401,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:21.961Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:21.966Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:23.337Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":652,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:23.383Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173919091_tyuqiirn8","totalTime":4292,"layerTimings":{"router":74,"transformer":62,"protocol":36,"serverCompatibility":54,"server":4006,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:23.417Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173919091_tyuqiirn8","executionId":"req_1756173919091_tyuqiirn8","totalTime":4292,"success":true}}
{"timestamp":"2025-08-26T02:05:23.537Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:23.543Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:23.548Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:23.553Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:23.558Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:23.562Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:23.568Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173923568_u90z95ca9","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:23.631Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:23.637Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173923568_u90z95ca9","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:23.642Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173923568_u90z95ca9","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:23.677Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173923568_u90z95ca9","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:23.707Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173923568_u90z95ca9","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:23.711Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173923568_u90z95ca9","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:05:23.736Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173923568_u90z95ca9","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:23.741Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173923568_u90z95ca9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:23.746Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173923568_u90z95ca9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:23.772Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173923568_u90z95ca9","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:23.797Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173923568_u90z95ca9","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:23.823Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173923568_u90z95ca9","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:23.829Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173923568_u90z95ca9","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:23.834Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173923568_u90z95ca9","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:23.840Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173923568_u90z95ca9","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:23.863Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173923568_u90z95ca9","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:23.868Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173923568_u90z95ca9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:23.873Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173923568_u90z95ca9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:23.907Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":156130,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:23.912Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":156130,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:23.918Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":491,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:23.947Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173921768_s3z1dafpz","totalTime":2179,"layerTimings":{"router":31,"transformer":43,"protocol":21,"serverCompatibility":36,"server":1994,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:23.960Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173921768_s3z1dafpz","executionId":"req_1756173921768_s3z1dafpz","totalTime":2179,"success":true}}
{"timestamp":"2025-08-26T02:05:23.968Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:23.973Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:23.981Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:23.986Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:23.991Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:23.996Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:24.002Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:24.006Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:24.011Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173924011_no6xu0diw","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:24.025Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:24.030Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173924011_no6xu0diw","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:24.036Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173924011_no6xu0diw","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:24.057Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173924011_no6xu0diw","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:24.073Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173924011_no6xu0diw","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:24.078Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173924011_no6xu0diw","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:24.090Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173924011_no6xu0diw","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:24.095Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173924011_no6xu0diw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:24.100Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173924011_no6xu0diw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:24.112Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173924011_no6xu0diw","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:24.124Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173924011_no6xu0diw","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:24.137Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173924011_no6xu0diw","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:24.141Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173924011_no6xu0diw","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:24.146Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173924011_no6xu0diw","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:24.153Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173924011_no6xu0diw","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:24.166Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173924011_no6xu0diw","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:24.170Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173924011_no6xu0diw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:24.175Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173924011_no6xu0diw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:24.191Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":28153,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.196Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":28153,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.201Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:24.206Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:24.275Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:24.282Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173924011_no6xu0diw","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"510ff25e-70a2-4778-b4b6-7bea5c7ec792\"}}"}}
{"timestamp":"2025-08-26T02:05:24.286Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173924011_no6xu0diw","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.292Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.297Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173924011_no6xu0diw","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:05:24.302Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173924011_no6xu0diw","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:05:24.307Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:05:24.315Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":28153,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.321Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":28153,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.404Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:24.413Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173924011_no6xu0diw","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"8f588312-8b60-4afa-9392-baba907dbc2c\"}}"}}
{"timestamp":"2025-08-26T02:05:24.421Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.428Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.435Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173924011_no6xu0diw","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:05:24.442Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173924011_no6xu0diw","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:05:24.449Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:05:24.460Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":28153,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.467Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":28153,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.576Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:24.587Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173924011_no6xu0diw","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"d2d8ba98-73c0-41d6-86f9-8b31e8fa5de8\"}}"}}
{"timestamp":"2025-08-26T02:05:24.594Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.602Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.609Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173924011_no6xu0diw","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:05:24.615Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173924011_no6xu0diw","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:05:24.620Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:05:24.629Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":28153,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.634Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":28153,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.962Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:24.978Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173924011_no6xu0diw","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"10e8fd9a-3014-4168-a75f-c34ccdb81ca4\"}}"}}
{"timestamp":"2025-08-26T02:05:24.987Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.996Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":394,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:05:25.004Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173924011_no6xu0diw","success":false,"recoveryAction":"failed","recoveryTime":394}}
{"timestamp":"2025-08-26T02:05:25.011Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":583,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:05:25.018Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173924011_no6xu0diw","success":false,"recoveryAction":"failed","recoveryTime":583}}
{"timestamp":"2025-08-26T02:05:25.024Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":732,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:05:25.030Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173924011_no6xu0diw","success":false,"recoveryAction":"failed","recoveryTime":732}}
{"timestamp":"2025-08-26T02:05:25.036Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:05:25.042Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173924011_no6xu0diw","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:05:25.052Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173924011_no6xu0diw","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:290:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":32,"transformer":42,"protocol":20,"serverCompatibility":37},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:05:25.058Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173924011_no6xu0diw","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:25.073Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:05:25.088Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:25.092Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:25.097Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:25.102Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:25.107Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:25.111Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:25.116Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173925116_lzzv97f8f","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:25.128Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:25.133Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173925116_lzzv97f8f","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:25.138Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173925116_lzzv97f8f","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:25.156Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173925116_lzzv97f8f","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:25.173Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173925116_lzzv97f8f","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:25.178Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173925116_lzzv97f8f","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:25.190Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173925116_lzzv97f8f","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:25.195Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173925116_lzzv97f8f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:25.199Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173925116_lzzv97f8f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:25.211Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173925116_lzzv97f8f","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:25.224Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173925116_lzzv97f8f","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:25.236Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173925116_lzzv97f8f","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:25.241Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173925116_lzzv97f8f","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:25.246Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173925116_lzzv97f8f","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:25.253Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173925116_lzzv97f8f","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:25.265Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173925116_lzzv97f8f","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:25.270Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173925116_lzzv97f8f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:25.276Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173925116_lzzv97f8f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:25.293Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":26426,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:25.298Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":26426,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:25.304Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:25.309Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:26.531Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":502,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:26.584Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173925116_lzzv97f8f","totalTime":1468,"layerTimings":{"router":28,"transformer":41,"protocol":20,"serverCompatibility":37,"server":1279,"responseTransform":24},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:26.601Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173925116_lzzv97f8f","executionId":"req_1756173925116_lzzv97f8f","totalTime":1468,"success":true}}
{"timestamp":"2025-08-26T02:05:26.615Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:26.620Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:26.625Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:26.630Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:26.635Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:26.640Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:26.645Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173926645_lexy6s70t","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:26.658Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:26.662Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173926645_lexy6s70t","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:26.667Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173926645_lexy6s70t","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:26.686Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173926645_lexy6s70t","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:26.704Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173926645_lexy6s70t","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:26.709Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173926645_lexy6s70t","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:26.721Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173926645_lexy6s70t","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:26.725Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173926645_lexy6s70t","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:26.730Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173926645_lexy6s70t","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:26.743Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173926645_lexy6s70t","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:26.755Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173926645_lexy6s70t","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:26.767Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173926645_lexy6s70t","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:26.772Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173926645_lexy6s70t","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:26.777Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173926645_lexy6s70t","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:26.784Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173926645_lexy6s70t","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:26.797Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173926645_lexy6s70t","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:26.802Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173926645_lexy6s70t","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:26.807Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173926645_lexy6s70t","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:26.824Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25953,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:26.830Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25953,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:26.836Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:26.842Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:28.489Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":498,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:28.539Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173926645_lexy6s70t","totalTime":1894,"layerTimings":{"router":28,"transformer":43,"protocol":20,"serverCompatibility":37,"server":1706,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:28.556Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173926645_lexy6s70t","executionId":"req_1756173926645_lexy6s70t","totalTime":1894,"success":true}}
{"timestamp":"2025-08-26T02:05:28.570Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:28.576Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:28.581Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:28.587Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:28.592Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:28.596Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:28.602Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173928602_x71gu5v13","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:28.615Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:28.620Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173928602_x71gu5v13","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:28.624Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173928602_x71gu5v13","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:28.644Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173928602_x71gu5v13","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:28.663Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173928602_x71gu5v13","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:28.668Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173928602_x71gu5v13","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:28.680Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173928602_x71gu5v13","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:28.685Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173928602_x71gu5v13","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:28.690Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173928602_x71gu5v13","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:28.702Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173928602_x71gu5v13","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:28.714Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173928602_x71gu5v13","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:28.727Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173928602_x71gu5v13","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:28.732Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173928602_x71gu5v13","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:28.737Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173928602_x71gu5v13","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:28.743Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173928602_x71gu5v13","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:28.755Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173928602_x71gu5v13","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:28.760Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173928602_x71gu5v13","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:28.765Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173928602_x71gu5v13","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:28.781Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":34693,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:28.785Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":34693,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:28.790Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:28.795Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:31.984Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":501,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:32.035Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173928602_x71gu5v13","totalTime":3433,"layerTimings":{"router":29,"transformer":44,"protocol":20,"serverCompatibility":36,"server":3245,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:32.053Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173928602_x71gu5v13","executionId":"req_1756173928602_x71gu5v13","totalTime":3433,"success":true}}
{"timestamp":"2025-08-26T02:05:32.066Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:32.071Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:32.076Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:32.081Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:32.087Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:32.092Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:32.097Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173932097_u9r9b1hfc","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:32.109Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:32.114Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173932097_u9r9b1hfc","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:32.119Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173932097_u9r9b1hfc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:32.140Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173932097_u9r9b1hfc","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:32.160Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173932097_u9r9b1hfc","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:32.166Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173932097_u9r9b1hfc","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:32.179Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173932097_u9r9b1hfc","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:32.184Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173932097_u9r9b1hfc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:32.189Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173932097_u9r9b1hfc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:32.202Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173932097_u9r9b1hfc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:32.215Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173932097_u9r9b1hfc","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:32.226Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173932097_u9r9b1hfc","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:32.231Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173932097_u9r9b1hfc","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:32.236Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173932097_u9r9b1hfc","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:32.243Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173932097_u9r9b1hfc","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:32.255Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173932097_u9r9b1hfc","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:32.260Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173932097_u9r9b1hfc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:32.264Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173932097_u9r9b1hfc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:32.278Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":21700,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:32.283Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":21700,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:32.289Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:32.294Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:32.950Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":965,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:33.005Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173923568_u90z95ca9","totalTime":9437,"layerTimings":{"router":84,"transformer":79,"protocol":46,"serverCompatibility":60,"server":9106,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:33.046Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173923568_u90z95ca9","executionId":"req_1756173923568_u90z95ca9","totalTime":9437,"success":true}}
{"timestamp":"2025-08-26T02:05:33.065Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:33.072Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:33.078Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:33.083Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:33.087Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:33.092Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:33.098Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173933098_xfpjj0qh3","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:33.160Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:33.165Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173933098_xfpjj0qh3","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:33.170Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173933098_xfpjj0qh3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:33.200Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173933098_xfpjj0qh3","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:33.235Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173933098_xfpjj0qh3","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:33.241Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173933098_xfpjj0qh3","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:05:33.267Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173933098_xfpjj0qh3","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:33.273Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173933098_xfpjj0qh3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:33.279Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173933098_xfpjj0qh3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:33.304Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173933098_xfpjj0qh3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:33.330Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173933098_xfpjj0qh3","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:33.357Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173933098_xfpjj0qh3","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:33.362Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173933098_xfpjj0qh3","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:33.368Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173933098_xfpjj0qh3","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:33.377Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173933098_xfpjj0qh3","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:33.400Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173933098_xfpjj0qh3","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:33.405Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173933098_xfpjj0qh3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:33.411Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173933098_xfpjj0qh3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:33.442Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":156130,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:33.447Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":156130,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:33.453Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:33.458Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:33.761Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":507,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:33.816Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173932097_u9r9b1hfc","totalTime":1719,"layerTimings":{"router":30,"transformer":47,"protocol":21,"serverCompatibility":36,"server":1526,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:33.835Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173932097_u9r9b1hfc","executionId":"req_1756173932097_u9r9b1hfc","totalTime":1719,"success":true}}
{"timestamp":"2025-08-26T02:05:43.579Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":889,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:43.628Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173933098_xfpjj0qh3","totalTime":10530,"layerTimings":{"router":78,"transformer":86,"protocol":46,"serverCompatibility":64,"server":10192,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:43.664Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173933098_xfpjj0qh3","executionId":"req_1756173933098_xfpjj0qh3","totalTime":10530,"success":true}}
{"timestamp":"2025-08-26T02:06:08.725Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T02:06:08.729Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T02:06:08.732Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T02:06:08.735Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T02:06:08.738Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T02:06:08.742Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:06:08.745Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:06:08.748Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:06:08.751Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:06:08.754Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T02:06:08.757Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:06:08.759Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:06:09.763Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T02:07:35.295Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T02:07:35.302Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T02:07:35.312Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T02:07:35.317Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T02:07:35.322Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T02:07:35.327Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T02:07:35.330Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T02:07:35.334Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T02:07:35.339Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T02:07:35.343Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T02:07:35.349Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:07:35.353Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:07:35.356Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:07:35.361Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T02:07:35.366Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T02:07:35.368Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:07:35.373Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:07:35.377Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T02:07:35.382Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T02:07:35.387Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T02:07:35.392Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:07:35.397Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:07:35.403Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T02:07:35.408Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":40,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T02:07:35.412Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T02:07:35.421Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T02:07:35.427Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":40,"uptime":0}}
{"timestamp":"2025-08-26T02:07:35.432Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T02:07:35.438Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:07:35.443Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:07:41.022Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:07:41.028Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:07:41.033Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:07:41.038Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:07:41.043Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:07:41.046Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:07:41.052Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174061051_59w7g2os5","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:07:41.076Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:07:41.082Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174061051_59w7g2os5","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:07:41.087Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174061051_59w7g2os5","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:07:41.106Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174061051_59w7g2os5","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:07:41.118Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174061051_59w7g2os5","hasOutput":true}}
{"timestamp":"2025-08-26T02:07:41.123Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174061051_59w7g2os5","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:07:41.136Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174061051_59w7g2os5","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:07:41.141Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174061051_59w7g2os5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:07:41.146Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174061051_59w7g2os5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:07:41.158Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174061051_59w7g2os5","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:07:41.171Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174061051_59w7g2os5","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:07:41.184Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174061051_59w7g2os5","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:07:41.189Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174061051_59w7g2os5","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:07:41.194Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174061051_59w7g2os5","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:07:41.199Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174061051_59w7g2os5","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:07:41.212Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174061051_59w7g2os5","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:07:41.216Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174061051_59w7g2os5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:07:41.221Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174061051_59w7g2os5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:07:41.236Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":542,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:07:41.278Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:07:41.285Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:07:41.290Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:07:41.296Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:07:41.301Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:07:41.304Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:07:41.309Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174061309_dro3i7k7r","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:07:41.433Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:07:41.438Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174061309_dro3i7k7r","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:07:41.442Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174061309_dro3i7k7r","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:07:41.496Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174061309_dro3i7k7r","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:07:41.575Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174061309_dro3i7k7r","hasOutput":true}}
{"timestamp":"2025-08-26T02:07:41.581Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174061309_dro3i7k7r","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:07:41.625Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174061309_dro3i7k7r","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:07:41.631Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174061309_dro3i7k7r","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:07:41.637Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174061309_dro3i7k7r","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:07:41.680Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174061309_dro3i7k7r","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:07:41.725Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174061309_dro3i7k7r","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:07:41.771Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174061309_dro3i7k7r","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:07:41.776Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174061309_dro3i7k7r","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:07:41.782Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174061309_dro3i7k7r","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:07:41.788Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174061309_dro3i7k7r","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:07:41.834Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174061309_dro3i7k7r","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:07:41.840Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174061309_dro3i7k7r","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:07:41.846Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174061309_dro3i7k7r","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:07:41.920Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:07:41.926Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:07:41.933Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:07:41.938Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:07:41.945Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:07:41.950Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:07:43.449Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":499,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T02:07:43.501Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756174061051_59w7g2os5","totalTime":2449,"layerTimings":{"router":43,"transformer":37,"protocol":20,"serverCompatibility":36,"server":2253,"responseTransform":22},"transformationCount":4}}
{"timestamp":"2025-08-26T02:07:43.514Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756174061051_59w7g2os5","executionId":"req_1756174061051_59w7g2os5","totalTime":2449,"success":true}}
{"timestamp":"2025-08-26T02:08:12.358Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821026,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:08:12.369Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174061309_dro3i7k7r","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:08:12.378Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174061309_dro3i7k7r","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:08:12.386Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174061309_dro3i7k7r","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:08:12.393Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174061309_dro3i7k7r","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:08:12.398Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174061309_dro3i7k7r","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:08:12.437Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:12.443Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:12.449Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821026,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:08:41.072Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:08:41.080Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:08:41.086Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:08:41.093Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:08:41.100Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:08:41.103Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:08:41.109Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174121109_7hmpnmj6n","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:08:41.244Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:08:41.249Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174121109_7hmpnmj6n","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:08:41.254Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174121109_7hmpnmj6n","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:08:41.311Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174121109_7hmpnmj6n","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:08:41.390Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174121109_7hmpnmj6n","hasOutput":true}}
{"timestamp":"2025-08-26T02:08:41.395Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174121109_7hmpnmj6n","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:08:41.438Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174121109_7hmpnmj6n","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:08:41.444Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174121109_7hmpnmj6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:08:41.449Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174121109_7hmpnmj6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:08:41.493Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174121109_7hmpnmj6n","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:08:41.541Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174121109_7hmpnmj6n","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:08:41.588Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174121109_7hmpnmj6n","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:08:41.594Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174121109_7hmpnmj6n","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:08:41.600Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174121109_7hmpnmj6n","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:08:41.607Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174121109_7hmpnmj6n","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:08:41.654Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174121109_7hmpnmj6n","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:08:41.659Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174121109_7hmpnmj6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:08:41.664Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174121109_7hmpnmj6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:08:41.740Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:41.746Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:41.751Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:08:41.757Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:08:42.847Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821026,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:08:42.860Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174061309_dro3i7k7r","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:08:42.868Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174061309_dro3i7k7r","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:08:42.877Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174061309_dro3i7k7r","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:08:42.884Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174061309_dro3i7k7r","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:08:42.894Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174061309_dro3i7k7r","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:08:42.938Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:42.946Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:42.953Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821026,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:09:12.261Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821026,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:09:12.277Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174121109_7hmpnmj6n","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:09:12.286Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174121109_7hmpnmj6n","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:09:12.295Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174121109_7hmpnmj6n","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:09:12.302Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174121109_7hmpnmj6n","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:09:12.308Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174121109_7hmpnmj6n","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:09:12.350Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:09:12.357Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:09:12.363Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821026,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:09:13.021Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":691,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:09:13.036Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174061309_dro3i7k7r","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":true,"newPipelineId":"shuaihong-glm-4.5-key0","recoveryAction":"switched","response":{"id":"2025082610084470d643502b574919","object":"","created":1756174153,"model":"ZhipuAI/GLM-4.5","system_fingerprint":"","choices":[{"index":0,"delta":{"role":null,"content":"","tool_calls":null,"function_calls":null,"reasoning_content":""},"finish_reason":"stop","message":{"role":"assistant","content":"\n我注意到我们之前的对话被系统消息打断了。看起来是一个关于GitHub或代码开发的技术性讨论，但最后一条消息显示了一个错误响应（\"bad response status code 504\"）。\n\n如果您有新的问题或想继续之前的讨论，请告诉我您想要讨论的具体内容，我会很乐意为您提供帮助。\n\n例如，如果您想了解：\n- 特定编程语言或框架的问题\n- 代码调试或优化建议\n- 软件开发最佳实践\n- 或任何其他技术主题\n\n请随时提出您的问题，我会尽力协助您。","tool_calls":null,"function_calls":null,"reasoning_content":""}}],"usage":{"prompt_tokens":"[REDACTED]","completion_tokens":"[REDACTED]","total_tokens":"[REDACTED]"}},"recoveryTime":30168,"details":"成功切换到流水线 shuaihong-glm-4.5-key0"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:09:13.044Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174061309_dro3i7k7r","success":true,"recoveryAction":"switched","newPipelineId":"shuaihong-glm-4.5-key0","recoveryTime":30168}}
{"timestamp":"2025-08-26T02:09:13.052Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174061309_dro3i7k7r","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":true,"newPipelineId":"shuaihong-glm-4.5-key0","recoveryAction":"switched","response":{"id":"2025082610084470d643502b574919","object":"","created":1756174153,"model":"ZhipuAI/GLM-4.5","system_fingerprint":"","choices":[{"index":0,"delta":{"role":null,"content":"","tool_calls":null,"function_calls":null,"reasoning_content":""},"finish_reason":"stop","message":{"role":"assistant","content":"\n我注意到我们之前的对话被系统消息打断了。看起来是一个关于GitHub或代码开发的技术性讨论，但最后一条消息显示了一个错误响应（\"bad response status code 504\"）。\n\n如果您有新的问题或想继续之前的讨论，请告诉我您想要讨论的具体内容，我会很乐意为您提供帮助。\n\n例如，如果您想了解：\n- 特定编程语言或框架的问题\n- 代码调试或优化建议\n- 软件开发最佳实践\n- 或任何其他技术主题\n\n请随时提出您的问题，我会尽力协助您。","tool_calls":null,"function_calls":null,"reasoning_content":""}}],"usage":{"prompt_tokens":"[REDACTED]","completion_tokens":"[REDACTED]","total_tokens":"[REDACTED]"}},"recoveryTime":60674,"details":"成功切换到流水线 shuaihong-glm-4.5-key0"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:09:13.059Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174061309_dro3i7k7r","success":true,"recoveryAction":"switched","newPipelineId":"shuaihong-glm-4.5-key0","recoveryTime":60674}}
{"timestamp":"2025-08-26T02:09:13.067Z","level":"INFO","message":"✅ 流水线切换恢复成功","data":{"requestId":"req_1756174061309_dro3i7k7r","originalPipeline":"modelscope-zhipuai-glm-4.5-key0","newPipeline":"shuaihong-glm-4.5-key0","recoveryAction":"switched","recoveryTime":60674}}
{"timestamp":"2025-08-26T02:09:13.100Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756174061309_dro3i7k7r","totalTime":91791,"layerTimings":{"router":139,"transformer":172,"protocol":84,"serverCompatibility":103,"server":91232,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T02:09:13.219Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756174061309_dro3i7k7r","executionId":"req_1756174061309_dro3i7k7r","totalTime":91791,"success":true}}
{"timestamp":"2025-08-26T02:09:41.638Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:09:41.645Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:09:41.650Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:09:41.656Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:09:41.661Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:09:41.664Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:09:41.670Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174181670_d89t4fchr","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:09:41.792Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:09:41.797Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174181670_d89t4fchr","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:09:41.802Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174181670_d89t4fchr","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:09:41.856Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174181670_d89t4fchr","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:09:41.939Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174181670_d89t4fchr","hasOutput":true}}
{"timestamp":"2025-08-26T02:09:41.944Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174181670_d89t4fchr","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:09:41.987Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174181670_d89t4fchr","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:09:41.991Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174181670_d89t4fchr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:09:41.996Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174181670_d89t4fchr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:09:42.040Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174181670_d89t4fchr","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:09:42.084Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174181670_d89t4fchr","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:09:42.130Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174181670_d89t4fchr","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:09:42.135Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174181670_d89t4fchr","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:09:42.140Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174181670_d89t4fchr","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:09:42.147Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174181670_d89t4fchr","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:09:42.191Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174181670_d89t4fchr","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:09:42.197Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174181670_d89t4fchr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:09:42.202Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174181670_d89t4fchr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:09:42.279Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:09:42.286Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:09:42.292Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":884,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:09:42.302Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174121109_7hmpnmj6n","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":true,"newPipelineId":"qwen-qwen3-coder-plus-key0","recoveryAction":"switched","response":{"id":"20250826100913bdf2779600054868","object":"","created":1756174182,"model":"ZhipuAI/GLM-4.5","system_fingerprint":"","choices":[{"index":0,"delta":{"role":null,"content":"","tool_calls":null,"function_calls":null,"reasoning_content":""},"finish_reason":"stop","message":{"role":"assistant","content":"\n\n很抱歉，之前的请求似乎遇到了技术问题（状态码504）。如果这是关于特定任务的延续，请告诉我您希望继续的内容或需要协助的具体方向，我会立即为您处理！ 😊","tool_calls":null,"function_calls":null,"reasoning_content":"嗯，用户只是简单地回复了“继续”，这表示他们希望我继续之前的对话或任务。不过，根据之前的对话历史，我注意到最后一次交互时出现了一个错误消息，显示“bad response status code 504 (request id: 20250826080768961893KA9rPw9B)”和“openai_error”类型。\n\n用户可能是在测试系统稳定性，或者希望我忽略这个错误继续之前的话题。考虑到错误是技术性的，而用户没有提供具体上下文，我会以友好方式确认并询问具体需求。\n\n为了保持对话自然，我会：\n1. 简要提及之前的错误状态，但不过度强调\n2. 表明已准备好继续服务\n3. 邀请用户明确需求，避免重复错误\n\n这样既回应了技术问题，又把主动权交还给用户，符合“继续”的指令。"}}],"usage":{"prompt_tokens":"[REDACTED]","completion_tokens":"[REDACTED]","total_tokens":"[REDACTED]"}},"recoveryTime":30016,"details":"成功切换到流水线 qwen-qwen3-coder-plus-key0"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:09:42.307Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174121109_7hmpnmj6n","success":true,"recoveryAction":"switched","newPipelineId":"qwen-qwen3-coder-plus-key0","recoveryTime":30016}}
{"timestamp":"2025-08-26T02:09:42.312Z","level":"INFO","message":"✅ 流水线切换恢复成功","data":{"requestId":"req_1756174121109_7hmpnmj6n","originalPipeline":"modelscope-zhipuai-glm-4.5-key0","newPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"switched","recoveryTime":30016}}
{"timestamp":"2025-08-26T02:09:42.338Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756174121109_7hmpnmj6n","totalTime":61229,"layerTimings":{"router":153,"transformer":171,"protocol":87,"serverCompatibility":106,"server":60655,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T02:09:42.453Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756174121109_7hmpnmj6n","executionId":"req_1756174121109_7hmpnmj6n","totalTime":61229,"success":true}}
{"timestamp":"2025-08-26T02:09:42.465Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:09:42.471Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:10:11.161Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":774,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:10:11.204Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756174181670_d89t4fchr","totalTime":29534,"layerTimings":{"router":139,"transformer":174,"protocol":83,"serverCompatibility":102,"server":28977,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T02:10:11.326Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756174181670_d89t4fchr","executionId":"req_1756174181670_d89t4fchr","totalTime":29534,"success":true}}
{"timestamp":"2025-08-26T02:11:21.217Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:11:21.223Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:11:21.228Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:11:21.234Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:11:21.239Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:11:21.243Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:11:21.250Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174281250_ry50atn1k","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:11:21.263Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:11:21.268Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174281250_ry50atn1k","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:11:21.274Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174281250_ry50atn1k","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:11:21.294Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174281250_ry50atn1k","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:11:21.309Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174281250_ry50atn1k","hasOutput":true}}
{"timestamp":"2025-08-26T02:11:21.313Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174281250_ry50atn1k","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:11:21.325Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174281250_ry50atn1k","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:11:21.330Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174281250_ry50atn1k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:11:21.335Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174281250_ry50atn1k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:11:21.347Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174281250_ry50atn1k","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:11:21.360Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174281250_ry50atn1k","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:11:21.371Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174281250_ry50atn1k","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:11:21.376Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174281250_ry50atn1k","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:11:21.381Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174281250_ry50atn1k","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:11:21.387Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174281250_ry50atn1k","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:11:21.399Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174281250_ry50atn1k","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:11:21.403Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174281250_ry50atn1k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:11:21.408Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174281250_ry50atn1k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:11:21.422Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":797,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:11:21.456Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:11:21.462Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:11:21.467Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:11:21.472Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:11:21.478Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:11:21.481Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:11:21.486Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174281486_6dj822ztj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:11:21.609Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:11:21.614Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174281486_6dj822ztj","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:11:21.619Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174281486_6dj822ztj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:11:21.671Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174281486_6dj822ztj","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:11:21.761Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174281486_6dj822ztj","hasOutput":true}}
{"timestamp":"2025-08-26T02:11:21.767Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174281486_6dj822ztj","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:11:21.814Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174281486_6dj822ztj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:11:21.820Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174281486_6dj822ztj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:11:21.826Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174281486_6dj822ztj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:11:21.872Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174281486_6dj822ztj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:11:21.916Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174281486_6dj822ztj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:11:21.963Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174281486_6dj822ztj","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:11:21.969Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174281486_6dj822ztj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:11:21.975Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174281486_6dj822ztj","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:11:21.981Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174281486_6dj822ztj","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:11:22.024Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174281486_6dj822ztj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:11:22.029Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174281486_6dj822ztj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:11:22.035Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174281486_6dj822ztj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:11:22.110Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:11:22.117Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:11:22.124Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:11:22.129Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:11:22.137Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:11:22.143Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:11:23.229Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":516,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T02:11:23.275Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756174281250_ry50atn1k","totalTime":2025,"layerTimings":{"router":31,"transformer":39,"protocol":21,"serverCompatibility":35,"server":1848,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T02:11:23.286Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756174281250_ry50atn1k","executionId":"req_1756174281250_ry50atn1k","totalTime":2025,"success":true}}
{"timestamp":"2025-08-26T02:11:52.511Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:11:52.525Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174281486_6dj822ztj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:11:52.535Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:11:52.545Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174281486_6dj822ztj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:11:52.551Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174281486_6dj822ztj","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:11:52.558Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:11:52.597Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:11:52.604Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:11:52.611Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:12:21.300Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:12:21.309Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:12:21.316Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:12:21.322Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:12:21.329Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:12:21.334Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:12:21.341Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174341341_c4eygziid","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:12:21.477Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:12:21.482Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174341341_c4eygziid","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:12:21.487Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174341341_c4eygziid","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:12:21.542Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174341341_c4eygziid","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:12:21.632Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174341341_c4eygziid","hasOutput":true}}
{"timestamp":"2025-08-26T02:12:21.637Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174341341_c4eygziid","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:12:21.681Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174341341_c4eygziid","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:12:21.687Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174341341_c4eygziid","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:12:21.693Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174341341_c4eygziid","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:12:21.737Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174341341_c4eygziid","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:12:21.784Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174341341_c4eygziid","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:12:21.830Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174341341_c4eygziid","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:12:21.836Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174341341_c4eygziid","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:12:21.841Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174341341_c4eygziid","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:12:21.848Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174341341_c4eygziid","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:12:21.892Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174341341_c4eygziid","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:12:21.897Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174341341_c4eygziid","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:12:21.903Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174341341_c4eygziid","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:12:21.978Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:21.985Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:21.991Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:12:21.996Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:12:23.036Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:12:23.048Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:23.057Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:23.066Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174281486_6dj822ztj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:12:23.074Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174281486_6dj822ztj","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:12:23.080Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:12:23.123Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:23.130Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:23.136Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:12:52.432Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:12:52.449Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174341341_c4eygziid","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:52.459Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:52.468Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174341341_c4eygziid","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:12:52.477Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174341341_c4eygziid","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:12:52.484Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:12:52.526Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:52.532Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:52.538Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:12:53.593Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:12:53.611Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:53.621Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:53.631Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174281486_6dj822ztj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:12:53.639Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174281486_6dj822ztj","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:12:53.647Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:12:53.688Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:53.695Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:53.701Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:13:21.905Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:13:21.914Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:13:21.920Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:13:21.926Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:13:21.932Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:13:21.937Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:13:21.943Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174401943_7txp8b3kd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:13:22.066Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:13:22.071Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174401943_7txp8b3kd","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:13:22.077Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174401943_7txp8b3kd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:13:22.132Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174401943_7txp8b3kd","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:13:22.228Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174401943_7txp8b3kd","hasOutput":true}}
{"timestamp":"2025-08-26T02:13:22.233Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174401943_7txp8b3kd","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:13:22.278Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174401943_7txp8b3kd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:13:22.284Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174401943_7txp8b3kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:13:22.289Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174401943_7txp8b3kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:13:22.333Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174401943_7txp8b3kd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:13:22.378Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174401943_7txp8b3kd","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:13:22.424Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174401943_7txp8b3kd","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:13:22.429Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174401943_7txp8b3kd","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:13:22.435Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174401943_7txp8b3kd","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:13:22.442Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174401943_7txp8b3kd","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:13:22.485Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174401943_7txp8b3kd","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:13:22.491Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174401943_7txp8b3kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:13:22.497Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174401943_7txp8b3kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:13:22.570Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:22.577Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:22.586Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:13:22.592Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:13:22.941Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:13:22.954Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:22.962Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:22.968Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174341341_c4eygziid","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:13:22.975Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174341341_c4eygziid","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:13:22.982Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:13:23.022Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:23.028Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:23.034Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:13:24.116Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:13:24.141Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:24.152Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30531,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:13:24.161Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174281486_6dj822ztj","success":false,"recoveryAction":"failed","recoveryTime":30531}}
{"timestamp":"2025-08-26T02:13:24.169Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":61112,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:13:24.178Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174281486_6dj822ztj","success":false,"recoveryAction":"failed","recoveryTime":61112}}
{"timestamp":"2025-08-26T02:13:24.185Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91650,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:13:24.191Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174281486_6dj822ztj","success":false,"recoveryAction":"failed","recoveryTime":91650}}
{"timestamp":"2025-08-26T02:13:24.197Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:13:24.203Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174281486_6dj822ztj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:13:24.212Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174281486_6dj822ztj","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":140,"transformer":183,"protocol":85,"serverCompatibility":103},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:13:24.217Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174281486_6dj822ztj","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:24.333Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:13:24.343Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:13:53.034Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:13:53.045Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174401943_7txp8b3kd","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:53.053Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:53.060Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174401943_7txp8b3kd","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:13:53.068Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174401943_7txp8b3kd","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:13:53.074Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:13:53.115Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:53.121Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:53.127Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:13:53.455Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:13:53.473Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:53.484Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:53.493Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174341341_c4eygziid","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:13:53.501Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174341341_c4eygziid","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:13:53.509Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:13:53.551Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:53.558Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:53.564Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:14:23.127Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:14:23.135Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:14:23.141Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:14:23.147Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:14:23.153Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:14:23.158Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:14:23.164Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174463164_3flxesoxa","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:14:23.301Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:14:23.307Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174463164_3flxesoxa","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:14:23.312Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174463164_3flxesoxa","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:14:23.372Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174463164_3flxesoxa","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:14:23.475Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174463164_3flxesoxa","hasOutput":true}}
{"timestamp":"2025-08-26T02:14:23.481Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174463164_3flxesoxa","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:14:23.532Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174463164_3flxesoxa","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:14:23.538Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174463164_3flxesoxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:14:23.544Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174463164_3flxesoxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:14:23.595Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174463164_3flxesoxa","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:14:23.639Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174463164_3flxesoxa","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:14:23.684Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174463164_3flxesoxa","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:14:23.691Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174463164_3flxesoxa","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:14:23.697Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174463164_3flxesoxa","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:14:23.704Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174463164_3flxesoxa","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:14:23.748Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174463164_3flxesoxa","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:14:23.754Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174463164_3flxesoxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:14:23.759Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174463164_3flxesoxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:14:23.834Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:23.841Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:23.847Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:14:23.853Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:23.858Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:23.864Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174401943_7txp8b3kd","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:14:23.869Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174401943_7txp8b3kd","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:14:23.874Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:14:23.909Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:23.915Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:23.922Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:14:23.931Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:14:23.936Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:14:24.000Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:14:24.007Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:24.014Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30530,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:14:24.020Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174341341_c4eygziid","success":false,"recoveryAction":"failed","recoveryTime":30530}}
{"timestamp":"2025-08-26T02:14:24.026Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":61064,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:14:24.031Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174341341_c4eygziid","success":false,"recoveryAction":"failed","recoveryTime":61064}}
{"timestamp":"2025-08-26T02:14:24.037Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91578,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:14:24.042Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174341341_c4eygziid","success":false,"recoveryAction":"failed","recoveryTime":91578}}
{"timestamp":"2025-08-26T02:14:24.047Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174341341_c4eygziid","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:14:24.053Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174341341_c4eygziid","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:14:24.061Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174341341_c4eygziid","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":152,"transformer":182,"protocol":85,"serverCompatibility":102},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:14:24.066Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174341341_c4eygziid","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:24.179Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:14:24.188Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:14:54.525Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:14:54.532Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174463164_3flxesoxa","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:54.539Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:54.546Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174463164_3flxesoxa","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:14:54.552Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174463164_3flxesoxa","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:14:54.559Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:14:54.600Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:54.608Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:54.614Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:14:55.760Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:14:55.770Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:55.777Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:55.784Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174401943_7txp8b3kd","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:14:55.791Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174401943_7txp8b3kd","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:14:55.798Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:14:55.844Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:55.850Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:55.855Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:15:25.013Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:15:25.024Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:25.033Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:25.040Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174463164_3flxesoxa","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:15:25.048Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174463164_3flxesoxa","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:15:25.054Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:15:25.093Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:25.100Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:25.106Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:15:25.262Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:15:25.270Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:15:25.277Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:15:25.285Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:15:25.291Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:15:25.296Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:15:25.302Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174525302_e247ktf5s","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:15:25.442Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:15:25.448Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174525302_e247ktf5s","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:15:25.454Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174525302_e247ktf5s","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:15:25.509Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174525302_e247ktf5s","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:15:25.610Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174525302_e247ktf5s","hasOutput":true}}
{"timestamp":"2025-08-26T02:15:25.615Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174525302_e247ktf5s","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:15:25.662Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174525302_e247ktf5s","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:15:25.668Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174525302_e247ktf5s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:15:25.674Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174525302_e247ktf5s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:15:25.722Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174525302_e247ktf5s","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:15:25.770Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174525302_e247ktf5s","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:15:25.818Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174525302_e247ktf5s","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:15:25.825Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174525302_e247ktf5s","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:15:25.831Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174525302_e247ktf5s","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:15:25.839Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174525302_e247ktf5s","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:15:25.885Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174525302_e247ktf5s","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:15:25.892Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174525302_e247ktf5s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:15:25.897Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174525302_e247ktf5s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:15:25.973Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:25.980Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:25.987Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:15:25.992Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:15:26.265Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:15:26.274Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:26.282Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30505,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:15:26.291Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174401943_7txp8b3kd","success":false,"recoveryAction":"failed","recoveryTime":30505}}
{"timestamp":"2025-08-26T02:15:26.298Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":62440,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:15:26.304Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174401943_7txp8b3kd","success":false,"recoveryAction":"failed","recoveryTime":62440}}
{"timestamp":"2025-08-26T02:15:26.309Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":93256,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:15:26.315Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174401943_7txp8b3kd","success":false,"recoveryAction":"failed","recoveryTime":93256}}
{"timestamp":"2025-08-26T02:15:26.320Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:15:26.325Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174401943_7txp8b3kd","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:15:26.334Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174401943_7txp8b3kd","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":139,"transformer":190,"protocol":84,"serverCompatibility":101},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:15:26.339Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174401943_7txp8b3kd","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:26.459Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:15:26.468Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:15:56.104Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:15:56.111Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:56.117Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:56.123Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174463164_3flxesoxa","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:15:56.129Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174463164_3flxesoxa","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:15:56.135Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:15:56.177Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:56.184Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:56.190Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:15:56.581Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:15:56.588Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174525302_e247ktf5s","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:56.594Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:56.600Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174525302_e247ktf5s","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:15:56.605Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174525302_e247ktf5s","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:15:56.611Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:15:56.652Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:56.660Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:56.666Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:16:26.666Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:16:26.673Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:26.679Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30562,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:16:26.685Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174463164_3flxesoxa","success":false,"recoveryAction":"failed","recoveryTime":30562}}
{"timestamp":"2025-08-26T02:16:26.691Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":61658,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:16:26.697Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174463164_3flxesoxa","success":false,"recoveryAction":"failed","recoveryTime":61658}}
{"timestamp":"2025-08-26T02:16:26.702Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":92163,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:16:26.708Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174463164_3flxesoxa","success":false,"recoveryAction":"failed","recoveryTime":92163}}
{"timestamp":"2025-08-26T02:16:26.713Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:16:26.718Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174463164_3flxesoxa","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:16:26.727Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174463164_3flxesoxa","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":156,"transformer":206,"protocol":90,"serverCompatibility":102},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:16:26.733Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174463164_3flxesoxa","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:26.861Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:16:26.871Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:16:27.089Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:16:27.097Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:27.102Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:27.108Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174525302_e247ktf5s","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:16:27.114Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174525302_e247ktf5s","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:16:27.119Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:16:27.161Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:27.168Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:27.174Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:16:29.533Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:16:29.540Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:16:29.546Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:16:29.551Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:16:29.557Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:16:29.562Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:16:29.568Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174589568_d04bpqfxx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:16:29.707Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:16:29.713Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174589568_d04bpqfxx","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:16:29.718Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174589568_d04bpqfxx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:16:29.783Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174589568_d04bpqfxx","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:16:29.894Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174589568_d04bpqfxx","hasOutput":true}}
{"timestamp":"2025-08-26T02:16:29.900Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174589568_d04bpqfxx","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:16:29.945Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174589568_d04bpqfxx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:16:29.951Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174589568_d04bpqfxx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:16:29.958Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174589568_d04bpqfxx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:16:30.009Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174589568_d04bpqfxx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:16:30.062Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174589568_d04bpqfxx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:16:30.112Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174589568_d04bpqfxx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:16:30.118Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174589568_d04bpqfxx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:16:30.124Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174589568_d04bpqfxx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:16:30.132Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174589568_d04bpqfxx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:16:30.181Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174589568_d04bpqfxx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:16:30.187Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174589568_d04bpqfxx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:16:30.193Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174589568_d04bpqfxx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:16:30.280Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:30.288Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:30.296Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:16:30.302Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:16:57.618Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:16:57.631Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:57.640Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:57.648Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174525302_e247ktf5s","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:16:57.656Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174525302_e247ktf5s","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:16:57.663Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:16:57.703Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:57.710Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:57.716Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:17:00.645Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:17:00.657Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174589568_d04bpqfxx","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:00.665Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:00.672Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174589568_d04bpqfxx","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:17:00.678Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174589568_d04bpqfxx","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:17:00.683Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:17:00.722Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:00.728Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:00.734Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:17:28.160Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:17:28.173Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:28.182Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30542,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:17:28.191Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174525302_e247ktf5s","success":false,"recoveryAction":"failed","recoveryTime":30542}}
{"timestamp":"2025-08-26T02:17:28.199Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":61097,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:17:28.207Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174525302_e247ktf5s","success":false,"recoveryAction":"failed","recoveryTime":61097}}
{"timestamp":"2025-08-26T02:17:28.213Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91619,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:17:28.219Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174525302_e247ktf5s","success":false,"recoveryAction":"failed","recoveryTime":91619}}
{"timestamp":"2025-08-26T02:17:28.225Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:17:28.231Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174525302_e247ktf5s","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:17:28.239Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174525302_e247ktf5s","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":158,"transformer":196,"protocol":90,"serverCompatibility":108},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:17:28.244Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174525302_e247ktf5s","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:28.362Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:17:28.370Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:17:31.149Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:17:31.161Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:31.171Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:31.179Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174589568_d04bpqfxx","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:17:31.186Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174589568_d04bpqfxx","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:17:31.193Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:17:31.234Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:31.241Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:31.247Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:17:37.997Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:17:38.005Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:17:38.010Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:17:38.017Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:17:38.022Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:17:38.027Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:17:38.033Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174658033_th32z5mvk","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:17:38.157Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:17:38.163Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174658033_th32z5mvk","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:17:38.168Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174658033_th32z5mvk","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:17:38.224Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174658033_th32z5mvk","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:17:38.327Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174658033_th32z5mvk","hasOutput":true}}
{"timestamp":"2025-08-26T02:17:38.332Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174658033_th32z5mvk","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:17:38.376Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174658033_th32z5mvk","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:17:38.382Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174658033_th32z5mvk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:17:38.387Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174658033_th32z5mvk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:17:38.430Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174658033_th32z5mvk","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:17:38.478Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174658033_th32z5mvk","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:17:38.523Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174658033_th32z5mvk","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:17:38.529Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174658033_th32z5mvk","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:17:38.534Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174658033_th32z5mvk","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:17:38.542Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174658033_th32z5mvk","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:17:38.585Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174658033_th32z5mvk","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:17:38.591Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174658033_th32z5mvk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:17:38.596Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174658033_th32z5mvk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:17:38.669Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:38.676Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:38.684Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:17:38.690Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:18:01.635Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:18:01.646Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:01.653Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:01.661Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174589568_d04bpqfxx","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:18:01.669Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174589568_d04bpqfxx","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:18:01.676Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:18:01.715Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:01.721Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:01.727Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:18:09.060Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:18:09.074Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174658033_th32z5mvk","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:09.083Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:09.090Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174658033_th32z5mvk","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:18:09.099Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174658033_th32z5mvk","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:18:09.106Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:18:09.148Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:09.154Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:09.161Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:18:32.128Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:18:32.140Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:32.149Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30496,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:18:32.158Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174589568_d04bpqfxx","success":false,"recoveryAction":"failed","recoveryTime":30496}}
{"timestamp":"2025-08-26T02:18:32.165Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":60994,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:18:32.172Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174589568_d04bpqfxx","success":false,"recoveryAction":"failed","recoveryTime":60994}}
{"timestamp":"2025-08-26T02:18:32.177Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91512,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:18:32.182Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174589568_d04bpqfxx","success":false,"recoveryAction":"failed","recoveryTime":91512}}
{"timestamp":"2025-08-26T02:18:32.187Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:18:32.193Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174589568_d04bpqfxx","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:18:32.201Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174589568_d04bpqfxx","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":157,"transformer":214,"protocol":98,"serverCompatibility":113},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:18:32.207Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174589568_d04bpqfxx","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:32.324Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:18:32.333Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:18:39.574Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:18:39.586Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:39.596Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:39.604Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174658033_th32z5mvk","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:18:39.613Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174658033_th32z5mvk","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:18:39.620Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:18:39.660Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:39.666Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:39.672Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:18:56.524Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:18:56.533Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:18:56.539Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:18:56.546Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:18:56.552Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:18:56.557Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:18:56.564Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174736564_0soxr0tjn","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:18:56.688Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:18:56.693Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174736564_0soxr0tjn","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:18:56.698Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174736564_0soxr0tjn","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:18:56.749Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174736564_0soxr0tjn","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:18:56.853Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174736564_0soxr0tjn","hasOutput":true}}
{"timestamp":"2025-08-26T02:18:56.860Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174736564_0soxr0tjn","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:18:56.903Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174736564_0soxr0tjn","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:18:56.909Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174736564_0soxr0tjn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:18:56.915Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174736564_0soxr0tjn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:18:56.959Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174736564_0soxr0tjn","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:18:57.005Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174736564_0soxr0tjn","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:18:57.049Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174736564_0soxr0tjn","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:18:57.055Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174736564_0soxr0tjn","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:18:57.060Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174736564_0soxr0tjn","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:18:57.068Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174736564_0soxr0tjn","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:18:57.111Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174736564_0soxr0tjn","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:18:57.116Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174736564_0soxr0tjn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:18:57.121Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174736564_0soxr0tjn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:18:57.196Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:57.202Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:57.209Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:18:57.214Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:19:10.040Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:19:10.052Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:10.059Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:10.067Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174658033_th32z5mvk","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:19:10.074Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174658033_th32z5mvk","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:19:10.081Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:19:10.119Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:10.127Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:10.133Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:19:27.667Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:19:27.678Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174736564_0soxr0tjn","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:27.686Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:27.694Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174736564_0soxr0tjn","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:19:27.702Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174736564_0soxr0tjn","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:19:27.708Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:19:27.748Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:27.755Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:27.761Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:19:40.542Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:19:40.560Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:40.571Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30512,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:19:40.581Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174658033_th32z5mvk","success":false,"recoveryAction":"failed","recoveryTime":30512}}
{"timestamp":"2025-08-26T02:19:40.589Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":60993,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:19:40.599Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174658033_th32z5mvk","success":false,"recoveryAction":"failed","recoveryTime":60993}}
{"timestamp":"2025-08-26T02:19:40.607Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91524,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:19:40.614Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174658033_th32z5mvk","success":false,"recoveryAction":"failed","recoveryTime":91524}}
{"timestamp":"2025-08-26T02:19:40.621Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:19:40.627Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174658033_th32z5mvk","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:19:40.636Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174658033_th32z5mvk","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":144,"transformer":194,"protocol":86,"serverCompatibility":100},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:19:40.642Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174658033_th32z5mvk","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:40.760Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:19:40.768Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:19:58.110Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:19:58.120Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:58.128Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:58.136Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174736564_0soxr0tjn","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:19:58.143Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174736564_0soxr0tjn","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:19:58.150Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:19:58.189Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:58.195Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:58.200Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:20:28.601Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:20:28.612Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:20:28.621Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:20:28.627Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174736564_0soxr0tjn","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:20:28.634Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174736564_0soxr0tjn","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:20:28.641Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:20:28.681Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:20:28.688Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:20:28.694Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:20:31.660Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:20:31.667Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:20:31.673Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:20:31.679Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:20:31.685Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:20:31.690Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:20:31.696Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174831696_sv5seuidj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:20:31.819Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:20:31.824Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174831696_sv5seuidj","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:20:31.828Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174831696_sv5seuidj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:20:31.880Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174831696_sv5seuidj","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:20:31.987Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174831696_sv5seuidj","hasOutput":true}}
{"timestamp":"2025-08-26T02:20:31.993Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174831696_sv5seuidj","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:20:32.037Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174831696_sv5seuidj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:20:32.043Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174831696_sv5seuidj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:20:32.049Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174831696_sv5seuidj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:20:32.096Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174831696_sv5seuidj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:20:32.142Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174831696_sv5seuidj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:20:32.188Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174831696_sv5seuidj","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:20:32.194Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174831696_sv5seuidj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:20:32.199Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174831696_sv5seuidj","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:20:32.207Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174831696_sv5seuidj","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:20:32.250Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174831696_sv5seuidj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:20:32.255Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174831696_sv5seuidj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:20:32.261Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174831696_sv5seuidj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:20:32.337Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:20:32.343Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:20:32.350Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:20:32.357Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:20:59.103Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:20:59.110Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:20:59.116Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30495,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:20:59.121Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174736564_0soxr0tjn","success":false,"recoveryAction":"failed","recoveryTime":30495}}
{"timestamp":"2025-08-26T02:20:59.127Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":60999,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:20:59.132Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174736564_0soxr0tjn","success":false,"recoveryAction":"failed","recoveryTime":60999}}
{"timestamp":"2025-08-26T02:20:59.138Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91452,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:20:59.143Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174736564_0soxr0tjn","success":false,"recoveryAction":"failed","recoveryTime":91452}}
{"timestamp":"2025-08-26T02:20:59.148Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:20:59.153Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174736564_0soxr0tjn","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:20:59.161Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174736564_0soxr0tjn","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":140,"transformer":194,"protocol":84,"serverCompatibility":100},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:20:59.167Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174736564_0soxr0tjn","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:20:59.284Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:20:59.293Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:21:02.736Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:21:02.747Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174831696_sv5seuidj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:21:02.755Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:21:02.763Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174831696_sv5seuidj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:21:02.770Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174831696_sv5seuidj","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:21:02.777Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:21:02.818Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:21:02.825Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:21:02.830Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:21:33.255Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:21:33.276Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:21:33.285Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:21:33.293Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174831696_sv5seuidj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:21:33.301Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174831696_sv5seuidj","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:21:33.310Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:21:33.353Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:21:33.361Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:21:33.366Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:22:03.792Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:22:03.802Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:03.811Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:03.818Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174831696_sv5seuidj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:22:03.825Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174831696_sv5seuidj","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:22:03.831Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:22:03.871Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:03.878Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:03.883Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:22:07.362Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:22:07.369Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:22:07.376Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:22:07.382Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:22:07.388Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:22:07.393Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:22:07.399Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174927399_5rh3txotp","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:22:07.524Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:22:07.529Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174927399_5rh3txotp","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:22:07.535Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174927399_5rh3txotp","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:22:07.589Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174927399_5rh3txotp","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:22:07.700Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174927399_5rh3txotp","hasOutput":true}}
{"timestamp":"2025-08-26T02:22:07.707Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174927399_5rh3txotp","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:22:07.752Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174927399_5rh3txotp","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:22:07.758Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174927399_5rh3txotp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:22:07.764Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174927399_5rh3txotp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:22:07.810Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174927399_5rh3txotp","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:22:07.855Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174927399_5rh3txotp","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:22:07.900Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174927399_5rh3txotp","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:22:07.906Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174927399_5rh3txotp","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:22:07.912Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174927399_5rh3txotp","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:22:07.921Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174927399_5rh3txotp","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:22:07.965Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174927399_5rh3txotp","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:22:07.971Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174927399_5rh3txotp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:22:07.976Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174927399_5rh3txotp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:22:08.051Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:08.058Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:08.064Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:22:08.070Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:22:34.279Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:22:34.287Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:34.294Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30483,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:22:34.301Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174831696_sv5seuidj","success":false,"recoveryAction":"failed","recoveryTime":30483}}
{"timestamp":"2025-08-26T02:22:34.307Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":61022,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:22:34.314Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174831696_sv5seuidj","success":false,"recoveryAction":"failed","recoveryTime":61022}}
{"timestamp":"2025-08-26T02:22:34.319Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91564,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:22:34.325Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174831696_sv5seuidj","success":false,"recoveryAction":"failed","recoveryTime":91564}}
{"timestamp":"2025-08-26T02:22:34.331Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:22:34.337Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174831696_sv5seuidj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:22:34.345Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174831696_sv5seuidj","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":140,"transformer":197,"protocol":87,"serverCompatibility":101},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:22:34.351Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174831696_sv5seuidj","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:34.469Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:22:34.478Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:22:38.528Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:22:38.538Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174927399_5rh3txotp","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:38.544Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:38.552Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174927399_5rh3txotp","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:22:38.559Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174927399_5rh3txotp","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:22:38.565Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:22:38.604Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:38.610Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:38.616Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:23:09.054Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:23:09.081Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:23:09.092Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:23:09.102Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174927399_5rh3txotp","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:23:09.112Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174927399_5rh3txotp","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:23:09.121Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:23:09.162Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:09.168Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:09.175Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:23:16.112Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":107,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:23:16.136Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756174927399_5rh3txotp","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1210\",\"message\":\"API 调用参数有误，请检查文档。\"},\"request_id\":\"8d65ac02-269b-40ac-aa65-2118e7c04047\"}","extractedErrorMessage":"API 调用参数有误，请检查文档。"}}
{"timestamp":"2025-08-26T02:23:16.147Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"shuaihong-glm-4.5-key0","error":"API 调用参数有误，请检查文档。"}}
{"timestamp":"2025-08-26T02:23:16.158Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"API 调用参数有误，请检查文档。"}}
{"timestamp":"2025-08-26T02:23:16.167Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174927399_5rh3txotp","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T02:23:16.175Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174927399_5rh3txotp","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:23:16.183Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:23:16.223Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:16.229Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:43.233Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:23:43.242Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:23:43.248Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:23:43.255Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:23:43.261Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:23:43.268Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:23:43.275Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756175023275_vbkllsdqd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:23:43.406Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:23:43.412Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756175023275_vbkllsdqd","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:23:43.417Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756175023275_vbkllsdqd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:23:43.469Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756175023275_vbkllsdqd","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:23:43.581Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756175023275_vbkllsdqd","hasOutput":true}}
{"timestamp":"2025-08-26T02:23:43.586Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756175023275_vbkllsdqd","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:23:43.630Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175023275_vbkllsdqd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:23:43.636Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175023275_vbkllsdqd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:23:43.642Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756175023275_vbkllsdqd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:23:43.685Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756175023275_vbkllsdqd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:23:43.733Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756175023275_vbkllsdqd","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:23:43.779Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756175023275_vbkllsdqd","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:23:43.785Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756175023275_vbkllsdqd","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:23:43.792Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756175023275_vbkllsdqd","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:23:43.801Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756175023275_vbkllsdqd","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:23:43.848Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175023275_vbkllsdqd","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:23:43.854Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175023275_vbkllsdqd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:23:43.860Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756175023275_vbkllsdqd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:23:43.940Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:43.948Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:43.954Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:23:43.960Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:23:46.713Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:23:46.726Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:23:46.733Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30575,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T02:23:46.739Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174927399_5rh3txotp","success":false,"recoveryAction":"failed","recoveryTime":30575}}
{"timestamp":"2025-08-26T02:23:46.745Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":37653,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:23:46.752Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174927399_5rh3txotp","success":false,"recoveryAction":"failed","recoveryTime":37653}}
{"timestamp":"2025-08-26T02:23:46.757Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":68213,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:23:46.763Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174927399_5rh3txotp","success":false,"recoveryAction":"failed","recoveryTime":68213}}
{"timestamp":"2025-08-26T02:23:46.769Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:23:46.775Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174927399_5rh3txotp","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:23:46.785Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174927399_5rh3txotp","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":143,"transformer":205,"protocol":86,"serverCompatibility":104},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:23:46.792Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174927399_5rh3txotp","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:23:46.919Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:23:46.929Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:24:14.396Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:24:14.405Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756175023275_vbkllsdqd","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:24:14.411Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:24:14.417Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175023275_vbkllsdqd","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:24:14.423Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175023275_vbkllsdqd","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:24:14.429Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:24:14.467Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:14.474Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:14.480Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:24:15.544Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:24:15.552Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175023275_vbkllsdqd","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"5c58fdce-5ea0-480e-8ebf-c2ba5485b246\"}"}}
{"timestamp":"2025-08-26T02:24:15.558Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:24:15.564Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:24:15.570Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175023275_vbkllsdqd","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:24:15.576Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175023275_vbkllsdqd","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:24:15.581Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:24:15.619Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:15.625Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:16.648Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:24:16.660Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175023275_vbkllsdqd","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"ec31a1a7-c444-4eb4-a0b7-3136d8ca1ada\"}"}}
{"timestamp":"2025-08-26T02:24:16.668Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:24:16.675Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:24:16.683Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175023275_vbkllsdqd","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:24:16.688Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175023275_vbkllsdqd","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:24:16.694Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:24:16.731Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:16.737Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:46.943Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:24:46.954Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:24:46.963Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30288,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:24:46.973Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175023275_vbkllsdqd","success":false,"recoveryAction":"failed","recoveryTime":30288}}
{"timestamp":"2025-08-26T02:24:46.982Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":31418,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:24:46.990Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175023275_vbkllsdqd","success":false,"recoveryAction":"failed","recoveryTime":31418}}
{"timestamp":"2025-08-26T02:24:46.997Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":32586,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:24:47.004Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175023275_vbkllsdqd","success":false,"recoveryAction":"failed","recoveryTime":32586}}
{"timestamp":"2025-08-26T02:24:47.010Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:24:47.015Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756175023275_vbkllsdqd","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:24:47.022Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756175023275_vbkllsdqd","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":147,"transformer":201,"protocol":86,"serverCompatibility":109},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:24:47.028Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756175023275_vbkllsdqd","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:24:47.147Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:24:47.155Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:25:17.237Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:25:17.246Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:25:17.252Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:25:17.257Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:25:17.264Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:25:17.270Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:25:17.276Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756175117276_iy6yw01h0","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:25:17.399Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:25:17.404Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756175117276_iy6yw01h0","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:25:17.409Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756175117276_iy6yw01h0","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:25:17.461Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756175117276_iy6yw01h0","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:25:17.575Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756175117276_iy6yw01h0","hasOutput":true}}
{"timestamp":"2025-08-26T02:25:17.581Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756175117276_iy6yw01h0","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:25:17.628Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175117276_iy6yw01h0","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:25:17.634Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175117276_iy6yw01h0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:25:17.640Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756175117276_iy6yw01h0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:25:17.685Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756175117276_iy6yw01h0","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:25:17.729Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756175117276_iy6yw01h0","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:25:17.774Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756175117276_iy6yw01h0","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:25:17.779Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756175117276_iy6yw01h0","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:25:17.784Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756175117276_iy6yw01h0","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:25:17.792Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756175117276_iy6yw01h0","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:25:17.835Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175117276_iy6yw01h0","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:25:17.840Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175117276_iy6yw01h0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:25:17.845Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756175117276_iy6yw01h0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:25:17.919Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:17.926Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:17.932Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:25:17.938Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:25:20.161Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:25:20.173Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175117276_iy6yw01h0","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"2498d072-8922-4276-91f3-a4ead376899e\"}"}}
{"timestamp":"2025-08-26T02:25:20.179Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756175117276_iy6yw01h0","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:20.184Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:20.189Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175117276_iy6yw01h0","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:25:20.195Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175117276_iy6yw01h0","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:25:20.201Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:25:20.240Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:20.246Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:21.145Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:25:21.159Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175117276_iy6yw01h0","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"4feb7518-e4d1-4e27-b821-e91fc77cc283\"}"}}
{"timestamp":"2025-08-26T02:25:21.168Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:21.176Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:21.184Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175117276_iy6yw01h0","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:25:21.192Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175117276_iy6yw01h0","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:25:21.199Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:25:21.237Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:21.242Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:22.003Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:25:22.019Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175117276_iy6yw01h0","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"dfc73fe9-34ad-4422-b372-31f315bcd07d\"}"}}
{"timestamp":"2025-08-26T02:25:22.028Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:22.036Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:22.043Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175117276_iy6yw01h0","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:25:22.051Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175117276_iy6yw01h0","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:25:22.058Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:25:22.098Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:22.104Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:23.009Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:25:23.019Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175117276_iy6yw01h0","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"6bd311f2-8ce6-4734-a48f-224ee0b909cb\"}"}}
{"timestamp":"2025-08-26T02:25:23.027Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:23.034Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":998,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:25:23.040Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175117276_iy6yw01h0","success":false,"recoveryAction":"failed","recoveryTime":998}}
{"timestamp":"2025-08-26T02:25:23.046Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":1870,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:25:23.053Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175117276_iy6yw01h0","success":false,"recoveryAction":"failed","recoveryTime":1870}}
{"timestamp":"2025-08-26T02:25:23.059Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":2875,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:25:23.064Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175117276_iy6yw01h0","success":false,"recoveryAction":"failed","recoveryTime":2875}}
{"timestamp":"2025-08-26T02:25:23.070Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:25:23.075Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756175117276_iy6yw01h0","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:25:23.084Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756175117276_iy6yw01h0","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:290:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":139,"transformer":207,"protocol":84,"serverCompatibility":100},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:25:23.090Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756175117276_iy6yw01h0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:23.209Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:35:48.647Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T02:35:48.651Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T02:35:48.655Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T02:35:48.658Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T02:35:48.661Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T02:35:48.665Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:35:48.668Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:35:48.672Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:35:48.675Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:35:48.678Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T02:35:48.681Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:35:48.684Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:35:49.687Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T02:35:51.248Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T02:35:51.254Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T02:35:51.265Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T02:35:51.271Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T02:35:51.276Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T02:35:51.281Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T02:35:51.283Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T02:35:51.288Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T02:35:51.294Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T02:35:51.299Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T02:35:51.305Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:35:51.310Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:35:51.313Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:35:51.319Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T02:35:51.324Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T02:35:51.327Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:35:51.332Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:35:51.337Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T02:35:51.343Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T02:35:51.349Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T02:35:51.354Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:35:51.360Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:35:51.366Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T02:35:51.371Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":44,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T02:35:51.377Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T02:35:51.386Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T02:35:51.392Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":44,"uptime":0}}
{"timestamp":"2025-08-26T02:35:51.397Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T02:35:51.403Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:35:51.409Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:38:06.378Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages","hasBody":true}}
{"timestamp":"2025-08-26T02:38:06.384Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:38:06.390Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:38:06.396Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:38:06.402Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:38:06.405Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:38:06.411Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756175886411_2ybggbdqj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:38:06.436Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:38:06.442Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756175886411_2ybggbdqj","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:38:06.448Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T02:38:06.454Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T02:38:06.460Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756175886411_2ybggbdqj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:38:06.482Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756175886411_2ybggbdqj","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:38:06.494Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756175886411_2ybggbdqj","hasOutput":true}}
{"timestamp":"2025-08-26T02:38:06.500Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756175886411_2ybggbdqj","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:38:06.514Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175886411_2ybggbdqj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:38:06.520Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175886411_2ybggbdqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:38:06.525Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756175886411_2ybggbdqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:38:06.539Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756175886411_2ybggbdqj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:38:06.552Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756175886411_2ybggbdqj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:38:06.565Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756175886411_2ybggbdqj","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:38:06.571Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756175886411_2ybggbdqj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:38:06.577Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756175886411_2ybggbdqj","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:38:06.583Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756175886411_2ybggbdqj","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:38:06.595Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175886411_2ybggbdqj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:38:06.599Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175886411_2ybggbdqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:38:06.604Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756175886411_2ybggbdqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:38:06.618Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":703,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:38:06.631Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:38:06.636Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:38:36.788Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"originalTimeout":30000,"bodySize":703,"isLongTextRequest":false,"suggestion":"考虑检查网络连接"}}
{"timestamp":"2025-08-26T02:38:36.802Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756175886411_2ybggbdqj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:38:36.811Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:38:36.819Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175886411_2ybggbdqj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:38:36.827Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175886411_2ybggbdqj","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:38:36.834Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:38:36.844Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":703,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:38:36.852Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":703,"isLongTextRequest":false,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:39:07.062Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"originalTimeout":30000,"bodySize":703,"isLongTextRequest":false,"suggestion":"考虑检查网络连接"}}
{"timestamp":"2025-08-26T02:39:07.073Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:39:07.083Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:39:07.091Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175886411_2ybggbdqj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:39:07.097Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175886411_2ybggbdqj","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:39:07.103Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:39:07.113Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":703,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:39:07.120Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":703,"isLongTextRequest":false,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:39:37.282Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"originalTimeout":30000,"bodySize":703,"isLongTextRequest":false,"suggestion":"考虑检查网络连接"}}
{"timestamp":"2025-08-26T02:39:37.288Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:39:37.293Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:39:37.299Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175886411_2ybggbdqj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:39:37.304Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175886411_2ybggbdqj","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:39:37.310Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:39:37.318Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":703,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:39:37.324Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":703,"isLongTextRequest":false,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:40:07.486Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"originalTimeout":30000,"bodySize":703,"isLongTextRequest":false,"suggestion":"考虑检查网络连接"}}
{"timestamp":"2025-08-26T02:40:07.498Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:40:07.507Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30214,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:40:07.516Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175886411_2ybggbdqj","success":false,"recoveryAction":"failed","recoveryTime":30214}}
{"timestamp":"2025-08-26T02:40:07.524Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":60441,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:40:07.532Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175886411_2ybggbdqj","success":false,"recoveryAction":"failed","recoveryTime":60441}}
{"timestamp":"2025-08-26T02:40:07.540Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":90729,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:40:07.547Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175886411_2ybggbdqj","success":false,"recoveryAction":"failed","recoveryTime":90729}}
{"timestamp":"2025-08-26T02:40:07.553Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:40:07.559Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756175886411_2ybggbdqj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:40:07.570Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756175886411_2ybggbdqj","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:371:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":57,"transformer":40,"protocol":21,"serverCompatibility":38},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:40:07.575Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756175886411_2ybggbdqj","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:40:07.587Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:40:07.595Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":703,"isLongTextRequest":false,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T04:24:53.208Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T04:24:53.214Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T04:24:53.225Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T04:24:53.230Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T04:24:53.236Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T04:24:53.241Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T04:24:53.244Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T04:24:53.248Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T04:24:53.253Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T04:24:53.257Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-26T04:24:53.263Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:24:53.268Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:24:53.270Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:24:53.276Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T04:24:53.281Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T04:24:53.284Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:24:53.289Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:24:53.294Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T04:24:53.300Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T04:24:53.305Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T04:24:53.310Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:24:53.315Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:24:53.321Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T04:24:53.327Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":43,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T04:24:53.333Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T04:24:53.342Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T04:24:53.348Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":43,"uptime":0}}
{"timestamp":"2025-08-26T04:24:53.354Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json"}}
{"timestamp":"2025-08-26T04:24:53.361Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:24:53.368Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:11.101Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:11.106Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:11.111Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:11.116Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:11.121Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:11.124Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:11.130Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182311130_y0p7e5rpm","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:11.155Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:11.159Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182311130_y0p7e5rpm","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:11.165Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:11.170Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:11.175Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182311130_y0p7e5rpm","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:11.194Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182311130_y0p7e5rpm","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:11.210Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182311130_y0p7e5rpm","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:11.214Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182311130_y0p7e5rpm","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:25:11.226Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182311130_y0p7e5rpm","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:11.231Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182311130_y0p7e5rpm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:11.235Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182311130_y0p7e5rpm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:11.248Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182311130_y0p7e5rpm","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:11.253Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182311130_y0p7e5rpm","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:11.257Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182311130_y0p7e5rpm","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:11.269Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182311130_y0p7e5rpm","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:11.282Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182311130_y0p7e5rpm","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:11.286Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182311130_y0p7e5rpm","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:11.292Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182311130_y0p7e5rpm","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:11.296Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182311130_y0p7e5rpm","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:11.309Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182311130_y0p7e5rpm","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:11.313Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182311130_y0p7e5rpm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:11.318Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182311130_y0p7e5rpm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:11.335Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182311130_y0p7e5rpm","bodySize":25323,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:11.340Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25323,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:11.353Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25323,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:25:11.358Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25323,"expectedSize":25323}}
{"timestamp":"2025-08-26T04:25:11.363Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25323,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:11.376Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:11.383Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:11.388Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:11.393Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:11.398Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:11.401Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:11.406Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182311406_ipjmsvvey","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:11.470Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:11.475Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182311406_ipjmsvvey","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:11.480Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:11.486Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:11.492Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182311406_ipjmsvvey","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:11.520Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182311406_ipjmsvvey","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:11.539Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182311406_ipjmsvvey","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:11.544Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182311406_ipjmsvvey","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:25:11.567Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182311406_ipjmsvvey","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:11.572Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182311406_ipjmsvvey","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:11.577Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182311406_ipjmsvvey","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:11.601Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182311406_ipjmsvvey","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:11.607Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182311406_ipjmsvvey","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:11.613Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182311406_ipjmsvvey","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:11.638Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182311406_ipjmsvvey","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:11.664Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182311406_ipjmsvvey","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:11.670Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182311406_ipjmsvvey","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:11.676Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182311406_ipjmsvvey","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:11.683Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182311406_ipjmsvvey","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:11.707Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182311406_ipjmsvvey","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:11.712Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182311406_ipjmsvvey","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:11.718Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182311406_ipjmsvvey","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:11.748Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182311406_ipjmsvvey","bodySize":123445,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:11.754Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123445,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:11.761Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123445,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:25:11.766Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123445,"expectedSize":123445}}
{"timestamp":"2025-08-26T04:25:11.772Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123445,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:11.779Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:11.785Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:11.790Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:11.796Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:13.309Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":496,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:13.354Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182311130_y0p7e5rpm","totalTime":2224,"layerTimings":{"router":51,"transformer":40,"protocol":29,"serverCompatibility":35,"server":2012,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T04:25:13.372Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182311130_y0p7e5rpm","executionId":"req_1756182311130_y0p7e5rpm","totalTime":2224,"success":true}}
{"timestamp":"2025-08-26T04:25:13.412Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:13.418Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:13.423Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:13.428Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:13.432Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:13.435Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:13.440Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182313440_a30xbk63q","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:13.451Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:13.456Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182313440_a30xbk63q","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:13.460Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:13.465Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:13.469Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182313440_a30xbk63q","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:13.488Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182313440_a30xbk63q","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:13.501Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182313440_a30xbk63q","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:13.506Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182313440_a30xbk63q","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:25:13.518Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182313440_a30xbk63q","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:13.523Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182313440_a30xbk63q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:13.527Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182313440_a30xbk63q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:13.539Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182313440_a30xbk63q","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:13.544Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182313440_a30xbk63q","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:13.549Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182313440_a30xbk63q","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:13.561Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182313440_a30xbk63q","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:13.572Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182313440_a30xbk63q","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:13.577Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182313440_a30xbk63q","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:13.582Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182313440_a30xbk63q","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:13.588Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182313440_a30xbk63q","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:13.602Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182313440_a30xbk63q","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:13.606Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182313440_a30xbk63q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:13.611Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182313440_a30xbk63q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:13.627Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182313440_a30xbk63q","bodySize":19523,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:13.631Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19523,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:13.636Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19523,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:25:13.641Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19523,"expectedSize":19523}}
{"timestamp":"2025-08-26T04:25:13.646Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19523,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:13.651Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:13.656Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:14.924Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":489,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:14.975Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182313440_a30xbk63q","totalTime":1535,"layerTimings":{"router":36,"transformer":38,"protocol":29,"serverCompatibility":37,"server":1339,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T04:25:14.992Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182313440_a30xbk63q","executionId":"req_1756182313440_a30xbk63q","totalTime":1535,"success":true}}
{"timestamp":"2025-08-26T04:25:15.007Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:15.013Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:15.019Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:15.025Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:15.030Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:15.034Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:15.039Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182315039_eet4l58le","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:15.053Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:15.057Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182315039_eet4l58le","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:15.062Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:15.067Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:15.073Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182315039_eet4l58le","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:15.093Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182315039_eet4l58le","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:15.108Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182315039_eet4l58le","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:15.112Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182315039_eet4l58le","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:25:15.125Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182315039_eet4l58le","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:15.130Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182315039_eet4l58le","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:15.135Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182315039_eet4l58le","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:15.148Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182315039_eet4l58le","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:15.153Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182315039_eet4l58le","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:15.158Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182315039_eet4l58le","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:15.170Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182315039_eet4l58le","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:15.182Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182315039_eet4l58le","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:15.187Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182315039_eet4l58le","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:15.192Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182315039_eet4l58le","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:15.197Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182315039_eet4l58le","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:15.210Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182315039_eet4l58le","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:15.214Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182315039_eet4l58le","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:15.219Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182315039_eet4l58le","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:15.233Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182315039_eet4l58le","bodySize":19423,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:15.238Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19423,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:15.243Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19423,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:25:15.247Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19423,"expectedSize":19423}}
{"timestamp":"2025-08-26T04:25:15.252Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19423,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:15.256Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:15.261Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:15.986Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":652,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:16.043Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182311406_ipjmsvvey","totalTime":4637,"layerTimings":{"router":92,"transformer":64,"protocol":55,"serverCompatibility":63,"server":4294,"responseTransform":26},"transformationCount":4}}
{"timestamp":"2025-08-26T04:25:16.075Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182311406_ipjmsvvey","executionId":"req_1756182311406_ipjmsvvey","totalTime":4637,"success":true}}
{"timestamp":"2025-08-26T04:25:16.095Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:16.101Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:16.107Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:16.113Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:16.119Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:16.123Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:16.129Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182316129_x986peynj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:16.196Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:16.202Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182316129_x986peynj","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:16.207Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:16.212Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:16.217Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182316129_x986peynj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:16.247Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182316129_x986peynj","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:16.268Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182316129_x986peynj","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:16.274Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182316129_x986peynj","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:25:16.296Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182316129_x986peynj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:16.301Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182316129_x986peynj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:16.306Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182316129_x986peynj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:16.327Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182316129_x986peynj","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:16.331Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182316129_x986peynj","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:16.337Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182316129_x986peynj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:16.357Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182316129_x986peynj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:16.379Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182316129_x986peynj","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:16.385Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182316129_x986peynj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:16.389Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182316129_x986peynj","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:16.395Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182316129_x986peynj","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:16.416Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182316129_x986peynj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:16.421Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182316129_x986peynj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:16.426Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182316129_x986peynj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:16.452Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182316129_x986peynj","bodySize":123445,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:16.458Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123445,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:16.463Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123445,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:25:16.468Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123445,"expectedSize":123445}}
{"timestamp":"2025-08-26T04:25:16.472Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123445,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:16.478Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":500,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:16.504Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182315039_eet4l58le","totalTime":1465,"layerTimings":{"router":41,"transformer":40,"protocol":30,"serverCompatibility":34,"server":1268,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T04:25:16.517Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182315039_eet4l58le","executionId":"req_1756182315039_eet4l58le","totalTime":1465,"success":true}}
{"timestamp":"2025-08-26T04:25:16.525Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:16.529Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:16.537Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:16.542Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:16.547Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:16.552Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:16.557Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:16.560Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:16.565Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182316565_tlwphl5av","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:16.578Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:16.583Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182316565_tlwphl5av","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:16.588Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:16.592Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:16.597Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182316565_tlwphl5av","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:16.616Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182316565_tlwphl5av","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:16.632Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182316565_tlwphl5av","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:16.637Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182316565_tlwphl5av","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:25:16.649Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182316565_tlwphl5av","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:16.655Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182316565_tlwphl5av","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:16.659Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182316565_tlwphl5av","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:16.672Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182316565_tlwphl5av","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:16.677Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182316565_tlwphl5av","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:16.682Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182316565_tlwphl5av","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:16.694Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182316565_tlwphl5av","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:16.706Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182316565_tlwphl5av","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:16.711Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182316565_tlwphl5av","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:16.716Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182316565_tlwphl5av","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:16.721Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182316565_tlwphl5av","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:16.734Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182316565_tlwphl5av","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:16.738Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182316565_tlwphl5av","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:16.743Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182316565_tlwphl5av","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:16.758Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182316565_tlwphl5av","bodySize":24955,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:16.763Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":24955,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:16.767Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":24955,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:25:16.772Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":24955,"expectedSize":24955}}
{"timestamp":"2025-08-26T04:25:16.777Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":24955,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:16.782Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:16.787Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:17.092Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:17.109Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756182316129_x986peynj","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"40ca5110-cdf9-4f26-b9b2-52ae32a65b92\"}}"}}
{"timestamp":"2025-08-26T04:25:17.119Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756182316129_x986peynj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.127Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.134Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756182316129_x986peynj","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T04:25:17.139Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756182316129_x986peynj","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:25:17.145Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T04:25:17.159Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182316129_x986peynj","bodySize":123445,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:17.166Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123445,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:17.172Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123445,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:25:17.179Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123445,"expectedSize":123445}}
{"timestamp":"2025-08-26T04:25:17.185Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123445,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:17.303Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:17.311Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756182316129_x986peynj","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"2cc3586e-90c6-4725-b5e0-74969c745592\"}}"}}
{"timestamp":"2025-08-26T04:25:17.317Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.323Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.329Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756182316129_x986peynj","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T04:25:17.335Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756182316129_x986peynj","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:25:17.341Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T04:25:17.352Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182316129_x986peynj","bodySize":123445,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:17.358Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123445,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:17.364Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123445,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:25:17.370Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123445,"expectedSize":123445}}
{"timestamp":"2025-08-26T04:25:17.375Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123445,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:17.507Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:17.517Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756182316129_x986peynj","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"82ce0072-3e81-4ef5-b4e5-36706a886aae\"}}"}}
{"timestamp":"2025-08-26T04:25:17.525Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.531Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.537Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756182316129_x986peynj","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T04:25:17.543Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756182316129_x986peynj","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:25:17.548Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T04:25:17.560Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182316129_x986peynj","bodySize":123445,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:17.565Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123445,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:17.571Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123445,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:25:17.576Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123445,"expectedSize":123445}}
{"timestamp":"2025-08-26T04:25:17.580Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123445,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:17.704Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:17.714Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756182316129_x986peynj","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"a52dc62d-d1c0-4d82-bb89-75016fe32e5f\"}}"}}
{"timestamp":"2025-08-26T04:25:17.722Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.730Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":199,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T04:25:17.737Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756182316129_x986peynj","success":false,"recoveryAction":"failed","recoveryTime":199}}
{"timestamp":"2025-08-26T04:25:17.744Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":421,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T04:25:17.750Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756182316129_x986peynj","success":false,"recoveryAction":"failed","recoveryTime":421}}
{"timestamp":"2025-08-26T04:25:17.756Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":629,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T04:25:17.762Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756182316129_x986peynj","success":false,"recoveryAction":"failed","recoveryTime":629}}
{"timestamp":"2025-08-26T04:25:17.767Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756182316129_x986peynj","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:25:17.771Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756182316129_x986peynj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:25:17.779Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756182316129_x986peynj","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:340:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":95,"transformer":66,"protocol":46,"serverCompatibility":53},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:25:17.784Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756182316129_x986peynj","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.812Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:25:18.070Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":497,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:18.102Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182316565_tlwphl5av","totalTime":1537,"layerTimings":{"router":38,"transformer":40,"protocol":30,"serverCompatibility":36,"server":1339,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T04:25:18.118Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182316565_tlwphl5av","executionId":"req_1756182316565_tlwphl5av","totalTime":1537,"success":true}}
{"timestamp":"2025-08-26T04:27:48.792Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T04:27:48.796Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T04:27:48.799Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T04:27:48.802Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T04:27:48.804Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T04:27:48.808Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:27:48.811Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:27:48.814Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:27:48.817Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:27:48.820Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T04:27:48.823Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:27:48.826Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:27:49.829Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T04:28:06.331Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T04:28:06.338Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T04:28:06.350Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T04:28:06.355Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T04:28:06.361Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T04:28:06.366Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T04:28:06.369Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T04:28:06.374Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T04:28:06.380Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T04:28:06.385Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-26T04:28:06.391Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:28:06.396Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:28:06.400Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:28:06.406Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T04:28:06.411Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T04:28:06.413Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:28:06.419Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:28:06.424Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T04:28:06.430Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T04:28:06.435Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T04:28:06.440Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:28:06.446Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:28:06.451Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T04:28:06.456Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":43,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T04:28:06.461Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T04:28:06.470Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T04:28:06.475Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":43,"uptime":0}}
{"timestamp":"2025-08-26T04:28:06.480Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json"}}
{"timestamp":"2025-08-26T04:28:06.487Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:28:06.492Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:28:31.371Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages","hasBody":true}}
{"timestamp":"2025-08-26T04:28:31.379Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:28:31.385Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:28:31.392Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:28:31.398Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:28:31.401Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:28:31.408Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182511407_czrzaxvna","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:28:31.434Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:28:31.440Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182511407_czrzaxvna","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:28:31.446Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:28:31.452Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:28:31.458Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:28:31.464Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182511407_czrzaxvna","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:28:31.486Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182511407_czrzaxvna","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:28:31.497Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182511407_czrzaxvna","hasOutput":true}}
{"timestamp":"2025-08-26T04:28:31.502Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182511407_czrzaxvna","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:28:31.515Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182511407_czrzaxvna","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:28:31.521Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182511407_czrzaxvna","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:28:31.526Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182511407_czrzaxvna","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:28:31.539Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182511407_czrzaxvna","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:28:31.544Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182511407_czrzaxvna","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:28:31.549Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182511407_czrzaxvna","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:28:31.560Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182511407_czrzaxvna","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:28:31.574Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182511407_czrzaxvna","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:28:31.578Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182511407_czrzaxvna","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:28:31.585Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182511407_czrzaxvna","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:28:31.590Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182511407_czrzaxvna","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:28:31.602Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182511407_czrzaxvna","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:28:31.608Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182511407_czrzaxvna","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:28:31.613Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182511407_czrzaxvna","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:28:31.628Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":166,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:28:31.641Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:28:31.646Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:28:33.431Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":695,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:28:33.472Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182511407_czrzaxvna","totalTime":2064,"layerTimings":{"router":65,"transformer":37,"protocol":28,"serverCompatibility":37,"server":1835,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T04:28:33.484Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182511407_czrzaxvna","executionId":"req_1756182511407_czrzaxvna","totalTime":2064,"success":true}}
{"timestamp":"2025-08-26T04:28:59.951Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages","hasBody":true}}
{"timestamp":"2025-08-26T04:28:59.958Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:28:59.964Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:28:59.970Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:28:59.976Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:28:59.980Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:28:59.986Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182539986_8qtnhrkl3","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:29:00.000Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:29:00.006Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182539986_8qtnhrkl3","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:29:00.013Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:29:00.019Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:29:00.025Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:29:00.032Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182539986_8qtnhrkl3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:29:00.056Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182539986_8qtnhrkl3","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:29:00.068Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182539986_8qtnhrkl3","hasOutput":true}}
{"timestamp":"2025-08-26T04:29:00.074Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182539986_8qtnhrkl3","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:29:00.088Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182539986_8qtnhrkl3","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:29:00.094Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182539986_8qtnhrkl3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:00.099Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182539986_8qtnhrkl3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:00.113Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182539986_8qtnhrkl3","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:29:00.119Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182539986_8qtnhrkl3","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:29:00.124Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182539986_8qtnhrkl3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:29:00.136Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182539986_8qtnhrkl3","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:29:00.149Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182539986_8qtnhrkl3","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:29:00.154Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182539986_8qtnhrkl3","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:29:00.159Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182539986_8qtnhrkl3","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:29:00.165Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182539986_8qtnhrkl3","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:29:00.178Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182539986_8qtnhrkl3","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:29:00.183Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182539986_8qtnhrkl3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:00.188Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182539986_8qtnhrkl3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:00.203Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":166,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:29:00.210Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:29:00.215Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:29:02.319Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":674,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:29:02.368Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182539986_8qtnhrkl3","totalTime":2381,"layerTimings":{"router":57,"transformer":40,"protocol":31,"serverCompatibility":37,"server":2153,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T04:29:02.380Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182539986_8qtnhrkl3","executionId":"req_1756182539986_8qtnhrkl3","totalTime":2381,"success":true}}
{"timestamp":"2025-08-26T04:29:37.257Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages","hasBody":true}}
{"timestamp":"2025-08-26T04:29:37.264Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:29:37.271Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:29:37.277Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:29:37.283Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:29:37.287Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:29:37.293Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182577293_y10j1jzcv","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:29:37.307Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:29:37.312Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182577293_y10j1jzcv","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:29:37.318Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:29:37.323Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:29:37.329Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:29:37.334Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182577293_y10j1jzcv","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:29:37.355Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182577293_y10j1jzcv","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:29:37.367Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182577293_y10j1jzcv","hasOutput":true}}
{"timestamp":"2025-08-26T04:29:37.373Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182577293_y10j1jzcv","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:29:37.385Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182577293_y10j1jzcv","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:29:37.390Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182577293_y10j1jzcv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:37.396Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182577293_y10j1jzcv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:37.409Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182577293_y10j1jzcv","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:29:37.415Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182577293_y10j1jzcv","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:29:37.420Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182577293_y10j1jzcv","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:29:37.432Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182577293_y10j1jzcv","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:29:37.445Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182577293_y10j1jzcv","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:29:37.450Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182577293_y10j1jzcv","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:29:37.456Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182577293_y10j1jzcv","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:29:37.462Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182577293_y10j1jzcv","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:29:37.474Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182577293_y10j1jzcv","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:29:37.478Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182577293_y10j1jzcv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:37.483Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182577293_y10j1jzcv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:37.497Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":166,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:29:37.503Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:29:37.508Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:29:39.395Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":687,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:29:39.440Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182577293_y10j1jzcv","totalTime":2147,"layerTimings":{"router":48,"transformer":38,"protocol":31,"serverCompatibility":36,"server":1933,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T04:29:39.454Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182577293_y10j1jzcv","executionId":"req_1756182577293_y10j1jzcv","totalTime":2147,"success":true}}
{"timestamp":"2025-08-26T04:30:44.215Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T04:30:44.219Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T04:30:44.222Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T04:30:44.225Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T04:30:44.228Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T04:30:44.232Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:30:44.235Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:30:44.237Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:30:44.240Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:30:44.243Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T04:30:44.246Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:30:44.249Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:30:45.252Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T04:43:26.625Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T04:43:26.632Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T04:43:26.644Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T04:43:26.649Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T04:43:26.655Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T04:43:26.660Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T04:43:26.662Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T04:43:26.667Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T04:43:26.673Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T04:43:26.678Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T04:43:26.684Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:26.690Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:26.693Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:26.698Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T04:43:26.704Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T04:43:26.707Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:43:26.713Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:43:26.719Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T04:43:26.727Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T04:43:26.733Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T04:43:26.740Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:43:26.745Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:43:26.752Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T04:43:26.757Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":50,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T04:43:26.763Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T04:43:26.773Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T04:43:26.780Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":50,"uptime":0}}
{"timestamp":"2025-08-26T04:43:26.786Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T04:43:26.793Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:26.799Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:36.047Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:43:36.054Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:36.059Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:36.065Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:36.071Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:36.075Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:36.081Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183416081_dz3b87z6d","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:43:36.109Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:36.115Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183416081_dz3b87z6d","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:43:36.121Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:43:36.127Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:43:36.133Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:43:36.139Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183416081_dz3b87z6d","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:43:36.160Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183416081_dz3b87z6d","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:43:36.175Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183416081_dz3b87z6d","hasOutput":true}}
{"timestamp":"2025-08-26T04:43:36.180Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183416081_dz3b87z6d","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:43:36.193Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183416081_dz3b87z6d","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:36.199Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183416081_dz3b87z6d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.204Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183416081_dz3b87z6d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.217Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183416081_dz3b87z6d","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:36.222Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183416081_dz3b87z6d","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:43:36.227Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183416081_dz3b87z6d","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:43:36.240Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183416081_dz3b87z6d","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:43:36.252Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183416081_dz3b87z6d","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:43:36.257Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183416081_dz3b87z6d","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:36.263Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183416081_dz3b87z6d","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:43:36.269Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183416081_dz3b87z6d","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:43:36.283Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183416081_dz3b87z6d","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:36.288Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183416081_dz3b87z6d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.293Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183416081_dz3b87z6d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.309Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":1399,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:43:36.325Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:43:36.330Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:36.335Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:36.340Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:36.345Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:36.348Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:36.353Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183416353_cg5mgpab0","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:43:36.366Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:36.371Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183416353_cg5mgpab0","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:43:36.375Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:43:36.380Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:43:36.385Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":1,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":2,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",2]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:43:36.389Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183416353_cg5mgpab0","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:43:36.408Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183416353_cg5mgpab0","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:43:36.420Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183416353_cg5mgpab0","hasOutput":true}}
{"timestamp":"2025-08-26T04:43:36.425Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183416353_cg5mgpab0","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:43:36.437Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183416353_cg5mgpab0","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:36.441Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183416353_cg5mgpab0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.446Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183416353_cg5mgpab0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.458Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183416353_cg5mgpab0","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:43:36.463Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183416353_cg5mgpab0","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:43:36.469Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183416353_cg5mgpab0","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:43:36.473Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183416353_cg5mgpab0","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:43:36.485Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183416353_cg5mgpab0","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:43:36.497Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183416353_cg5mgpab0","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:43:36.502Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183416353_cg5mgpab0","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:36.507Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183416353_cg5mgpab0","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:43:36.513Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183416353_cg5mgpab0","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:43:36.524Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183416353_cg5mgpab0","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:36.529Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183416353_cg5mgpab0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.534Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183416353_cg5mgpab0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.548Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":2563,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:43:36.555Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:36.560Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:36.565Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:36.570Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:36.710Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:36.720Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183416353_cg5mgpab0","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"0510e952-e125-9530-9160-57a6e35e09b0\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.725Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183416353_cg5mgpab0","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.731Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.736Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183416353_cg5mgpab0","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:36.742Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183416353_cg5mgpab0","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:43:36.752Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:36.762Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":2563,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:43:36.850Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:36.858Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183416353_cg5mgpab0","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"4fbda0b0-468e-916e-b8bc-70bdc06cbafe\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.863Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.868Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.873Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183416353_cg5mgpab0","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:36.879Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183416353_cg5mgpab0","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:43:36.885Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:36.895Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":2563,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:43:36.999Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:37.008Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183416353_cg5mgpab0","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"957a3b1c-d245-93d6-906a-3a650fc924f8\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.015Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.021Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.026Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183416353_cg5mgpab0","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:37.031Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183416353_cg5mgpab0","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:43:37.036Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:37.043Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":2563,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:43:37.135Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:37.144Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183416353_cg5mgpab0","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"f2fad185-95d5-911b-a0af-4db17ccf722b\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.149Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.154Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":133,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:37.160Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183416353_cg5mgpab0","success":false,"recoveryAction":"failed","recoveryTime":133}}
{"timestamp":"2025-08-26T04:43:37.165Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":297,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:37.170Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183416353_cg5mgpab0","success":false,"recoveryAction":"failed","recoveryTime":297}}
{"timestamp":"2025-08-26T04:43:37.175Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":444,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:37.179Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183416353_cg5mgpab0","success":false,"recoveryAction":"failed","recoveryTime":444}}
{"timestamp":"2025-08-26T04:43:37.184Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:43:37.188Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183416353_cg5mgpab0","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:43:37.198Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183416353_cg5mgpab0","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":43,"transformer":36,"protocol":35,"serverCompatibility":35},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:43:37.203Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183416353_cg5mgpab0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.215Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:43:37.606Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":506,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:37.639Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183416081_dz3b87z6d","totalTime":1558,"layerTimings":{"router":65,"transformer":40,"protocol":31,"serverCompatibility":38,"server":1325,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T04:43:37.651Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183416081_dz3b87z6d","executionId":"req_1756183416081_dz3b87z6d","totalTime":1558,"success":true}}
{"timestamp":"2025-08-26T04:43:38.480Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:43:38.486Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:38.491Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:38.497Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:38.502Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:38.506Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:38.512Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183418512_mlz9k5llz","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:43:38.526Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:38.531Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183418512_mlz9k5llz","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:43:38.536Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:43:38.541Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:43:38.546Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":2,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":3,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",3]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:43:38.552Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183418512_mlz9k5llz","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:43:38.571Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183418512_mlz9k5llz","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:43:38.584Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183418512_mlz9k5llz","hasOutput":true}}
{"timestamp":"2025-08-26T04:43:38.588Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183418512_mlz9k5llz","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:43:38.600Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183418512_mlz9k5llz","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:38.605Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183418512_mlz9k5llz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:38.610Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183418512_mlz9k5llz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:38.623Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183418512_mlz9k5llz","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:38.628Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183418512_mlz9k5llz","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:43:38.632Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183418512_mlz9k5llz","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:43:38.645Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183418512_mlz9k5llz","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:43:38.656Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183418512_mlz9k5llz","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:43:38.661Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183418512_mlz9k5llz","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:38.667Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183418512_mlz9k5llz","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:43:38.673Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183418512_mlz9k5llz","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:43:38.685Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183418512_mlz9k5llz","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:38.689Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183418512_mlz9k5llz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:38.694Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183418512_mlz9k5llz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:38.709Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":789,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:43:38.721Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:43:38.727Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:38.732Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:38.737Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:38.741Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:38.745Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:38.750Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183418750_3bg0kjfjm","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:43:38.841Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:38.846Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183418750_3bg0kjfjm","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T04:43:38.851Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:43:38.855Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:43:38.861Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":3,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":4,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",4]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:43:38.866Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183418750_3bg0kjfjm","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:43:38.894Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183418750_3bg0kjfjm","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:43:38.914Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183418750_3bg0kjfjm","hasOutput":true}}
{"timestamp":"2025-08-26T04:43:38.919Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183418750_3bg0kjfjm","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:43:38.940Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183418750_3bg0kjfjm","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:38.945Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183418750_3bg0kjfjm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:38.951Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183418750_3bg0kjfjm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:38.973Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183418750_3bg0kjfjm","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:38.979Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183418750_3bg0kjfjm","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:43:38.984Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183418750_3bg0kjfjm","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:43:39.006Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183418750_3bg0kjfjm","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:43:39.029Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183418750_3bg0kjfjm","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:43:39.034Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183418750_3bg0kjfjm","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:39.040Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183418750_3bg0kjfjm","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:43:39.046Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183418750_3bg0kjfjm","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:43:39.069Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183418750_3bg0kjfjm","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:39.076Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183418750_3bg0kjfjm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:39.081Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183418750_3bg0kjfjm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:39.114Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183418750_3bg0kjfjm","bodySize":120510,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:39.121Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":120510,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:43:39.126Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":120510,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:43:39.132Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":120510,"expectedSize":120510}}
{"timestamp":"2025-08-26T04:43:39.137Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":120510,"timeout":600000}}
{"timestamp":"2025-08-26T04:43:39.144Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:39.149Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:39.155Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:39.161Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:41.717Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":389,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:41.761Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183418512_mlz9k5llz","totalTime":3249,"layerTimings":{"router":46,"transformer":36,"protocol":29,"serverCompatibility":36,"server":3043,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T04:43:41.774Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183418512_mlz9k5llz","executionId":"req_1756183418512_mlz9k5llz","totalTime":3249,"success":true}}
{"timestamp":"2025-08-26T04:43:46.841Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1316,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:43:46.899Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183418750_3bg0kjfjm","totalTime":8149,"layerTimings":{"router":123,"transformer":62,"protocol":51,"serverCompatibility":57,"server":7786,"responseTransform":26},"transformationCount":4}}
{"timestamp":"2025-08-26T04:43:46.932Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183418750_3bg0kjfjm","executionId":"req_1756183418750_3bg0kjfjm","totalTime":8149,"success":true}}
{"timestamp":"2025-08-26T04:43:46.949Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:43:46.955Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:46.961Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:46.966Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:46.972Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:46.975Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:46.981Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183426981_vdtu49bvx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:43:47.072Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:47.077Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183426981_vdtu49bvx","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T04:43:47.081Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:43:47.086Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:43:47.091Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":4,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":5,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",5]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:43:47.096Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183426981_vdtu49bvx","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:43:47.124Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183426981_vdtu49bvx","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:43:47.144Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183426981_vdtu49bvx","hasOutput":true}}
{"timestamp":"2025-08-26T04:43:47.149Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183426981_vdtu49bvx","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:43:47.170Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183426981_vdtu49bvx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:47.176Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183426981_vdtu49bvx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:47.182Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183426981_vdtu49bvx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:47.203Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183426981_vdtu49bvx","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:43:47.208Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183426981_vdtu49bvx","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:43:47.213Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183426981_vdtu49bvx","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:43:47.218Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183426981_vdtu49bvx","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:43:47.238Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183426981_vdtu49bvx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:43:47.259Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183426981_vdtu49bvx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:43:47.264Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183426981_vdtu49bvx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:47.270Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183426981_vdtu49bvx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:43:47.276Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183426981_vdtu49bvx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:43:47.299Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183426981_vdtu49bvx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:47.305Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183426981_vdtu49bvx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:47.310Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183426981_vdtu49bvx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:47.338Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183426981_vdtu49bvx","bodySize":120511,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:47.344Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":120511,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:43:47.350Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":120511,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:43:47.355Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":120511,"expectedSize":120511}}
{"timestamp":"2025-08-26T04:43:47.360Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":120511,"timeout":600000}}
{"timestamp":"2025-08-26T04:43:47.365Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:47.370Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:47.615Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:43:47.632Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183426981_vdtu49bvx","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"a2e4eaef-da3d-9412-9ad5-df71826cee40\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:47.641Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183426981_vdtu49bvx","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:47.649Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:47.655Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183426981_vdtu49bvx","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:47.661Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183426981_vdtu49bvx","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:43:47.667Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:47.681Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183426981_vdtu49bvx","bodySize":120511,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:47.688Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":120511,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:43:47.693Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":120511,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:43:47.699Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":120511,"expectedSize":120511}}
{"timestamp":"2025-08-26T04:43:47.704Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":120511,"timeout":600000}}
{"timestamp":"2025-08-26T04:43:47.709Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://portal.qwen.ai/v1/chat/***","error":"socket hang up","bodySize":120511,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketOnEnd (node:_http_client:542:25)\n    at TLSSocket.emit (node:events:519:35)\n    at endReadableNT (node:internal/streams/readable:1701:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)"}}
{"timestamp":"2025-08-26T04:43:47.714Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"socket hang up"}}
{"timestamp":"2025-08-26T04:43:47.718Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"socket hang up"}}
{"timestamp":"2025-08-26T04:43:47.723Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183426981_vdtu49bvx","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:47.728Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183426981_vdtu49bvx","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:43:47.733Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:47.745Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183426981_vdtu49bvx","bodySize":120511,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:47.750Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":120511,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:43:47.755Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":120511,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:43:47.760Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":120511,"expectedSize":120511}}
{"timestamp":"2025-08-26T04:43:47.766Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":120511,"timeout":600000}}
{"timestamp":"2025-08-26T04:43:48.056Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:43:48.070Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183426981_vdtu49bvx","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"e9b8d738-8473-9d14-9ba9-86518d1f4807\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.080Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.088Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.096Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183426981_vdtu49bvx","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:48.103Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183426981_vdtu49bvx","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:43:48.109Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:48.124Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183426981_vdtu49bvx","bodySize":120511,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:48.130Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":120511,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:43:48.135Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":120511,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:43:48.140Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":120511,"expectedSize":120511}}
{"timestamp":"2025-08-26T04:43:48.146Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":120511,"timeout":600000}}
{"timestamp":"2025-08-26T04:43:48.281Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:43:48.296Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183426981_vdtu49bvx","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"4de18108-45a4-9957-89da-92838c32e168\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.307Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.317Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":229,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:48.324Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183426981_vdtu49bvx","success":false,"recoveryAction":"failed","recoveryTime":229}}
{"timestamp":"2025-08-26T04:43:48.331Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":613,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:48.337Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183426981_vdtu49bvx","success":false,"recoveryAction":"failed","recoveryTime":613}}
{"timestamp":"2025-08-26T04:43:48.343Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":694,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:48.349Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183426981_vdtu49bvx","success":false,"recoveryAction":"failed","recoveryTime":694}}
{"timestamp":"2025-08-26T04:43:48.354Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:43:48.359Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183426981_vdtu49bvx","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:43:48.367Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183426981_vdtu49bvx","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":122,"transformer":63,"protocol":51,"serverCompatibility":56},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:43:48.373Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183426981_vdtu49bvx","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.403Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:44:24.069Z","level":"INFO","message":"Received SIGINT, exiting gracefully"}
{"timestamp":"2025-08-26T04:44:24.075Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T04:44:24.079Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T04:44:24.083Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T04:44:24.087Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T04:44:24.092Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:44:24.096Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:44:24.099Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:44:24.102Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:44:24.106Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T04:44:24.109Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:44:24.113Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:44:25.117Z","level":"INFO","message":"优雅关闭完成"}
{
	"timestamp": "2025-08-26T08:06:59.595Z",
	"port": 5510,
	"requestId": "sim_1756195619595_seue1npzf",
	"input": {
		"model": "claude-3-haiku-20240307",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Hello world"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:59.599Z",
	"port": 5510,
	"requestId": "sim_1756195619595_seue1npzf",
	"output": {
		"id": "msg_sim_1756195619595_seue1npzf",
		"type": "message",
		"role": "assistant",
		"content": [
			{
				"type": "text",
				"text": "This is a mock response for your request with model claude-3-haiku-20240307. Your message was: \"Hello world\""
			}
		],
		"model": "claude-3-haiku-20240307",
		"stop_reason": "end_turn",
		"usage": {
			"input_tokens": 11,
			"output_tokens": 50
		}
	},
	"processingTime": 4,
	"validation": {
		"inputValidation": {
			"success": true,
			"processingTime": 0.4
		},
		"outputValidation": {
			"success": true,
			"processingTime": 0.4
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:59.602Z",
	"port": 5510,
	"requestId": "sim_1756195619602_13h5d22hh",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": 2000,
		"system": "You are a helpful assistant.",
		"messages": [
			{
				"role": "user",
				"content": "What is the weather?"
			}
		],
		"tools": [
			{
				"name": "get_weather",
				"description": "Get weather info",
				"input_schema": {
					"type": "object",
					"properties": {}
				}
			}
		],
		"tool_choice": {
			"type": "auto"
		}
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:59.608Z",
	"port": 5510,
	"requestId": "sim_1756195619602_13h5d22hh",
	"processingTime": 6,
	"error": {
		"name": "InputValidationError",
		"message": "字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000",
		"code": "FIELD_VALIDATION_FAILED",
		"stack": "InputValidationError: 字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000\n    at ClientInputValidator.handleValidationFailure (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:179:29)\n    at ClientInputValidator.handleValidationFailure [as validateClaudeCodeRequest] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:127:14)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:66:50)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:752:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)",
		"details": {
			"module": "client.input.validation",
			"field": "max_tokens",
			"expected": "one of: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000",
			"actual": "invalid enum value",
			"value": "see originalData",
			"path": "max_tokens",
			"message": "字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000",
			"code": "FIELD_VALIDATION_FAILED",
			"timestamp": 1756195619605
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000"
			]
		}
	}
}
{"timestamp":"2025-08-26T08:16:35.365Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T08:16:35.371Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T08:16:35.383Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T08:16:35.389Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T08:16:35.395Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T08:16:35.401Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T08:16:35.403Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T08:16:35.409Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T08:16:35.414Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T08:16:35.420Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T08:16:35.426Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T08:16:35.432Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T08:16:35.435Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T08:16:35.441Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T08:16:35.446Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T08:16:35.448Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T08:16:35.453Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T08:16:35.459Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T08:16:35.465Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T08:16:35.470Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T08:16:35.476Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T08:16:35.481Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T08:16:35.487Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T08:16:35.494Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":46,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T08:16:35.500Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T08:16:35.510Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T08:16:35.516Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":46,"uptime":0}}
{"timestamp":"2025-08-26T08:16:35.522Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T08:16:35.529Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T08:16:35.535Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T08:16:39.380Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T08:16:39.386Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:16:39.393Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:16:39.399Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T08:16:39.405Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T08:16:39.408Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T08:16:39.415Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756196199414_jpbaookzc","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T08:16:39.442Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:16:39.447Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756196199414_jpbaookzc","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T08:16:39.453Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T08:16:39.459Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T08:16:39.465Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T08:16:39.470Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756196199414_jpbaookzc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T08:16:39.494Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756196199414_jpbaookzc","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T08:16:39.511Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756196199414_jpbaookzc","hasOutput":true}}
{"timestamp":"2025-08-26T08:16:39.517Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756196199414_jpbaookzc","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T08:16:39.535Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756196199414_jpbaookzc","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:16:39.542Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756196199414_jpbaookzc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T08:16:39.549Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756196199414_jpbaookzc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T08:16:39.578Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756196199414_jpbaookzc","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:16:39.585Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756196199414_jpbaookzc","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T08:16:39.590Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756196199414_jpbaookzc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T08:16:39.603Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756196199414_jpbaookzc","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T08:16:39.617Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756196199414_jpbaookzc","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T08:16:39.623Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756196199414_jpbaookzc","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:16:39.629Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756196199414_jpbaookzc","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T08:16:39.635Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756196199414_jpbaookzc","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T08:16:39.649Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756196199414_jpbaookzc","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:16:39.654Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756196199414_jpbaookzc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T08:16:39.659Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756196199414_jpbaookzc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T08:16:39.676Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":797,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T08:16:39.698Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T08:16:39.705Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:16:39.711Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:16:39.717Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T08:16:39.723Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T08:16:39.727Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T08:16:39.733Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756196199733_wnlq8lxhl","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T08:16:39.852Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:16:39.857Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756196199733_wnlq8lxhl","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T08:16:39.862Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T08:16:39.868Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T08:16:39.873Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":1,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":2,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",2]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T08:16:39.878Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756196199733_wnlq8lxhl","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T08:16:39.911Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756196199733_wnlq8lxhl","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T08:16:39.932Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756196199733_wnlq8lxhl","hasOutput":true}}
{"timestamp":"2025-08-26T08:16:39.937Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756196199733_wnlq8lxhl","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T08:16:39.962Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756196199733_wnlq8lxhl","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:16:39.968Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756196199733_wnlq8lxhl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:39.974Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756196199733_wnlq8lxhl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:39.999Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756196199733_wnlq8lxhl","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T08:16:40.005Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756196199733_wnlq8lxhl","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T08:16:40.010Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756196199733_wnlq8lxhl","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T08:16:40.015Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756196199733_wnlq8lxhl","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T08:16:40.040Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756196199733_wnlq8lxhl","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T08:16:40.066Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756196199733_wnlq8lxhl","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T08:16:40.071Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756196199733_wnlq8lxhl","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:16:40.077Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756196199733_wnlq8lxhl","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T08:16:40.083Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756196199733_wnlq8lxhl","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T08:16:40.107Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756196199733_wnlq8lxhl","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:16:40.112Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756196199733_wnlq8lxhl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:40.118Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756196199733_wnlq8lxhl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:40.150Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756196199733_wnlq8lxhl","bodySize":124007,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:16:40.157Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":124007,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:16:40.163Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":124007,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:16:40.169Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":124007,"expectedSize":124007}}
{"timestamp":"2025-08-26T08:16:40.175Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":124007,"timeout":600000}}
{"timestamp":"2025-08-26T08:16:40.183Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T08:16:40.189Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T08:16:40.195Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T08:16:40.206Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T08:16:40.487Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:16:40.497Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756196199733_wnlq8lxhl","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"408fe915-e05c-9e31-ae02-cbecd1723721\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:40.503Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756196199733_wnlq8lxhl","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:40.510Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756196199733_wnlq8lxhl","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:40.516Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756196199733_wnlq8lxhl","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T08:16:40.523Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756196199733_wnlq8lxhl","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T08:16:40.528Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756196199733_wnlq8lxhl","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T08:16:40.542Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756196199733_wnlq8lxhl","bodySize":124007,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:16:40.548Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":124007,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:16:40.554Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":124007,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:16:40.559Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":124007,"expectedSize":124007}}
{"timestamp":"2025-08-26T08:16:40.565Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":124007,"timeout":600000}}
{"timestamp":"2025-08-26T08:16:40.690Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:16:40.700Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756196199733_wnlq8lxhl","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"b78368a9-22b2-9139-bc77-7ba0270a9bf5\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:40.706Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756196199733_wnlq8lxhl","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:40.713Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756196199733_wnlq8lxhl","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:40.719Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756196199733_wnlq8lxhl","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T08:16:40.724Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756196199733_wnlq8lxhl","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T08:16:40.730Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756196199733_wnlq8lxhl","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T08:16:40.743Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756196199733_wnlq8lxhl","bodySize":124007,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:16:40.750Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":124007,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:16:40.754Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":124007,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:16:40.760Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":124007,"expectedSize":124007}}
{"timestamp":"2025-08-26T08:16:40.765Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":124007,"timeout":600000}}
{"timestamp":"2025-08-26T08:16:40.903Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:16:40.912Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756196199733_wnlq8lxhl","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"dd4a3cb7-c8e1-93e2-87ee-a9c62bf6c04d\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:40.918Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756196199733_wnlq8lxhl","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:40.923Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756196199733_wnlq8lxhl","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:40.929Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756196199733_wnlq8lxhl","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T08:16:40.934Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756196199733_wnlq8lxhl","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T08:16:40.939Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756196199733_wnlq8lxhl","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T08:16:40.952Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756196199733_wnlq8lxhl","bodySize":124007,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:16:40.958Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":124007,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:16:40.964Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":124007,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:16:40.969Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":124007,"expectedSize":124007}}
{"timestamp":"2025-08-26T08:16:40.975Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":124007,"timeout":600000}}
{"timestamp":"2025-08-26T08:16:41.088Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:16:41.097Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756196199733_wnlq8lxhl","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"1b45d73b-2346-9710-abc4-706d086f5a90\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:41.104Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756196199733_wnlq8lxhl","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:41.109Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756196199733_wnlq8lxhl","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":185,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T08:16:41.113Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756196199733_wnlq8lxhl","success":false,"recoveryAction":"failed","recoveryTime":185}}
{"timestamp":"2025-08-26T08:16:41.118Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756196199733_wnlq8lxhl","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":405,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T08:16:41.123Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756196199733_wnlq8lxhl","success":false,"recoveryAction":"failed","recoveryTime":405}}
{"timestamp":"2025-08-26T08:16:41.129Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756196199733_wnlq8lxhl","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":619,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T08:16:41.134Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756196199733_wnlq8lxhl","success":false,"recoveryAction":"failed","recoveryTime":619}}
{"timestamp":"2025-08-26T08:16:41.139Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756196199733_wnlq8lxhl","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T08:16:41.145Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756196199733_wnlq8lxhl","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T08:16:41.156Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756196199733_wnlq8lxhl","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":153,"transformer":70,"protocol":60,"serverCompatibility":61},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T08:16:41.162Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756196199733_wnlq8lxhl","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:16:41.197Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T08:16:41.219Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T08:16:41.225Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:16:41.231Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:16:41.237Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T08:16:41.243Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T08:16:41.247Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T08:16:41.252Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756196201252_usxjs7z6u","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T08:16:41.364Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:16:41.370Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756196201252_usxjs7z6u","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T08:16:41.375Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T08:16:41.380Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T08:16:41.386Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":2,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":3,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",3]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T08:16:41.391Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756196201252_usxjs7z6u","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T08:16:41.422Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756196201252_usxjs7z6u","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T08:16:41.444Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756196201252_usxjs7z6u","hasOutput":true}}
{"timestamp":"2025-08-26T08:16:41.449Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756196201252_usxjs7z6u","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T08:16:41.473Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756196201252_usxjs7z6u","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:16:41.478Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756196201252_usxjs7z6u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:41.484Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756196201252_usxjs7z6u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:41.508Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756196201252_usxjs7z6u","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:16:41.514Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756196201252_usxjs7z6u","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T08:16:41.519Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756196201252_usxjs7z6u","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T08:16:41.544Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756196201252_usxjs7z6u","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T08:16:41.568Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756196201252_usxjs7z6u","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T08:16:41.574Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756196201252_usxjs7z6u","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:16:41.580Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756196201252_usxjs7z6u","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T08:16:41.586Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756196201252_usxjs7z6u","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T08:16:41.611Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756196201252_usxjs7z6u","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:16:41.617Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756196201252_usxjs7z6u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:41.623Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756196201252_usxjs7z6u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:41.654Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756196201252_usxjs7z6u","bodySize":123998,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:16:41.660Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":123998,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:16:41.666Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123998,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:16:41.672Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123998,"expectedSize":123998}}
{"timestamp":"2025-08-26T08:16:41.677Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":123998,"timeout":600000}}
{"timestamp":"2025-08-26T08:16:41.683Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":516,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T08:16:41.715Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756196199414_jpbaookzc","totalTime":2300,"layerTimings":{"router":64,"transformer":50,"protocol":43,"serverCompatibility":40,"server":2034,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T08:16:41.727Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756196199414_jpbaookzc","executionId":"req_1756196199414_jpbaookzc","totalTime":2300,"success":true}}
{"timestamp":"2025-08-26T08:16:41.735Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T08:16:41.741Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T08:16:53.825Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1094,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:16:53.862Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756196201252_usxjs7z6u","totalTime":12610,"layerTimings":{"router":145,"transformer":69,"protocol":54,"serverCompatibility":61,"server":12214,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T08:16:53.892Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756196201252_usxjs7z6u","executionId":"req_1756196201252_usxjs7z6u","totalTime":12610,"success":true}}
{"timestamp":"2025-08-26T08:16:54.100Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T08:16:54.106Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:16:54.111Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:16:54.117Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T08:16:54.122Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T08:16:54.126Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T08:16:54.132Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756196214132_uorwz88tx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T08:16:54.263Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:16:54.272Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756196214132_uorwz88tx","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T08:16:54.278Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T08:16:54.284Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T08:16:54.290Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":3,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":4,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",4]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T08:16:54.295Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756196214132_uorwz88tx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T08:16:54.324Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756196214132_uorwz88tx","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T08:16:54.351Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756196214132_uorwz88tx","hasOutput":true}}
{"timestamp":"2025-08-26T08:16:54.356Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756196214132_uorwz88tx","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T08:16:54.379Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756196214132_uorwz88tx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:16:54.385Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756196214132_uorwz88tx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:54.391Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756196214132_uorwz88tx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:54.416Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756196214132_uorwz88tx","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:16:54.421Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756196214132_uorwz88tx","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T08:16:54.426Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756196214132_uorwz88tx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T08:16:54.450Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756196214132_uorwz88tx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T08:16:54.475Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756196214132_uorwz88tx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T08:16:54.481Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756196214132_uorwz88tx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:16:54.486Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756196214132_uorwz88tx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T08:16:54.493Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756196214132_uorwz88tx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T08:16:54.516Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756196214132_uorwz88tx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:16:54.522Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756196214132_uorwz88tx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:54.528Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756196214132_uorwz88tx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:16:54.561Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756196214132_uorwz88tx","bodySize":126158,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:16:54.567Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":126158,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:16:54.573Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126158,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:16:54.579Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126158,"expectedSize":126158}}
{"timestamp":"2025-08-26T08:16:54.585Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":126158,"timeout":600000}}
{"timestamp":"2025-08-26T08:16:54.591Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T08:16:54.596Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T08:17:01.328Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1147,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:17:01.365Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756196214132_uorwz88tx","totalTime":7233,"layerTimings":{"router":170,"transformer":72,"protocol":54,"serverCompatibility":60,"server":6812,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T08:17:01.395Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756196214132_uorwz88tx","executionId":"req_1756196214132_uorwz88tx","totalTime":7233,"success":true}}
{"timestamp":"2025-08-26T08:17:01.414Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T08:17:01.419Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:17:01.425Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:17:01.430Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T08:17:01.435Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T08:17:01.439Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T08:17:01.444Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756196221444_5la8d16mx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T08:17:01.555Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:17:01.561Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756196221444_5la8d16mx","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T08:17:01.567Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T08:17:01.573Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T08:17:01.579Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":4,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":5,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",5]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T08:17:01.585Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756196221444_5la8d16mx","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T08:17:01.619Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756196221444_5la8d16mx","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T08:17:01.647Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756196221444_5la8d16mx","hasOutput":true}}
{"timestamp":"2025-08-26T08:17:01.652Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756196221444_5la8d16mx","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T08:17:01.675Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756196221444_5la8d16mx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:17:01.680Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756196221444_5la8d16mx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:17:01.685Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756196221444_5la8d16mx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:17:01.707Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756196221444_5la8d16mx","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T08:17:01.713Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756196221444_5la8d16mx","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T08:17:01.718Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756196221444_5la8d16mx","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T08:17:01.724Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756196221444_5la8d16mx","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T08:17:01.746Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756196221444_5la8d16mx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T08:17:01.769Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756196221444_5la8d16mx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T08:17:01.774Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756196221444_5la8d16mx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:17:01.779Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756196221444_5la8d16mx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T08:17:01.787Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756196221444_5la8d16mx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T08:17:01.809Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756196221444_5la8d16mx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:17:01.815Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756196221444_5la8d16mx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:17:01.820Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756196221444_5la8d16mx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:17:01.849Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756196221444_5la8d16mx","bodySize":126159,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:17:01.855Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":126159,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:17:01.861Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126159,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:17:01.866Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126159,"expectedSize":126159}}
{"timestamp":"2025-08-26T08:17:01.872Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":126159,"timeout":600000}}
{"timestamp":"2025-08-26T08:17:01.877Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T08:17:01.883Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T08:17:02.111Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:17:02.121Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756196221444_5la8d16mx","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"9ddb11cb-b42f-9a4b-b39f-c24c1155ea70\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.127Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756196221444_5la8d16mx","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.133Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756196221444_5la8d16mx","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.138Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756196221444_5la8d16mx","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T08:17:02.143Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756196221444_5la8d16mx","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T08:17:02.149Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756196221444_5la8d16mx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T08:17:02.161Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756196221444_5la8d16mx","bodySize":126159,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:17:02.168Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":126159,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:17:02.174Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126159,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:17:02.179Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126159,"expectedSize":126159}}
{"timestamp":"2025-08-26T08:17:02.185Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":126159,"timeout":600000}}
{"timestamp":"2025-08-26T08:17:02.320Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:17:02.330Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756196221444_5la8d16mx","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"711d9747-3cdf-9ee3-8868-eb5351fb4789\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.337Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756196221444_5la8d16mx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.343Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756196221444_5la8d16mx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.350Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756196221444_5la8d16mx","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T08:17:02.356Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756196221444_5la8d16mx","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T08:17:02.363Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756196221444_5la8d16mx","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T08:17:02.376Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756196221444_5la8d16mx","bodySize":126159,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:17:02.382Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":126159,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:17:02.388Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126159,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:17:02.393Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126159,"expectedSize":126159}}
{"timestamp":"2025-08-26T08:17:02.399Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":126159,"timeout":600000}}
{"timestamp":"2025-08-26T08:17:02.513Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:17:02.522Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756196221444_5la8d16mx","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"3e1852a1-3e18-91ff-aeeb-0a3b4f4df8e8\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.528Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756196221444_5la8d16mx","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.534Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756196221444_5la8d16mx","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.540Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756196221444_5la8d16mx","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T08:17:02.545Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756196221444_5la8d16mx","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T08:17:02.551Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756196221444_5la8d16mx","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T08:17:02.564Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756196221444_5la8d16mx","bodySize":126159,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:17:02.571Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":126159,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:17:02.577Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126159,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:17:02.583Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126159,"expectedSize":126159}}
{"timestamp":"2025-08-26T08:17:02.589Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":126159,"timeout":600000}}
{"timestamp":"2025-08-26T08:17:02.717Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:17:02.726Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756196221444_5la8d16mx","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"f3aaeb8a-b2eb-9977-85d3-426604247235\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.733Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756196221444_5la8d16mx","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.738Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756196221444_5la8d16mx","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":204,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T08:17:02.743Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756196221444_5la8d16mx","success":false,"recoveryAction":"failed","recoveryTime":204}}
{"timestamp":"2025-08-26T08:17:02.749Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756196221444_5la8d16mx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":406,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T08:17:02.753Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756196221444_5la8d16mx","success":false,"recoveryAction":"failed","recoveryTime":406}}
{"timestamp":"2025-08-26T08:17:02.758Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756196221444_5la8d16mx","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":625,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T08:17:02.763Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756196221444_5la8d16mx","success":false,"recoveryAction":"failed","recoveryTime":625}}
{"timestamp":"2025-08-26T08:17:02.768Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756196221444_5la8d16mx","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T08:17:02.773Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756196221444_5la8d16mx","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T08:17:02.781Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756196221444_5la8d16mx","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":150,"transformer":75,"protocol":55,"serverCompatibility":58},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T08:17:02.786Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756196221444_5la8d16mx","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:17:02.816Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T08:41:54.923Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T08:41:54.928Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:41:54.934Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:41:54.939Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T08:41:54.946Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T08:41:54.950Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T08:41:54.956Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756197714956_xkg7n6lav","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T08:41:54.971Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:41:54.977Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756197714956_xkg7n6lav","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T08:41:54.983Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T08:41:54.989Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T08:41:54.995Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":5,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":6,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",6]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T08:41:55.000Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756197714956_xkg7n6lav","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T08:41:55.021Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756197714956_xkg7n6lav","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T08:41:55.037Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756197714956_xkg7n6lav","hasOutput":true}}
{"timestamp":"2025-08-26T08:41:55.043Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756197714956_xkg7n6lav","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T08:41:55.057Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756197714956_xkg7n6lav","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:41:55.063Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756197714956_xkg7n6lav","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T08:41:55.069Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756197714956_xkg7n6lav","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T08:41:55.083Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756197714956_xkg7n6lav","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:41:55.088Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756197714956_xkg7n6lav","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T08:41:55.094Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756197714956_xkg7n6lav","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T08:41:55.108Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756197714956_xkg7n6lav","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T08:41:55.123Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756197714956_xkg7n6lav","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T08:41:55.129Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756197714956_xkg7n6lav","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:41:55.136Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756197714956_xkg7n6lav","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T08:41:55.143Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756197714956_xkg7n6lav","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T08:41:55.158Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756197714956_xkg7n6lav","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:41:55.164Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756197714956_xkg7n6lav","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T08:41:55.170Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756197714956_xkg7n6lav","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T08:41:55.189Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":532,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T08:41:55.203Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T08:41:55.209Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:41:55.215Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:41:55.220Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T08:41:55.226Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T08:41:55.231Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T08:41:55.237Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756197715237_t3z309r3e","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T08:41:55.358Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:41:55.364Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756197715237_t3z309r3e","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T08:41:55.371Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T08:41:55.377Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T08:41:55.382Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":6,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":7,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",7]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T08:41:55.388Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756197715237_t3z309r3e","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T08:41:55.422Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756197715237_t3z309r3e","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T08:41:55.455Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756197715237_t3z309r3e","hasOutput":true}}
{"timestamp":"2025-08-26T08:41:55.462Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756197715237_t3z309r3e","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T08:41:55.487Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756197715237_t3z309r3e","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:41:55.494Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756197715237_t3z309r3e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:41:55.500Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756197715237_t3z309r3e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:41:55.527Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756197715237_t3z309r3e","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:41:55.534Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756197715237_t3z309r3e","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T08:41:55.539Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756197715237_t3z309r3e","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T08:41:55.564Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756197715237_t3z309r3e","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T08:41:55.594Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756197715237_t3z309r3e","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T08:41:55.600Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756197715237_t3z309r3e","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:41:55.606Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756197715237_t3z309r3e","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T08:41:55.612Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756197715237_t3z309r3e","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T08:41:55.635Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756197715237_t3z309r3e","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:41:55.641Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756197715237_t3z309r3e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:41:55.646Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756197715237_t3z309r3e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:41:55.675Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756197715237_t3z309r3e","bodySize":126209,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:41:55.680Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":126209,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:41:55.686Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126209,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:41:55.691Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126209,"expectedSize":126209}}
{"timestamp":"2025-08-26T08:41:55.696Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":126209,"timeout":600000}}
{"timestamp":"2025-08-26T08:41:55.701Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T08:41:55.706Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T08:41:55.711Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T08:41:55.716Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T08:41:59.127Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":384,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T08:41:59.161Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756197714956_xkg7n6lav","totalTime":4205,"layerTimings":{"router":52,"transformer":43,"protocol":34,"serverCompatibility":44,"server":3968,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T08:41:59.174Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756197714956_xkg7n6lav","executionId":"req_1756197714956_xkg7n6lav","totalTime":4205,"success":true}}
{"timestamp":"2025-08-26T08:42:03.121Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1142,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:42:03.159Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756197715237_t3z309r3e","totalTime":7922,"layerTimings":{"router":159,"transformer":85,"protocol":57,"serverCompatibility":63,"server":7489,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T08:42:03.190Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756197715237_t3z309r3e","executionId":"req_1756197715237_t3z309r3e","totalTime":7922,"success":true}}
{"timestamp":"2025-08-26T08:42:03.208Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T08:42:03.214Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:42:03.219Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T08:42:03.225Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T08:42:03.231Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T08:42:03.236Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T08:42:03.242Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756197723242_ichgo3hqw","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T08:42:03.347Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:42:03.353Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756197723242_ichgo3hqw","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T08:42:03.358Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T08:42:03.364Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T08:42:03.369Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":7,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":8,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",8]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T08:42:03.375Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756197723242_ichgo3hqw","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T08:42:03.406Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756197723242_ichgo3hqw","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T08:42:03.438Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756197723242_ichgo3hqw","hasOutput":true}}
{"timestamp":"2025-08-26T08:42:03.444Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756197723242_ichgo3hqw","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T08:42:03.466Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756197723242_ichgo3hqw","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:42:03.471Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756197723242_ichgo3hqw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:42:03.477Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756197723242_ichgo3hqw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:42:03.500Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756197723242_ichgo3hqw","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T08:42:03.505Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756197723242_ichgo3hqw","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T08:42:03.510Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756197723242_ichgo3hqw","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T08:42:03.516Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756197723242_ichgo3hqw","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T08:42:03.539Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756197723242_ichgo3hqw","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T08:42:03.562Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756197723242_ichgo3hqw","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T08:42:03.568Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756197723242_ichgo3hqw","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T08:42:03.574Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756197723242_ichgo3hqw","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T08:42:03.581Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756197723242_ichgo3hqw","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T08:42:03.604Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756197723242_ichgo3hqw","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T08:42:03.610Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756197723242_ichgo3hqw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:42:03.616Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756197723242_ichgo3hqw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T08:42:03.647Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756197723242_ichgo3hqw","bodySize":126210,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:42:03.653Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":126210,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:42:03.659Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126210,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:42:03.665Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126210,"expectedSize":126210}}
{"timestamp":"2025-08-26T08:42:03.671Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":126210,"timeout":600000}}
{"timestamp":"2025-08-26T08:42:03.678Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T08:42:03.683Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T08:42:04.201Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:42:04.211Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756197723242_ichgo3hqw","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"1bf4d148-56c3-93ac-80cc-6ef8df5e6e9f\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.218Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756197723242_ichgo3hqw","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.224Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756197723242_ichgo3hqw","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.230Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756197723242_ichgo3hqw","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T08:42:04.235Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756197723242_ichgo3hqw","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T08:42:04.241Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756197723242_ichgo3hqw","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T08:42:04.255Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756197723242_ichgo3hqw","bodySize":126210,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:42:04.262Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":126210,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:42:04.268Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126210,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:42:04.275Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126210,"expectedSize":126210}}
{"timestamp":"2025-08-26T08:42:04.281Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":126210,"timeout":600000}}
{"timestamp":"2025-08-26T08:42:04.419Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:42:04.430Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756197723242_ichgo3hqw","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"6dec89a0-2fe7-9960-a00c-41b8a33944e6\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.437Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756197723242_ichgo3hqw","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.443Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756197723242_ichgo3hqw","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.448Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756197723242_ichgo3hqw","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T08:42:04.453Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756197723242_ichgo3hqw","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T08:42:04.458Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756197723242_ichgo3hqw","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T08:42:04.471Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756197723242_ichgo3hqw","bodySize":126210,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:42:04.477Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":126210,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:42:04.482Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126210,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:42:04.488Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126210,"expectedSize":126210}}
{"timestamp":"2025-08-26T08:42:04.494Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":126210,"timeout":600000}}
{"timestamp":"2025-08-26T08:42:04.623Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:42:04.633Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756197723242_ichgo3hqw","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"7f35d9ac-e8e8-9b4b-93d8-730c1192e4e4\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.638Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756197723242_ichgo3hqw","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.644Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756197723242_ichgo3hqw","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.648Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756197723242_ichgo3hqw","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T08:42:04.654Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756197723242_ichgo3hqw","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T08:42:04.659Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756197723242_ichgo3hqw","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T08:42:04.672Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756197723242_ichgo3hqw","bodySize":126210,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T08:42:04.678Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":126210,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T08:42:04.684Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126210,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T08:42:04.690Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126210,"expectedSize":126210}}
{"timestamp":"2025-08-26T08:42:04.695Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":126210,"timeout":600000}}
{"timestamp":"2025-08-26T08:42:04.860Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T08:42:04.870Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756197723242_ichgo3hqw","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"1ff3dd01-8b98-9789-8689-20e8f0ef2a03\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.876Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756197723242_ichgo3hqw","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.882Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756197723242_ichgo3hqw","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":238,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T08:42:04.888Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756197723242_ichgo3hqw","success":false,"recoveryAction":"failed","recoveryTime":238}}
{"timestamp":"2025-08-26T08:42:04.894Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756197723242_ichgo3hqw","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":451,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T08:42:04.901Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756197723242_ichgo3hqw","success":false,"recoveryAction":"failed","recoveryTime":451}}
{"timestamp":"2025-08-26T08:42:04.907Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756197723242_ichgo3hqw","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":683,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T08:42:04.914Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756197723242_ichgo3hqw","success":false,"recoveryAction":"failed","recoveryTime":683}}
{"timestamp":"2025-08-26T08:42:04.921Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756197723242_ichgo3hqw","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T08:42:04.927Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756197723242_ichgo3hqw","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T08:42:04.937Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756197723242_ichgo3hqw","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":140,"transformer":78,"protocol":57,"serverCompatibility":60},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T08:42:04.943Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756197723242_ichgo3hqw","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T08:42:04.977Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T09:05:55.274Z","level":"INFO","message":"Received SIGINT, exiting gracefully"}
{"timestamp":"2025-08-26T09:05:55.282Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T09:05:55.286Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T09:05:55.290Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T09:05:55.296Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T09:05:55.311Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T09:05:55.318Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T09:05:55.322Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T09:05:55.326Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T09:05:55.331Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T09:05:55.334Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T09:05:55.338Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T09:05:56.344Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T09:05:57.512Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T09:05:57.518Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T09:05:57.531Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T09:05:57.538Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T09:05:57.545Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T09:05:57.551Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T09:05:57.555Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T09:05:57.560Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T09:05:57.567Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T09:05:57.573Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T09:05:57.579Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:05:57.585Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:05:57.589Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:05:57.595Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T09:05:57.602Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T09:05:57.605Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T09:05:57.611Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T09:05:57.618Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T09:05:57.625Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":0,"categories":[],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T09:05:57.633Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":[]}}
{"timestamp":"2025-08-26T09:05:57.639Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":0,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T09:05:57.646Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":0,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T09:05:57.653Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T09:05:57.659Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":54,"totalPipelines":26,"virtualModels":[],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T09:05:57.666Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T09:05:57.677Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T09:05:57.684Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":54,"uptime":0}}
{"timestamp":"2025-08-26T09:05:57.690Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T09:05:57.697Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:05:57.704Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:06:03.400Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:06:03.406Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:03.413Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:03.419Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:06:03.425Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:06:03.429Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:06:03.436Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756199163436_ahxx90ddr","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:06:03.465Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:03.471Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756199163436_ahxx90ddr","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T09:06:03.478Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:06:03.484Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:06:03.491Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T09:06:03.497Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756199163436_ahxx90ddr","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:06:03.524Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756199163436_ahxx90ddr","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:06:03.542Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756199163436_ahxx90ddr","hasOutput":true}}
{"timestamp":"2025-08-26T09:06:03.549Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756199163436_ahxx90ddr","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T09:06:03.564Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199163436_ahxx90ddr","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:03.571Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199163436_ahxx90ddr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:06:03.577Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756199163436_ahxx90ddr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:06:03.593Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756199163436_ahxx90ddr","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:03.599Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756199163436_ahxx90ddr","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:06:03.605Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756199163436_ahxx90ddr","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T09:06:03.619Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756199163436_ahxx90ddr","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:06:03.635Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756199163436_ahxx90ddr","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:06:03.641Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756199163436_ahxx90ddr","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:06:03.648Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756199163436_ahxx90ddr","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:03.654Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756199163436_ahxx90ddr","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:06:03.661Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756199163436_ahxx90ddr","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:06:03.675Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199163436_ahxx90ddr","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:03.681Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199163436_ahxx90ddr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:06:03.687Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756199163436_ahxx90ddr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:06:03.706Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":540,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T09:06:03.730Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:06:03.736Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:03.742Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:03.748Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:06:03.754Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:06:03.758Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:06:03.764Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756199163764_ufhgai3au","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:06:03.889Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:03.896Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756199163764_ufhgai3au","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:06:03.903Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:06:03.909Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:06:03.915Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":1,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":2,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",2]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T09:06:03.921Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756199163764_ufhgai3au","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:06:03.958Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756199163764_ufhgai3au","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:06:03.985Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756199163764_ufhgai3au","hasOutput":true}}
{"timestamp":"2025-08-26T09:06:03.991Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756199163764_ufhgai3au","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:06:04.019Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199163764_ufhgai3au","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:04.025Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199163764_ufhgai3au","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:04.031Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756199163764_ufhgai3au","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:04.059Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756199163764_ufhgai3au","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T09:06:04.065Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756199163764_ufhgai3au","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T09:06:04.072Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756199163764_ufhgai3au","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:06:04.079Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756199163764_ufhgai3au","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:06:04.106Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756199163764_ufhgai3au","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:06:04.133Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756199163764_ufhgai3au","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:06:04.140Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756199163764_ufhgai3au","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:06:04.146Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756199163764_ufhgai3au","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:04.154Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756199163764_ufhgai3au","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T09:06:04.161Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:06:04.168Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:06:04.175Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:06:04.181Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:06:04.187Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756199163764_ufhgai3au","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:06:04.193Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756199163764_ufhgai3au","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:04.201Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756199163764_ufhgai3au","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T09:06:04.207Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756199163764_ufhgai3au","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:04.220Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756199163764_ufhgai3au","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T09:06:04.230Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756199163764_ufhgai3au","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T09:06:04.236Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756199163764_ufhgai3au","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T09:06:04.243Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756199163764_ufhgai3au","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:04.249Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756199163764_ufhgai3au","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:06:04.276Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199163764_ufhgai3au","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:04.282Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199163764_ufhgai3au","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:04.288Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756199163764_ufhgai3au","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:04.322Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756199163764_ufhgai3au","bodySize":126218,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:04.330Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":126218,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:06:04.338Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126218,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T09:06:04.344Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126218,"expectedSize":126218}}
{"timestamp":"2025-08-26T09:06:04.351Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":126218,"timeout":600000}}
{"timestamp":"2025-08-26T09:06:05.349Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":499,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T09:06:05.381Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756199163436_ahxx90ddr","totalTime":1945,"layerTimings":{"router":72,"transformer":50,"protocol":36,"serverCompatibility":50,"server":1673,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T09:06:05.393Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756199163436_ahxx90ddr","executionId":"req_1756199163436_ahxx90ddr","totalTime":1945,"success":true}}
{"timestamp":"2025-08-26T09:06:10.006Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756199163764_ufhgai3au","requestSize":126218,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:06:10.014Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756199163764_ufhgai3au","duration":8,"requestSize":126218,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:06:10.021Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":1048,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:06:10.073Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756199163764_ufhgai3au","totalTime":6309,"layerTimings":{"router":167,"transformer":82,"protocol":68,"serverCompatibility":163,"server":5746,"responseTransform":33},"transformationCount":4}}
{"timestamp":"2025-08-26T09:06:10.108Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756199163764_ufhgai3au","executionId":"req_1756199163764_ufhgai3au","totalTime":6309,"success":true}}
{"timestamp":"2025-08-26T09:06:10.128Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:06:10.134Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:10.140Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:10.147Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:06:10.153Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:06:10.157Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:06:10.164Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756199170163_m4fm1fw2n","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:06:10.288Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:10.295Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756199170163_m4fm1fw2n","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:06:10.301Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:06:10.307Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:06:10.314Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":2,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":3,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",3]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T09:06:10.320Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756199170163_m4fm1fw2n","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:06:10.357Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756199170163_m4fm1fw2n","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:06:10.387Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756199170163_m4fm1fw2n","hasOutput":true}}
{"timestamp":"2025-08-26T09:06:10.393Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756199170163_m4fm1fw2n","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:06:10.419Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199170163_m4fm1fw2n","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:10.426Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199170163_m4fm1fw2n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:10.433Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756199170163_m4fm1fw2n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:10.459Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756199170163_m4fm1fw2n","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:10.466Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756199170163_m4fm1fw2n","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:06:10.472Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756199170163_m4fm1fw2n","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T09:06:10.498Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756199170163_m4fm1fw2n","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:06:10.524Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756199170163_m4fm1fw2n","selectedPipelineId":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:06:10.530Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756199170163_m4fm1fw2n","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:06:10.536Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756199170163_m4fm1fw2n","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:10.543Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756199170163_m4fm1fw2n","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:06:10.550Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756199170163_m4fm1fw2n","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:06:10.577Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199170163_m4fm1fw2n","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:10.583Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199170163_m4fm1fw2n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:10.589Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756199170163_m4fm1fw2n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:10.624Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756199170163_m4fm1fw2n","bodySize":126209,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:10.631Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":126209,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:06:10.637Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":126209,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T09:06:10.644Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":126209,"expectedSize":126209}}
{"timestamp":"2025-08-26T09:06:10.650Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":126209,"timeout":600000}}
{"timestamp":"2025-08-26T09:06:10.658Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:06:10.664Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:06:20.111Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756199170163_m4fm1fw2n","requestSize":126209,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:06:20.124Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756199170163_m4fm1fw2n","duration":13,"requestSize":126209,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:06:20.132Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1053,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:06:20.177Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756199170163_m4fm1fw2n","totalTime":10013,"layerTimings":{"router":166,"transformer":83,"protocol":59,"serverCompatibility":73,"server":9556,"responseTransform":25},"transformationCount":4}}
{"timestamp":"2025-08-26T09:06:20.212Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756199170163_m4fm1fw2n","executionId":"req_1756199170163_m4fm1fw2n","totalTime":10013,"success":true}}
{"timestamp":"2025-08-26T09:06:20.441Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:06:20.448Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:20.455Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:20.462Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:06:20.469Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:06:20.474Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:06:20.480Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756199180480_exm2khrbd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:06:20.615Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:20.621Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756199180480_exm2khrbd","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:06:20.627Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:06:20.634Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:06:20.641Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":3,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":4,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",4]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T09:06:20.647Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756199180480_exm2khrbd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:06:20.685Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756199180480_exm2khrbd","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:06:20.720Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756199180480_exm2khrbd","hasOutput":true}}
{"timestamp":"2025-08-26T09:06:20.726Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756199180480_exm2khrbd","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:06:20.754Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199180480_exm2khrbd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:20.760Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199180480_exm2khrbd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:20.768Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756199180480_exm2khrbd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:20.794Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756199180480_exm2khrbd","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:20.800Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756199180480_exm2khrbd","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:06:20.806Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756199180480_exm2khrbd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T09:06:20.834Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756199180480_exm2khrbd","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:06:20.862Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756199180480_exm2khrbd","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:06:20.868Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756199180480_exm2khrbd","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:06:20.874Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756199180480_exm2khrbd","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:20.880Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756199180480_exm2khrbd","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:06:20.888Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756199180480_exm2khrbd","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:06:20.915Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199180480_exm2khrbd","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:20.923Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199180480_exm2khrbd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:20.930Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756199180480_exm2khrbd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:20.973Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756199180480_exm2khrbd","bodySize":128248,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:20.985Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":128248,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:06:20.992Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":128248,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T09:06:20.997Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":128248,"expectedSize":128248}}
{"timestamp":"2025-08-26T09:06:21.003Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":128248,"timeout":600000}}
{"timestamp":"2025-08-26T09:06:21.010Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:06:21.016Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:06:31.417Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756199180480_exm2khrbd","requestSize":128248,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:06:31.425Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756199180480_exm2khrbd","duration":8,"requestSize":128248,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:06:31.432Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":626,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:06:31.473Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756199180480_exm2khrbd","totalTime":10993,"layerTimings":{"router":177,"transformer":90,"protocol":60,"serverCompatibility":74,"server":10514,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T09:06:31.507Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756199180480_exm2khrbd","executionId":"req_1756199180480_exm2khrbd","totalTime":10993,"success":true}}
{"timestamp":"2025-08-26T09:06:31.528Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:06:31.537Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:31.543Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:31.550Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:06:31.557Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:06:31.562Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:06:31.569Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756199191569_k6gp2tsqj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:06:31.703Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:31.710Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756199191569_k6gp2tsqj","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:06:31.716Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:06:31.723Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:06:31.730Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":4,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":5,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",5]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T09:06:31.737Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756199191569_k6gp2tsqj","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:06:31.774Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756199191569_k6gp2tsqj","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:06:31.814Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756199191569_k6gp2tsqj","hasOutput":true}}
{"timestamp":"2025-08-26T09:06:31.821Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756199191569_k6gp2tsqj","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:06:31.850Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199191569_k6gp2tsqj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:31.857Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199191569_k6gp2tsqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:31.864Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756199191569_k6gp2tsqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:31.893Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756199191569_k6gp2tsqj","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T09:06:31.899Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756199191569_k6gp2tsqj","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T09:06:31.906Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756199191569_k6gp2tsqj","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:06:31.913Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756199191569_k6gp2tsqj","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:06:31.941Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756199191569_k6gp2tsqj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:06:31.970Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756199191569_k6gp2tsqj","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:06:31.976Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756199191569_k6gp2tsqj","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:06:31.983Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756199191569_k6gp2tsqj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:31.992Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756199191569_k6gp2tsqj","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T09:06:32.000Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756199191569_k6gp2tsqj","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:06:32.006Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756199191569_k6gp2tsqj","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:32.013Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756199191569_k6gp2tsqj","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T09:06:32.019Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756199191569_k6gp2tsqj","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:32.032Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756199191569_k6gp2tsqj","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T09:06:32.041Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756199191569_k6gp2tsqj","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T09:06:32.048Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756199191569_k6gp2tsqj","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T09:06:32.054Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756199191569_k6gp2tsqj","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:32.060Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756199191569_k6gp2tsqj","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:06:32.088Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199191569_k6gp2tsqj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:32.095Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199191569_k6gp2tsqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:32.102Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756199191569_k6gp2tsqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:32.139Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756199191569_k6gp2tsqj","bodySize":128249,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:32.146Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":128249,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:06:32.154Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":128249,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T09:06:32.161Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":128249,"expectedSize":128249}}
{"timestamp":"2025-08-26T09:06:32.168Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":128249,"timeout":600000}}
{"timestamp":"2025-08-26T09:06:32.175Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:06:32.181Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:06:38.227Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756199191569_k6gp2tsqj","requestSize":128249,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:06:38.235Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756199191569_k6gp2tsqj","duration":8,"requestSize":128249,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:06:38.240Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":653,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:06:38.273Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756199191569_k6gp2tsqj","totalTime":6704,"layerTimings":{"router":177,"transformer":98,"protocol":70,"serverCompatibility":140,"server":6147,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T09:06:38.305Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756199191569_k6gp2tsqj","executionId":"req_1756199191569_k6gp2tsqj","totalTime":6704,"success":true}}
{"timestamp":"2025-08-26T09:06:43.808Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:06:43.814Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:43.820Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:43.825Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:06:43.831Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:06:43.835Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:06:43.841Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756199203841_715tl4lgt","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:06:43.959Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:43.965Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756199203841_715tl4lgt","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:06:43.970Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:06:43.976Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:06:43.981Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":5,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":6,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",6]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T09:06:43.987Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756199203841_715tl4lgt","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:06:44.018Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756199203841_715tl4lgt","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:06:44.058Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756199203841_715tl4lgt","hasOutput":true}}
{"timestamp":"2025-08-26T09:06:44.064Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756199203841_715tl4lgt","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:06:44.088Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199203841_715tl4lgt","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:44.093Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199203841_715tl4lgt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:44.099Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756199203841_715tl4lgt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:44.123Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756199203841_715tl4lgt","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:44.128Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756199203841_715tl4lgt","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:06:44.134Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756199203841_715tl4lgt","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T09:06:44.158Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756199203841_715tl4lgt","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:06:44.183Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756199203841_715tl4lgt","selectedPipelineId":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:06:44.189Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756199203841_715tl4lgt","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:06:44.194Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756199203841_715tl4lgt","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:44.200Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756199203841_715tl4lgt","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:06:44.207Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756199203841_715tl4lgt","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:06:44.232Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199203841_715tl4lgt","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:44.237Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199203841_715tl4lgt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:44.242Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756199203841_715tl4lgt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:44.274Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756199203841_715tl4lgt","bodySize":133913,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:44.280Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":133913,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:06:44.285Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":133913,"chunkSize":16384,"estimatedChunks":9}}
{"timestamp":"2025-08-26T09:06:44.290Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":133913,"expectedSize":133913}}
{"timestamp":"2025-08-26T09:06:44.296Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":133913,"timeout":600000}}
{"timestamp":"2025-08-26T09:06:44.303Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:06:44.308Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:06:50.066Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756199203841_715tl4lgt","requestSize":133913,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:06:50.073Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756199203841_715tl4lgt","duration":7,"requestSize":133913,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:06:50.079Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:06:50.085Z","level":"ERROR","message":"Server error detected, throwing for retry","data":{"requestId":"req_1756199203841_715tl4lgt","status":504,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions","responsePreview":"{\"error\":{\"message\":\"bad response status code 504 (request id: 20250826170644354675775yiuoUOx0)\",\"type\":\"openai_error\",\"param\":\"\",\"code\":\"bad_response_status_code\"}}"}}
{"timestamp":"2025-08-26T09:06:50.090Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756199203841_715tl4lgt","pipelineId":"shuaihong-glm-4.5-key0","errorMessage":"Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T09:06:50.095Z","level":"ERROR","message":"❌ Server层错误 - 零Fallback策略：立即失败","data":{"requestId":"req_1756199203841_715tl4lgt","pipelineId":"shuaihong-glm-4.5-key0","error":"Server error: 504 Internal Server Error","zeroFallbackPolicy":true,"deprecated":"IntelligentPipelineSwitching disabled"}}
{"timestamp":"2025-08-26T09:06:50.104Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756199203841_715tl4lgt","error":"Provider shuaihong failed for model glm: Server error: 504 Internal Server Error","stack":"ProviderFailureError: Provider shuaihong failed for model glm: Server error: 504 Internal Server Error\n    at ZeroFallbackErrorFactory.createProviderFailure (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/interfaces/core/zero-fallback-errors.js:136:16)\n    at PipelineRequestProcessor.processRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-request-processor.js:359:91)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:236:13)","layerTimings":{"router":152,"transformer":89,"protocol":54,"serverCompatibility":69},"errors":[{"layer":"pipeline","error":"Provider shuaihong failed for model glm: Server error: 504 Internal Server Error","timestamp":{}}]}}
{"timestamp":"2025-08-26T09:06:50.109Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756199203841_715tl4lgt","error":"Provider shuaihong failed for model glm: Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T09:06:50.141Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Provider shuaihong failed for model glm: Server error: 504 Internal Server Error","stack":"Error: Pipeline request processing failed: Provider shuaihong failed for model glm: Server error: 504 Internal Server Error\n    at PipelineRequestProcessor.processRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-request-processor.js:442:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T09:06:50.159Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:06:50.165Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:50.170Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:50.175Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:06:50.181Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:06:50.185Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:06:50.191Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756199210191_jaa1cjfca","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:06:50.301Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:50.307Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756199210191_jaa1cjfca","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:06:50.313Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:06:50.319Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:06:50.324Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":6,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":7,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",7]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T09:06:50.330Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756199210191_jaa1cjfca","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:06:50.360Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756199210191_jaa1cjfca","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:06:50.402Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756199210191_jaa1cjfca","hasOutput":true}}
{"timestamp":"2025-08-26T09:06:50.407Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756199210191_jaa1cjfca","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:06:50.430Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199210191_jaa1cjfca","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:50.437Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199210191_jaa1cjfca","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:50.442Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756199210191_jaa1cjfca","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:50.466Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756199210191_jaa1cjfca","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:50.472Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756199210191_jaa1cjfca","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:06:50.477Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756199210191_jaa1cjfca","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T09:06:50.502Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756199210191_jaa1cjfca","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:06:50.527Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756199210191_jaa1cjfca","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:06:50.532Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756199210191_jaa1cjfca","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:06:50.537Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756199210191_jaa1cjfca","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:50.544Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756199210191_jaa1cjfca","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:06:50.550Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756199210191_jaa1cjfca","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:06:50.574Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199210191_jaa1cjfca","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:50.580Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199210191_jaa1cjfca","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:50.584Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756199210191_jaa1cjfca","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:50.616Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756199210191_jaa1cjfca","bodySize":133921,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:50.622Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":133921,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:06:50.628Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":133921,"chunkSize":16384,"estimatedChunks":9}}
{"timestamp":"2025-08-26T09:06:50.634Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":133921,"expectedSize":133921}}
{"timestamp":"2025-08-26T09:06:50.639Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":133921,"timeout":600000}}
{"timestamp":"2025-08-26T09:06:50.646Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:06:50.651Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:06:53.828Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756199210191_jaa1cjfca","requestSize":133921,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:06:53.835Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756199210191_jaa1cjfca","duration":7,"requestSize":133921,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:06:53.841Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":637,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:06:53.876Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756199210191_jaa1cjfca","totalTime":3685,"layerTimings":{"router":145,"transformer":89,"protocol":55,"serverCompatibility":66,"server":3268,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T09:06:53.908Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756199210191_jaa1cjfca","executionId":"req_1756199210191_jaa1cjfca","totalTime":3685,"success":true}}
{"timestamp":"2025-08-26T09:06:54.563Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:06:54.569Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:54.575Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:06:54.581Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:06:54.586Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:06:54.590Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:06:54.596Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756199214596_0a1q0t3gp","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:06:54.725Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:54.731Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756199214596_0a1q0t3gp","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:06:54.737Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:06:54.743Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:06:54.748Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":7,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":8,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",8]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T09:06:54.754Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756199214596_0a1q0t3gp","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:06:54.810Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756199214596_0a1q0t3gp","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:06:54.905Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756199214596_0a1q0t3gp","hasOutput":true}}
{"timestamp":"2025-08-26T09:06:54.910Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756199214596_0a1q0t3gp","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:06:54.955Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199214596_0a1q0t3gp","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:54.961Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199214596_0a1q0t3gp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:54.966Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756199214596_0a1q0t3gp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:55.012Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756199214596_0a1q0t3gp","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T09:06:55.018Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756199214596_0a1q0t3gp","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T09:06:55.023Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756199214596_0a1q0t3gp","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:06:55.029Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756199214596_0a1q0t3gp","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:06:55.075Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756199214596_0a1q0t3gp","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:06:55.123Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756199214596_0a1q0t3gp","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:06:55.129Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756199214596_0a1q0t3gp","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:06:55.133Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756199214596_0a1q0t3gp","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:55.140Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756199214596_0a1q0t3gp","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T09:06:55.145Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756199214596_0a1q0t3gp","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:06:55.150Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756199214596_0a1q0t3gp","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:55.155Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756199214596_0a1q0t3gp","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T09:06:55.160Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756199214596_0a1q0t3gp","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:55.170Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756199214596_0a1q0t3gp","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T09:06:55.177Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756199214596_0a1q0t3gp","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T09:06:55.182Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756199214596_0a1q0t3gp","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T09:06:55.187Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756199214596_0a1q0t3gp","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:06:55.192Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756199214596_0a1q0t3gp","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:06:55.235Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199214596_0a1q0t3gp","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:06:55.242Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199214596_0a1q0t3gp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:55.248Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756199214596_0a1q0t3gp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:06:55.324Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756199214596_0a1q0t3gp","bodySize":788124,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:06:55.337Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":788124,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:06:55.351Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":788124,"chunkSize":16384,"estimatedChunks":49}}
{"timestamp":"2025-08-26T09:06:55.362Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":788124,"expectedSize":788124}}
{"timestamp":"2025-08-26T09:06:55.368Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":788124,"timeout":600000}}
{"timestamp":"2025-08-26T09:06:55.380Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:06:55.387Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:07:54.566Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:07:54.573Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:07:54.579Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:07:54.584Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:07:54.590Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:07:54.595Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:07:54.601Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756199274601_qtnbj9d0c","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:07:54.735Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:07:54.741Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756199274601_qtnbj9d0c","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:07:54.747Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:07:54.752Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:07:54.759Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":8,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":9,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",9]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T09:07:54.769Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756199274601_qtnbj9d0c","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:07:54.836Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756199274601_qtnbj9d0c","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:07:54.938Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756199274601_qtnbj9d0c","hasOutput":true}}
{"timestamp":"2025-08-26T09:07:54.944Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756199274601_qtnbj9d0c","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:07:54.990Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199274601_qtnbj9d0c","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:07:54.996Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199274601_qtnbj9d0c","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:07:55.001Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756199274601_qtnbj9d0c","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:07:55.047Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756199274601_qtnbj9d0c","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:07:55.054Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756199274601_qtnbj9d0c","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:07:55.059Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756199274601_qtnbj9d0c","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T09:07:55.105Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756199274601_qtnbj9d0c","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:07:55.153Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756199274601_qtnbj9d0c","selectedPipelineId":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:07:55.160Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756199274601_qtnbj9d0c","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:07:55.166Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756199274601_qtnbj9d0c","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:07:55.174Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756199274601_qtnbj9d0c","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:07:55.182Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756199274601_qtnbj9d0c","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:07:55.230Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756199274601_qtnbj9d0c","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:07:55.237Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756199274601_qtnbj9d0c","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:07:55.243Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756199274601_qtnbj9d0c","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:07:55.322Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756199274601_qtnbj9d0c","bodySize":788115,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:07:55.333Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":788115,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:07:55.340Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":788115,"chunkSize":16384,"estimatedChunks":49}}
{"timestamp":"2025-08-26T09:07:55.347Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":788115,"expectedSize":788115}}
{"timestamp":"2025-08-26T09:07:55.353Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":788115,"timeout":600000}}
{"timestamp":"2025-08-26T09:07:55.360Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:07:55.366Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:08:26.364Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756199274601_qtnbj9d0c","requestSize":788115,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:08:26.372Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756199274601_qtnbj9d0c","duration":8,"requestSize":788115,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:08:26.378Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:08:26.385Z","level":"ERROR","message":"Server error detected, throwing for retry","data":{"requestId":"req_1756199274601_qtnbj9d0c","status":504,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions","responsePreview":"{\"error\":{\"message\":\"bad response status code 504 (request id: 20250826170755407432403cVaoZvg0)\",\"type\":\"openai_error\",\"param\":\"\",\"code\":\"bad_response_status_code\"}}"}}
{"timestamp":"2025-08-26T09:08:26.392Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756199274601_qtnbj9d0c","pipelineId":"shuaihong-glm-4.5-key0","errorMessage":"Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T09:08:26.398Z","level":"ERROR","message":"❌ Server层错误 - 零Fallback策略：立即失败","data":{"requestId":"req_1756199274601_qtnbj9d0c","pipelineId":"shuaihong-glm-4.5-key0","error":"Server error: 504 Internal Server Error","zeroFallbackPolicy":true,"deprecated":"IntelligentPipelineSwitching disabled"}}
{"timestamp":"2025-08-26T09:08:26.409Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756199274601_qtnbj9d0c","error":"Provider shuaihong failed for model glm: Server error: 504 Internal Server Error","stack":"ProviderFailureError: Provider shuaihong failed for model glm: Server error: 504 Internal Server Error\n    at ZeroFallbackErrorFactory.createProviderFailure (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/interfaces/core/zero-fallback-errors.js:136:16)\n    at PipelineRequestProcessor.processRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-request-processor.js:359:91)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:236:13)","layerTimings":{"router":182,"transformer":200,"protocol":98,"serverCompatibility":119},"errors":[{"layer":"pipeline","error":"Provider shuaihong failed for model glm: Server error: 504 Internal Server Error","timestamp":{}}]}}
{"timestamp":"2025-08-26T09:08:26.416Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756199274601_qtnbj9d0c","error":"Provider shuaihong failed for model glm: Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T09:08:26.545Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Provider shuaihong failed for model glm: Server error: 504 Internal Server Error","stack":"Error: Pipeline request processing failed: Provider shuaihong failed for model glm: Server error: 504 Internal Server Error\n    at PipelineRequestProcessor.processRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-request-processor.js:442:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T09:09:16.246Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756199214596_0a1q0t3gp","requestSize":788124,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:09:16.256Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756199214596_0a1q0t3gp","duration":10,"requestSize":788124,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:09:16.262Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":637,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:09:16.302Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756199214596_0a1q0t3gp","totalTime":141706,"layerTimings":{"router":168,"transformer":186,"protocol":103,"serverCompatibility":154,"server":141028,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T09:09:16.424Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756199214596_0a1q0t3gp","executionId":"req_1756199214596_0a1q0t3gp","totalTime":141706,"success":true}}
{"timestamp":"2025-08-26T09:27:05.421Z","level":"INFO","message":"Received SIGINT, exiting gracefully"}
{"timestamp":"2025-08-26T09:27:05.586Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T09:27:06.251Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T09:27:06.255Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T09:27:06.259Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T09:27:06.263Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T09:27:06.266Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T09:27:06.269Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T09:27:06.272Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T09:27:06.276Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T09:27:06.279Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T09:27:06.282Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T09:27:07.286Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T09:27:08.478Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T09:27:08.486Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T09:27:08.503Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T09:27:08.510Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T09:27:08.517Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T09:27:08.524Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T09:27:08.527Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T09:27:08.533Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","kimi-k2","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","kimi-k2","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["kimi-k2","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["kimi-k2","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["kimi-k2","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T09:27:08.539Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T09:27:08.545Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T09:27:08.552Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:27:08.558Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:27:08.562Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:27:08.568Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T09:27:08.575Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T09:27:08.578Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T09:27:08.585Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T09:27:08.592Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T09:27:08.598Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":0,"categories":[],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T09:27:08.605Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":[]}}
{"timestamp":"2025-08-26T09:27:08.612Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":0,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T09:27:08.619Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":0,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T09:27:08.626Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T09:27:08.632Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":54,"totalPipelines":26,"virtualModels":[],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T09:27:08.638Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T09:27:08.649Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T09:27:08.655Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":54,"uptime":0}}
{"timestamp":"2025-08-26T09:27:08.662Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T09:27:08.672Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:27:08.679Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:27:22.254Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:27:22.261Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:27:22.267Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:27:22.272Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:27:22.277Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:27:22.279Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:27:22.285Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756200442284_w34zabglc","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:27:22.309Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:27:22.314Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756200442284_w34zabglc","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T09:27:22.320Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,kimi-k2;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,kimi-k2","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:27:22.325Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-kimi-k2-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:27:22.330Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-kimi-k2-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-kimi-k2-key0"]}}
{"timestamp":"2025-08-26T09:27:22.336Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756200442284_w34zabglc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-kimi-k2-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:27:22.358Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756200442284_w34zabglc","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:27:22.373Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756200442284_w34zabglc","hasOutput":true}}
{"timestamp":"2025-08-26T09:27:22.378Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756200442284_w34zabglc","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T09:27:22.391Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200442284_w34zabglc","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:27:22.396Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200442284_w34zabglc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:27:22.402Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756200442284_w34zabglc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:27:22.415Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756200442284_w34zabglc","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:27:22.420Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756200442284_w34zabglc","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:27:22.425Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756200442284_w34zabglc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T09:27:22.439Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756200442284_w34zabglc","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:27:22.452Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756200442284_w34zabglc","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-kimi-k2-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:27:22.458Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756200442284_w34zabglc","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:27:22.463Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756200442284_w34zabglc","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:27:22.469Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756200442284_w34zabglc","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:27:22.475Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756200442284_w34zabglc","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:27:22.487Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200442284_w34zabglc","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:27:22.492Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200442284_w34zabglc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:27:22.497Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756200442284_w34zabglc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:27:22.514Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":540,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T09:27:22.559Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:27:22.564Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:27:22.569Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:27:22.575Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:27:22.580Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:27:22.584Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:27:22.589Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756200442589_4auj585pg","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:27:22.728Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:27:22.735Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756200442589_4auj585pg","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:27:22.741Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,kimi-k2;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,kimi-k2","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:27:22.747Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-kimi-k2-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:27:22.753Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":1,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":2,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-kimi-k2-key0",2]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-kimi-k2-key0"]}}
{"timestamp":"2025-08-26T09:27:22.759Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756200442589_4auj585pg","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-kimi-k2-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:27:22.819Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756200442589_4auj585pg","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:27:22.905Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756200442589_4auj585pg","hasOutput":true}}
{"timestamp":"2025-08-26T09:27:22.912Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756200442589_4auj585pg","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:27:22.959Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200442589_4auj585pg","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:27:22.966Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200442589_4auj585pg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:27:22.972Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756200442589_4auj585pg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:27:23.021Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756200442589_4auj585pg","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T09:27:23.027Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756200442589_4auj585pg","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T09:27:23.033Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756200442589_4auj585pg","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:27:23.038Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756200442589_4auj585pg","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:27:23.087Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756200442589_4auj585pg","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:27:23.136Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756200442589_4auj585pg","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-kimi-k2-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:27:23.142Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756200442589_4auj585pg","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:27:23.146Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756200442589_4auj585pg","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:27:23.154Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756200442589_4auj585pg","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T09:27:23.164Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:27:23.169Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:27:23.178Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:27:23.183Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:27:23.192Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756200442589_4auj585pg","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:27:23.197Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756200442589_4auj585pg","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:27:23.203Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756200442589_4auj585pg","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T09:27:23.209Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756200442589_4auj585pg","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:27:23.221Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756200442589_4auj585pg","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T09:27:23.229Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756200442589_4auj585pg","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T09:27:23.235Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756200442589_4auj585pg","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T09:27:23.241Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756200442589_4auj585pg","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:27:23.247Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756200442589_4auj585pg","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:27:23.292Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200442589_4auj585pg","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:27:23.298Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200442589_4auj585pg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:27:23.304Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756200442589_4auj585pg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:27:23.382Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756200442589_4auj585pg","bodySize":788175,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:27:23.393Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":788175,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:27:23.399Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":788175,"chunkSize":16384,"estimatedChunks":49}}
{"timestamp":"2025-08-26T09:27:23.405Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":788175,"expectedSize":788175}}
{"timestamp":"2025-08-26T09:27:23.411Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":788175,"timeout":600000}}
{"timestamp":"2025-08-26T09:27:25.365Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":501,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T09:27:25.400Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756200442284_w34zabglc","totalTime":3115,"layerTimings":{"router":59,"transformer":42,"protocol":32,"serverCompatibility":43,"server":2880,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T09:27:25.413Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756200442284_w34zabglc","executionId":"req_1756200442284_w34zabglc","totalTime":3115,"success":true}}
{"timestamp":"2025-08-26T09:28:22.287Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:28:22.295Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:28:22.302Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:28:22.309Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:28:22.316Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:28:22.321Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:28:22.327Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756200502327_ezx55p98s","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:28:22.483Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:28:22.489Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756200502327_ezx55p98s","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:28:22.496Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,kimi-k2;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,kimi-k2","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:28:22.503Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-kimi-k2-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:28:22.510Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":2,"selectedIndex":2,"selectedPipeline":"shuaihong-kimi-k2-key0","totalPipelines":3,"position":"3/3","nextIndex":3,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-kimi-k2-key0",3]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-kimi-k2-key0"]}}
{"timestamp":"2025-08-26T09:28:22.516Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756200502327_ezx55p98s","selectedPipeline":"shuaihong-kimi-k2-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-kimi-k2-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:28:22.578Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756200502327_ezx55p98s","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:28:22.669Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756200502327_ezx55p98s","hasOutput":true}}
{"timestamp":"2025-08-26T09:28:22.676Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756200502327_ezx55p98s","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:28:22.725Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200502327_ezx55p98s","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:28:22.732Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200502327_ezx55p98s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:28:22.738Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756200502327_ezx55p98s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:28:22.788Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756200502327_ezx55p98s","selectedPipelineId":"shuaihong-kimi-k2-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:28:22.794Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756200502327_ezx55p98s","selectedPipelineId":"shuaihong-kimi-k2-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:28:22.800Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756200502327_ezx55p98s","selectedPipeline":"shuaihong-kimi-k2-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"kimi-k2","routeUsed":"shuaihong,kimi-k2"}}
{"timestamp":"2025-08-26T09:28:22.847Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756200502327_ezx55p98s","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:28:22.896Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756200502327_ezx55p98s","selectedPipelineId":"shuaihong-kimi-k2-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-kimi-k2-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:28:22.903Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756200502327_ezx55p98s","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:28:22.909Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756200502327_ezx55p98s","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:28:22.916Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756200502327_ezx55p98s","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:28:22.923Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756200502327_ezx55p98s","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:28:22.971Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200502327_ezx55p98s","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:28:22.978Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200502327_ezx55p98s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:28:22.985Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756200502327_ezx55p98s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:28:23.065Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756200502327_ezx55p98s","bodySize":788166,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:28:23.075Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":788166,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:28:23.083Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":788166,"chunkSize":16384,"estimatedChunks":49}}
{"timestamp":"2025-08-26T09:28:23.089Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":788166,"expectedSize":788166}}
{"timestamp":"2025-08-26T09:28:23.095Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":788166,"timeout":600000}}
{"timestamp":"2025-08-26T09:28:23.106Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:28:23.112Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:29:05.326Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756200502327_ezx55p98s","requestSize":788166,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:29:05.332Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756200502327_ezx55p98s","duration":6,"requestSize":788166,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:29:05.339Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":400,"responseSize":394,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:29:05.349Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756200502327_ezx55p98s","status":400,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions","responsePreview":"{\"error\":{\"message\":\"This endpoint's maximum context length is 32768 tokens. However, you requested about 203914 tokens (179026 of text input, 16696 of tool input, 8192 in the output). Please reduce t","extractedErrorMessage":"This endpoint's maximum context length is 32768 tokens. However, you requested about 203914 tokens (179026 of text input, 16696 of tool input, 8192 in the output). Please reduce the length of either one, or use the \"middle-out\" transform to compress your prompt automatically. (request id: 20250826172823159534604y05A9sCd)"}}
{"timestamp":"2025-08-26T09:29:05.354Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756200502327_ezx55p98s","pipelineId":"shuaihong-kimi-k2-key0","errorMessage":"This endpoint's maximum context length is 32768 tokens. However, you requested about 203914 tokens (179026 of text input, 16696 of tool input, 8192 in the output). Please reduce the length of either one, or use the \"middle-out\" transform to compress your prompt automatically. (request id: 20250826172823159534604y05A9sCd)"}}
{"timestamp":"2025-08-26T09:29:05.361Z","level":"ERROR","message":"❌ Server层错误 - 零Fallback策略：立即失败","data":{"requestId":"req_1756200502327_ezx55p98s","pipelineId":"shuaihong-kimi-k2-key0","error":"This endpoint's maximum context length is 32768 tokens. However, you requested about 203914 tokens (179026 of text input, 16696 of tool input, 8192 in the output). Please reduce the length of either one, or use the \"middle-out\" transform to compress your prompt automatically. (request id: 20250826172823159534604y05A9sCd)","zeroFallbackPolicy":true,"deprecated":"IntelligentPipelineSwitching disabled"}}
{"timestamp":"2025-08-26T09:29:05.371Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756200502327_ezx55p98s","error":"Provider shuaihong failed for model kimi: This endpoint's maximum context length is 32768 tokens. However, you requested about 203914 tokens (179026 of text input, 16696 of tool input, 8192 in the output). Please reduce the length of either one, or use the \"middle-out\" transform to compress your prompt automatically. (request id: 20250826172823159534604y05A9sCd)","stack":"ProviderFailureError: Provider shuaihong failed for model kimi: This endpoint's maximum context length is 32768 tokens. However, you requested about 203914 tokens (179026 of text input, 16696 of tool input, 8192 in the output). Please reduce the length of either one, or use the \"middle-out\" transform to compress your prompt automatically. (request id: 20250826172823159534604y05A9sCd)\n    at ZeroFallbackErrorFactory.createProviderFailure (/opt/homebrew/lib/node_modules/route-claude-code/dist/interfaces/core/zero-fallback-errors.js:136:16)\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:359:91)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":198,"transformer":194,"protocol":102,"serverCompatibility":117},"errors":[{"layer":"pipeline","error":"Provider shuaihong failed for model kimi: This endpoint's maximum context length is 32768 tokens. However, you requested about 203914 tokens (179026 of text input, 16696 of tool input, 8192 in the output). Please reduce the length of either one, or use the \"middle-out\" transform to compress your prompt automatically. (request id: 20250826172823159534604y05A9sCd)","timestamp":{}}]}}
{"timestamp":"2025-08-26T09:29:05.377Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756200502327_ezx55p98s","error":"Provider shuaihong failed for model kimi: This endpoint's maximum context length is 32768 tokens. However, you requested about 203914 tokens (179026 of text input, 16696 of tool input, 8192 in the output). Please reduce the length of either one, or use the \"middle-out\" transform to compress your prompt automatically. (request id: 20250826172823159534604y05A9sCd)"}}
{"timestamp":"2025-08-26T09:29:05.501Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Provider shuaihong failed for model kimi: This endpoint's maximum context length is 32768 tokens. However, you requested about 203914 tokens (179026 of text input, 16696 of tool input, 8192 in the output). Please reduce the length of either one, or use the \"middle-out\" transform to compress your prompt automatically. (request id: 20250826172823159534604y05A9sCd)","stack":"Error: Pipeline request processing failed: Provider shuaihong failed for model kimi: This endpoint's maximum context length is 32768 tokens. However, you requested about 203914 tokens (179026 of text input, 16696 of tool input, 8192 in the output). Please reduce the length of either one, or use the \"middle-out\" transform to compress your prompt automatically. (request id: 20250826172823159534604y05A9sCd)\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:442:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T09:30:38.574Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756200442589_4auj585pg","requestSize":788175,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:30:38.581Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756200442589_4auj585pg","duration":7,"requestSize":788175,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:30:38.587Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":1366,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:30:38.623Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756200442589_4auj585pg","totalTime":196034,"layerTimings":{"router":179,"transformer":185,"protocol":108,"serverCompatibility":199,"server":195294,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T09:30:38.743Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756200442589_4auj585pg","executionId":"req_1756200442589_4auj585pg","totalTime":196034,"success":true}}
{"timestamp":"2025-08-26T09:31:34.805Z","level":"INFO","message":"Received SIGINT, exiting gracefully"}
{"timestamp":"2025-08-26T09:31:34.809Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T09:31:34.812Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T09:31:34.815Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T09:31:34.818Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T09:31:34.821Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T09:31:34.824Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T09:31:34.827Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T09:31:34.829Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T09:31:34.832Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T09:31:34.835Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T09:31:34.837Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T09:31:35.842Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T09:31:37.140Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T09:31:37.146Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T09:31:37.159Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T09:31:37.165Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T09:31:37.171Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T09:31:37.177Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T09:31:37.180Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T09:31:37.186Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","gemini-2.5-pro","ZhipuAI/GLM-4.5","gpt-oss-20b-mlx"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","qwen-long","gpt-oss-20b-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","gpt-oss-20b-mlx"]},"webSearch":{"primary":3,"security":1,"models":["gemini-2.5-pro","qwen3-coder-plus","ZhipuAI/GLM-4.5","gpt-oss-20b-mlx"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","gpt-oss-20b-mlx"]},"coding":{"primary":3,"security":2,"models":["gemini-2.5-pro","qwen3-coder-plus","ZhipuAI/GLM-4.5","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["gpt-oss-20b-mlx","nextcoder-32b-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T09:31:37.192Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T09:31:37.198Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T09:31:37.204Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:31:37.209Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:31:37.212Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:31:37.219Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T09:31:37.225Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T09:31:37.228Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T09:31:37.235Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T09:31:37.241Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T09:31:37.248Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":0,"categories":[],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T09:31:37.253Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":[]}}
{"timestamp":"2025-08-26T09:31:37.259Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":0,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T09:31:37.265Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":0,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T09:31:37.272Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T09:31:37.279Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":51,"totalPipelines":26,"virtualModels":[],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T09:31:37.286Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T09:31:37.295Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T09:31:37.301Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":51,"uptime":0}}
{"timestamp":"2025-08-26T09:31:37.306Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T09:31:37.316Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:31:37.322Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:31:42.850Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:31:42.856Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:31:42.862Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:31:42.867Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:31:42.873Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:31:42.876Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:31:42.882Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756200702882_j21wji5pq","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:31:42.907Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:31:42.913Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756200702882_j21wji5pq","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T09:31:42.918Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:31:42.924Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:31:42.929Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T09:31:42.935Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756200702882_j21wji5pq","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:31:42.954Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756200702882_j21wji5pq","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:31:42.968Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756200702882_j21wji5pq","hasOutput":true}}
{"timestamp":"2025-08-26T09:31:42.974Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756200702882_j21wji5pq","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T09:31:42.986Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200702882_j21wji5pq","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:31:42.991Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200702882_j21wji5pq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:31:42.997Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756200702882_j21wji5pq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:31:43.011Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756200702882_j21wji5pq","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:31:43.016Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756200702882_j21wji5pq","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:31:43.021Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756200702882_j21wji5pq","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T09:31:43.034Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756200702882_j21wji5pq","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:31:43.047Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756200702882_j21wji5pq","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:31:43.052Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756200702882_j21wji5pq","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:31:43.058Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756200702882_j21wji5pq","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:31:43.064Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756200702882_j21wji5pq","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:31:43.070Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756200702882_j21wji5pq","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:31:43.084Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200702882_j21wji5pq","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:31:43.089Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200702882_j21wji5pq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:31:43.095Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756200702882_j21wji5pq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:31:43.111Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":540,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T09:31:43.156Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:31:43.162Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:31:43.168Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:31:43.173Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:31:43.178Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:31:43.182Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:31:43.188Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756200703188_mw3p7iein","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:31:43.322Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:31:43.328Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756200703188_mw3p7iein","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:31:43.333Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,gemini-2.5-pro;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,gemini-2.5-pro","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:31:43.338Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-gemini-2.5-pro-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:31:43.344Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":1,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":2,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",2]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T09:31:43.349Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756200703188_mw3p7iein","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:31:43.408Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756200703188_mw3p7iein","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:31:43.494Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756200703188_mw3p7iein","hasOutput":true}}
{"timestamp":"2025-08-26T09:31:43.500Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756200703188_mw3p7iein","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:31:43.546Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200703188_mw3p7iein","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:31:43.552Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200703188_mw3p7iein","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:31:43.557Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756200703188_mw3p7iein","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:31:43.604Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756200703188_mw3p7iein","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T09:31:43.610Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756200703188_mw3p7iein","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T09:31:43.616Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756200703188_mw3p7iein","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:31:43.622Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756200703188_mw3p7iein","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:31:43.669Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756200703188_mw3p7iein","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:31:43.715Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756200703188_mw3p7iein","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:31:43.722Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756200703188_mw3p7iein","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:31:43.727Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756200703188_mw3p7iein","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:31:43.735Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756200703188_mw3p7iein","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T09:31:43.745Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:31:43.750Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:31:43.758Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756200703188_mw3p7iein","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:31:43.764Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756200703188_mw3p7iein","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:31:43.769Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756200703188_mw3p7iein","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T09:31:43.775Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756200703188_mw3p7iein","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:31:43.785Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756200703188_mw3p7iein","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T09:31:43.793Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756200703188_mw3p7iein","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T09:31:43.798Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756200703188_mw3p7iein","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T09:31:43.804Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756200703188_mw3p7iein","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:31:43.809Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756200703188_mw3p7iein","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:31:43.854Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200703188_mw3p7iein","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:31:43.860Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200703188_mw3p7iein","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:31:43.865Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756200703188_mw3p7iein","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:31:43.940Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756200703188_mw3p7iein","bodySize":788183,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:31:43.949Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":788183,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:31:43.956Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":788183,"chunkSize":16384,"estimatedChunks":49}}
{"timestamp":"2025-08-26T09:31:43.962Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":788183,"expectedSize":788183}}
{"timestamp":"2025-08-26T09:31:43.967Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":788183,"timeout":600000}}
{"timestamp":"2025-08-26T09:31:43.975Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:31:43.980Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:31:44.816Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":499,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T09:31:44.849Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756200702882_j21wji5pq","totalTime":1967,"layerTimings":{"router":60,"transformer":39,"protocol":32,"serverCompatibility":45,"server":1732,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T09:31:44.861Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756200702882_j21wji5pq","executionId":"req_1756200702882_j21wji5pq","totalTime":1967,"success":true}}
{"timestamp":"2025-08-26T09:32:42.883Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:32:42.890Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:32:42.896Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:32:42.903Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:32:42.908Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:32:42.913Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:32:42.919Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756200762919_szkxqnj7l","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:32:43.067Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:32:43.074Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756200762919_szkxqnj7l","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:32:43.080Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,gemini-2.5-pro;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,gemini-2.5-pro","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:32:43.087Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-gemini-2.5-pro-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:32:43.093Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":2,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":3,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",3]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T09:32:43.099Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756200762919_szkxqnj7l","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:32:43.159Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756200762919_szkxqnj7l","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:32:43.253Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756200762919_szkxqnj7l","hasOutput":true}}
{"timestamp":"2025-08-26T09:32:43.259Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756200762919_szkxqnj7l","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:32:43.308Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200762919_szkxqnj7l","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:32:43.315Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200762919_szkxqnj7l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:32:43.321Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756200762919_szkxqnj7l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:32:43.371Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756200762919_szkxqnj7l","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:32:43.378Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756200762919_szkxqnj7l","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:32:43.385Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756200762919_szkxqnj7l","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T09:32:43.433Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756200762919_szkxqnj7l","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:32:43.481Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756200762919_szkxqnj7l","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:32:43.488Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756200762919_szkxqnj7l","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:32:43.495Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756200762919_szkxqnj7l","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:32:43.502Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756200762919_szkxqnj7l","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:32:43.510Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756200762919_szkxqnj7l","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:32:43.560Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200762919_szkxqnj7l","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:32:43.566Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200762919_szkxqnj7l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:32:43.572Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756200762919_szkxqnj7l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:32:43.651Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756200762919_szkxqnj7l","bodySize":788181,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:32:43.662Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":788181,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:32:43.669Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":788181,"chunkSize":16384,"estimatedChunks":49}}
{"timestamp":"2025-08-26T09:32:43.675Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":788181,"expectedSize":788181}}
{"timestamp":"2025-08-26T09:32:43.680Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":788181,"timeout":600000}}
{"timestamp":"2025-08-26T09:32:43.690Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:32:43.696Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:33:43.438Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:33:43.446Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:33:43.453Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:33:43.461Z","level":"INFO","message":"✅ Zero Fallback Policy Enabled - 智能流水线切换已禁用","data":{"zeroFallbackPolicy":true,"deprecatedFeatures":["IntelligentPipelineSwitching","PipelineRecovery","AutoRetry"]}}
{"timestamp":"2025-08-26T09:33:43.470Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:33:43.475Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:33:43.483Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756200823483_x73rs0isu","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:33:43.638Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:33:43.646Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756200823483_x73rs0isu","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T09:33:43.655Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,gemini-2.5-pro;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,gemini-2.5-pro","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:33:43.662Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-gemini-2.5-pro-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:33:43.668Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":3,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":4,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",4]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T09:33:43.674Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756200823483_x73rs0isu","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:33:43.737Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756200823483_x73rs0isu","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:33:43.842Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756200823483_x73rs0isu","hasOutput":true}}
{"timestamp":"2025-08-26T09:33:43.849Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756200823483_x73rs0isu","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T09:33:43.897Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200823483_x73rs0isu","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:33:43.904Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200823483_x73rs0isu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:33:43.911Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756200823483_x73rs0isu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:33:43.959Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756200823483_x73rs0isu","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:33:43.966Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756200823483_x73rs0isu","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:33:43.972Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756200823483_x73rs0isu","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T09:33:44.020Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756200823483_x73rs0isu","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:33:44.071Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756200823483_x73rs0isu","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:33:44.079Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756200823483_x73rs0isu","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:33:44.086Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756200823483_x73rs0isu","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:33:44.093Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756200823483_x73rs0isu","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:33:44.101Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756200823483_x73rs0isu","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:33:44.149Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756200823483_x73rs0isu","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:33:44.156Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756200823483_x73rs0isu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:33:44.163Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756200823483_x73rs0isu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T09:33:44.245Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756200823483_x73rs0isu","bodySize":788182,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:33:44.257Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":788182,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:33:44.265Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":788182,"chunkSize":16384,"estimatedChunks":49}}
{"timestamp":"2025-08-26T09:33:44.272Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":788182,"expectedSize":788182}}
{"timestamp":"2025-08-26T09:33:44.278Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":788182,"timeout":600000}}
{"timestamp":"2025-08-26T09:33:44.288Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:33:44.294Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:34:24.492Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756200762919_szkxqnj7l","requestSize":788181,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:34:24.499Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756200762919_szkxqnj7l","duration":7,"requestSize":788181,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:34:24.505Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":524,"responseSize":165,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:34:24.511Z","level":"ERROR","message":"Server error detected, throwing for retry","data":{"requestId":"req_1756200762919_szkxqnj7l","status":524,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions","responsePreview":"{\"error\":{\"message\":\"bad response status code 524 (request id: 20250826173243725043378sq8TbWnx)\",\"type\":\"openai_error\",\"param\":\"\",\"code\":\"bad_response_status_code\"}}"}}
{"timestamp":"2025-08-26T09:34:24.517Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756200762919_szkxqnj7l","pipelineId":"shuaihong-gemini-2.5-pro-key0","errorMessage":"Server error: 524 Internal Server Error"}}
{"timestamp":"2025-08-26T09:34:24.522Z","level":"ERROR","message":"❌ Server层错误 - 零Fallback策略：立即失败","data":{"requestId":"req_1756200762919_szkxqnj7l","pipelineId":"shuaihong-gemini-2.5-pro-key0","error":"Server error: 524 Internal Server Error","zeroFallbackPolicy":true,"deprecated":"IntelligentPipelineSwitching disabled"}}
{"timestamp":"2025-08-26T09:34:24.532Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756200762919_szkxqnj7l","error":"Provider shuaihong failed for model gemini: Server error: 524 Internal Server Error","stack":"ProviderFailureError: Provider shuaihong failed for model gemini: Server error: 524 Internal Server Error\n    at ZeroFallbackErrorFactory.createProviderFailure (/opt/homebrew/lib/node_modules/route-claude-code/dist/interfaces/core/zero-fallback-errors.js:136:16)\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:359:91)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":189,"transformer":194,"protocol":105,"serverCompatibility":121},"errors":[{"layer":"pipeline","error":"Provider shuaihong failed for model gemini: Server error: 524 Internal Server Error","timestamp":{}}]}}
{"timestamp":"2025-08-26T09:34:24.538Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756200762919_szkxqnj7l","error":"Provider shuaihong failed for model gemini: Server error: 524 Internal Server Error"}}
{"timestamp":"2025-08-26T09:34:24.662Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Provider shuaihong failed for model gemini: Server error: 524 Internal Server Error","stack":"Error: Pipeline request processing failed: Provider shuaihong failed for model gemini: Server error: 524 Internal Server Error\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:442:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T09:34:27.044Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756200823483_x73rs0isu","requestSize":788182,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:34:27.051Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756200823483_x73rs0isu","duration":7,"requestSize":788182,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:34:27.058Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":3115,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:34:27.095Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756200823483_x73rs0isu","totalTime":43612,"layerTimings":{"router":200,"transformer":208,"protocol":103,"serverCompatibility":121,"server":42907,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T09:34:27.219Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756200823483_x73rs0isu","executionId":"req_1756200823483_x73rs0isu","totalTime":43612,"success":true}}
{"timestamp":"2025-08-26T09:34:36.842Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756200703188_mw3p7iein","requestSize":788183,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:34:36.849Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756200703188_mw3p7iein","duration":7,"requestSize":788183,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:34:36.854Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":612,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:34:36.889Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756200703188_mw3p7iein","totalTime":173701,"layerTimings":{"router":169,"transformer":184,"protocol":106,"serverCompatibility":179,"server":173000,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T09:34:37.004Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756200703188_mw3p7iein","executionId":"req_1756200703188_mw3p7iein","totalTime":173701,"success":true}}
{"timestamp":"2025-08-26T09:59:08.625Z","level":"INFO","message":"Received SIGINT, exiting gracefully"}
{"timestamp":"2025-08-26T09:59:08.630Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T09:59:08.632Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T09:59:08.635Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T09:59:08.638Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T09:59:08.641Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T09:59:08.644Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T09:59:08.647Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T09:59:08.650Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T09:59:08.653Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T09:59:08.656Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T09:59:08.659Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T09:59:09.664Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T09:59:10.842Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T09:59:10.848Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T09:59:10.860Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T09:59:10.865Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T09:59:10.870Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T09:59:10.875Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T09:59:10.877Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T09:59:10.882Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","gemini-2.5-pro","ZhipuAI/GLM-4.5","gpt-oss-20b-mlx"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","qwen-long","gpt-oss-20b-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","gpt-oss-20b-mlx"]},"webSearch":{"primary":3,"security":1,"models":["gemini-2.5-pro","qwen3-coder-plus","ZhipuAI/GLM-4.5","gpt-oss-20b-mlx"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","gpt-oss-20b-mlx"]},"coding":{"primary":3,"security":2,"models":["gemini-2.5-pro","qwen3-coder-plus","ZhipuAI/GLM-4.5","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["gpt-oss-20b-mlx","nextcoder-32b-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T09:59:10.887Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T09:59:10.892Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T09:59:10.897Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T09:59:10.902Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:59:10.905Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:59:10.910Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T09:59:10.914Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T09:59:10.917Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T09:59:10.922Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T09:59:10.927Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T09:59:10.933Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":0,"categories":[],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T09:59:10.938Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":[]}}
{"timestamp":"2025-08-26T09:59:10.943Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":0,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T09:59:10.948Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":0,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T09:59:10.955Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T09:59:10.960Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":43,"totalPipelines":26,"virtualModels":[],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T09:59:10.966Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T09:59:10.976Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T09:59:10.981Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":43,"uptime":0}}
{"timestamp":"2025-08-26T09:59:10.987Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T09:59:10.996Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:59:11.002Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:59:25.411Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:59:25.417Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:25.423Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:25.428Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T09:59:25.434Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:59:25.437Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:59:25.443Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202365443_6g5vjiej3","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:59:25.469Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:25.475Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202365443_6g5vjiej3","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T09:59:25.480Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:59:25.486Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:59:25.491Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T09:59:25.497Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202365443_6g5vjiej3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:59:25.516Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202365443_6g5vjiej3","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:59:25.530Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202365443_6g5vjiej3","hasOutput":true}}
{"timestamp":"2025-08-26T09:59:25.535Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202365443_6g5vjiej3","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T09:59:25.547Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202365443_6g5vjiej3","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:25.553Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202365443_6g5vjiej3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:25.558Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202365443_6g5vjiej3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:25.572Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202365443_6g5vjiej3","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:59:25.578Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202365443_6g5vjiej3","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:59:25.583Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202365443_6g5vjiej3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T09:59:25.595Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202365443_6g5vjiej3","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:59:25.609Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202365443_6g5vjiej3","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:59:25.614Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202365443_6g5vjiej3","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:59:25.619Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202365443_6g5vjiej3","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:25.625Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202365443_6g5vjiej3","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:59:25.631Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202365443_6g5vjiej3","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:59:25.644Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202365443_6g5vjiej3","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:25.649Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202365443_6g5vjiej3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:25.654Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202365443_6g5vjiej3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:25.670Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":747,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T09:59:25.686Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:59:25.692Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:25.696Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:25.701Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T09:59:25.706Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:59:25.710Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:59:25.714Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202365714_r047zfyno","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:59:25.727Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:25.732Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202365714_r047zfyno","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T09:59:25.737Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:59:25.742Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:59:25.747Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":1,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":2,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",2]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T09:59:25.752Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202365714_r047zfyno","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:59:25.773Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202365714_r047zfyno","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:59:25.786Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202365714_r047zfyno","hasOutput":true}}
{"timestamp":"2025-08-26T09:59:25.791Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202365714_r047zfyno","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T09:59:25.805Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202365714_r047zfyno","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:25.810Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202365714_r047zfyno","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:25.826Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202365714_r047zfyno","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:25.837Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202365714_r047zfyno","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T09:59:25.842Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756202365714_r047zfyno","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T09:59:25.847Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202365714_r047zfyno","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:59:25.852Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202365714_r047zfyno","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:59:25.865Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202365714_r047zfyno","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:59:25.878Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202365714_r047zfyno","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:59:25.883Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202365714_r047zfyno","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:59:25.888Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202365714_r047zfyno","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:25.894Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202365714_r047zfyno","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T09:59:25.903Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:59:25.908Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:59:25.915Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756202365714_r047zfyno","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:59:25.919Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756202365714_r047zfyno","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:25.924Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756202365714_r047zfyno","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T09:59:25.930Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756202365714_r047zfyno","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:25.941Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756202365714_r047zfyno","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T09:59:25.950Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756202365714_r047zfyno","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T09:59:25.955Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756202365714_r047zfyno","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T09:59:25.961Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756202365714_r047zfyno","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:25.967Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202365714_r047zfyno","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:59:25.981Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202365714_r047zfyno","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:25.986Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202365714_r047zfyno","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:25.992Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202365714_r047zfyno","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:26.006Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202365714_r047zfyno","bodySize":16672,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:59:26.011Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":16672,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:59:26.016Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":16672,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T09:59:26.021Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":16672,"expectedSize":16672}}
{"timestamp":"2025-08-26T09:59:26.026Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":16672,"timeout":600000}}
{"timestamp":"2025-08-26T09:59:26.034Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:59:26.039Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:59:27.057Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202365714_r047zfyno","requestSize":16672,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:59:27.064Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202365714_r047zfyno","duration":7,"requestSize":16672,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:59:27.070Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":440,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:59:27.104Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202365714_r047zfyno","totalTime":1390,"layerTimings":{"router":46,"transformer":40,"protocol":35,"serverCompatibility":111,"server":1091,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T09:59:27.119Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202365714_r047zfyno","executionId":"req_1756202365714_r047zfyno","totalTime":1390,"success":true}}
{"timestamp":"2025-08-26T09:59:27.157Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:59:27.162Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:27.168Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:27.174Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T09:59:27.180Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:59:27.184Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:59:27.189Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202367189_z3yxe5dg0","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:59:27.203Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:27.209Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202367189_z3yxe5dg0","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T09:59:27.214Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:59:27.219Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:59:27.224Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":2,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":3,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",3]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T09:59:27.229Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202367189_z3yxe5dg0","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:59:27.250Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202367189_z3yxe5dg0","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:59:27.265Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202367189_z3yxe5dg0","hasOutput":true}}
{"timestamp":"2025-08-26T09:59:27.270Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202367189_z3yxe5dg0","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T09:59:27.287Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202367189_z3yxe5dg0","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:27.293Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202367189_z3yxe5dg0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:27.299Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202367189_z3yxe5dg0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:27.315Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202367189_z3yxe5dg0","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:59:27.321Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202367189_z3yxe5dg0","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:59:27.326Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202367189_z3yxe5dg0","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T09:59:27.341Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202367189_z3yxe5dg0","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:59:27.355Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202367189_z3yxe5dg0","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:59:27.360Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202367189_z3yxe5dg0","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:59:27.366Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202367189_z3yxe5dg0","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:27.371Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202367189_z3yxe5dg0","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:59:27.376Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202367189_z3yxe5dg0","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:59:27.389Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202367189_z3yxe5dg0","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:27.394Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202367189_z3yxe5dg0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:27.399Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202367189_z3yxe5dg0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:27.417Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202367189_z3yxe5dg0","bodySize":28246,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:59:27.422Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":28246,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:59:27.427Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":28246,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T09:59:27.432Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":28246,"expectedSize":28246}}
{"timestamp":"2025-08-26T09:59:27.437Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":28246,"timeout":600000}}
{"timestamp":"2025-08-26T09:59:27.445Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:59:27.450Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:59:32.205Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1930,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T09:59:32.239Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202365443_6g5vjiej3","totalTime":6796,"layerTimings":{"router":60,"transformer":38,"protocol":32,"serverCompatibility":43,"server":6564,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T09:59:32.251Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202365443_6g5vjiej3","executionId":"req_1756202365443_6g5vjiej3","totalTime":6796,"success":true}}
{"timestamp":"2025-08-26T09:59:39.895Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202367189_z3yxe5dg0","requestSize":28246,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:59:39.902Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202367189_z3yxe5dg0","duration":7,"requestSize":28246,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:59:39.907Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":536,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:59:39.940Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202367189_z3yxe5dg0","totalTime":12751,"layerTimings":{"router":47,"transformer":46,"protocol":36,"serverCompatibility":42,"server":12518,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T09:59:39.955Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202367189_z3yxe5dg0","executionId":"req_1756202367189_z3yxe5dg0","totalTime":12751,"success":true}}
{"timestamp":"2025-08-26T09:59:39.969Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:59:39.974Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:39.980Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:39.985Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T09:59:39.990Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:59:39.993Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:59:39.998Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202379998_fiu1nyxb4","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:59:40.010Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:40.016Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202379998_fiu1nyxb4","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T09:59:40.020Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:59:40.026Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:59:40.031Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":3,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":4,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",4]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T09:59:40.036Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202379998_fiu1nyxb4","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:59:40.058Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202379998_fiu1nyxb4","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:59:40.072Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202379998_fiu1nyxb4","hasOutput":true}}
{"timestamp":"2025-08-26T09:59:40.077Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202379998_fiu1nyxb4","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T09:59:40.090Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202379998_fiu1nyxb4","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:40.095Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202379998_fiu1nyxb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:40.101Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202379998_fiu1nyxb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:40.114Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202379998_fiu1nyxb4","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:59:40.120Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202379998_fiu1nyxb4","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:59:40.125Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202379998_fiu1nyxb4","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T09:59:40.138Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202379998_fiu1nyxb4","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:59:40.150Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202379998_fiu1nyxb4","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:59:40.156Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202379998_fiu1nyxb4","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:59:40.162Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202379998_fiu1nyxb4","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:40.167Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202379998_fiu1nyxb4","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:59:40.174Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202379998_fiu1nyxb4","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:59:40.188Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202379998_fiu1nyxb4","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:40.194Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202379998_fiu1nyxb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:40.199Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202379998_fiu1nyxb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:40.217Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202379998_fiu1nyxb4","bodySize":21321,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:59:40.223Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":21321,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:59:40.229Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":21321,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T09:59:40.234Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":21321,"expectedSize":21321}}
{"timestamp":"2025-08-26T09:59:40.239Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":21321,"timeout":600000}}
{"timestamp":"2025-08-26T09:59:40.248Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:59:40.254Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:59:41.673Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202379998_fiu1nyxb4","requestSize":21321,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:59:41.680Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202379998_fiu1nyxb4","duration":7,"requestSize":21321,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:59:41.686Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":499,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:59:41.717Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202379998_fiu1nyxb4","totalTime":1719,"layerTimings":{"router":46,"transformer":41,"protocol":32,"serverCompatibility":45,"server":1497,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T09:59:41.732Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202379998_fiu1nyxb4","executionId":"req_1756202379998_fiu1nyxb4","totalTime":1719,"success":true}}
{"timestamp":"2025-08-26T09:59:41.746Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:59:41.751Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:41.756Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:41.762Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T09:59:41.767Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:59:41.771Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:59:41.777Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202381777_jephiq8qr","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:59:41.791Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:41.796Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202381777_jephiq8qr","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T09:59:41.803Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:59:41.808Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:59:41.814Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":4,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":5,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",5]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T09:59:41.819Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202381777_jephiq8qr","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:59:41.841Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202381777_jephiq8qr","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:59:41.858Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202381777_jephiq8qr","hasOutput":true}}
{"timestamp":"2025-08-26T09:59:41.864Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202381777_jephiq8qr","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T09:59:41.877Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202381777_jephiq8qr","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:41.882Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202381777_jephiq8qr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:41.888Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202381777_jephiq8qr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:41.902Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202381777_jephiq8qr","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T09:59:41.907Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756202381777_jephiq8qr","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T09:59:41.914Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202381777_jephiq8qr","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:59:41.919Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202381777_jephiq8qr","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:59:41.932Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202381777_jephiq8qr","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:59:41.944Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202381777_jephiq8qr","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:59:41.949Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202381777_jephiq8qr","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:59:41.954Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202381777_jephiq8qr","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:41.959Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202381777_jephiq8qr","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T09:59:41.968Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756202381777_jephiq8qr","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T09:59:41.973Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756202381777_jephiq8qr","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:41.978Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756202381777_jephiq8qr","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T09:59:41.984Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756202381777_jephiq8qr","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:41.994Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756202381777_jephiq8qr","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T09:59:42.002Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756202381777_jephiq8qr","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T09:59:42.008Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756202381777_jephiq8qr","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T09:59:42.013Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756202381777_jephiq8qr","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:42.018Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202381777_jephiq8qr","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:59:42.030Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202381777_jephiq8qr","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:42.035Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202381777_jephiq8qr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:42.041Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202381777_jephiq8qr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:42.058Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202381777_jephiq8qr","bodySize":28735,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:59:42.064Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":28735,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:59:42.069Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":28735,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T09:59:42.075Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":28735,"expectedSize":28735}}
{"timestamp":"2025-08-26T09:59:42.080Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":28735,"timeout":600000}}
{"timestamp":"2025-08-26T09:59:42.088Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:59:42.093Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T09:59:46.655Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202381777_jephiq8qr","requestSize":28735,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T09:59:46.662Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202381777_jephiq8qr","duration":7,"requestSize":28735,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T09:59:46.668Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":457,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T09:59:46.698Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202381777_jephiq8qr","totalTime":4921,"layerTimings":{"router":50,"transformer":45,"protocol":39,"serverCompatibility":93,"server":4638,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T09:59:46.713Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202381777_jephiq8qr","executionId":"req_1756202381777_jephiq8qr","totalTime":4921,"success":true}}
{"timestamp":"2025-08-26T09:59:46.727Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T09:59:46.736Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:46.745Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T09:59:46.751Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T09:59:46.756Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T09:59:46.760Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T09:59:46.765Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202386765_3tjvqadaz","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T09:59:46.779Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:46.784Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202386765_3tjvqadaz","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T09:59:46.789Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T09:59:46.794Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T09:59:46.799Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":5,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":6,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",6]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T09:59:46.805Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202386765_3tjvqadaz","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T09:59:46.827Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202386765_3tjvqadaz","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T09:59:46.844Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202386765_3tjvqadaz","hasOutput":true}}
{"timestamp":"2025-08-26T09:59:46.849Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202386765_3tjvqadaz","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T09:59:46.863Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202386765_3tjvqadaz","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:46.868Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202386765_3tjvqadaz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:46.872Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202386765_3tjvqadaz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:46.886Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202386765_3tjvqadaz","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:59:46.891Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202386765_3tjvqadaz","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T09:59:46.895Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202386765_3tjvqadaz","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T09:59:46.908Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202386765_3tjvqadaz","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T09:59:46.920Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202386765_3tjvqadaz","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T09:59:46.925Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202386765_3tjvqadaz","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T09:59:46.930Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202386765_3tjvqadaz","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T09:59:46.935Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202386765_3tjvqadaz","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T09:59:46.941Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202386765_3tjvqadaz","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T09:59:46.953Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202386765_3tjvqadaz","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T09:59:46.959Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202386765_3tjvqadaz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:46.964Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202386765_3tjvqadaz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T09:59:46.981Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202386765_3tjvqadaz","bodySize":21284,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T09:59:46.986Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":21284,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T09:59:46.991Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":21284,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T09:59:46.997Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":21284,"expectedSize":21284}}
{"timestamp":"2025-08-26T09:59:47.002Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":21284,"timeout":600000}}
{"timestamp":"2025-08-26T09:59:47.010Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T09:59:47.015Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:00:08.961Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202386765_3tjvqadaz","requestSize":21284,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:00:08.968Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202386765_3tjvqadaz","duration":7,"requestSize":21284,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:00:08.974Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":535,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:00:09.006Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202386765_3tjvqadaz","totalTime":22241,"layerTimings":{"router":47,"transformer":45,"protocol":31,"serverCompatibility":40,"server":22022,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:00:09.021Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202386765_3tjvqadaz","executionId":"req_1756202386765_3tjvqadaz","totalTime":22241,"success":true}}
{"timestamp":"2025-08-26T10:00:09.034Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:00:09.040Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:00:09.044Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:00:09.049Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:00:09.054Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:00:09.059Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:00:09.064Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202409064_aalnih54o","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:00:09.076Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:00:09.081Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202409064_aalnih54o","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:00:09.086Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:00:09.091Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:00:09.096Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":6,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":7,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",7]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:00:09.102Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202409064_aalnih54o","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:00:09.123Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202409064_aalnih54o","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:00:09.141Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202409064_aalnih54o","hasOutput":true}}
{"timestamp":"2025-08-26T10:00:09.146Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202409064_aalnih54o","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:00:09.159Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202409064_aalnih54o","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:00:09.165Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202409064_aalnih54o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:00:09.170Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202409064_aalnih54o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:00:09.184Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202409064_aalnih54o","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:00:09.190Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202409064_aalnih54o","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:00:09.195Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202409064_aalnih54o","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:00:09.208Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202409064_aalnih54o","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:00:09.220Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202409064_aalnih54o","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:00:09.224Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202409064_aalnih54o","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:00:09.229Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202409064_aalnih54o","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:00:09.235Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202409064_aalnih54o","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:00:09.241Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202409064_aalnih54o","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:00:09.254Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202409064_aalnih54o","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:00:09.258Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202409064_aalnih54o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:00:09.263Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202409064_aalnih54o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:00:09.278Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202409064_aalnih54o","bodySize":18199,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:00:09.284Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":18199,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:00:09.289Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":18199,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:00:09.295Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":18199,"expectedSize":18199}}
{"timestamp":"2025-08-26T10:00:09.300Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":18199,"timeout":600000}}
{"timestamp":"2025-08-26T10:00:09.308Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:00:09.313Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:00:10.413Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202409064_aalnih54o","requestSize":18199,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:00:10.420Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202409064_aalnih54o","duration":7,"requestSize":18199,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:00:10.426Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":496,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:00:10.457Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202409064_aalnih54o","totalTime":1393,"layerTimings":{"router":47,"transformer":44,"protocol":32,"serverCompatibility":41,"server":1173,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:00:10.470Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202409064_aalnih54o","executionId":"req_1756202409064_aalnih54o","totalTime":1393,"success":true}}
{"timestamp":"2025-08-26T10:01:48.997Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:01:49.004Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:01:49.010Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:01:49.017Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:01:49.023Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:01:49.029Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:01:49.035Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202509035_tz0addjgk","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:01:49.048Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:01:49.054Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202509035_tz0addjgk","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:01:49.059Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:01:49.064Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:01:49.070Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":7,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":8,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",8]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:01:49.075Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202509035_tz0addjgk","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:01:49.096Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202509035_tz0addjgk","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:01:49.115Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202509035_tz0addjgk","hasOutput":true}}
{"timestamp":"2025-08-26T10:01:49.120Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202509035_tz0addjgk","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:01:49.134Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202509035_tz0addjgk","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:01:49.140Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202509035_tz0addjgk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:01:49.145Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202509035_tz0addjgk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:01:49.158Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202509035_tz0addjgk","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:01:49.164Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756202509035_tz0addjgk","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:01:49.169Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202509035_tz0addjgk","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:01:49.174Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202509035_tz0addjgk","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:01:49.187Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202509035_tz0addjgk","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:01:49.199Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202509035_tz0addjgk","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:01:49.204Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202509035_tz0addjgk","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:01:49.209Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202509035_tz0addjgk","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:01:49.216Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202509035_tz0addjgk","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:01:49.227Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:01:49.233Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:01:49.239Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:01:49.244Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:01:49.249Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:01:49.254Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:01:49.259Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202509259_ctnnx7vpn","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:01:49.324Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:01:49.330Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202509259_ctnnx7vpn","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:01:49.336Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:01:49.341Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:01:49.347Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":8,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":9,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",9]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:01:49.352Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202509259_ctnnx7vpn","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:01:49.381Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202509259_ctnnx7vpn","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:01:49.408Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202509259_ctnnx7vpn","hasOutput":true}}
{"timestamp":"2025-08-26T10:01:49.413Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202509259_ctnnx7vpn","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:01:49.436Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202509259_ctnnx7vpn","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:01:49.442Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202509259_ctnnx7vpn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:01:49.448Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202509259_ctnnx7vpn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:01:49.472Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202509259_ctnnx7vpn","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:01:49.478Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202509259_ctnnx7vpn","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:01:49.484Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202509259_ctnnx7vpn","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:01:49.507Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202509259_ctnnx7vpn","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:01:49.530Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202509259_ctnnx7vpn","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:01:49.535Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202509259_ctnnx7vpn","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:01:49.541Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202509259_ctnnx7vpn","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:01:49.547Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202509259_ctnnx7vpn","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:01:49.555Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202509259_ctnnx7vpn","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:01:49.577Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202509259_ctnnx7vpn","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:01:49.583Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202509259_ctnnx7vpn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:01:49.590Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202509259_ctnnx7vpn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:01:49.620Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202509259_ctnnx7vpn","bodySize":95962,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:01:49.627Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":95962,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:01:49.633Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":95962,"chunkSize":16384,"estimatedChunks":6}}
{"timestamp":"2025-08-26T10:01:49.639Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":95962,"expectedSize":95962}}
{"timestamp":"2025-08-26T10:01:49.645Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":95962,"timeout":600000}}
{"timestamp":"2025-08-26T10:01:49.655Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756202509035_tz0addjgk","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:01:49.661Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756202509035_tz0addjgk","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:01:49.667Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756202509035_tz0addjgk","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:01:49.673Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756202509035_tz0addjgk","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:01:49.684Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756202509035_tz0addjgk","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:01:49.693Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756202509035_tz0addjgk","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:01:49.698Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756202509035_tz0addjgk","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:01:49.704Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756202509035_tz0addjgk","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:01:49.711Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202509035_tz0addjgk","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:01:49.725Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202509035_tz0addjgk","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:01:49.731Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202509035_tz0addjgk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:01:49.738Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202509035_tz0addjgk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:01:49.755Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":722,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T10:01:49.764Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:01:49.769Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:01:49.778Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:01:49.784Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:01:50.508Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":457,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:01:50.541Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202509035_tz0addjgk","totalTime":1506,"layerTimings":{"router":48,"transformer":46,"protocol":36,"serverCompatibility":533,"server":782,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:01:50.553Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202509035_tz0addjgk","executionId":"req_1756202509035_tz0addjgk","totalTime":1506,"success":true}}
{"timestamp":"2025-08-26T10:02:35.422Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202509259_ctnnx7vpn","requestSize":95962,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:02:35.430Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202509259_ctnnx7vpn","duration":8,"requestSize":95962,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:02:35.436Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":965,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:02:35.477Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202509259_ctnnx7vpn","totalTime":46218,"layerTimings":{"router":100,"transformer":72,"protocol":53,"serverCompatibility":65,"server":45859,"responseTransform":22},"transformationCount":4}}
{"timestamp":"2025-08-26T10:02:35.507Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202509259_ctnnx7vpn","executionId":"req_1756202509259_ctnnx7vpn","totalTime":46218,"success":true}}
{"timestamp":"2025-08-26T10:02:35.526Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:02:35.533Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:35.539Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:35.545Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:02:35.550Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:02:35.555Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:02:35.561Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202555561_rbpt13q1z","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:02:35.628Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:35.633Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202555561_rbpt13q1z","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:02:35.639Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:02:35.645Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:02:35.650Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":9,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":10,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",10]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:02:35.656Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202555561_rbpt13q1z","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:02:35.689Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202555561_rbpt13q1z","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:02:35.716Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202555561_rbpt13q1z","hasOutput":true}}
{"timestamp":"2025-08-26T10:02:35.722Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202555561_rbpt13q1z","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:02:35.745Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202555561_rbpt13q1z","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:35.751Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202555561_rbpt13q1z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:35.757Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202555561_rbpt13q1z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:35.781Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202555561_rbpt13q1z","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:02:35.787Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202555561_rbpt13q1z","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:02:35.793Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202555561_rbpt13q1z","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:02:35.817Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202555561_rbpt13q1z","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:02:35.840Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202555561_rbpt13q1z","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:02:35.846Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202555561_rbpt13q1z","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:02:35.853Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202555561_rbpt13q1z","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:35.860Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202555561_rbpt13q1z","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:02:35.868Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202555561_rbpt13q1z","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:02:35.891Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202555561_rbpt13q1z","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:35.896Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202555561_rbpt13q1z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:35.902Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202555561_rbpt13q1z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:35.933Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202555561_rbpt13q1z","bodySize":95963,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:02:35.940Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":95963,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:02:35.947Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":95963,"chunkSize":16384,"estimatedChunks":6}}
{"timestamp":"2025-08-26T10:02:35.953Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":95963,"expectedSize":95963}}
{"timestamp":"2025-08-26T10:02:35.959Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":95963,"timeout":600000}}
{"timestamp":"2025-08-26T10:02:35.968Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:02:35.975Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:02:38.835Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202555561_rbpt13q1z","requestSize":95963,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:02:38.843Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202555561_rbpt13q1z","duration":8,"requestSize":95963,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:02:38.849Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":836,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:02:38.881Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202555561_rbpt13q1z","totalTime":3320,"layerTimings":{"router":105,"transformer":73,"protocol":53,"serverCompatibility":68,"server":2955,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:02:38.907Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202555561_rbpt13q1z","executionId":"req_1756202555561_rbpt13q1z","totalTime":3320,"success":true}}
{"timestamp":"2025-08-26T10:02:38.927Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:02:38.932Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:38.938Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:38.944Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:02:38.950Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:02:38.954Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:02:38.960Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202558960_cgqxddc7y","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:02:38.976Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:38.981Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202558960_cgqxddc7y","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T10:02:38.986Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,gemini-2.5-pro;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,gemini-2.5-pro","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:02:38.992Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-gemini-2.5-pro-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:02:38.996Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":10,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":11,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",11]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:02:39.002Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202558960_cgqxddc7y","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:02:39.022Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202558960_cgqxddc7y","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:02:39.041Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202558960_cgqxddc7y","hasOutput":true}}
{"timestamp":"2025-08-26T10:02:39.047Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202558960_cgqxddc7y","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:02:39.060Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202558960_cgqxddc7y","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:39.065Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202558960_cgqxddc7y","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:39.070Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202558960_cgqxddc7y","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:39.083Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202558960_cgqxddc7y","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:02:39.089Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756202558960_cgqxddc7y","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:02:39.094Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202558960_cgqxddc7y","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:02:39.099Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202558960_cgqxddc7y","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:02:39.113Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202558960_cgqxddc7y","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:02:39.126Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202558960_cgqxddc7y","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:02:39.131Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202558960_cgqxddc7y","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:02:39.136Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202558960_cgqxddc7y","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:39.142Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202558960_cgqxddc7y","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:02:39.150Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756202558960_cgqxddc7y","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:02:39.155Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756202558960_cgqxddc7y","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:39.160Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756202558960_cgqxddc7y","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:02:39.165Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756202558960_cgqxddc7y","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:39.174Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756202558960_cgqxddc7y","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:02:39.182Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756202558960_cgqxddc7y","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:02:39.187Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756202558960_cgqxddc7y","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:02:39.193Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756202558960_cgqxddc7y","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:39.198Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202558960_cgqxddc7y","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:02:39.211Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202558960_cgqxddc7y","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:39.216Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202558960_cgqxddc7y","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:39.222Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202558960_cgqxddc7y","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:39.237Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":698,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T10:02:39.246Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:02:39.251Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:02:39.983Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":540,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:02:40.022Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202558960_cgqxddc7y","totalTime":1062,"layerTimings":{"router":48,"transformer":46,"protocol":37,"serverCompatibility":93,"server":775,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T10:02:40.036Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202558960_cgqxddc7y","executionId":"req_1756202558960_cgqxddc7y","totalTime":1062,"success":true}}
{"timestamp":"2025-08-26T10:02:40.049Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:02:40.054Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:40.060Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:40.065Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:02:40.070Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:02:40.076Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:02:40.082Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202560082_dgz3hbb1b","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:02:40.098Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:40.103Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202560082_dgz3hbb1b","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T10:02:40.108Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,gemini-2.5-pro;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,gemini-2.5-pro","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:02:40.113Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-gemini-2.5-pro-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:02:40.119Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":11,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":12,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",12]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:02:40.125Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202560082_dgz3hbb1b","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:02:40.148Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202560082_dgz3hbb1b","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:02:40.173Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202560082_dgz3hbb1b","hasOutput":true}}
{"timestamp":"2025-08-26T10:02:40.178Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202560082_dgz3hbb1b","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:02:40.193Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202560082_dgz3hbb1b","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:40.198Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202560082_dgz3hbb1b","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:40.203Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202560082_dgz3hbb1b","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:40.217Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202560082_dgz3hbb1b","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:02:40.222Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202560082_dgz3hbb1b","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:02:40.228Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202560082_dgz3hbb1b","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:02:40.244Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202560082_dgz3hbb1b","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:02:40.259Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202560082_dgz3hbb1b","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:02:40.265Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202560082_dgz3hbb1b","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:02:40.271Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202560082_dgz3hbb1b","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:40.278Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202560082_dgz3hbb1b","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:02:40.287Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202560082_dgz3hbb1b","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:02:40.302Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202560082_dgz3hbb1b","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:40.308Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202560082_dgz3hbb1b","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:40.315Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202560082_dgz3hbb1b","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:40.332Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":696,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T10:02:40.343Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:02:40.349Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:02:48.486Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":735,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:02:48.528Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202560082_dgz3hbb1b","totalTime":8446,"layerTimings":{"router":52,"transformer":54,"protocol":35,"serverCompatibility":52,"server":8187,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T10:02:48.541Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202560082_dgz3hbb1b","executionId":"req_1756202560082_dgz3hbb1b","totalTime":8446,"success":true}}
{"timestamp":"2025-08-26T10:02:48.686Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:02:48.693Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:48.700Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:48.706Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:02:48.712Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:02:48.719Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:02:48.726Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202568726_a622mv80i","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:02:48.788Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:48.793Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202568726_a622mv80i","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:02:48.798Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:02:48.803Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:02:48.808Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":12,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":13,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",13]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:02:48.813Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202568726_a622mv80i","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:02:48.844Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202568726_a622mv80i","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:02:48.920Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202568726_a622mv80i","hasOutput":true}}
{"timestamp":"2025-08-26T10:02:48.926Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202568726_a622mv80i","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:02:48.949Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202568726_a622mv80i","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:48.955Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202568726_a622mv80i","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:48.961Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202568726_a622mv80i","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:48.987Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202568726_a622mv80i","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:02:48.994Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202568726_a622mv80i","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:02:49.000Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202568726_a622mv80i","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:02:49.023Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202568726_a622mv80i","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:02:49.047Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202568726_a622mv80i","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:02:49.053Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202568726_a622mv80i","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:02:49.058Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202568726_a622mv80i","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:49.063Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202568726_a622mv80i","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:02:49.070Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202568726_a622mv80i","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:02:49.092Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202568726_a622mv80i","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:49.098Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202568726_a622mv80i","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:49.103Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202568726_a622mv80i","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:49.133Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202568726_a622mv80i","bodySize":96643,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:02:49.139Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":96643,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:02:49.145Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":96643,"chunkSize":16384,"estimatedChunks":6}}
{"timestamp":"2025-08-26T10:02:49.151Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":96643,"expectedSize":96643}}
{"timestamp":"2025-08-26T10:02:49.157Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":96643,"timeout":600000}}
{"timestamp":"2025-08-26T10:02:49.165Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:02:49.170Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:02:51.226Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202568726_a622mv80i","requestSize":96643,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:02:51.233Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202568726_a622mv80i","duration":7,"requestSize":96643,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:02:51.239Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":640,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:02:51.276Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202568726_a622mv80i","totalTime":2550,"layerTimings":{"router":96,"transformer":122,"protocol":56,"serverCompatibility":63,"server":2148,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:02:51.303Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202568726_a622mv80i","executionId":"req_1756202568726_a622mv80i","totalTime":2550,"success":true}}
{"timestamp":"2025-08-26T10:02:51.321Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:02:51.327Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:51.333Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:51.339Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:02:51.345Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:02:51.350Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:02:51.356Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202571356_wh83050yt","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:02:51.419Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:51.425Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202571356_wh83050yt","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:02:51.431Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:02:51.436Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:02:51.442Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":13,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":14,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",14]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:02:51.447Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202571356_wh83050yt","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:02:51.478Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202571356_wh83050yt","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:02:51.515Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202571356_wh83050yt","hasOutput":true}}
{"timestamp":"2025-08-26T10:02:51.520Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202571356_wh83050yt","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:02:51.542Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202571356_wh83050yt","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:51.548Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202571356_wh83050yt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:51.553Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202571356_wh83050yt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:51.575Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202571356_wh83050yt","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:02:51.582Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756202571356_wh83050yt","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:02:51.587Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202571356_wh83050yt","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:02:51.593Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202571356_wh83050yt","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:02:51.617Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202571356_wh83050yt","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:02:51.639Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202571356_wh83050yt","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:02:51.645Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202571356_wh83050yt","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:02:51.650Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202571356_wh83050yt","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:51.658Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202571356_wh83050yt","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:02:51.666Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756202571356_wh83050yt","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:02:51.671Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756202571356_wh83050yt","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:51.677Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756202571356_wh83050yt","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:02:51.682Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756202571356_wh83050yt","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:51.692Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756202571356_wh83050yt","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:02:51.701Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756202571356_wh83050yt","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:02:51.707Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756202571356_wh83050yt","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:02:51.712Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756202571356_wh83050yt","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:51.717Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202571356_wh83050yt","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:02:51.740Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202571356_wh83050yt","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:51.746Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202571356_wh83050yt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:51.752Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202571356_wh83050yt","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:51.781Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202571356_wh83050yt","bodySize":96644,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:02:51.787Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":96644,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:02:51.793Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":96644,"chunkSize":16384,"estimatedChunks":6}}
{"timestamp":"2025-08-26T10:02:51.798Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":96644,"expectedSize":96644}}
{"timestamp":"2025-08-26T10:02:51.804Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":96644,"timeout":600000}}
{"timestamp":"2025-08-26T10:02:51.811Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:02:51.817Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:02:55.539Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202571356_wh83050yt","requestSize":96644,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:02:55.546Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202571356_wh83050yt","duration":7,"requestSize":96644,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:02:55.551Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":663,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:02:55.585Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202571356_wh83050yt","totalTime":4229,"layerTimings":{"router":98,"transformer":82,"protocol":59,"serverCompatibility":118,"server":3810,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:02:55.613Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202571356_wh83050yt","executionId":"req_1756202571356_wh83050yt","totalTime":4229,"success":true}}
{"timestamp":"2025-08-26T10:02:55.994Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:02:56.001Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:56.007Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:02:56.012Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:02:56.018Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:02:56.024Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:02:56.030Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202576030_fucyhce4g","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:02:56.092Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:56.098Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202576030_fucyhce4g","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:02:56.103Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:02:56.109Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:02:56.114Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":14,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":15,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",15]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:02:56.120Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202576030_fucyhce4g","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:02:56.150Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202576030_fucyhce4g","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:02:56.193Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202576030_fucyhce4g","hasOutput":true}}
{"timestamp":"2025-08-26T10:02:56.199Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202576030_fucyhce4g","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:02:56.222Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202576030_fucyhce4g","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:56.227Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202576030_fucyhce4g","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:56.232Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202576030_fucyhce4g","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:56.255Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202576030_fucyhce4g","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:02:56.261Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202576030_fucyhce4g","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:02:56.266Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202576030_fucyhce4g","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:02:56.287Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202576030_fucyhce4g","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:02:56.309Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202576030_fucyhce4g","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:02:56.314Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202576030_fucyhce4g","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:02:56.320Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202576030_fucyhce4g","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:02:56.325Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202576030_fucyhce4g","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:02:56.334Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202576030_fucyhce4g","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:02:56.356Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202576030_fucyhce4g","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:02:56.361Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202576030_fucyhce4g","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:56.367Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202576030_fucyhce4g","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:02:56.394Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202576030_fucyhce4g","bodySize":97641,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:02:56.401Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":97641,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:02:56.407Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":97641,"chunkSize":16384,"estimatedChunks":6}}
{"timestamp":"2025-08-26T10:02:56.412Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":97641,"expectedSize":97641}}
{"timestamp":"2025-08-26T10:02:56.418Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":97641,"timeout":600000}}
{"timestamp":"2025-08-26T10:02:56.426Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:02:56.432Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:03:55.997Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:03:56.004Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:03:56.010Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:03:56.016Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:03:56.022Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:03:56.028Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:03:56.034Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202636034_ewy77lmvu","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:03:56.108Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:03:56.115Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202636034_ewy77lmvu","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:03:56.120Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:03:56.126Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:03:56.132Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":15,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":16,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",16]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:03:56.138Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202636034_ewy77lmvu","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:03:56.167Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202636034_ewy77lmvu","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:03:56.213Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202636034_ewy77lmvu","hasOutput":true}}
{"timestamp":"2025-08-26T10:03:56.218Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202636034_ewy77lmvu","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:03:56.240Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202636034_ewy77lmvu","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:03:56.245Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202636034_ewy77lmvu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:03:56.250Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202636034_ewy77lmvu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:03:56.271Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202636034_ewy77lmvu","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:03:56.276Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202636034_ewy77lmvu","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:03:56.281Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202636034_ewy77lmvu","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:03:56.302Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202636034_ewy77lmvu","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:03:56.324Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202636034_ewy77lmvu","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:03:56.330Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202636034_ewy77lmvu","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:03:56.335Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202636034_ewy77lmvu","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:03:56.341Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202636034_ewy77lmvu","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:03:56.351Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202636034_ewy77lmvu","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:03:56.375Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202636034_ewy77lmvu","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:03:56.381Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202636034_ewy77lmvu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:03:56.387Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202636034_ewy77lmvu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:03:56.417Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202636034_ewy77lmvu","bodySize":97642,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:03:56.423Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":97642,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:03:56.428Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":97642,"chunkSize":16384,"estimatedChunks":6}}
{"timestamp":"2025-08-26T10:03:56.433Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":97642,"expectedSize":97642}}
{"timestamp":"2025-08-26T10:03:56.438Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":97642,"timeout":600000}}
{"timestamp":"2025-08-26T10:03:56.447Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:03:56.452Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:03:58.719Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202636034_ewy77lmvu","requestSize":97642,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:03:58.726Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202636034_ewy77lmvu","duration":7,"requestSize":97642,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:03:58.731Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":651,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:03:58.767Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202636034_ewy77lmvu","totalTime":2733,"layerTimings":{"router":111,"transformer":89,"protocol":47,"serverCompatibility":68,"server":2355,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:03:58.794Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202636034_ewy77lmvu","executionId":"req_1756202636034_ewy77lmvu","totalTime":2733,"success":true}}
{"timestamp":"2025-08-26T10:03:58.985Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:03:58.991Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:03:58.997Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:03:59.002Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:03:59.008Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:03:59.014Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:03:59.021Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202639021_unpsj966w","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:03:59.096Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:03:59.102Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202639021_unpsj966w","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:03:59.108Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:03:59.115Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:03:59.122Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":16,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":17,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",17]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:03:59.128Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202639021_unpsj966w","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:03:59.161Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202639021_unpsj966w","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:03:59.214Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202639021_unpsj966w","hasOutput":true}}
{"timestamp":"2025-08-26T10:03:59.219Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202639021_unpsj966w","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:03:59.240Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202639021_unpsj966w","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:03:59.246Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202639021_unpsj966w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:03:59.251Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202639021_unpsj966w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:03:59.274Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202639021_unpsj966w","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:03:59.279Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756202639021_unpsj966w","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:03:59.284Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202639021_unpsj966w","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:03:59.289Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202639021_unpsj966w","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:03:59.312Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202639021_unpsj966w","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:03:59.335Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202639021_unpsj966w","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:03:59.340Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202639021_unpsj966w","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:03:59.345Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202639021_unpsj966w","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:03:59.353Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202639021_unpsj966w","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:03:59.361Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756202639021_unpsj966w","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:03:59.366Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756202639021_unpsj966w","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:03:59.372Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756202639021_unpsj966w","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:03:59.377Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756202639021_unpsj966w","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:03:59.387Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756202639021_unpsj966w","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:03:59.395Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756202639021_unpsj966w","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:03:59.400Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756202639021_unpsj966w","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:03:59.406Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756202639021_unpsj966w","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:03:59.411Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202639021_unpsj966w","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:03:59.433Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202639021_unpsj966w","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:03:59.438Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202639021_unpsj966w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:03:59.444Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202639021_unpsj966w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:03:59.474Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202639021_unpsj966w","bodySize":129511,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:03:59.480Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":129511,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:03:59.485Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":129511,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T10:03:59.491Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":129511,"expectedSize":129511}}
{"timestamp":"2025-08-26T10:03:59.496Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":129511,"timeout":600000}}
{"timestamp":"2025-08-26T10:03:59.504Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:03:59.509Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:04:05.252Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202576030_fucyhce4g","requestSize":97641,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:04:05.260Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202576030_fucyhce4g","duration":8,"requestSize":97641,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:04:05.265Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":753,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:04:05.299Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202576030_fucyhce4g","totalTime":69269,"layerTimings":{"router":98,"transformer":89,"protocol":50,"serverCompatibility":63,"server":68910,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:04:05.326Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202576030_fucyhce4g","executionId":"req_1756202576030_fucyhce4g","totalTime":69269,"success":true}}
{"timestamp":"2025-08-26T10:04:07.752Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202639021_unpsj966w","requestSize":129511,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:04:07.760Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202639021_unpsj966w","duration":8,"requestSize":129511,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:04:07.766Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":719,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:04:07.799Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202639021_unpsj966w","totalTime":8778,"layerTimings":{"router":117,"transformer":97,"protocol":56,"serverCompatibility":116,"server":8333,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:04:07.831Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202639021_unpsj966w","executionId":"req_1756202639021_unpsj966w","totalTime":8778,"success":true}}
{"timestamp":"2025-08-26T10:04:07.849Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:04:07.855Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:04:07.860Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:04:07.866Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:04:07.872Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:04:07.879Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:04:07.884Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202647884_jjokvyzcp","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:04:07.950Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:04:07.956Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202647884_jjokvyzcp","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:04:07.961Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:04:07.967Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:04:07.972Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":17,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":18,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",18]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:04:07.977Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202647884_jjokvyzcp","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:04:08.006Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202647884_jjokvyzcp","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:04:08.061Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202647884_jjokvyzcp","hasOutput":true}}
{"timestamp":"2025-08-26T10:04:08.067Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202647884_jjokvyzcp","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:04:08.090Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202647884_jjokvyzcp","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:04:08.095Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202647884_jjokvyzcp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:04:08.100Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202647884_jjokvyzcp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:04:08.124Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202647884_jjokvyzcp","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:04:08.130Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202647884_jjokvyzcp","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:04:08.135Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202647884_jjokvyzcp","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:04:08.159Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202647884_jjokvyzcp","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:04:08.181Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202647884_jjokvyzcp","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:04:08.187Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202647884_jjokvyzcp","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:04:08.192Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202647884_jjokvyzcp","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:04:08.198Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202647884_jjokvyzcp","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:04:08.207Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202647884_jjokvyzcp","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:04:08.230Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202647884_jjokvyzcp","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:04:08.235Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202647884_jjokvyzcp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:04:08.240Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202647884_jjokvyzcp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:04:08.269Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202647884_jjokvyzcp","bodySize":129509,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:04:08.275Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":129509,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:04:08.281Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":129509,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T10:04:08.286Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":129509,"expectedSize":129509}}
{"timestamp":"2025-08-26T10:04:08.291Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":129509,"timeout":600000}}
{"timestamp":"2025-08-26T10:04:08.300Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:04:08.305Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:04:58.777Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202647884_jjokvyzcp","requestSize":129509,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:04:58.820Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202647884_jjokvyzcp","duration":43,"requestSize":129509,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:04:58.826Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":3005,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:04:58.862Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202647884_jjokvyzcp","totalTime":50978,"layerTimings":{"router":99,"transformer":101,"protocol":53,"serverCompatibility":66,"server":50598,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:04:58.893Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202647884_jjokvyzcp","executionId":"req_1756202647884_jjokvyzcp","totalTime":50978,"success":true}}
{"timestamp":"2025-08-26T10:06:31.342Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:06:31.349Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:06:31.355Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:06:31.361Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:06:31.367Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:06:31.374Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:06:31.380Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202791380_bwdylg3au","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:06:31.443Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:06:31.449Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202791380_bwdylg3au","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:06:31.456Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:06:31.461Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:06:31.467Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":18,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":19,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",19]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:06:31.473Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202791380_bwdylg3au","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:06:31.507Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202791380_bwdylg3au","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:06:31.574Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202791380_bwdylg3au","hasOutput":true}}
{"timestamp":"2025-08-26T10:06:31.580Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202791380_bwdylg3au","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:06:31.604Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202791380_bwdylg3au","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:06:31.610Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202791380_bwdylg3au","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:31.615Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202791380_bwdylg3au","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:31.638Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202791380_bwdylg3au","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:06:31.644Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202791380_bwdylg3au","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:06:31.649Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202791380_bwdylg3au","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:06:31.671Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202791380_bwdylg3au","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:06:31.695Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202791380_bwdylg3au","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:06:31.701Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202791380_bwdylg3au","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:06:31.706Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202791380_bwdylg3au","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:06:31.713Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202791380_bwdylg3au","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:06:31.722Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202791380_bwdylg3au","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:06:31.746Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202791380_bwdylg3au","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:06:31.752Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202791380_bwdylg3au","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:31.758Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202791380_bwdylg3au","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:31.789Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202791380_bwdylg3au","bodySize":134302,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:06:31.796Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":134302,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:06:31.801Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":134302,"chunkSize":16384,"estimatedChunks":9}}
{"timestamp":"2025-08-26T10:06:31.807Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":134302,"expectedSize":134302}}
{"timestamp":"2025-08-26T10:06:31.813Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":134302,"timeout":600000}}
{"timestamp":"2025-08-26T10:06:31.821Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:06:31.826Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:06:39.088Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202791380_bwdylg3au","requestSize":134302,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:06:39.095Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202791380_bwdylg3au","duration":7,"requestSize":134302,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:06:39.101Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1206,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:06:39.135Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202791380_bwdylg3au","totalTime":7755,"layerTimings":{"router":101,"transformer":117,"protocol":51,"serverCompatibility":70,"server":7355,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:06:39.167Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202791380_bwdylg3au","executionId":"req_1756202791380_bwdylg3au","totalTime":7755,"success":true}}
{"timestamp":"2025-08-26T10:06:39.186Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:06:39.192Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:06:39.197Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:06:39.203Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:06:39.209Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:06:39.215Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:06:39.221Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202799221_nu3pdrwwk","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:06:39.287Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:06:39.293Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202799221_nu3pdrwwk","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:06:39.299Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:06:39.305Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:06:39.311Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":19,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":20,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",20]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:06:39.316Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202799221_nu3pdrwwk","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:06:39.347Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202799221_nu3pdrwwk","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:06:39.416Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202799221_nu3pdrwwk","hasOutput":true}}
{"timestamp":"2025-08-26T10:06:39.421Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202799221_nu3pdrwwk","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:06:39.445Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202799221_nu3pdrwwk","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:06:39.451Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202799221_nu3pdrwwk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:39.457Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202799221_nu3pdrwwk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:39.480Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202799221_nu3pdrwwk","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:06:39.485Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756202799221_nu3pdrwwk","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:06:39.490Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202799221_nu3pdrwwk","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:06:39.495Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202799221_nu3pdrwwk","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:06:39.519Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202799221_nu3pdrwwk","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:06:39.544Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202799221_nu3pdrwwk","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:06:39.550Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202799221_nu3pdrwwk","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:06:39.556Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202799221_nu3pdrwwk","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:06:39.564Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202799221_nu3pdrwwk","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:06:39.573Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756202799221_nu3pdrwwk","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:06:39.579Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756202799221_nu3pdrwwk","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:06:39.584Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756202799221_nu3pdrwwk","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:06:39.589Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756202799221_nu3pdrwwk","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:06:39.600Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756202799221_nu3pdrwwk","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:06:39.608Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756202799221_nu3pdrwwk","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:06:39.614Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756202799221_nu3pdrwwk","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:06:39.619Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756202799221_nu3pdrwwk","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:06:39.624Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202799221_nu3pdrwwk","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:06:39.647Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202799221_nu3pdrwwk","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:06:39.653Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202799221_nu3pdrwwk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:39.659Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202799221_nu3pdrwwk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:39.689Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202799221_nu3pdrwwk","bodySize":134303,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:06:39.695Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":134303,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:06:39.701Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":134303,"chunkSize":16384,"estimatedChunks":9}}
{"timestamp":"2025-08-26T10:06:39.706Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":134303,"expectedSize":134303}}
{"timestamp":"2025-08-26T10:06:39.712Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":134303,"timeout":600000}}
{"timestamp":"2025-08-26T10:06:39.719Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:06:39.725Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:06:47.753Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202799221_nu3pdrwwk","requestSize":134303,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:06:47.762Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202799221_nu3pdrwwk","duration":9,"requestSize":134303,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:06:47.768Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":1042,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:06:47.803Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202799221_nu3pdrwwk","totalTime":8582,"layerTimings":{"router":102,"transformer":116,"protocol":57,"serverCompatibility":121,"server":8121,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:06:47.835Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202799221_nu3pdrwwk","executionId":"req_1756202799221_nu3pdrwwk","totalTime":8582,"success":true}}
{"timestamp":"2025-08-26T10:06:48.038Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:06:48.045Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:06:48.051Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:06:48.057Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:06:48.062Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:06:48.069Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:06:48.076Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202808076_wxprn93fu","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:06:48.140Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:06:48.147Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202808076_wxprn93fu","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:06:48.152Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:06:48.158Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:06:48.164Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":20,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":21,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",21]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:06:48.170Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202808076_wxprn93fu","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:06:48.204Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202808076_wxprn93fu","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:06:48.288Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202808076_wxprn93fu","hasOutput":true}}
{"timestamp":"2025-08-26T10:06:48.296Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202808076_wxprn93fu","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:06:48.321Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202808076_wxprn93fu","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:06:48.327Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202808076_wxprn93fu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:48.333Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202808076_wxprn93fu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:48.356Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202808076_wxprn93fu","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:06:48.362Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202808076_wxprn93fu","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:06:48.367Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202808076_wxprn93fu","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:06:48.391Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202808076_wxprn93fu","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:06:48.416Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202808076_wxprn93fu","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:06:48.422Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202808076_wxprn93fu","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:06:48.427Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202808076_wxprn93fu","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:06:48.434Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202808076_wxprn93fu","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:06:48.444Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202808076_wxprn93fu","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:06:48.470Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202808076_wxprn93fu","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:06:48.477Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202808076_wxprn93fu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:48.483Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202808076_wxprn93fu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:06:48.514Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202808076_wxprn93fu","bodySize":136193,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:06:48.520Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":136193,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:06:48.526Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":136193,"chunkSize":16384,"estimatedChunks":9}}
{"timestamp":"2025-08-26T10:06:48.532Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":136193,"expectedSize":136193}}
{"timestamp":"2025-08-26T10:06:48.537Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":136193,"timeout":600000}}
{"timestamp":"2025-08-26T10:06:48.545Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:06:48.551Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:07:48.041Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:07:48.049Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:07:48.054Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:07:48.059Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:07:48.065Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:07:48.072Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:07:48.078Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202868078_vv4xg99m7","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:07:48.150Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:07:48.157Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202868078_vv4xg99m7","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:07:48.165Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:07:48.174Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:07:48.180Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":21,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":22,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",22]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:07:48.187Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202868078_vv4xg99m7","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:07:48.222Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202868078_vv4xg99m7","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:07:48.304Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202868078_vv4xg99m7","hasOutput":true}}
{"timestamp":"2025-08-26T10:07:48.310Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202868078_vv4xg99m7","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:07:48.336Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202868078_vv4xg99m7","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:07:48.343Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202868078_vv4xg99m7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:07:48.350Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202868078_vv4xg99m7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:07:48.376Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202868078_vv4xg99m7","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:07:48.383Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202868078_vv4xg99m7","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:07:48.389Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202868078_vv4xg99m7","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:07:48.414Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202868078_vv4xg99m7","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:07:48.443Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202868078_vv4xg99m7","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:07:48.452Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202868078_vv4xg99m7","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:07:48.458Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202868078_vv4xg99m7","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:07:48.466Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202868078_vv4xg99m7","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:07:48.477Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202868078_vv4xg99m7","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:07:48.503Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202868078_vv4xg99m7","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:07:48.511Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202868078_vv4xg99m7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:07:48.517Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202868078_vv4xg99m7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:07:48.551Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202868078_vv4xg99m7","bodySize":136194,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:07:48.558Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":136194,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:07:48.565Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":136194,"chunkSize":16384,"estimatedChunks":9}}
{"timestamp":"2025-08-26T10:07:48.571Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":136194,"expectedSize":136194}}
{"timestamp":"2025-08-26T10:07:48.577Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":136194,"timeout":600000}}
{"timestamp":"2025-08-26T10:07:48.587Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:07:48.592Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:07:51.940Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202868078_vv4xg99m7","requestSize":136194,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:07:51.948Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202868078_vv4xg99m7","duration":8,"requestSize":136194,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:07:51.953Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":728,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:07:51.987Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202868078_vv4xg99m7","totalTime":3909,"layerTimings":{"router":119,"transformer":134,"protocol":58,"serverCompatibility":81,"server":3445,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:07:52.019Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202868078_vv4xg99m7","executionId":"req_1756202868078_vv4xg99m7","totalTime":3909,"success":true}}
{"timestamp":"2025-08-26T10:07:52.040Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:07:52.046Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:07:52.052Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:07:52.058Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:07:52.063Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:07:52.070Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:07:52.076Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202872076_sbp5rkpfr","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:07:52.089Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:07:52.094Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202872076_sbp5rkpfr","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:07:52.099Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:07:52.105Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:07:52.110Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":22,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":23,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",23]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:07:52.116Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202872076_sbp5rkpfr","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:07:52.138Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202872076_sbp5rkpfr","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:07:52.166Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202872076_sbp5rkpfr","hasOutput":true}}
{"timestamp":"2025-08-26T10:07:52.172Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202872076_sbp5rkpfr","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:07:52.185Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202872076_sbp5rkpfr","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:07:52.191Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202872076_sbp5rkpfr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:07:52.197Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202872076_sbp5rkpfr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:07:52.211Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202872076_sbp5rkpfr","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:07:52.216Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756202872076_sbp5rkpfr","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:07:52.222Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202872076_sbp5rkpfr","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:07:52.229Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202872076_sbp5rkpfr","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:07:52.243Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202872076_sbp5rkpfr","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:07:52.257Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202872076_sbp5rkpfr","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:07:52.262Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202872076_sbp5rkpfr","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:07:52.267Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202872076_sbp5rkpfr","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:07:52.275Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202872076_sbp5rkpfr","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:07:52.283Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756202872076_sbp5rkpfr","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:07:52.288Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756202872076_sbp5rkpfr","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:07:52.293Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756202872076_sbp5rkpfr","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:07:52.298Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756202872076_sbp5rkpfr","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:07:52.308Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756202872076_sbp5rkpfr","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:07:52.316Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756202872076_sbp5rkpfr","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:07:52.321Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756202872076_sbp5rkpfr","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:07:52.327Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756202872076_sbp5rkpfr","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:07:52.332Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202872076_sbp5rkpfr","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:07:52.345Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202872076_sbp5rkpfr","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:07:52.350Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202872076_sbp5rkpfr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:07:52.355Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202872076_sbp5rkpfr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:07:52.370Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":2996,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T10:07:52.378Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:07:52.384Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:07:53.669Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":403,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:07:53.704Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202872076_sbp5rkpfr","totalTime":1628,"layerTimings":{"router":49,"transformer":55,"protocol":40,"serverCompatibility":96,"server":1328,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:07:53.718Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202872076_sbp5rkpfr","executionId":"req_1756202872076_sbp5rkpfr","totalTime":1628,"success":true}}
{"timestamp":"2025-08-26T10:08:17.851Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202808076_wxprn93fu","requestSize":136193,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:08:17.860Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202808076_wxprn93fu","duration":9,"requestSize":136193,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:08:17.867Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:08:17.874Z","level":"ERROR","message":"Server error detected, throwing for retry","data":{"requestId":"req_1756202808076_wxprn93fu","status":504,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions","responsePreview":"{\"error\":{\"message\":\"bad response status code 504 (request id: 20250826180648577075513Z8vwytZw)\",\"type\":\"openai_error\",\"param\":\"\",\"code\":\"bad_response_status_code\"}}"}}
{"timestamp":"2025-08-26T10:08:17.880Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756202808076_wxprn93fu","pipelineId":"shuaihong-gemini-2.5-pro-key0","errorMessage":"Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T10:08:17.887Z","level":"INFO","message":"🔄 Server层错误，启动智能错误恢复","data":{"requestId":"req_1756202808076_wxprn93fu","pipelineId":"shuaihong-gemini-2.5-pro-key0","error":"Server error: 504 Internal Server Error","availablePipelines":3,"transparentErrorHandling":true}}
{"timestamp":"2025-08-26T10:08:17.897Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756202808076_wxprn93fu","error":"Provider shuaihong failed for model gemini: Server error: 504 Internal Server Error","stack":"ProviderFailureError: Provider shuaihong failed for model gemini: Server error: 504 Internal Server Error\n    at ZeroFallbackErrorFactory.createProviderFailure (/opt/homebrew/lib/node_modules/route-claude-code/dist/interfaces/core/zero-fallback-errors.js:136:16)\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:363:91)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":102,"transformer":137,"protocol":53,"serverCompatibility":73},"errors":[{"layer":"pipeline","error":"Provider shuaihong failed for model gemini: Server error: 504 Internal Server Error","timestamp":{}}]}}
{"timestamp":"2025-08-26T10:08:17.904Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756202808076_wxprn93fu","error":"Provider shuaihong failed for model gemini: Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T10:08:17.938Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Provider shuaihong failed for model gemini: Server error: 504 Internal Server Error","stack":"Error: Pipeline request processing failed: Provider shuaihong failed for model gemini: Server error: 504 Internal Server Error\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:446:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T10:08:19.427Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:08:19.435Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:08:19.441Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:08:19.447Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:08:19.453Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:08:19.462Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:08:19.469Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202899469_7q5aeql5c","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:08:19.483Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:19.489Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202899469_7q5aeql5c","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:08:19.495Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:08:19.502Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:08:19.508Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":23,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":24,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",24]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:08:19.514Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202899469_7q5aeql5c","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:08:19.538Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202899469_7q5aeql5c","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:08:19.569Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202899469_7q5aeql5c","hasOutput":true}}
{"timestamp":"2025-08-26T10:08:19.575Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202899469_7q5aeql5c","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:08:19.589Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202899469_7q5aeql5c","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:08:19.594Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202899469_7q5aeql5c","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:08:19.600Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202899469_7q5aeql5c","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:08:19.612Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202899469_7q5aeql5c","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:08:19.618Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202899469_7q5aeql5c","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:08:19.624Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202899469_7q5aeql5c","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:08:19.638Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202899469_7q5aeql5c","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:08:19.651Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202899469_7q5aeql5c","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:08:19.656Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202899469_7q5aeql5c","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:08:19.662Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202899469_7q5aeql5c","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:19.668Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202899469_7q5aeql5c","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:08:19.677Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202899469_7q5aeql5c","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:08:19.690Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202899469_7q5aeql5c","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:08:19.695Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202899469_7q5aeql5c","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:08:19.701Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202899469_7q5aeql5c","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:08:19.718Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":1474,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T10:08:19.732Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:08:19.737Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:08:19.743Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:08:19.749Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:08:19.754Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:08:19.762Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:08:19.769Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202899769_glllj34os","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:08:19.837Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:19.843Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202899769_glllj34os","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:08:19.848Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:08:19.854Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:08:19.859Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":24,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":25,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",25]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:08:19.865Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202899769_glllj34os","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:08:19.896Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202899769_glllj34os","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:08:19.992Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202899769_glllj34os","hasOutput":true}}
{"timestamp":"2025-08-26T10:08:19.999Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202899769_glllj34os","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:08:20.023Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202899769_glllj34os","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:08:20.029Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202899769_glllj34os","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:20.034Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202899769_glllj34os","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:20.058Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202899769_glllj34os","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:08:20.064Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202899769_glllj34os","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:08:20.071Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202899769_glllj34os","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:08:20.095Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202899769_glllj34os","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:08:20.121Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202899769_glllj34os","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:08:20.127Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202899769_glllj34os","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:08:20.133Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202899769_glllj34os","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:20.140Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202899769_glllj34os","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:08:20.151Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202899769_glllj34os","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:08:20.175Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202899769_glllj34os","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:08:20.181Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202899769_glllj34os","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:20.187Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202899769_glllj34os","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:20.220Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202899769_glllj34os","bodySize":136680,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:08:20.227Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":136680,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:08:20.233Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":136680,"chunkSize":16384,"estimatedChunks":9}}
{"timestamp":"2025-08-26T10:08:20.239Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":136680,"expectedSize":136680}}
{"timestamp":"2025-08-26T10:08:20.245Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":136680,"timeout":600000}}
{"timestamp":"2025-08-26T10:08:20.254Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:08:20.260Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:08:20.269Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:08:20.275Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:08:25.523Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202899769_glllj34os","requestSize":136680,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:08:25.533Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202899769_glllj34os","duration":10,"requestSize":136680,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:08:25.544Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1035,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:08:25.582Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202899769_glllj34os","totalTime":5813,"layerTimings":{"router":102,"transformer":145,"protocol":55,"serverCompatibility":73,"server":5370,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:08:25.617Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202899769_glllj34os","executionId":"req_1756202899769_glllj34os","totalTime":5813,"success":true}}
{"timestamp":"2025-08-26T10:08:25.638Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:08:25.645Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:08:25.651Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:08:25.657Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:08:25.663Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:08:25.672Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:08:25.680Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202905680_cr66zr3qq","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:08:25.751Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:25.758Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202905680_cr66zr3qq","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:08:25.764Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:08:25.771Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:08:25.777Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":25,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":26,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",26]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:08:25.783Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202905680_cr66zr3qq","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:08:25.818Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202905680_cr66zr3qq","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:08:25.922Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202905680_cr66zr3qq","hasOutput":true}}
{"timestamp":"2025-08-26T10:08:25.927Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202905680_cr66zr3qq","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:08:25.951Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202905680_cr66zr3qq","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:08:25.957Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202905680_cr66zr3qq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:25.962Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202905680_cr66zr3qq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:25.985Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202905680_cr66zr3qq","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:08:25.991Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756202905680_cr66zr3qq","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:08:25.997Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202905680_cr66zr3qq","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:08:26.003Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202905680_cr66zr3qq","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:08:26.027Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202905680_cr66zr3qq","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:08:26.052Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202905680_cr66zr3qq","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:08:26.058Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202905680_cr66zr3qq","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:08:26.063Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202905680_cr66zr3qq","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:26.073Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202905680_cr66zr3qq","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:08:26.082Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:08:26.089Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:08:26.097Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756202905680_cr66zr3qq","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:08:26.104Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756202905680_cr66zr3qq","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:26.111Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756202905680_cr66zr3qq","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:08:26.117Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756202905680_cr66zr3qq","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:26.128Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756202905680_cr66zr3qq","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:08:26.137Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756202905680_cr66zr3qq","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:08:26.144Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756202905680_cr66zr3qq","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:08:26.150Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756202905680_cr66zr3qq","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:26.156Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202905680_cr66zr3qq","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:08:26.182Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202905680_cr66zr3qq","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:08:26.188Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202905680_cr66zr3qq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:26.195Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202905680_cr66zr3qq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:26.230Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202905680_cr66zr3qq","bodySize":136681,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:08:26.237Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":136681,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:08:26.243Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":136681,"chunkSize":16384,"estimatedChunks":9}}
{"timestamp":"2025-08-26T10:08:26.249Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":136681,"expectedSize":136681}}
{"timestamp":"2025-08-26T10:08:26.254Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":136681,"timeout":600000}}
{"timestamp":"2025-08-26T10:08:28.064Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202905680_cr66zr3qq","requestSize":136681,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:08:28.071Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202905680_cr66zr3qq","duration":7,"requestSize":136681,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:08:28.078Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":630,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:08:28.111Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202905680_cr66zr3qq","totalTime":2431,"layerTimings":{"router":112,"transformer":153,"protocol":59,"serverCompatibility":149,"server":1892,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:08:28.144Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202905680_cr66zr3qq","executionId":"req_1756202905680_cr66zr3qq","totalTime":2431,"success":true}}
{"timestamp":"2025-08-26T10:08:28.357Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:08:28.364Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:08:28.370Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:08:28.375Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:08:28.381Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:08:28.389Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:08:28.395Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202908395_g8yfxvkju","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:08:28.463Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:28.469Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202908395_g8yfxvkju","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:08:28.475Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:08:28.481Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:08:28.487Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":26,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":27,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",27]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:08:28.493Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202908395_g8yfxvkju","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:08:28.524Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202908395_g8yfxvkju","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:08:28.639Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202908395_g8yfxvkju","hasOutput":true}}
{"timestamp":"2025-08-26T10:08:28.646Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202908395_g8yfxvkju","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:08:28.670Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202908395_g8yfxvkju","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:08:28.676Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202908395_g8yfxvkju","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:28.682Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202908395_g8yfxvkju","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:28.706Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202908395_g8yfxvkju","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:08:28.712Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202908395_g8yfxvkju","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:08:28.717Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202908395_g8yfxvkju","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:08:28.743Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202908395_g8yfxvkju","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:08:28.768Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202908395_g8yfxvkju","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:08:28.774Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202908395_g8yfxvkju","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:08:28.780Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202908395_g8yfxvkju","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:08:28.786Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202908395_g8yfxvkju","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:08:28.797Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202908395_g8yfxvkju","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:08:28.824Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202908395_g8yfxvkju","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:08:28.830Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202908395_g8yfxvkju","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:28.835Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202908395_g8yfxvkju","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:08:28.867Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202908395_g8yfxvkju","bodySize":168556,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:08:28.874Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":168556,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:08:28.880Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":168556,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:08:28.886Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":168556,"expectedSize":168556}}
{"timestamp":"2025-08-26T10:08:28.891Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":168556,"timeout":600000}}
{"timestamp":"2025-08-26T10:08:28.900Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:08:28.906Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:08:35.668Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":533,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:08:35.700Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202899469_7q5aeql5c","totalTime":16231,"layerTimings":{"router":54,"transformer":60,"protocol":33,"serverCompatibility":46,"server":15980,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T10:08:35.714Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202899469_7q5aeql5c","executionId":"req_1756202899469_7q5aeql5c","totalTime":16231,"success":true}}
{"timestamp":"2025-08-26T10:09:14.946Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202908395_g8yfxvkju","requestSize":168556,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:09:14.954Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202908395_g8yfxvkju","duration":8,"requestSize":168556,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:09:14.960Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":6735,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:09:14.997Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202908395_g8yfxvkju","totalTime":46602,"layerTimings":{"router":105,"transformer":164,"protocol":55,"serverCompatibility":75,"server":46138,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:09:15.036Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202908395_g8yfxvkju","executionId":"req_1756202908395_g8yfxvkju","totalTime":46602,"success":true}}
{"timestamp":"2025-08-26T10:09:15.057Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:09:15.063Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:09:15.069Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:09:15.075Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:09:15.080Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:09:15.089Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:09:15.095Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202955095_z352n7k6e","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:09:15.162Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:09:15.168Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202955095_z352n7k6e","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:09:15.174Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:09:15.180Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:09:15.186Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":27,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":28,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",28]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:09:15.192Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202955095_z352n7k6e","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:09:15.224Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202955095_z352n7k6e","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:09:15.343Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202955095_z352n7k6e","hasOutput":true}}
{"timestamp":"2025-08-26T10:09:15.349Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202955095_z352n7k6e","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:09:15.374Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202955095_z352n7k6e","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:09:15.380Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202955095_z352n7k6e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:15.386Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202955095_z352n7k6e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:15.411Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202955095_z352n7k6e","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:09:15.418Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202955095_z352n7k6e","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:09:15.424Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202955095_z352n7k6e","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:09:15.451Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202955095_z352n7k6e","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:09:15.478Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202955095_z352n7k6e","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:09:15.484Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202955095_z352n7k6e","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:09:15.490Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202955095_z352n7k6e","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:09:15.497Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202955095_z352n7k6e","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:09:15.509Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202955095_z352n7k6e","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:09:15.535Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202955095_z352n7k6e","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:09:15.541Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202955095_z352n7k6e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:15.547Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202955095_z352n7k6e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:15.581Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202955095_z352n7k6e","bodySize":168557,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:09:15.587Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":168557,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:09:15.593Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":168557,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:09:15.599Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":168557,"expectedSize":168557}}
{"timestamp":"2025-08-26T10:09:15.605Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":168557,"timeout":600000}}
{"timestamp":"2025-08-26T10:09:15.613Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:09:15.618Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:09:21.856Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202955095_z352n7k6e","requestSize":168557,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:09:21.864Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202955095_z352n7k6e","duration":8,"requestSize":168557,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:09:21.870Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1035,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:09:21.905Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202955095_z352n7k6e","totalTime":6810,"layerTimings":{"router":104,"transformer":170,"protocol":59,"serverCompatibility":78,"server":6335,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:09:21.945Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202955095_z352n7k6e","executionId":"req_1756202955095_z352n7k6e","totalTime":6810,"success":true}}
{"timestamp":"2025-08-26T10:09:22.174Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:09:22.180Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:09:22.187Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:09:22.193Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:09:22.199Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:09:22.208Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:09:22.216Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202962216_fr7l7oa5e","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:09:22.284Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:09:22.290Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202962216_fr7l7oa5e","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:09:22.296Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:09:22.302Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:09:22.308Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":28,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":29,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",29]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:09:22.314Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202962216_fr7l7oa5e","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:09:22.348Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202962216_fr7l7oa5e","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:09:22.487Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202962216_fr7l7oa5e","hasOutput":true}}
{"timestamp":"2025-08-26T10:09:22.493Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202962216_fr7l7oa5e","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:09:22.519Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202962216_fr7l7oa5e","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:09:22.525Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202962216_fr7l7oa5e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:22.531Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202962216_fr7l7oa5e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:22.557Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202962216_fr7l7oa5e","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:09:22.563Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756202962216_fr7l7oa5e","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:09:22.569Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202962216_fr7l7oa5e","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:09:22.574Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202962216_fr7l7oa5e","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:09:22.599Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202962216_fr7l7oa5e","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:09:22.624Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202962216_fr7l7oa5e","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:09:22.631Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202962216_fr7l7oa5e","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:09:22.637Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202962216_fr7l7oa5e","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:09:22.647Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202962216_fr7l7oa5e","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:09:22.656Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756202962216_fr7l7oa5e","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:09:22.661Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756202962216_fr7l7oa5e","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:09:22.668Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756202962216_fr7l7oa5e","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:09:22.674Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756202962216_fr7l7oa5e","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:09:22.685Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756202962216_fr7l7oa5e","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:09:22.694Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756202962216_fr7l7oa5e","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:09:22.700Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756202962216_fr7l7oa5e","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:09:22.706Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756202962216_fr7l7oa5e","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:09:22.712Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202962216_fr7l7oa5e","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:09:22.739Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202962216_fr7l7oa5e","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:09:22.745Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202962216_fr7l7oa5e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:22.750Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202962216_fr7l7oa5e","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:22.785Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202962216_fr7l7oa5e","bodySize":170355,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:09:22.792Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":170355,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:09:22.799Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":170355,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:09:22.806Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":170355,"expectedSize":170355}}
{"timestamp":"2025-08-26T10:09:22.811Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":170355,"timeout":600000}}
{"timestamp":"2025-08-26T10:09:22.820Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:09:22.826Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:09:39.215Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202962216_fr7l7oa5e","requestSize":170355,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:09:39.224Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202962216_fr7l7oa5e","duration":9,"requestSize":170355,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:09:39.230Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":3246,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:09:39.288Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202962216_fr7l7oa5e","totalTime":17072,"layerTimings":{"router":106,"transformer":191,"protocol":62,"serverCompatibility":134,"server":16492,"responseTransform":40},"transformationCount":4}}
{"timestamp":"2025-08-26T10:09:39.327Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202962216_fr7l7oa5e","executionId":"req_1756202962216_fr7l7oa5e","totalTime":17072,"success":true}}
{"timestamp":"2025-08-26T10:09:39.349Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:09:39.355Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:09:39.362Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:09:39.368Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:09:39.374Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:09:39.383Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:09:39.389Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756202979389_7vy4gnkat","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:09:39.454Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:09:39.460Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756202979389_7vy4gnkat","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:09:39.465Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:09:39.471Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:09:39.477Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":29,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":30,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",30]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:09:39.482Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756202979389_7vy4gnkat","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:09:39.516Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756202979389_7vy4gnkat","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:09:39.648Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756202979389_7vy4gnkat","hasOutput":true}}
{"timestamp":"2025-08-26T10:09:39.654Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756202979389_7vy4gnkat","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:09:39.681Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202979389_7vy4gnkat","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:09:39.688Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202979389_7vy4gnkat","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:39.695Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756202979389_7vy4gnkat","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:39.721Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756202979389_7vy4gnkat","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:09:39.727Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756202979389_7vy4gnkat","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:09:39.733Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756202979389_7vy4gnkat","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:09:39.760Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756202979389_7vy4gnkat","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:09:39.786Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756202979389_7vy4gnkat","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:09:39.793Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756202979389_7vy4gnkat","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:09:39.799Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756202979389_7vy4gnkat","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:09:39.807Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756202979389_7vy4gnkat","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:09:39.819Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756202979389_7vy4gnkat","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:09:39.843Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756202979389_7vy4gnkat","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:09:39.849Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756202979389_7vy4gnkat","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:39.854Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756202979389_7vy4gnkat","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:09:39.887Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756202979389_7vy4gnkat","bodySize":170353,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:09:39.893Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":170353,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:09:39.900Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":170353,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:09:39.906Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":170353,"expectedSize":170353}}
{"timestamp":"2025-08-26T10:09:39.912Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":170353,"timeout":600000}}
{"timestamp":"2025-08-26T10:09:39.921Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:09:39.928Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:10:39.859Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:10:39.866Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:10:39.871Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:10:39.877Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:10:39.882Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:10:39.891Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:10:39.898Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203039898_4uw3vbf1q","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:10:39.963Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:10:39.970Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203039898_4uw3vbf1q","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:10:39.976Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:10:39.982Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:10:39.989Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":30,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":31,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",31]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:10:39.996Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203039898_4uw3vbf1q","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:10:40.031Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203039898_4uw3vbf1q","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:10:40.174Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203039898_4uw3vbf1q","hasOutput":true}}
{"timestamp":"2025-08-26T10:10:40.180Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203039898_4uw3vbf1q","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:10:40.206Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203039898_4uw3vbf1q","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:10:40.213Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203039898_4uw3vbf1q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:40.219Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203039898_4uw3vbf1q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:40.245Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203039898_4uw3vbf1q","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:10:40.251Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203039898_4uw3vbf1q","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:10:40.258Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203039898_4uw3vbf1q","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:10:40.283Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203039898_4uw3vbf1q","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:10:40.309Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203039898_4uw3vbf1q","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:10:40.316Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203039898_4uw3vbf1q","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:10:40.322Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203039898_4uw3vbf1q","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:10:40.328Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203039898_4uw3vbf1q","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:10:40.340Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203039898_4uw3vbf1q","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:10:40.366Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203039898_4uw3vbf1q","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:10:40.373Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203039898_4uw3vbf1q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:40.379Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203039898_4uw3vbf1q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:40.413Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203039898_4uw3vbf1q","bodySize":170354,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:10:40.420Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":170354,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:10:40.427Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":170354,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:10:40.433Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":170354,"expectedSize":170354}}
{"timestamp":"2025-08-26T10:10:40.439Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":170354,"timeout":600000}}
{"timestamp":"2025-08-26T10:10:40.448Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:10:40.454Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:10:48.434Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203039898_4uw3vbf1q","requestSize":170354,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:10:48.443Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203039898_4uw3vbf1q","duration":9,"requestSize":170354,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:10:48.450Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1277,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:10:48.486Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203039898_4uw3vbf1q","totalTime":8588,"layerTimings":{"router":108,"transformer":195,"protocol":58,"serverCompatibility":76,"server":8082,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:10:48.526Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203039898_4uw3vbf1q","executionId":"req_1756203039898_4uw3vbf1q","totalTime":8588,"success":true}}
{"timestamp":"2025-08-26T10:10:51.450Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:10:51.456Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:10:51.462Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:10:51.469Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:10:51.475Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:10:51.484Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:10:51.492Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203051492_0wlg8ppzf","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:10:51.562Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:10:51.569Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203051492_0wlg8ppzf","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:10:51.575Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:10:51.580Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:10:51.586Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":31,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":32,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",32]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:10:51.593Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203051492_0wlg8ppzf","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:10:51.628Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203051492_0wlg8ppzf","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:10:51.779Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203051492_0wlg8ppzf","hasOutput":true}}
{"timestamp":"2025-08-26T10:10:51.786Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203051492_0wlg8ppzf","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:10:51.815Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203051492_0wlg8ppzf","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:10:51.821Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203051492_0wlg8ppzf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:51.828Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203051492_0wlg8ppzf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:51.854Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203051492_0wlg8ppzf","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:10:51.860Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203051492_0wlg8ppzf","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:10:51.866Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203051492_0wlg8ppzf","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:10:51.872Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203051492_0wlg8ppzf","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:10:51.897Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203051492_0wlg8ppzf","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:10:51.923Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203051492_0wlg8ppzf","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:10:51.929Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203051492_0wlg8ppzf","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:10:51.934Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203051492_0wlg8ppzf","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:10:51.944Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203051492_0wlg8ppzf","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:10:51.951Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203051492_0wlg8ppzf","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:10:51.957Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203051492_0wlg8ppzf","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:10:51.962Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203051492_0wlg8ppzf","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:10:51.968Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203051492_0wlg8ppzf","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:10:51.977Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203051492_0wlg8ppzf","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:10:51.984Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203051492_0wlg8ppzf","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:10:51.990Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203051492_0wlg8ppzf","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:10:51.996Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203051492_0wlg8ppzf","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:10:52.002Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203051492_0wlg8ppzf","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:10:52.027Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203051492_0wlg8ppzf","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:10:52.033Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203051492_0wlg8ppzf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:52.039Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203051492_0wlg8ppzf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:52.073Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203051492_0wlg8ppzf","bodySize":172027,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:10:52.080Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":172027,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:10:52.086Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":172027,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:10:52.093Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":172027,"expectedSize":172027}}
{"timestamp":"2025-08-26T10:10:52.099Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":172027,"timeout":600000}}
{"timestamp":"2025-08-26T10:10:52.109Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:10:52.115Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:10:55.577Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203051492_0wlg8ppzf","requestSize":172027,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:10:55.586Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203051492_0wlg8ppzf","duration":9,"requestSize":172027,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:10:55.593Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":955,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:10:55.643Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203051492_0wlg8ppzf","totalTime":4151,"layerTimings":{"router":109,"transformer":207,"protocol":63,"serverCompatibility":124,"server":3565,"responseTransform":33},"transformationCount":4}}
{"timestamp":"2025-08-26T10:10:55.681Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203051492_0wlg8ppzf","executionId":"req_1756203051492_0wlg8ppzf","totalTime":4151,"success":true}}
{"timestamp":"2025-08-26T10:10:55.703Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:10:55.709Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:10:55.715Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:10:55.720Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:10:55.726Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:10:55.736Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:10:55.744Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203055744_oqvefbjea","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:10:55.821Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:10:55.828Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203055744_oqvefbjea","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:10:55.835Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:10:55.841Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:10:55.848Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":32,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":33,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",33]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:10:55.855Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203055744_oqvefbjea","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:10:55.898Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203055744_oqvefbjea","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:10:56.050Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203055744_oqvefbjea","hasOutput":true}}
{"timestamp":"2025-08-26T10:10:56.056Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203055744_oqvefbjea","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:10:56.082Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203055744_oqvefbjea","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:10:56.089Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203055744_oqvefbjea","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:56.095Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203055744_oqvefbjea","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:56.121Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203055744_oqvefbjea","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:10:56.128Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203055744_oqvefbjea","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:10:56.134Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203055744_oqvefbjea","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:10:56.160Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203055744_oqvefbjea","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:10:56.186Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203055744_oqvefbjea","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:10:56.193Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203055744_oqvefbjea","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:10:56.199Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203055744_oqvefbjea","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:10:56.206Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203055744_oqvefbjea","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:10:56.218Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203055744_oqvefbjea","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:10:56.243Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203055744_oqvefbjea","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:10:56.250Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203055744_oqvefbjea","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:56.256Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203055744_oqvefbjea","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:10:56.290Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203055744_oqvefbjea","bodySize":172025,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:10:56.297Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":172025,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:10:56.304Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":172025,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:10:56.311Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":172025,"expectedSize":172025}}
{"timestamp":"2025-08-26T10:10:56.317Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":172025,"timeout":600000}}
{"timestamp":"2025-08-26T10:10:56.327Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:10:56.333Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:11:42.930Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756202979389_7vy4gnkat","requestSize":170353,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:11:42.938Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756202979389_7vy4gnkat","duration":8,"requestSize":170353,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:11:42.944Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1188,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:11:42.977Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756202979389_7vy4gnkat","totalTime":123588,"layerTimings":{"router":101,"transformer":185,"protocol":59,"serverCompatibility":77,"server":123100,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:11:43.015Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756202979389_7vy4gnkat","executionId":"req_1756202979389_7vy4gnkat","totalTime":123588,"success":true}}
{"timestamp":"2025-08-26T10:11:56.328Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:11:56.335Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:11:56.342Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:11:56.348Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:11:56.355Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:11:56.365Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:11:56.372Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203116372_wjs7jroxj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:11:56.436Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:11:56.442Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203116372_wjs7jroxj","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:11:56.448Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:11:56.454Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:11:56.459Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":33,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":34,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",34]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:11:56.465Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203116372_wjs7jroxj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:11:56.497Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203116372_wjs7jroxj","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:11:56.659Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203116372_wjs7jroxj","hasOutput":true}}
{"timestamp":"2025-08-26T10:11:56.665Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203116372_wjs7jroxj","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:11:56.689Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203116372_wjs7jroxj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:11:56.695Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203116372_wjs7jroxj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:11:56.700Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203116372_wjs7jroxj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:11:56.725Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203116372_wjs7jroxj","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:11:56.732Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203116372_wjs7jroxj","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:11:56.738Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203116372_wjs7jroxj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:11:56.763Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203116372_wjs7jroxj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:11:56.787Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203116372_wjs7jroxj","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:11:56.793Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203116372_wjs7jroxj","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:11:56.799Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203116372_wjs7jroxj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:11:56.805Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203116372_wjs7jroxj","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:11:56.817Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203116372_wjs7jroxj","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:11:56.843Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203116372_wjs7jroxj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:11:56.849Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203116372_wjs7jroxj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:11:56.855Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203116372_wjs7jroxj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:11:56.888Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203116372_wjs7jroxj","bodySize":172026,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:11:56.895Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":172026,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:11:56.902Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":172026,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:11:56.908Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":172026,"expectedSize":172026}}
{"timestamp":"2025-08-26T10:11:56.914Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":172026,"timeout":600000}}
{"timestamp":"2025-08-26T10:11:56.922Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:11:56.928Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:12:02.759Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203116372_wjs7jroxj","requestSize":172026,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:12:02.767Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203116372_wjs7jroxj","duration":8,"requestSize":172026,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:12:02.773Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1037,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:12:02.808Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203116372_wjs7jroxj","totalTime":6436,"layerTimings":{"router":101,"transformer":211,"protocol":57,"serverCompatibility":74,"server":5930,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:12:02.847Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203116372_wjs7jroxj","executionId":"req_1756203116372_wjs7jroxj","totalTime":6436,"success":true}}
{"timestamp":"2025-08-26T10:12:03.073Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:12:03.080Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:12:03.086Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:12:03.092Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:12:03.097Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:12:03.108Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:12:03.115Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203123115_sxjx13tl2","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:12:03.184Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:12:03.190Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203123115_sxjx13tl2","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:12:03.196Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:12:03.202Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:12:03.207Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":34,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":35,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",35]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:12:03.213Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203123115_sxjx13tl2","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:12:03.245Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203123115_sxjx13tl2","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:12:03.414Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203123115_sxjx13tl2","hasOutput":true}}
{"timestamp":"2025-08-26T10:12:03.420Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203123115_sxjx13tl2","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:12:03.445Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203123115_sxjx13tl2","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:12:03.450Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203123115_sxjx13tl2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:03.456Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203123115_sxjx13tl2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:03.481Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203123115_sxjx13tl2","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:12:03.487Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203123115_sxjx13tl2","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:12:03.494Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203123115_sxjx13tl2","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:12:03.500Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203123115_sxjx13tl2","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:12:03.525Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203123115_sxjx13tl2","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:12:03.550Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203123115_sxjx13tl2","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:12:03.557Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203123115_sxjx13tl2","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:12:03.564Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203123115_sxjx13tl2","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:12:03.576Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203123115_sxjx13tl2","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:12:03.585Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203123115_sxjx13tl2","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:12:03.590Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203123115_sxjx13tl2","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:12:03.596Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203123115_sxjx13tl2","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:12:03.602Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203123115_sxjx13tl2","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:12:03.613Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203123115_sxjx13tl2","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:12:03.622Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203123115_sxjx13tl2","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:12:03.628Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203123115_sxjx13tl2","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:12:03.634Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203123115_sxjx13tl2","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:12:03.639Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203123115_sxjx13tl2","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:12:03.665Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203123115_sxjx13tl2","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:12:03.671Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203123115_sxjx13tl2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:03.678Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203123115_sxjx13tl2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:03.712Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203123115_sxjx13tl2","bodySize":173828,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:12:03.719Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":173828,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:12:03.726Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":173828,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:12:03.731Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":173828,"expectedSize":173828}}
{"timestamp":"2025-08-26T10:12:03.737Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":173828,"timeout":600000}}
{"timestamp":"2025-08-26T10:12:03.746Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:12:03.752Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:12:11.710Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203123115_sxjx13tl2","requestSize":173828,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:12:11.718Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203123115_sxjx13tl2","duration":8,"requestSize":173828,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:12:11.724Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":2987,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:12:11.757Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203123115_sxjx13tl2","totalTime":8642,"layerTimings":{"router":105,"transformer":219,"protocol":64,"serverCompatibility":134,"server":8057,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:12:11.796Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203123115_sxjx13tl2","executionId":"req_1756203123115_sxjx13tl2","totalTime":8642,"success":true}}
{"timestamp":"2025-08-26T10:12:11.816Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:12:11.823Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:12:11.829Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:12:11.835Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:12:11.841Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:12:11.850Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:12:11.857Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203131857_3gktdb52k","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:12:11.921Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:12:11.927Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203131857_3gktdb52k","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:12:11.933Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:12:11.939Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:12:11.945Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":35,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":36,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",36]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:12:11.951Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203131857_3gktdb52k","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:12:11.983Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203131857_3gktdb52k","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:12:12.160Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203131857_3gktdb52k","hasOutput":true}}
{"timestamp":"2025-08-26T10:12:12.166Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203131857_3gktdb52k","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:12:12.191Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203131857_3gktdb52k","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:12:12.197Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203131857_3gktdb52k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:12.203Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203131857_3gktdb52k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:12.229Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203131857_3gktdb52k","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:12:12.236Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203131857_3gktdb52k","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:12:12.242Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203131857_3gktdb52k","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:12:12.268Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203131857_3gktdb52k","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:12:12.295Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203131857_3gktdb52k","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:12:12.301Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203131857_3gktdb52k","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:12:12.307Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203131857_3gktdb52k","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:12:12.314Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203131857_3gktdb52k","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:12:12.327Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203131857_3gktdb52k","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:12:12.354Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203131857_3gktdb52k","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:12:12.360Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203131857_3gktdb52k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:12.366Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203131857_3gktdb52k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:12.400Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203131857_3gktdb52k","bodySize":173826,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:12:12.407Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":173826,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:12:12.413Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":173826,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:12:12.418Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":173826,"expectedSize":173826}}
{"timestamp":"2025-08-26T10:12:12.424Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":173826,"timeout":600000}}
{"timestamp":"2025-08-26T10:12:12.433Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:12:12.439Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:12:39.401Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203055744_oqvefbjea","requestSize":172025,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:12:39.408Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203055744_oqvefbjea","duration":7,"requestSize":172025,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:12:39.415Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1107,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:12:39.448Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203055744_oqvefbjea","totalTime":103704,"layerTimings":{"router":127,"transformer":205,"protocol":59,"serverCompatibility":76,"server":103170,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:12:39.486Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203055744_oqvefbjea","executionId":"req_1756203055744_oqvefbjea","totalTime":103704,"success":true}}
{"timestamp":"2025-08-26T10:12:56.639Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203131857_3gktdb52k","requestSize":173826,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:12:56.647Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203131857_3gktdb52k","duration":8,"requestSize":173826,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:12:56.654Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":2767,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:12:56.693Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203131857_3gktdb52k","totalTime":44836,"layerTimings":{"router":101,"transformer":227,"protocol":59,"serverCompatibility":79,"server":44301,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T10:12:56.732Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203131857_3gktdb52k","executionId":"req_1756203131857_3gktdb52k","totalTime":44836,"success":true}}
{"timestamp":"2025-08-26T10:12:56.968Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:12:56.975Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:12:56.981Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:12:56.987Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:12:56.993Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:12:57.004Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:12:57.011Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203177011_h46nt5ro8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:12:57.081Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:12:57.088Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203177011_h46nt5ro8","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:12:57.094Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:12:57.100Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:12:57.107Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":36,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":37,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",37]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:12:57.113Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203177011_h46nt5ro8","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:12:57.148Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203177011_h46nt5ro8","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:12:57.338Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203177011_h46nt5ro8","hasOutput":true}}
{"timestamp":"2025-08-26T10:12:57.345Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203177011_h46nt5ro8","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:12:57.372Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203177011_h46nt5ro8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:12:57.378Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203177011_h46nt5ro8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:57.385Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203177011_h46nt5ro8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:57.411Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203177011_h46nt5ro8","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:12:57.417Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203177011_h46nt5ro8","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:12:57.423Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203177011_h46nt5ro8","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:12:57.449Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203177011_h46nt5ro8","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:12:57.475Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203177011_h46nt5ro8","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:12:57.482Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203177011_h46nt5ro8","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:12:57.488Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203177011_h46nt5ro8","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:12:57.495Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203177011_h46nt5ro8","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:12:57.509Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203177011_h46nt5ro8","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:12:57.536Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203177011_h46nt5ro8","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:12:57.542Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203177011_h46nt5ro8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:57.549Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203177011_h46nt5ro8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:12:57.584Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203177011_h46nt5ro8","bodySize":178396,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:12:57.591Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":178396,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:12:57.598Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":178396,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:12:57.604Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":178396,"expectedSize":178396}}
{"timestamp":"2025-08-26T10:12:57.610Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":178396,"timeout":600000}}
{"timestamp":"2025-08-26T10:12:57.619Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:12:57.625Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:13:04.585Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203177011_h46nt5ro8","requestSize":178396,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:13:04.593Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203177011_h46nt5ro8","duration":8,"requestSize":178396,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:13:04.599Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1039,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:13:04.634Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203177011_h46nt5ro8","totalTime":7623,"layerTimings":{"router":111,"transformer":244,"protocol":58,"serverCompatibility":81,"server":7060,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:13:04.674Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203177011_h46nt5ro8","executionId":"req_1756203177011_h46nt5ro8","totalTime":7623,"success":true}}
{"timestamp":"2025-08-26T10:13:04.696Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:13:04.702Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:13:04.708Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:13:04.715Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:13:04.721Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:13:04.731Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:13:04.738Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203184738_d2ixlpsbu","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:13:04.805Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:13:04.811Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203184738_d2ixlpsbu","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:13:04.817Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:13:04.823Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:13:04.828Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":37,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":38,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",38]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:13:04.834Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203184738_d2ixlpsbu","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:13:04.866Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203184738_d2ixlpsbu","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:13:05.065Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203184738_d2ixlpsbu","hasOutput":true}}
{"timestamp":"2025-08-26T10:13:05.071Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203184738_d2ixlpsbu","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:13:05.098Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203184738_d2ixlpsbu","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:13:05.104Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203184738_d2ixlpsbu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:05.110Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203184738_d2ixlpsbu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:05.136Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203184738_d2ixlpsbu","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:13:05.142Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203184738_d2ixlpsbu","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:13:05.148Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203184738_d2ixlpsbu","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:13:05.154Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203184738_d2ixlpsbu","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:13:05.180Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203184738_d2ixlpsbu","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:13:05.207Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203184738_d2ixlpsbu","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:13:05.214Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203184738_d2ixlpsbu","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:13:05.220Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203184738_d2ixlpsbu","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:13:05.232Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203184738_d2ixlpsbu","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:13:05.241Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203184738_d2ixlpsbu","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:13:05.247Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203184738_d2ixlpsbu","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:13:05.255Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203184738_d2ixlpsbu","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:13:05.262Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203184738_d2ixlpsbu","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:13:05.273Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203184738_d2ixlpsbu","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:13:05.281Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203184738_d2ixlpsbu","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:13:05.287Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203184738_d2ixlpsbu","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:13:05.295Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203184738_d2ixlpsbu","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:13:05.301Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203184738_d2ixlpsbu","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:13:05.327Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203184738_d2ixlpsbu","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:13:05.334Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203184738_d2ixlpsbu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:05.340Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203184738_d2ixlpsbu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:05.374Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203184738_d2ixlpsbu","bodySize":178397,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:13:05.381Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":178397,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:13:05.388Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":178397,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:13:05.395Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":178397,"expectedSize":178397}}
{"timestamp":"2025-08-26T10:13:05.401Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":178397,"timeout":600000}}
{"timestamp":"2025-08-26T10:13:05.409Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:13:05.416Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:13:07.999Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203184738_d2ixlpsbu","requestSize":178397,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:13:08.007Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203184738_d2ixlpsbu","duration":8,"requestSize":178397,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:13:08.014Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":957,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:13:08.066Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203184738_d2ixlpsbu","totalTime":3328,"layerTimings":{"router":103,"transformer":251,"protocol":65,"serverCompatibility":140,"server":2685,"responseTransform":34},"transformationCount":4}}
{"timestamp":"2025-08-26T10:13:08.106Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203184738_d2ixlpsbu","executionId":"req_1756203184738_d2ixlpsbu","totalTime":3328,"success":true}}
{"timestamp":"2025-08-26T10:13:08.334Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:13:08.341Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:13:08.346Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:13:08.352Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:13:08.358Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:13:08.369Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:13:08.376Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203188376_beuc94sb8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:13:08.448Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:13:08.455Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203188376_beuc94sb8","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:13:08.461Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:13:08.467Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:13:08.473Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":38,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":39,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",39]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:13:08.480Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203188376_beuc94sb8","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:13:08.515Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203188376_beuc94sb8","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:13:08.724Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203188376_beuc94sb8","hasOutput":true}}
{"timestamp":"2025-08-26T10:13:08.730Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203188376_beuc94sb8","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:13:08.755Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203188376_beuc94sb8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:13:08.761Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203188376_beuc94sb8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:08.767Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203188376_beuc94sb8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:08.793Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203188376_beuc94sb8","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:13:08.799Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203188376_beuc94sb8","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:13:08.806Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203188376_beuc94sb8","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:13:08.832Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203188376_beuc94sb8","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:13:08.858Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203188376_beuc94sb8","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:13:08.865Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203188376_beuc94sb8","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:13:08.871Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203188376_beuc94sb8","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:13:08.878Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203188376_beuc94sb8","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:13:08.891Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203188376_beuc94sb8","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:13:08.917Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203188376_beuc94sb8","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:13:08.924Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203188376_beuc94sb8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:08.930Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203188376_beuc94sb8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:08.967Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203188376_beuc94sb8","bodySize":180208,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:13:08.974Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":180208,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:13:08.981Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":180208,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:13:08.987Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":180208,"expectedSize":180208}}
{"timestamp":"2025-08-26T10:13:08.993Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":180208,"timeout":600000}}
{"timestamp":"2025-08-26T10:13:09.002Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:13:09.009Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:13:42.753Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203188376_beuc94sb8","requestSize":180208,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:13:42.760Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203188376_beuc94sb8","duration":7,"requestSize":180208,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:13:42.766Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":7864,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:13:42.802Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203188376_beuc94sb8","totalTime":34426,"layerTimings":{"router":113,"transformer":260,"protocol":59,"serverCompatibility":79,"server":33847,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:13:42.842Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203188376_beuc94sb8","executionId":"req_1756203188376_beuc94sb8","totalTime":34426,"success":true}}
{"timestamp":"2025-08-26T10:13:42.863Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:13:42.870Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:13:42.875Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:13:42.881Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:13:42.887Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:13:42.898Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:13:42.904Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203222904_po3awbcq7","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:13:42.965Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:13:42.971Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203222904_po3awbcq7","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:13:42.977Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:13:42.984Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:13:42.989Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":39,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":40,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",40]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:13:42.995Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203222904_po3awbcq7","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:13:43.028Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203222904_po3awbcq7","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:13:43.233Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203222904_po3awbcq7","hasOutput":true}}
{"timestamp":"2025-08-26T10:13:43.239Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203222904_po3awbcq7","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:13:43.263Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203222904_po3awbcq7","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:13:43.269Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203222904_po3awbcq7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:43.275Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203222904_po3awbcq7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:43.302Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203222904_po3awbcq7","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:13:43.307Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203222904_po3awbcq7","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:13:43.314Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203222904_po3awbcq7","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:13:43.340Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203222904_po3awbcq7","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:13:43.367Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203222904_po3awbcq7","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:13:43.373Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203222904_po3awbcq7","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:13:43.380Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203222904_po3awbcq7","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:13:43.387Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203222904_po3awbcq7","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:13:43.400Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203222904_po3awbcq7","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:13:43.425Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203222904_po3awbcq7","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:13:43.431Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203222904_po3awbcq7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:43.436Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203222904_po3awbcq7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:13:43.469Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203222904_po3awbcq7","bodySize":180209,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:13:43.475Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":180209,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:13:43.481Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":180209,"chunkSize":16384,"estimatedChunks":11}}
{"timestamp":"2025-08-26T10:13:43.487Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":180209,"expectedSize":180209}}
{"timestamp":"2025-08-26T10:13:43.492Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":180209,"timeout":600000}}
{"timestamp":"2025-08-26T10:13:43.501Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:13:43.506Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:14:33.547Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203222904_po3awbcq7","requestSize":180209,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:14:33.594Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203222904_po3awbcq7","duration":47,"requestSize":180209,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:14:33.602Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":10804,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:14:33.641Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203222904_po3awbcq7","totalTime":50737,"layerTimings":{"router":99,"transformer":255,"protocol":59,"serverCompatibility":78,"server":50178,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T10:14:33.683Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203222904_po3awbcq7","executionId":"req_1756203222904_po3awbcq7","totalTime":50737,"success":true}}
{"timestamp":"2025-08-26T10:14:33.954Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:14:33.960Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:14:33.966Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:14:33.972Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:14:33.979Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:14:33.990Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:14:33.997Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203273997_puduql3yl","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:14:34.069Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:14:34.076Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203273997_puduql3yl","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:14:34.082Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:14:34.088Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:14:34.095Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":40,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":41,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",41]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:14:34.102Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203273997_puduql3yl","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:14:34.137Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203273997_puduql3yl","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:14:34.366Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203273997_puduql3yl","hasOutput":true}}
{"timestamp":"2025-08-26T10:14:34.373Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203273997_puduql3yl","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:14:34.403Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203273997_puduql3yl","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:14:34.409Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203273997_puduql3yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:14:34.416Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203273997_puduql3yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:14:34.446Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203273997_puduql3yl","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:14:34.452Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203273997_puduql3yl","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:14:34.459Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203273997_puduql3yl","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:14:34.465Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203273997_puduql3yl","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:14:34.494Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203273997_puduql3yl","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:14:34.523Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203273997_puduql3yl","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:14:34.530Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203273997_puduql3yl","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:14:34.536Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203273997_puduql3yl","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:14:34.548Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203273997_puduql3yl","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:14:34.557Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203273997_puduql3yl","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:14:34.563Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203273997_puduql3yl","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:14:34.570Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203273997_puduql3yl","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:14:34.576Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203273997_puduql3yl","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:14:34.587Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203273997_puduql3yl","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:14:34.596Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203273997_puduql3yl","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:14:34.603Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203273997_puduql3yl","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:14:34.610Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203273997_puduql3yl","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:14:34.616Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203273997_puduql3yl","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:14:34.645Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203273997_puduql3yl","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:14:34.651Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203273997_puduql3yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:14:34.657Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203273997_puduql3yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:14:34.694Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203273997_puduql3yl","bodySize":198519,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:14:34.702Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":198519,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:14:34.709Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":198519,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:14:34.715Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":198519,"expectedSize":198519}}
{"timestamp":"2025-08-26T10:14:34.722Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":198519,"timeout":600000}}
{"timestamp":"2025-08-26T10:14:34.731Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:14:34.737Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:14:38.849Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203273997_puduql3yl","requestSize":198519,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:14:38.857Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203273997_puduql3yl","duration":8,"requestSize":198519,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:14:38.864Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":959,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:14:38.915Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203273997_puduql3yl","totalTime":4918,"layerTimings":{"router":113,"transformer":287,"protocol":72,"serverCompatibility":145,"server":4218,"responseTransform":34},"transformationCount":4}}
{"timestamp":"2025-08-26T10:14:38.958Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203273997_puduql3yl","executionId":"req_1756203273997_puduql3yl","totalTime":4918,"success":true}}
{"timestamp":"2025-08-26T10:14:38.978Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:14:38.985Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:14:38.991Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:14:38.997Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:14:39.003Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:14:39.015Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:14:39.022Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203279022_vzsj5tkq1","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:14:39.089Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:14:39.095Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203279022_vzsj5tkq1","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:14:39.101Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:14:39.107Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:14:39.112Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":41,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":42,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",42]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:14:39.118Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203279022_vzsj5tkq1","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:14:39.152Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203279022_vzsj5tkq1","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:14:39.405Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203279022_vzsj5tkq1","hasOutput":true}}
{"timestamp":"2025-08-26T10:14:39.410Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203279022_vzsj5tkq1","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:14:39.438Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203279022_vzsj5tkq1","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:14:39.444Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203279022_vzsj5tkq1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:14:39.450Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203279022_vzsj5tkq1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:14:39.478Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203279022_vzsj5tkq1","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:14:39.484Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203279022_vzsj5tkq1","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:14:39.490Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203279022_vzsj5tkq1","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:14:39.518Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203279022_vzsj5tkq1","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:14:39.546Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203279022_vzsj5tkq1","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:14:39.552Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203279022_vzsj5tkq1","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:14:39.558Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203279022_vzsj5tkq1","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:14:39.566Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203279022_vzsj5tkq1","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:14:39.579Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203279022_vzsj5tkq1","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:14:39.608Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203279022_vzsj5tkq1","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:14:39.615Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203279022_vzsj5tkq1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:14:39.621Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203279022_vzsj5tkq1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:14:39.658Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203279022_vzsj5tkq1","bodySize":198517,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:14:39.665Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":198517,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:14:39.671Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":198517,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:14:39.677Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":198517,"expectedSize":198517}}
{"timestamp":"2025-08-26T10:14:39.683Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":198517,"timeout":600000}}
{"timestamp":"2025-08-26T10:14:39.691Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:14:39.697Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:15:06.387Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203279022_vzsj5tkq1","requestSize":198517,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:15:06.426Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203279022_vzsj5tkq1","duration":39,"requestSize":198517,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:15:06.433Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":3461,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:15:06.471Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203279022_vzsj5tkq1","totalTime":27449,"layerTimings":{"router":101,"transformer":308,"protocol":62,"serverCompatibility":83,"server":26825,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:15:06.516Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203279022_vzsj5tkq1","executionId":"req_1756203279022_vzsj5tkq1","totalTime":27449,"success":true}}
{"timestamp":"2025-08-26T10:15:06.754Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:15:06.761Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:15:06.767Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:15:06.773Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:15:06.779Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:15:06.790Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:15:06.798Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203306798_9dckomucd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:15:06.869Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:15:06.876Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203306798_9dckomucd","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:15:06.883Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:15:06.889Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:15:06.895Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":42,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":43,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",43]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:15:06.901Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203306798_9dckomucd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:15:06.940Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203306798_9dckomucd","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:15:07.192Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203306798_9dckomucd","hasOutput":true}}
{"timestamp":"2025-08-26T10:15:07.198Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203306798_9dckomucd","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:15:07.226Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203306798_9dckomucd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:15:07.233Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203306798_9dckomucd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:07.239Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203306798_9dckomucd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:07.269Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203306798_9dckomucd","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:15:07.275Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203306798_9dckomucd","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:15:07.281Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203306798_9dckomucd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:15:07.309Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203306798_9dckomucd","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:15:07.339Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203306798_9dckomucd","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:15:07.346Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203306798_9dckomucd","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:15:07.352Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203306798_9dckomucd","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:15:07.359Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203306798_9dckomucd","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:15:07.374Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203306798_9dckomucd","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:15:07.402Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203306798_9dckomucd","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:15:07.409Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203306798_9dckomucd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:07.416Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203306798_9dckomucd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:07.454Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203306798_9dckomucd","bodySize":203397,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:15:07.461Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":203397,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:15:07.469Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":203397,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:15:07.475Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":203397,"expectedSize":203397}}
{"timestamp":"2025-08-26T10:15:07.482Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":203397,"timeout":600000}}
{"timestamp":"2025-08-26T10:15:07.491Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:15:07.498Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:15:26.692Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203306798_9dckomucd","requestSize":203397,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:15:26.701Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203306798_9dckomucd","duration":9,"requestSize":203397,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:15:26.707Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":3952,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:15:26.743Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203306798_9dckomucd","totalTime":19945,"layerTimings":{"router":112,"transformer":310,"protocol":63,"serverCompatibility":86,"server":19302,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:15:26.786Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203306798_9dckomucd","executionId":"req_1756203306798_9dckomucd","totalTime":19945,"success":true}}
{"timestamp":"2025-08-26T10:15:26.807Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:15:26.814Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:15:26.820Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:15:26.827Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:15:26.834Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:15:26.845Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:15:26.853Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203326853_r268y9s4w","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:15:26.929Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:15:26.935Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203326853_r268y9s4w","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:15:26.940Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:15:26.946Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:15:26.952Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":43,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":44,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",44]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:15:26.958Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203326853_r268y9s4w","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:15:26.992Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203326853_r268y9s4w","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:15:27.248Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203326853_r268y9s4w","hasOutput":true}}
{"timestamp":"2025-08-26T10:15:27.254Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203326853_r268y9s4w","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:15:27.282Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203326853_r268y9s4w","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:15:27.288Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203326853_r268y9s4w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:27.294Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203326853_r268y9s4w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:27.324Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203326853_r268y9s4w","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:15:27.330Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203326853_r268y9s4w","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:15:27.336Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203326853_r268y9s4w","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:15:27.343Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203326853_r268y9s4w","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:15:27.371Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203326853_r268y9s4w","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:15:27.399Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203326853_r268y9s4w","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:15:27.405Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203326853_r268y9s4w","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:15:27.410Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203326853_r268y9s4w","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:15:27.422Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203326853_r268y9s4w","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:15:27.430Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203326853_r268y9s4w","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:15:27.436Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203326853_r268y9s4w","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:15:27.443Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203326853_r268y9s4w","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:15:27.449Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203326853_r268y9s4w","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:15:27.459Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203326853_r268y9s4w","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:15:27.468Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203326853_r268y9s4w","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:15:27.474Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203326853_r268y9s4w","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:15:27.480Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203326853_r268y9s4w","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:15:27.486Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203326853_r268y9s4w","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:15:27.516Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203326853_r268y9s4w","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:15:27.522Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203326853_r268y9s4w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:27.529Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203326853_r268y9s4w","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:27.568Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203326853_r268y9s4w","bodySize":203398,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:15:27.575Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":203398,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:15:27.583Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":203398,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:15:27.589Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":203398,"expectedSize":203398}}
{"timestamp":"2025-08-26T10:15:27.595Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":203398,"timeout":600000}}
{"timestamp":"2025-08-26T10:15:27.603Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:15:27.609Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:15:34.797Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203326853_r268y9s4w","requestSize":203398,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:15:34.805Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203326853_r268y9s4w","duration":8,"requestSize":203398,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:15:34.811Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":959,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:15:34.864Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203326853_r268y9s4w","totalTime":8011,"layerTimings":{"router":110,"transformer":312,"protocol":71,"serverCompatibility":139,"server":7292,"responseTransform":37},"transformationCount":4}}
{"timestamp":"2025-08-26T10:15:34.908Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203326853_r268y9s4w","executionId":"req_1756203326853_r268y9s4w","totalTime":8011,"success":true}}
{"timestamp":"2025-08-26T10:15:35.138Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:15:35.145Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:15:35.151Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:15:35.158Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:15:35.165Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:15:35.177Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:15:35.184Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203335184_zk40k94ob","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:15:35.255Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:15:35.261Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203335184_zk40k94ob","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:15:35.268Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:15:35.274Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:15:35.280Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":44,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":45,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",45]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:15:35.285Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203335184_zk40k94ob","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:15:35.323Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203335184_zk40k94ob","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:15:35.601Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203335184_zk40k94ob","hasOutput":true}}
{"timestamp":"2025-08-26T10:15:35.607Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203335184_zk40k94ob","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:15:35.636Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203335184_zk40k94ob","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:15:35.643Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203335184_zk40k94ob","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:35.649Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203335184_zk40k94ob","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:35.678Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203335184_zk40k94ob","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:15:35.685Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203335184_zk40k94ob","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:15:35.691Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203335184_zk40k94ob","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:15:35.720Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203335184_zk40k94ob","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:15:35.750Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203335184_zk40k94ob","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:15:35.758Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203335184_zk40k94ob","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:15:35.764Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203335184_zk40k94ob","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:15:35.771Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203335184_zk40k94ob","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:15:35.785Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203335184_zk40k94ob","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:15:35.813Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203335184_zk40k94ob","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:15:35.821Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203335184_zk40k94ob","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:35.828Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203335184_zk40k94ob","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:15:35.866Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203335184_zk40k94ob","bodySize":205213,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:15:35.874Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":205213,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:15:35.880Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":205213,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:15:35.886Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":205213,"expectedSize":205213}}
{"timestamp":"2025-08-26T10:15:35.892Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":205213,"timeout":600000}}
{"timestamp":"2025-08-26T10:15:35.901Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:15:35.908Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:16:03.458Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203335184_zk40k94ob","requestSize":205213,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:16:03.503Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203335184_zk40k94ob","duration":45,"requestSize":205213,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:16:03.510Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":3503,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:16:03.545Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203335184_zk40k94ob","totalTime":28361,"layerTimings":{"router":107,"transformer":338,"protocol":65,"serverCompatibility":87,"server":27694,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:16:03.588Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203335184_zk40k94ob","executionId":"req_1756203335184_zk40k94ob","totalTime":28361,"success":true}}
{"timestamp":"2025-08-26T10:16:03.611Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:16:03.618Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:16:03.624Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:16:03.630Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:16:03.637Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:16:03.649Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:16:03.656Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203363656_8x341e9kb","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:16:03.725Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:16:03.732Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203363656_8x341e9kb","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:16:03.738Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:16:03.744Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:16:03.750Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":45,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":46,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",46]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:16:03.756Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203363656_8x341e9kb","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:16:03.793Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203363656_8x341e9kb","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:16:04.080Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203363656_8x341e9kb","hasOutput":true}}
{"timestamp":"2025-08-26T10:16:04.086Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203363656_8x341e9kb","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:16:04.115Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203363656_8x341e9kb","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:16:04.122Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203363656_8x341e9kb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:04.128Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203363656_8x341e9kb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:04.156Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203363656_8x341e9kb","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:16:04.162Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203363656_8x341e9kb","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:16:04.169Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203363656_8x341e9kb","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:16:04.196Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203363656_8x341e9kb","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:16:04.224Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203363656_8x341e9kb","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:16:04.230Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203363656_8x341e9kb","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:16:04.237Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203363656_8x341e9kb","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:16:04.244Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203363656_8x341e9kb","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:16:04.259Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203363656_8x341e9kb","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:16:04.289Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203363656_8x341e9kb","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:16:04.296Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203363656_8x341e9kb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:04.302Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203363656_8x341e9kb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:04.344Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203363656_8x341e9kb","bodySize":205214,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:16:04.352Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":205214,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:16:04.360Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":205214,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:16:04.367Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":205214,"expectedSize":205214}}
{"timestamp":"2025-08-26T10:16:04.374Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":205214,"timeout":600000}}
{"timestamp":"2025-08-26T10:16:04.384Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:16:04.391Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:16:20.598Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203363656_8x341e9kb","requestSize":205214,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:16:20.606Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203363656_8x341e9kb","duration":8,"requestSize":205214,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:16:20.613Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":2832,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:16:20.646Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203363656_8x341e9kb","totalTime":16990,"layerTimings":{"router":106,"transformer":346,"protocol":62,"serverCompatibility":87,"server":16320,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:16:20.691Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203363656_8x341e9kb","executionId":"req_1756203363656_8x341e9kb","totalTime":16990,"success":true}}
{"timestamp":"2025-08-26T10:16:20.923Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:16:20.930Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:16:20.936Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:16:20.942Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:16:20.948Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:16:20.962Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:16:20.969Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203380969_d6q3dx15l","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:16:21.042Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:16:21.048Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203380969_d6q3dx15l","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:16:21.054Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:16:21.060Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:16:21.066Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":46,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":47,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",47]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:16:21.072Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203380969_d6q3dx15l","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:16:21.109Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203380969_d6q3dx15l","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:16:21.403Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203380969_d6q3dx15l","hasOutput":true}}
{"timestamp":"2025-08-26T10:16:21.409Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203380969_d6q3dx15l","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:16:21.438Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203380969_d6q3dx15l","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:16:21.445Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203380969_d6q3dx15l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:21.453Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203380969_d6q3dx15l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:21.481Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203380969_d6q3dx15l","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:16:21.488Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203380969_d6q3dx15l","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:16:21.495Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203380969_d6q3dx15l","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:16:21.501Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203380969_d6q3dx15l","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:16:21.530Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203380969_d6q3dx15l","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:16:21.558Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203380969_d6q3dx15l","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:16:21.566Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203380969_d6q3dx15l","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:16:21.572Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203380969_d6q3dx15l","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:16:21.584Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203380969_d6q3dx15l","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:16:21.592Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203380969_d6q3dx15l","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:16:21.599Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203380969_d6q3dx15l","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:16:21.604Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203380969_d6q3dx15l","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:16:21.610Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203380969_d6q3dx15l","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:16:21.620Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203380969_d6q3dx15l","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:16:21.629Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203380969_d6q3dx15l","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:16:21.635Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203380969_d6q3dx15l","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:16:21.640Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203380969_d6q3dx15l","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:16:21.646Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203380969_d6q3dx15l","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:16:21.674Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203380969_d6q3dx15l","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:16:21.681Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203380969_d6q3dx15l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:21.687Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203380969_d6q3dx15l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:21.725Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203380969_d6q3dx15l","bodySize":209843,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:16:21.733Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":209843,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:16:21.740Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":209843,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:16:21.746Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":209843,"expectedSize":209843}}
{"timestamp":"2025-08-26T10:16:21.752Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":209843,"timeout":600000}}
{"timestamp":"2025-08-26T10:16:21.760Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:16:21.765Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:16:29.769Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203380969_d6q3dx15l","requestSize":209843,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:16:29.777Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203380969_d6q3dx15l","duration":8,"requestSize":209843,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:16:29.784Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":868,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:16:29.818Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203380969_d6q3dx15l","totalTime":8849,"layerTimings":{"router":110,"transformer":352,"protocol":71,"serverCompatibility":137,"server":8109,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:16:29.863Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203380969_d6q3dx15l","executionId":"req_1756203380969_d6q3dx15l","totalTime":8849,"success":true}}
{"timestamp":"2025-08-26T10:16:29.886Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:16:29.892Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:16:29.899Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:16:29.905Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:16:29.911Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:16:29.924Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:16:29.931Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203389931_rqq5fkkzw","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:16:30.002Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:16:30.009Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203389931_rqq5fkkzw","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:16:30.015Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:16:30.021Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:16:30.027Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":47,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":48,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",48]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:16:30.034Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203389931_rqq5fkkzw","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:16:30.071Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203389931_rqq5fkkzw","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:16:30.380Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203389931_rqq5fkkzw","hasOutput":true}}
{"timestamp":"2025-08-26T10:16:30.386Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203389931_rqq5fkkzw","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:16:30.415Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203389931_rqq5fkkzw","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:16:30.422Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203389931_rqq5fkkzw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:30.428Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203389931_rqq5fkkzw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:30.457Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203389931_rqq5fkkzw","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:16:30.463Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203389931_rqq5fkkzw","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:16:30.470Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203389931_rqq5fkkzw","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:16:30.500Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203389931_rqq5fkkzw","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:16:30.529Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203389931_rqq5fkkzw","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:16:30.537Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203389931_rqq5fkkzw","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:16:30.544Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203389931_rqq5fkkzw","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:16:30.552Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203389931_rqq5fkkzw","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:16:30.567Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203389931_rqq5fkkzw","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:16:30.598Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203389931_rqq5fkkzw","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:16:30.606Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203389931_rqq5fkkzw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:30.613Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203389931_rqq5fkkzw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:16:30.652Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203389931_rqq5fkkzw","bodySize":209841,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:16:30.660Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":209841,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:16:30.667Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":209841,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:16:30.674Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":209841,"expectedSize":209841}}
{"timestamp":"2025-08-26T10:16:30.680Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":209841,"timeout":600000}}
{"timestamp":"2025-08-26T10:16:30.689Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:16:30.696Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:17:00.254Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203389931_rqq5fkkzw","requestSize":209841,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:17:00.263Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203389931_rqq5fkkzw","duration":9,"requestSize":209841,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:17:00.269Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1716,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:17:00.307Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203389931_rqq5fkkzw","totalTime":30376,"layerTimings":{"router":110,"transformer":368,"protocol":66,"serverCompatibility":92,"server":29667,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:17:00.354Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203389931_rqq5fkkzw","executionId":"req_1756203389931_rqq5fkkzw","totalTime":30376,"success":true}}
{"timestamp":"2025-08-26T10:17:00.641Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:17:00.649Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:17:00.655Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:17:00.662Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:17:00.668Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:17:00.682Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:17:00.690Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203420690_auz2c7vqy","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:17:00.763Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:00.770Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203420690_auz2c7vqy","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:17:00.777Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:17:00.784Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:17:00.791Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":48,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":49,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",49]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:17:00.797Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203420690_auz2c7vqy","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:17:00.835Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203420690_auz2c7vqy","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:17:01.161Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203420690_auz2c7vqy","hasOutput":true}}
{"timestamp":"2025-08-26T10:17:01.168Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203420690_auz2c7vqy","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:17:01.197Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203420690_auz2c7vqy","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:17:01.204Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203420690_auz2c7vqy","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:01.212Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203420690_auz2c7vqy","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:01.244Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203420690_auz2c7vqy","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:17:01.252Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203420690_auz2c7vqy","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:17:01.259Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203420690_auz2c7vqy","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:17:01.288Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203420690_auz2c7vqy","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:17:01.319Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203420690_auz2c7vqy","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:17:01.326Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203420690_auz2c7vqy","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:17:01.333Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203420690_auz2c7vqy","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:01.341Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203420690_auz2c7vqy","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:17:01.357Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203420690_auz2c7vqy","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:17:01.388Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203420690_auz2c7vqy","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:17:01.395Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203420690_auz2c7vqy","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:01.401Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203420690_auz2c7vqy","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:01.440Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203420690_auz2c7vqy","bodySize":211773,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:17:01.448Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":211773,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:17:01.455Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":211773,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:17:01.461Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":211773,"expectedSize":211773}}
{"timestamp":"2025-08-26T10:17:01.468Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":211773,"timeout":600000}}
{"timestamp":"2025-08-26T10:17:01.478Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:17:01.485Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:17:08.592Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203420690_auz2c7vqy","requestSize":211773,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:17:08.602Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203420690_auz2c7vqy","duration":10,"requestSize":211773,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:17:08.608Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1039,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:17:08.643Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203420690_auz2c7vqy","totalTime":7953,"layerTimings":{"router":116,"transformer":385,"protocol":68,"serverCompatibility":93,"server":7217,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T10:17:08.688Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203420690_auz2c7vqy","executionId":"req_1756203420690_auz2c7vqy","totalTime":7953,"success":true}}
{"timestamp":"2025-08-26T10:17:08.710Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:17:08.717Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:17:08.723Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:17:08.729Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:17:08.735Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:17:08.747Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:17:08.755Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203428755_57crkflg8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:17:08.825Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:08.832Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203428755_57crkflg8","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:17:08.838Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:17:08.844Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:17:08.851Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":49,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":50,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",50]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:17:08.857Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203428755_57crkflg8","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:17:08.895Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203428755_57crkflg8","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:17:09.249Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203428755_57crkflg8","hasOutput":true}}
{"timestamp":"2025-08-26T10:17:09.256Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203428755_57crkflg8","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:17:09.286Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203428755_57crkflg8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:17:09.293Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203428755_57crkflg8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:09.300Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203428755_57crkflg8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:09.329Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203428755_57crkflg8","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:17:09.336Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203428755_57crkflg8","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:17:09.342Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203428755_57crkflg8","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:17:09.349Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203428755_57crkflg8","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:17:09.377Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203428755_57crkflg8","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:17:09.407Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203428755_57crkflg8","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:17:09.414Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203428755_57crkflg8","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:17:09.421Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203428755_57crkflg8","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:09.434Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203428755_57crkflg8","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:17:09.443Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203428755_57crkflg8","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:17:09.450Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203428755_57crkflg8","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:09.456Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203428755_57crkflg8","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:17:09.463Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203428755_57crkflg8","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:09.473Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203428755_57crkflg8","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:17:09.483Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203428755_57crkflg8","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:17:09.489Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203428755_57crkflg8","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:17:09.495Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203428755_57crkflg8","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:09.502Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203428755_57crkflg8","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:17:09.530Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203428755_57crkflg8","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:17:09.537Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203428755_57crkflg8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:09.544Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203428755_57crkflg8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:09.583Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203428755_57crkflg8","bodySize":211774,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:17:09.591Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":211774,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:17:09.597Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":211774,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:17:09.603Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":211774,"expectedSize":211774}}
{"timestamp":"2025-08-26T10:17:09.609Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":211774,"timeout":600000}}
{"timestamp":"2025-08-26T10:17:09.618Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:17:09.624Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:17:17.568Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203428755_57crkflg8","requestSize":211774,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:17:17.576Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203428755_57crkflg8","duration":8,"requestSize":211774,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:17:17.583Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":957,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:17:17.639Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203428755_57crkflg8","totalTime":8884,"layerTimings":{"router":111,"transformer":414,"protocol":71,"serverCompatibility":146,"server":8050,"responseTransform":38},"transformationCount":4}}
{"timestamp":"2025-08-26T10:17:17.685Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203428755_57crkflg8","executionId":"req_1756203428755_57crkflg8","totalTime":8884,"success":true}}
{"timestamp":"2025-08-26T10:17:17.910Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:17:17.917Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:17:17.923Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:17:17.930Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:17:17.936Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:17:17.949Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:17:17.957Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203437957_bt7smggu9","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:17:18.028Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:18.034Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203437957_bt7smggu9","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:17:18.041Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:17:18.047Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:17:18.053Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":50,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":51,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",51]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:17:18.060Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203437957_bt7smggu9","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:17:18.097Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203437957_bt7smggu9","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:17:18.437Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203437957_bt7smggu9","hasOutput":true}}
{"timestamp":"2025-08-26T10:17:18.443Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203437957_bt7smggu9","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:17:18.473Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203437957_bt7smggu9","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:17:18.479Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203437957_bt7smggu9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:18.486Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203437957_bt7smggu9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:18.516Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203437957_bt7smggu9","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:17:18.522Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203437957_bt7smggu9","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:17:18.530Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203437957_bt7smggu9","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:17:18.560Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203437957_bt7smggu9","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:17:18.591Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203437957_bt7smggu9","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:17:18.598Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203437957_bt7smggu9","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:17:18.604Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203437957_bt7smggu9","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:18.612Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203437957_bt7smggu9","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:17:18.630Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203437957_bt7smggu9","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:17:18.661Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203437957_bt7smggu9","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:17:18.668Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203437957_bt7smggu9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:18.674Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203437957_bt7smggu9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:18.712Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203437957_bt7smggu9","bodySize":213585,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:17:18.720Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":213585,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:17:18.726Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":213585,"chunkSize":16384,"estimatedChunks":14}}
{"timestamp":"2025-08-26T10:17:18.733Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":213585,"expectedSize":213585}}
{"timestamp":"2025-08-26T10:17:18.739Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":213585,"timeout":600000}}
{"timestamp":"2025-08-26T10:17:18.749Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:17:18.755Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:17:50.414Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203437957_bt7smggu9","requestSize":213585,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:17:50.422Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203437957_bt7smggu9","duration":8,"requestSize":213585,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:17:50.429Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":852,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:17:50.461Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203437957_bt7smggu9","totalTime":32504,"layerTimings":{"router":110,"transformer":399,"protocol":67,"serverCompatibility":95,"server":31765,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:17:50.507Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203437957_bt7smggu9","executionId":"req_1756203437957_bt7smggu9","totalTime":32504,"success":true}}
{"timestamp":"2025-08-26T10:17:50.530Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:17:50.537Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:17:50.542Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:17:50.548Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:17:50.554Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:17:50.567Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:17:50.575Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203470575_ljzkrno8l","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:17:50.651Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:50.659Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203470575_ljzkrno8l","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:17:50.665Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:17:50.672Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:17:50.679Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":51,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":52,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",52]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:17:50.686Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203470575_ljzkrno8l","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:17:50.724Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203470575_ljzkrno8l","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:17:51.072Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203470575_ljzkrno8l","hasOutput":true}}
{"timestamp":"2025-08-26T10:17:51.078Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203470575_ljzkrno8l","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:17:51.108Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203470575_ljzkrno8l","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:17:51.115Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203470575_ljzkrno8l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:51.122Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203470575_ljzkrno8l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:51.152Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203470575_ljzkrno8l","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:17:51.159Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203470575_ljzkrno8l","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:17:51.166Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203470575_ljzkrno8l","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:17:51.196Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203470575_ljzkrno8l","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:17:51.226Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203470575_ljzkrno8l","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:17:51.233Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203470575_ljzkrno8l","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:17:51.239Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203470575_ljzkrno8l","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:17:51.247Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203470575_ljzkrno8l","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:17:51.263Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203470575_ljzkrno8l","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:17:51.293Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203470575_ljzkrno8l","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:17:51.300Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203470575_ljzkrno8l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:51.307Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203470575_ljzkrno8l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:17:51.347Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203470575_ljzkrno8l","bodySize":213586,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:17:51.355Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":213586,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:17:51.362Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":213586,"chunkSize":16384,"estimatedChunks":14}}
{"timestamp":"2025-08-26T10:17:51.368Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":213586,"expectedSize":213586}}
{"timestamp":"2025-08-26T10:17:51.375Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":213586,"timeout":600000}}
{"timestamp":"2025-08-26T10:17:51.385Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:17:51.392Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:18:03.731Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203470575_ljzkrno8l","requestSize":213586,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:18:03.740Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203470575_ljzkrno8l","duration":9,"requestSize":213586,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:18:03.747Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1211,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:18:03.782Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203470575_ljzkrno8l","totalTime":13207,"layerTimings":{"router":119,"transformer":407,"protocol":68,"serverCompatibility":91,"server":12452,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:18:03.828Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203470575_ljzkrno8l","executionId":"req_1756203470575_ljzkrno8l","totalTime":13207,"success":true}}
{"timestamp":"2025-08-26T10:23:02.972Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:02.978Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:02.985Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:02.991Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:02.996Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:03.010Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:03.017Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203783017_7ronlycw9","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:03.032Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:03.038Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203783017_7ronlycw9","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:03.043Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:03.049Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:03.056Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":52,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":53,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",53]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:03.062Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203783017_7ronlycw9","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:03.085Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203783017_7ronlycw9","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:03.139Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203783017_7ronlycw9","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:03.146Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203783017_7ronlycw9","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:03.162Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203783017_7ronlycw9","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:03.169Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203783017_7ronlycw9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:03.176Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203783017_7ronlycw9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:03.193Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203783017_7ronlycw9","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:23:03.200Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203783017_7ronlycw9","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:23:03.206Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203783017_7ronlycw9","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:03.212Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203783017_7ronlycw9","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:23:03.228Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203783017_7ronlycw9","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:03.242Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203783017_7ronlycw9","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:03.249Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203783017_7ronlycw9","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:03.256Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203783017_7ronlycw9","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:03.268Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203783017_7ronlycw9","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:03.277Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:03.283Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:23:03.293Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203783017_7ronlycw9","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:23:03.299Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203783017_7ronlycw9","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:03.305Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203783017_7ronlycw9","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:23:03.312Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203783017_7ronlycw9","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:03.324Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203783017_7ronlycw9","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:23:03.333Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203783017_7ronlycw9","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:23:03.339Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203783017_7ronlycw9","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:23:03.345Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203783017_7ronlycw9","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:03.351Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203783017_7ronlycw9","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:03.364Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203783017_7ronlycw9","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:03.370Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203783017_7ronlycw9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:03.376Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203783017_7ronlycw9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:03.392Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203783017_7ronlycw9","bodySize":25324,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:03.399Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:23:03.406Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25324,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:23:03.411Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25324,"expectedSize":25324}}
{"timestamp":"2025-08-26T10:23:03.417Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25324,"timeout":600000}}
{"timestamp":"2025-08-26T10:23:04.733Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203783017_7ronlycw9","requestSize":25324,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:23:04.742Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203783017_7ronlycw9","duration":9,"requestSize":25324,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:23:04.750Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":452,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:23:04.780Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203783017_7ronlycw9","totalTime":1763,"layerTimings":{"router":53,"transformer":85,"protocol":44,"serverCompatibility":130,"server":1384,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T10:23:04.798Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203783017_7ronlycw9","executionId":"req_1756203783017_7ronlycw9","totalTime":1763,"success":true}}
{"timestamp":"2025-08-26T10:23:04.837Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:04.844Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:04.850Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:04.857Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:04.863Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:04.877Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:04.884Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203784884_dgqderinp","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:04.898Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:04.904Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203784884_dgqderinp","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:04.911Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:04.917Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:04.924Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":53,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":54,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",54]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:04.930Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203784884_dgqderinp","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:04.951Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203784884_dgqderinp","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:05.005Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203784884_dgqderinp","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:05.011Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203784884_dgqderinp","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:05.026Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203784884_dgqderinp","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:05.032Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203784884_dgqderinp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:05.039Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203784884_dgqderinp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:05.053Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203784884_dgqderinp","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:05.060Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203784884_dgqderinp","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:05.066Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203784884_dgqderinp","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:23:05.080Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203784884_dgqderinp","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:05.095Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203784884_dgqderinp","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:05.101Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203784884_dgqderinp","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:05.108Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203784884_dgqderinp","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:05.115Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203784884_dgqderinp","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:05.131Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203784884_dgqderinp","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:05.144Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203784884_dgqderinp","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:05.151Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203784884_dgqderinp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:05.158Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203784884_dgqderinp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:05.175Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203784884_dgqderinp","bodySize":19522,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:05.182Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":19522,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:23:05.189Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19522,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:23:05.196Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19522,"expectedSize":19522}}
{"timestamp":"2025-08-26T10:23:05.202Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":19522,"timeout":600000}}
{"timestamp":"2025-08-26T10:23:05.211Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:05.217Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:23:19.856Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203784884_dgqderinp","requestSize":19522,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:23:19.865Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203784884_dgqderinp","duration":9,"requestSize":19522,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:23:19.873Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":536,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:23:19.903Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203784884_dgqderinp","totalTime":15019,"layerTimings":{"router":53,"transformer":83,"protocol":35,"serverCompatibility":57,"server":14726,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T10:23:19.920Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203784884_dgqderinp","executionId":"req_1756203784884_dgqderinp","totalTime":15019,"success":true}}
{"timestamp":"2025-08-26T10:23:19.935Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:19.942Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:19.948Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:19.954Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:19.961Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:19.974Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:19.982Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203799982_ii7kdqixa","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:19.997Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:20.004Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203799982_ii7kdqixa","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:20.010Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:20.016Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:20.023Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":54,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":55,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",55]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:20.030Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203799982_ii7kdqixa","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:20.051Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203799982_ii7kdqixa","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:20.104Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203799982_ii7kdqixa","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:20.110Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203799982_ii7kdqixa","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:20.124Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203799982_ii7kdqixa","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:20.130Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203799982_ii7kdqixa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:20.137Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203799982_ii7kdqixa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:20.151Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203799982_ii7kdqixa","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:20.158Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203799982_ii7kdqixa","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:20.164Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203799982_ii7kdqixa","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:23:20.179Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203799982_ii7kdqixa","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:20.193Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203799982_ii7kdqixa","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:20.200Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203799982_ii7kdqixa","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:20.206Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203799982_ii7kdqixa","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:20.213Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203799982_ii7kdqixa","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:20.228Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203799982_ii7kdqixa","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:20.240Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203799982_ii7kdqixa","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:20.247Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203799982_ii7kdqixa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:20.253Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203799982_ii7kdqixa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:20.270Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203799982_ii7kdqixa","bodySize":19423,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:20.278Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19423,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:23:20.286Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19423,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:23:20.293Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19423,"expectedSize":19423}}
{"timestamp":"2025-08-26T10:23:20.299Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19423,"timeout":600000}}
{"timestamp":"2025-08-26T10:23:20.307Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:20.312Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:23:21.318Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203799982_ii7kdqixa","requestSize":19423,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:23:21.327Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203799982_ii7kdqixa","duration":9,"requestSize":19423,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:23:21.334Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":496,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:23:21.364Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203799982_ii7kdqixa","totalTime":1382,"layerTimings":{"router":55,"transformer":81,"protocol":36,"serverCompatibility":55,"server":1090,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T10:23:21.381Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203799982_ii7kdqixa","executionId":"req_1756203799982_ii7kdqixa","totalTime":1382,"success":true}}
{"timestamp":"2025-08-26T10:23:21.397Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:21.404Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:21.410Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:21.417Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:21.423Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:21.437Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:21.445Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203801445_fmlnttsj0","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:21.460Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:21.467Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203801445_fmlnttsj0","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:21.474Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:21.480Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:21.487Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":55,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":56,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",56]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:21.493Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203801445_fmlnttsj0","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:21.514Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203801445_fmlnttsj0","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:21.569Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203801445_fmlnttsj0","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:21.575Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203801445_fmlnttsj0","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:21.589Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203801445_fmlnttsj0","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:21.596Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203801445_fmlnttsj0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:21.602Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203801445_fmlnttsj0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:21.618Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203801445_fmlnttsj0","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:23:21.624Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203801445_fmlnttsj0","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:23:21.630Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203801445_fmlnttsj0","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:21.637Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203801445_fmlnttsj0","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:23:21.650Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203801445_fmlnttsj0","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:21.662Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203801445_fmlnttsj0","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:21.668Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203801445_fmlnttsj0","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:21.674Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203801445_fmlnttsj0","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:21.686Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203801445_fmlnttsj0","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:21.695Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203801445_fmlnttsj0","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:23:21.702Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203801445_fmlnttsj0","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:21.709Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203801445_fmlnttsj0","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:23:21.715Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203801445_fmlnttsj0","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:21.726Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203801445_fmlnttsj0","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:23:21.735Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203801445_fmlnttsj0","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:23:21.741Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203801445_fmlnttsj0","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:23:21.748Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203801445_fmlnttsj0","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:21.754Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203801445_fmlnttsj0","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:21.768Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203801445_fmlnttsj0","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:21.774Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203801445_fmlnttsj0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:21.781Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203801445_fmlnttsj0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:21.798Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203801445_fmlnttsj0","bodySize":24956,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:21.804Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":24956,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:23:21.810Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":24956,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:23:21.816Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":24956,"expectedSize":24956}}
{"timestamp":"2025-08-26T10:23:21.822Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":24956,"timeout":600000}}
{"timestamp":"2025-08-26T10:23:21.831Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:21.837Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:23:23.378Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203801445_fmlnttsj0","requestSize":24956,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:23:23.388Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203801445_fmlnttsj0","duration":10,"requestSize":24956,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:23:23.394Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":447,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:23:23.424Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203801445_fmlnttsj0","totalTime":1979,"layerTimings":{"router":55,"transformer":82,"protocol":41,"serverCompatibility":113,"server":1623,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T10:23:23.441Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203801445_fmlnttsj0","executionId":"req_1756203801445_fmlnttsj0","totalTime":1979,"success":true}}
{"timestamp":"2025-08-26T10:23:23.465Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:23.472Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:23.479Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:23.484Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:23.490Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:23.505Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:23.513Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203803513_9si3wuuwz","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:23.528Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:23.535Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203803513_9si3wuuwz","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:23.541Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:23.548Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:23.554Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":56,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":57,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",57]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:23.563Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203803513_9si3wuuwz","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:23.584Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203803513_9si3wuuwz","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:23.656Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203803513_9si3wuuwz","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:23.662Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203803513_9si3wuuwz","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:23.674Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203803513_9si3wuuwz","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:23.681Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203803513_9si3wuuwz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:23.687Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203803513_9si3wuuwz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:23.699Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203803513_9si3wuuwz","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:23.705Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203803513_9si3wuuwz","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:23.711Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203803513_9si3wuuwz","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:23:23.723Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203803513_9si3wuuwz","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:23.736Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203803513_9si3wuuwz","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:23.742Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203803513_9si3wuuwz","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:23.748Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203803513_9si3wuuwz","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:23.754Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203803513_9si3wuuwz","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:23.769Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203803513_9si3wuuwz","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:23.784Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203803513_9si3wuuwz","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:23.790Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203803513_9si3wuuwz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:23.797Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203803513_9si3wuuwz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:23.815Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203803513_9si3wuuwz","bodySize":18400,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:23.821Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":18400,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:23:23.828Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":18400,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:23:23.834Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":18400,"expectedSize":18400}}
{"timestamp":"2025-08-26T10:23:23.841Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":18400,"timeout":600000}}
{"timestamp":"2025-08-26T10:23:23.850Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:23.856Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:23:35.364Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203803513_9si3wuuwz","requestSize":18400,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:23:35.373Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203803513_9si3wuuwz","duration":9,"requestSize":18400,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:23:35.380Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":536,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:23:35.410Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203803513_9si3wuuwz","totalTime":11897,"layerTimings":{"router":56,"transformer":98,"protocol":31,"serverCompatibility":55,"server":11593,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T10:23:35.427Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203803513_9si3wuuwz","executionId":"req_1756203803513_9si3wuuwz","totalTime":11897,"success":true}}
{"timestamp":"2025-08-26T10:23:35.442Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:35.448Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:35.454Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:35.460Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:35.465Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:35.480Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:35.487Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203815487_762s8mjak","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:35.502Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:35.509Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203815487_762s8mjak","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:35.515Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:35.521Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:35.528Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":57,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":58,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",58]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:35.535Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203815487_762s8mjak","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:35.558Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203815487_762s8mjak","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:35.613Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203815487_762s8mjak","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:35.619Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203815487_762s8mjak","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:35.632Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203815487_762s8mjak","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:35.639Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203815487_762s8mjak","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:35.645Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203815487_762s8mjak","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:35.659Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203815487_762s8mjak","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:35.666Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203815487_762s8mjak","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:35.672Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203815487_762s8mjak","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:23:35.687Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203815487_762s8mjak","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:35.702Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203815487_762s8mjak","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:35.708Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203815487_762s8mjak","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:35.714Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203815487_762s8mjak","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:35.722Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203815487_762s8mjak","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:35.737Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203815487_762s8mjak","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:35.752Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203815487_762s8mjak","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:35.758Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203815487_762s8mjak","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:35.765Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203815487_762s8mjak","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:35.784Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203815487_762s8mjak","bodySize":28153,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:35.791Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":28153,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:23:35.798Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":28153,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:23:35.804Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":28153,"expectedSize":28153}}
{"timestamp":"2025-08-26T10:23:35.809Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":28153,"timeout":600000}}
{"timestamp":"2025-08-26T10:23:35.818Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:35.824Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:23:37.022Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203815487_762s8mjak","requestSize":28153,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:23:37.030Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203815487_762s8mjak","duration":8,"requestSize":28153,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:23:37.036Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":498,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:23:37.066Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203815487_762s8mjak","totalTime":1579,"layerTimings":{"router":55,"transformer":83,"protocol":36,"serverCompatibility":58,"server":1279,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:23:37.084Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203815487_762s8mjak","executionId":"req_1756203815487_762s8mjak","totalTime":1579,"success":true}}
{"timestamp":"2025-08-26T10:23:37.099Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:37.106Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:37.112Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:37.118Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:37.125Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:37.144Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:37.152Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203817152_9uba98jdj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:37.166Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:37.172Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203817152_9uba98jdj","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:37.177Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:37.183Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:37.189Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":58,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":59,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",59]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:37.195Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203817152_9uba98jdj","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:37.215Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203817152_9uba98jdj","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:37.270Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203817152_9uba98jdj","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:37.277Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203817152_9uba98jdj","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:37.291Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203817152_9uba98jdj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:37.298Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203817152_9uba98jdj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:37.303Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203817152_9uba98jdj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:37.318Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203817152_9uba98jdj","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:23:37.324Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203817152_9uba98jdj","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:23:37.330Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203817152_9uba98jdj","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:37.337Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203817152_9uba98jdj","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:23:37.350Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203817152_9uba98jdj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:37.364Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203817152_9uba98jdj","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:37.370Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203817152_9uba98jdj","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:37.376Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203817152_9uba98jdj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:37.388Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203817152_9uba98jdj","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:37.397Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203817152_9uba98jdj","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:23:37.404Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203817152_9uba98jdj","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:37.410Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203817152_9uba98jdj","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:23:37.417Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203817152_9uba98jdj","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:37.428Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203817152_9uba98jdj","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:23:37.437Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203817152_9uba98jdj","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:23:37.443Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203817152_9uba98jdj","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:23:37.449Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203817152_9uba98jdj","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:37.456Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203817152_9uba98jdj","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:37.470Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203817152_9uba98jdj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:37.476Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203817152_9uba98jdj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:37.482Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203817152_9uba98jdj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:37.501Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203817152_9uba98jdj","bodySize":26427,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:37.508Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":26427,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:23:37.515Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":26427,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:23:37.521Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":26427,"expectedSize":26427}}
{"timestamp":"2025-08-26T10:23:37.528Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":26427,"timeout":600000}}
{"timestamp":"2025-08-26T10:23:37.537Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:37.543Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:23:39.002Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203817152_9uba98jdj","requestSize":26427,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:23:39.012Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203817152_9uba98jdj","duration":10,"requestSize":26427,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:23:39.019Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":419,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:23:39.047Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203817152_9uba98jdj","totalTime":1895,"layerTimings":{"router":49,"transformer":84,"protocol":41,"serverCompatibility":114,"server":1545,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T10:23:39.066Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203817152_9uba98jdj","executionId":"req_1756203817152_9uba98jdj","totalTime":1895,"success":true}}
{"timestamp":"2025-08-26T10:23:39.080Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:39.087Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:39.093Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:39.099Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:39.106Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:39.121Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:39.129Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203819129_7i1wnxvcb","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:39.144Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:39.151Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203819129_7i1wnxvcb","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:39.157Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:39.163Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:39.170Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":59,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":60,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",60]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:39.177Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203819129_7i1wnxvcb","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:39.201Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203819129_7i1wnxvcb","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:39.259Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203819129_7i1wnxvcb","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:39.266Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203819129_7i1wnxvcb","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:39.281Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203819129_7i1wnxvcb","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:39.288Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203819129_7i1wnxvcb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:39.294Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203819129_7i1wnxvcb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:39.309Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203819129_7i1wnxvcb","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:39.316Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203819129_7i1wnxvcb","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:39.322Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203819129_7i1wnxvcb","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:23:39.337Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203819129_7i1wnxvcb","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:39.352Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203819129_7i1wnxvcb","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:39.358Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203819129_7i1wnxvcb","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:39.365Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203819129_7i1wnxvcb","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:39.373Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203819129_7i1wnxvcb","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:39.389Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203819129_7i1wnxvcb","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:39.401Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203819129_7i1wnxvcb","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:39.407Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203819129_7i1wnxvcb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:39.413Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203819129_7i1wnxvcb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:39.429Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203819129_7i1wnxvcb","bodySize":25952,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:39.435Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":25952,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:23:39.441Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25952,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:23:39.448Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25952,"expectedSize":25952}}
{"timestamp":"2025-08-26T10:23:39.454Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":25952,"timeout":600000}}
{"timestamp":"2025-08-26T10:23:39.465Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:39.471Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:23:50.794Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203819129_7i1wnxvcb","requestSize":25952,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:23:50.802Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203819129_7i1wnxvcb","duration":8,"requestSize":25952,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:23:50.808Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":536,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:23:50.840Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203819129_7i1wnxvcb","totalTime":11711,"layerTimings":{"router":57,"transformer":89,"protocol":36,"serverCompatibility":58,"server":11406,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:23:50.859Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203819129_7i1wnxvcb","executionId":"req_1756203819129_7i1wnxvcb","totalTime":11711,"success":true}}
{"timestamp":"2025-08-26T10:23:50.874Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:50.881Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:50.887Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:50.894Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:50.901Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:50.916Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:50.923Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203830923_i6lulbotx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:50.939Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:50.946Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203830923_i6lulbotx","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:50.953Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:50.960Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:50.966Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":60,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":61,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",61]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:50.972Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203830923_i6lulbotx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:50.993Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203830923_i6lulbotx","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:51.080Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203830923_i6lulbotx","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:51.088Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203830923_i6lulbotx","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:51.103Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203830923_i6lulbotx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:51.110Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203830923_i6lulbotx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:51.117Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203830923_i6lulbotx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:51.134Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203830923_i6lulbotx","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:51.141Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203830923_i6lulbotx","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:51.148Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203830923_i6lulbotx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:23:51.164Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203830923_i6lulbotx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:51.179Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203830923_i6lulbotx","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:51.186Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203830923_i6lulbotx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:51.193Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203830923_i6lulbotx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:51.201Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203830923_i6lulbotx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:51.218Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203830923_i6lulbotx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:51.234Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203830923_i6lulbotx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:51.241Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203830923_i6lulbotx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:51.247Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203830923_i6lulbotx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:51.267Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203830923_i6lulbotx","bodySize":34693,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:51.275Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":34693,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:23:51.282Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":34693,"chunkSize":16384,"estimatedChunks":3}}
{"timestamp":"2025-08-26T10:23:51.289Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":34693,"expectedSize":34693}}
{"timestamp":"2025-08-26T10:23:51.296Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":34693,"timeout":600000}}
{"timestamp":"2025-08-26T10:23:51.306Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:51.313Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:23:53.292Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203830923_i6lulbotx","requestSize":34693,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:23:53.299Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203830923_i6lulbotx","duration":7,"requestSize":34693,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:23:53.305Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":496,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:23:53.333Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203830923_i6lulbotx","totalTime":2410,"layerTimings":{"router":55,"transformer":118,"protocol":39,"serverCompatibility":63,"server":2066,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T10:23:53.352Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203830923_i6lulbotx","executionId":"req_1756203830923_i6lulbotx","totalTime":2410,"success":true}}
{"timestamp":"2025-08-26T10:23:53.365Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:53.371Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:53.378Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:53.384Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:53.391Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:53.406Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:53.414Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203833414_cvkxddqxa","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:53.429Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:53.435Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203833414_cvkxddqxa","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:53.442Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:53.448Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:53.455Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":61,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":62,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",62]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:53.462Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203833414_cvkxddqxa","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:53.485Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203833414_cvkxddqxa","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:53.544Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203833414_cvkxddqxa","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:53.550Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203833414_cvkxddqxa","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:53.564Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203833414_cvkxddqxa","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:53.571Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203833414_cvkxddqxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:53.578Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203833414_cvkxddqxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:53.593Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203833414_cvkxddqxa","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:23:53.599Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203833414_cvkxddqxa","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:23:53.605Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203833414_cvkxddqxa","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:53.611Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203833414_cvkxddqxa","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:23:53.625Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203833414_cvkxddqxa","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:53.640Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203833414_cvkxddqxa","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:53.647Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203833414_cvkxddqxa","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:53.654Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203833414_cvkxddqxa","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:53.670Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203833414_cvkxddqxa","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:53.680Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203833414_cvkxddqxa","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:23:53.686Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203833414_cvkxddqxa","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:53.692Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203833414_cvkxddqxa","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:23:53.698Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203833414_cvkxddqxa","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:53.709Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203833414_cvkxddqxa","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:23:53.718Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203833414_cvkxddqxa","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:23:53.725Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203833414_cvkxddqxa","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:23:53.732Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203833414_cvkxddqxa","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:53.738Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203833414_cvkxddqxa","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:53.750Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203833414_cvkxddqxa","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:53.757Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203833414_cvkxddqxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:53.764Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203833414_cvkxddqxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:53.782Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":7542,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T10:23:53.792Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:53.798Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:23:54.632Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":425,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:23:54.664Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203833414_cvkxddqxa","totalTime":1250,"layerTimings":{"router":57,"transformer":87,"protocol":41,"serverCompatibility":118,"server":878,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:23:54.680Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203833414_cvkxddqxa","executionId":"req_1756203833414_cvkxddqxa","totalTime":1250,"success":true}}
{"timestamp":"2025-08-26T10:23:54.694Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:23:54.700Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:54.707Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:23:54.714Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:23:54.720Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:23:54.736Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:23:54.744Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203834744_rafq8brir","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:23:54.757Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:54.763Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203834744_rafq8brir","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:23:54.769Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:23:54.776Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:23:54.782Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":62,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":63,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",63]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:23:54.788Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203834744_rafq8brir","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:23:54.809Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203834744_rafq8brir","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:23:54.868Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203834744_rafq8brir","hasOutput":true}}
{"timestamp":"2025-08-26T10:23:54.875Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203834744_rafq8brir","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:23:54.889Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203834744_rafq8brir","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:54.895Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203834744_rafq8brir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:54.901Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203834744_rafq8brir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:54.916Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203834744_rafq8brir","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:23:54.921Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203834744_rafq8brir","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:23:54.928Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203834744_rafq8brir","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:23:54.943Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203834744_rafq8brir","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:23:54.958Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203834744_rafq8brir","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:23:54.965Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203834744_rafq8brir","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:23:54.971Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203834744_rafq8brir","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:23:54.980Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203834744_rafq8brir","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:23:54.998Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203834744_rafq8brir","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:23:55.014Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203834744_rafq8brir","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:23:55.021Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203834744_rafq8brir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:55.028Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203834744_rafq8brir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:23:55.046Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":2906,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T10:23:55.056Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:23:55.063Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:05.669Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":533,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:24:05.703Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203834744_rafq8brir","totalTime":10959,"layerTimings":{"router":52,"transformer":87,"protocol":35,"serverCompatibility":64,"server":10653,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:05.718Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203834744_rafq8brir","executionId":"req_1756203834744_rafq8brir","totalTime":10959,"success":true}}
{"timestamp":"2025-08-26T10:24:05.733Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:05.741Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:05.748Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:05.754Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:05.761Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:05.777Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:05.785Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203845785_axzqqs4ic","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:05.800Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:05.806Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203845785_axzqqs4ic","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:05.813Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:05.819Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:05.826Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":63,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":64,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",64]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:05.832Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203845785_axzqqs4ic","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:05.854Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203845785_axzqqs4ic","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:05.918Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203845785_axzqqs4ic","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:05.925Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203845785_axzqqs4ic","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:05.941Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203845785_axzqqs4ic","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:05.947Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203845785_axzqqs4ic","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:05.954Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203845785_axzqqs4ic","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:05.968Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203845785_axzqqs4ic","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:05.974Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203845785_axzqqs4ic","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:05.981Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203845785_axzqqs4ic","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:24:05.995Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203845785_axzqqs4ic","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:06.011Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203845785_axzqqs4ic","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:06.018Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203845785_axzqqs4ic","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:06.025Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203845785_axzqqs4ic","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:06.034Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203845785_axzqqs4ic","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:06.052Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203845785_axzqqs4ic","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:06.068Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203845785_axzqqs4ic","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:06.076Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203845785_axzqqs4ic","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:06.084Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203845785_axzqqs4ic","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:06.102Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203845785_axzqqs4ic","bodySize":40529,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:06.108Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":40529,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:06.115Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":40529,"chunkSize":16384,"estimatedChunks":3}}
{"timestamp":"2025-08-26T10:24:06.121Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":40529,"expectedSize":40529}}
{"timestamp":"2025-08-26T10:24:06.127Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":40529,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:06.135Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:06.141Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:07.597Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203845785_axzqqs4ic","requestSize":40529,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:24:07.605Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203845785_axzqqs4ic","duration":8,"requestSize":40529,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:24:07.611Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":506,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:24:07.644Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203845785_axzqqs4ic","totalTime":1859,"layerTimings":{"router":54,"transformer":96,"protocol":35,"serverCompatibility":66,"server":1538,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:07.666Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203845785_axzqqs4ic","executionId":"req_1756203845785_axzqqs4ic","totalTime":1859,"success":true}}
{"timestamp":"2025-08-26T10:24:07.680Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:07.687Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:07.693Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:07.700Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:07.706Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:07.721Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:07.730Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203847730_x8xfhowtv","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:07.745Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:07.751Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203847730_x8xfhowtv","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:07.758Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:07.764Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:07.771Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":64,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":65,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",65]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:07.778Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203847730_x8xfhowtv","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:07.799Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203847730_x8xfhowtv","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:07.866Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203847730_x8xfhowtv","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:07.873Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203847730_x8xfhowtv","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:07.886Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203847730_x8xfhowtv","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:07.892Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203847730_x8xfhowtv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:07.898Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203847730_x8xfhowtv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:07.917Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203847730_x8xfhowtv","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:24:07.924Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203847730_x8xfhowtv","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:24:07.930Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203847730_x8xfhowtv","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:07.937Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203847730_x8xfhowtv","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:24:07.951Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203847730_x8xfhowtv","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:07.965Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203847730_x8xfhowtv","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:07.971Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203847730_x8xfhowtv","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:07.977Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203847730_x8xfhowtv","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:07.992Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203847730_x8xfhowtv","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:08.001Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:08.008Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:08.016Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203847730_x8xfhowtv","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:24:08.023Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203847730_x8xfhowtv","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:08.029Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203847730_x8xfhowtv","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:24:08.037Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203847730_x8xfhowtv","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:08.047Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203847730_x8xfhowtv","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:24:08.056Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203847730_x8xfhowtv","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:24:08.062Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203847730_x8xfhowtv","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:24:08.068Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203847730_x8xfhowtv","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:08.074Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203847730_x8xfhowtv","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:08.088Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203847730_x8xfhowtv","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:08.095Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203847730_x8xfhowtv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:08.102Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203847730_x8xfhowtv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:08.119Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203847730_x8xfhowtv","bodySize":25117,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:08.126Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25117,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:08.132Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25117,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:24:08.138Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25117,"expectedSize":25117}}
{"timestamp":"2025-08-26T10:24:08.144Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25117,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:09.607Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203847730_x8xfhowtv","requestSize":25117,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:24:09.616Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203847730_x8xfhowtv","duration":9,"requestSize":25117,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:24:09.623Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":461,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:24:09.653Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203847730_x8xfhowtv","totalTime":1923,"layerTimings":{"router":55,"transformer":95,"protocol":42,"serverCompatibility":131,"server":1532,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:09.672Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203847730_x8xfhowtv","executionId":"req_1756203847730_x8xfhowtv","totalTime":1923,"success":true}}
{"timestamp":"2025-08-26T10:24:09.687Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:09.694Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:09.701Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:09.707Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:09.713Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:09.729Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:09.737Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203849737_dys53eqve","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:09.752Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:09.758Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203849737_dys53eqve","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:09.765Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:09.770Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:09.776Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":65,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":66,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",66]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:09.782Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203849737_dys53eqve","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:09.802Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203849737_dys53eqve","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:09.867Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203849737_dys53eqve","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:09.874Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203849737_dys53eqve","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:09.888Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203849737_dys53eqve","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:09.894Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203849737_dys53eqve","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:09.900Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203849737_dys53eqve","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:09.915Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203849737_dys53eqve","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:09.922Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203849737_dys53eqve","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:09.928Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203849737_dys53eqve","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:24:09.943Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203849737_dys53eqve","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:09.958Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203849737_dys53eqve","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:09.965Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203849737_dys53eqve","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:09.971Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203849737_dys53eqve","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:09.979Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203849737_dys53eqve","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:09.996Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203849737_dys53eqve","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:10.012Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203849737_dys53eqve","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:10.018Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203849737_dys53eqve","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:10.025Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203849737_dys53eqve","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:10.042Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203849737_dys53eqve","bodySize":17003,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:10.048Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":17003,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:10.054Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":17003,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:24:10.060Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":17003,"expectedSize":17003}}
{"timestamp":"2025-08-26T10:24:10.066Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":17003,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:10.076Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:10.082Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:20.417Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203849737_dys53eqve","requestSize":17003,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:24:20.424Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203849737_dys53eqve","duration":7,"requestSize":17003,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:24:20.431Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":535,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:24:20.463Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203849737_dys53eqve","totalTime":10726,"layerTimings":{"router":51,"transformer":93,"protocol":36,"serverCompatibility":62,"server":10417,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:20.482Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203849737_dys53eqve","executionId":"req_1756203849737_dys53eqve","totalTime":10726,"success":true}}
{"timestamp":"2025-08-26T10:24:20.496Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:20.503Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:20.510Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:20.516Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:20.523Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:20.539Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:20.547Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203860547_r4yk24g0a","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:20.562Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:20.569Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203860547_r4yk24g0a","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:20.576Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:20.584Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:20.590Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":66,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":67,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",67]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:20.597Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203860547_r4yk24g0a","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:20.620Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203860547_r4yk24g0a","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:20.682Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203860547_r4yk24g0a","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:20.689Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203860547_r4yk24g0a","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:20.704Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203860547_r4yk24g0a","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:20.711Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203860547_r4yk24g0a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:20.718Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203860547_r4yk24g0a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:20.733Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203860547_r4yk24g0a","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:20.740Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203860547_r4yk24g0a","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:20.748Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203860547_r4yk24g0a","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:24:20.764Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203860547_r4yk24g0a","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:20.778Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203860547_r4yk24g0a","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:20.785Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203860547_r4yk24g0a","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:20.790Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203860547_r4yk24g0a","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:20.798Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203860547_r4yk24g0a","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:20.816Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203860547_r4yk24g0a","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:20.830Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203860547_r4yk24g0a","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:20.837Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203860547_r4yk24g0a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:20.843Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203860547_r4yk24g0a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:20.860Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":7896,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T10:24:20.870Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:20.876Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:21.734Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":501,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:24:21.767Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203860547_r4yk24g0a","totalTime":1220,"layerTimings":{"router":59,"transformer":92,"protocol":39,"serverCompatibility":60,"server":902,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:21.785Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203860547_r4yk24g0a","executionId":"req_1756203860547_r4yk24g0a","totalTime":1220,"success":true}}
{"timestamp":"2025-08-26T10:24:21.825Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:21.833Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:21.840Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:21.847Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:21.855Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:21.871Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:21.880Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203861880_4ceaho2us","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:21.896Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:21.902Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203861880_4ceaho2us","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:21.908Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:21.914Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:21.920Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":67,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":68,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",68]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:21.927Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203861880_4ceaho2us","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:21.947Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203861880_4ceaho2us","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:22.016Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203861880_4ceaho2us","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:22.023Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203861880_4ceaho2us","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:22.036Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203861880_4ceaho2us","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:22.042Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203861880_4ceaho2us","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:22.048Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203861880_4ceaho2us","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:22.063Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203861880_4ceaho2us","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:24:22.070Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203861880_4ceaho2us","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:24:22.077Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203861880_4ceaho2us","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:22.084Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203861880_4ceaho2us","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:24:22.098Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203861880_4ceaho2us","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:22.113Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203861880_4ceaho2us","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:22.120Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203861880_4ceaho2us","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:22.126Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203861880_4ceaho2us","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:22.141Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203861880_4ceaho2us","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:22.151Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203861880_4ceaho2us","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:24:22.157Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203861880_4ceaho2us","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:22.163Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203861880_4ceaho2us","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:24:22.170Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203861880_4ceaho2us","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:22.180Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203861880_4ceaho2us","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:24:22.190Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203861880_4ceaho2us","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:24:22.197Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203861880_4ceaho2us","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:24:22.204Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203861880_4ceaho2us","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:22.210Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203861880_4ceaho2us","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:22.226Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203861880_4ceaho2us","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:22.233Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203861880_4ceaho2us","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:22.239Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203861880_4ceaho2us","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:22.257Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203861880_4ceaho2us","bodySize":23447,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:22.264Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":23447,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:22.271Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":23447,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:24:22.278Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":23447,"expectedSize":23447}}
{"timestamp":"2025-08-26T10:24:22.284Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":23447,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:22.293Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:22.299Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:23.638Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203861880_4ceaho2us","requestSize":23447,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:24:23.646Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203861880_4ceaho2us","duration":8,"requestSize":23447,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:24:23.653Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":451,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:24:23.683Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203861880_4ceaho2us","totalTime":1803,"layerTimings":{"router":53,"transformer":96,"protocol":43,"serverCompatibility":121,"server":1424,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:23.701Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203861880_4ceaho2us","executionId":"req_1756203861880_4ceaho2us","totalTime":1803,"success":true}}
{"timestamp":"2025-08-26T10:24:23.715Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:23.722Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:23.729Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:23.736Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:23.742Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:23.759Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:23.768Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203863768_u3l1kzxm5","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:23.783Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:23.789Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203863768_u3l1kzxm5","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:23.796Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:23.802Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:23.809Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":68,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":69,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",69]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:23.815Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203863768_u3l1kzxm5","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:23.835Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203863768_u3l1kzxm5","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:23.898Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203863768_u3l1kzxm5","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:23.904Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203863768_u3l1kzxm5","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:23.917Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203863768_u3l1kzxm5","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:23.923Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203863768_u3l1kzxm5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:23.930Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203863768_u3l1kzxm5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:23.944Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203863768_u3l1kzxm5","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:23.950Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203863768_u3l1kzxm5","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:23.956Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203863768_u3l1kzxm5","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:24:23.970Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203863768_u3l1kzxm5","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:23.985Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203863768_u3l1kzxm5","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:23.992Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203863768_u3l1kzxm5","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:23.998Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203863768_u3l1kzxm5","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:24.007Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203863768_u3l1kzxm5","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:24.025Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203863768_u3l1kzxm5","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:24.038Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203863768_u3l1kzxm5","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:24.044Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203863768_u3l1kzxm5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:24.050Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203863768_u3l1kzxm5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:24.069Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203863768_u3l1kzxm5","bodySize":25705,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:24.075Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":25705,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:24.082Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25705,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:24:24.089Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25705,"expectedSize":25705}}
{"timestamp":"2025-08-26T10:24:24.096Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":25705,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:24.105Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:24.112Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:35.801Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203863768_u3l1kzxm5","requestSize":25705,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:24:35.810Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203863768_u3l1kzxm5","duration":9,"requestSize":25705,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:24:35.818Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":536,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:24:35.850Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203863768_u3l1kzxm5","totalTime":12082,"layerTimings":{"router":53,"transformer":90,"protocol":34,"serverCompatibility":61,"server":11778,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:35.869Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203863768_u3l1kzxm5","executionId":"req_1756203863768_u3l1kzxm5","totalTime":12082,"success":true}}
{"timestamp":"2025-08-26T10:24:35.886Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:35.893Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:35.900Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:35.907Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:35.914Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:35.930Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:35.938Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203875938_qpvbyh1p3","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:35.954Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:35.961Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203875938_qpvbyh1p3","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:35.967Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:35.974Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:35.981Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":69,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":70,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",70]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:35.988Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203875938_qpvbyh1p3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:36.011Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203875938_qpvbyh1p3","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:36.081Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203875938_qpvbyh1p3","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:36.088Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203875938_qpvbyh1p3","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:36.104Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203875938_qpvbyh1p3","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:36.111Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203875938_qpvbyh1p3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:36.118Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203875938_qpvbyh1p3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:36.134Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203875938_qpvbyh1p3","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:36.142Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203875938_qpvbyh1p3","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:36.149Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203875938_qpvbyh1p3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:24:36.164Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203875938_qpvbyh1p3","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:36.182Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203875938_qpvbyh1p3","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:36.189Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203875938_qpvbyh1p3","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:36.196Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203875938_qpvbyh1p3","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:36.204Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203875938_qpvbyh1p3","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:36.221Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203875938_qpvbyh1p3","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:36.236Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203875938_qpvbyh1p3","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:36.242Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203875938_qpvbyh1p3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:36.248Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203875938_qpvbyh1p3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:36.266Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203875938_qpvbyh1p3","bodySize":59848,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:36.273Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":59848,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:36.280Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":59848,"chunkSize":16384,"estimatedChunks":4}}
{"timestamp":"2025-08-26T10:24:36.287Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":59848,"expectedSize":59848}}
{"timestamp":"2025-08-26T10:24:36.293Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":59848,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:36.302Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:36.308Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:39.456Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203875938_qpvbyh1p3","requestSize":59848,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:24:39.466Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203875938_qpvbyh1p3","duration":10,"requestSize":59848,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:24:39.473Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":506,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:24:39.505Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203875938_qpvbyh1p3","totalTime":3567,"layerTimings":{"router":57,"transformer":102,"protocol":39,"serverCompatibility":65,"server":3237,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:39.528Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203875938_qpvbyh1p3","executionId":"req_1756203875938_qpvbyh1p3","totalTime":3567,"success":true}}
{"timestamp":"2025-08-26T10:24:39.542Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:39.549Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:39.555Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:39.562Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:39.568Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:39.585Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:39.595Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203879595_t9du0dt7x","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:39.609Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:39.616Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203879595_t9du0dt7x","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:39.624Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:39.631Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:39.638Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":70,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":71,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",71]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:39.645Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203879595_t9du0dt7x","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:39.666Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203879595_t9du0dt7x","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:39.731Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203879595_t9du0dt7x","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:39.738Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203879595_t9du0dt7x","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:39.753Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203879595_t9du0dt7x","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:39.760Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203879595_t9du0dt7x","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:39.767Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203879595_t9du0dt7x","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:39.782Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203879595_t9du0dt7x","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:24:39.789Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203879595_t9du0dt7x","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:24:39.796Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203879595_t9du0dt7x","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:39.803Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203879595_t9du0dt7x","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:24:39.818Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203879595_t9du0dt7x","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:39.833Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203879595_t9du0dt7x","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:39.840Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203879595_t9du0dt7x","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:39.846Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203879595_t9du0dt7x","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:39.861Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203879595_t9du0dt7x","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:39.870Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203879595_t9du0dt7x","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:24:39.877Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203879595_t9du0dt7x","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:39.883Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203879595_t9du0dt7x","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:24:39.889Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203879595_t9du0dt7x","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:39.900Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203879595_t9du0dt7x","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:24:39.909Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203879595_t9du0dt7x","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:24:39.916Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203879595_t9du0dt7x","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:24:39.923Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203879595_t9du0dt7x","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:39.930Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203879595_t9du0dt7x","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:39.946Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203879595_t9du0dt7x","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:39.952Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203879595_t9du0dt7x","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:39.959Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203879595_t9du0dt7x","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:39.976Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203879595_t9du0dt7x","bodySize":28420,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:39.983Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":28420,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:39.989Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":28420,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:24:39.996Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":28420,"expectedSize":28420}}
{"timestamp":"2025-08-26T10:24:40.002Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":28420,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:40.011Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:40.017Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:41.636Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203879595_t9du0dt7x","requestSize":28420,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:24:41.644Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203879595_t9du0dt7x","duration":8,"requestSize":28420,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:24:41.651Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":455,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:24:41.683Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203879595_t9du0dt7x","totalTime":2088,"layerTimings":{"router":57,"transformer":95,"protocol":45,"serverCompatibility":121,"server":1703,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:41.703Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203879595_t9du0dt7x","executionId":"req_1756203879595_t9du0dt7x","totalTime":2088,"success":true}}
{"timestamp":"2025-08-26T10:24:41.717Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:41.724Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:41.731Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:41.737Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:41.743Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:41.760Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:41.769Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203881769_8ytpndbed","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:41.783Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:41.790Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203881769_8ytpndbed","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:41.796Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:41.803Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:41.809Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":71,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":72,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",72]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:41.816Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203881769_8ytpndbed","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:41.839Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203881769_8ytpndbed","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:41.906Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203881769_8ytpndbed","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:41.913Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203881769_8ytpndbed","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:41.927Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203881769_8ytpndbed","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:41.934Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203881769_8ytpndbed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:41.940Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203881769_8ytpndbed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:41.955Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203881769_8ytpndbed","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:41.962Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203881769_8ytpndbed","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:41.969Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203881769_8ytpndbed","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:24:41.983Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203881769_8ytpndbed","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:41.998Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203881769_8ytpndbed","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:42.004Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203881769_8ytpndbed","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:42.011Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203881769_8ytpndbed","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:42.020Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203881769_8ytpndbed","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:42.040Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203881769_8ytpndbed","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:42.053Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203881769_8ytpndbed","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:42.059Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203881769_8ytpndbed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:42.066Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203881769_8ytpndbed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:42.083Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203881769_8ytpndbed","bodySize":25263,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:42.090Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":25263,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:42.096Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25263,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:24:42.104Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25263,"expectedSize":25263}}
{"timestamp":"2025-08-26T10:24:42.110Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":25263,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:42.119Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:42.125Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:52.964Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203881769_8ytpndbed","requestSize":25263,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:24:52.974Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203881769_8ytpndbed","duration":10,"requestSize":25263,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:24:52.981Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":536,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:24:53.015Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203881769_8ytpndbed","totalTime":11246,"layerTimings":{"router":55,"transformer":97,"protocol":36,"serverCompatibility":64,"server":10927,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:53.041Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203881769_8ytpndbed","executionId":"req_1756203881769_8ytpndbed","totalTime":11246,"success":true}}
{"timestamp":"2025-08-26T10:24:53.057Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:53.064Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:53.070Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:53.077Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:53.083Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:53.101Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:53.109Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203893109_thjg8kwq2","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:53.125Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:53.132Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203893109_thjg8kwq2","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:53.140Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:53.147Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:53.154Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":72,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":73,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",73]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:53.162Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203893109_thjg8kwq2","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:53.189Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203893109_thjg8kwq2","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:53.265Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203893109_thjg8kwq2","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:53.272Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203893109_thjg8kwq2","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:53.288Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203893109_thjg8kwq2","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:53.295Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203893109_thjg8kwq2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:53.302Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203893109_thjg8kwq2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:53.318Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203893109_thjg8kwq2","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:53.325Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203893109_thjg8kwq2","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:53.332Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203893109_thjg8kwq2","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:24:53.346Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203893109_thjg8kwq2","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:53.360Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203893109_thjg8kwq2","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:53.366Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203893109_thjg8kwq2","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:53.372Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203893109_thjg8kwq2","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:53.381Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203893109_thjg8kwq2","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:53.399Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203893109_thjg8kwq2","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:53.413Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203893109_thjg8kwq2","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:53.420Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203893109_thjg8kwq2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:53.427Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203893109_thjg8kwq2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:53.446Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203893109_thjg8kwq2","bodySize":27586,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:53.453Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":27586,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:53.460Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":27586,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:24:53.467Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":27586,"expectedSize":27586}}
{"timestamp":"2025-08-26T10:24:53.474Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":27586,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:53.482Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:53.489Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:54.533Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203893109_thjg8kwq2","requestSize":27586,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:24:54.542Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203893109_thjg8kwq2","duration":9,"requestSize":27586,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:24:54.550Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":493,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:24:54.587Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203893109_thjg8kwq2","totalTime":1478,"layerTimings":{"router":63,"transformer":109,"protocol":36,"serverCompatibility":61,"server":1135,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:54.607Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203893109_thjg8kwq2","executionId":"req_1756203893109_thjg8kwq2","totalTime":1478,"success":true}}
{"timestamp":"2025-08-26T10:24:54.624Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:54.631Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:54.638Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:54.646Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:54.654Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:54.672Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:54.682Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203894682_8wljd2sz3","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:54.697Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:54.704Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203894682_8wljd2sz3","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:54.711Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:54.718Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:54.724Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":73,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":74,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",74]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:54.732Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203894682_8wljd2sz3","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:54.755Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203894682_8wljd2sz3","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:54.824Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203894682_8wljd2sz3","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:54.830Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203894682_8wljd2sz3","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:54.845Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203894682_8wljd2sz3","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:54.852Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203894682_8wljd2sz3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:54.859Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203894682_8wljd2sz3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:54.874Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203894682_8wljd2sz3","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:24:54.880Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203894682_8wljd2sz3","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:24:54.886Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203894682_8wljd2sz3","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:54.892Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203894682_8wljd2sz3","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:24:54.906Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203894682_8wljd2sz3","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:54.919Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203894682_8wljd2sz3","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:54.926Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203894682_8wljd2sz3","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:54.932Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203894682_8wljd2sz3","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:54.947Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203894682_8wljd2sz3","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:54.956Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203894682_8wljd2sz3","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:24:54.963Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203894682_8wljd2sz3","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:54.970Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203894682_8wljd2sz3","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:24:54.978Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203894682_8wljd2sz3","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:54.989Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203894682_8wljd2sz3","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:24:54.998Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203894682_8wljd2sz3","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:24:55.007Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203894682_8wljd2sz3","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:24:55.015Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203894682_8wljd2sz3","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:55.022Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203894682_8wljd2sz3","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:55.037Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203894682_8wljd2sz3","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:55.045Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203894682_8wljd2sz3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:55.052Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203894682_8wljd2sz3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:55.068Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203894682_8wljd2sz3","bodySize":22761,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:55.074Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":22761,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:55.081Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":22761,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:24:55.088Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":22761,"expectedSize":22761}}
{"timestamp":"2025-08-26T10:24:55.095Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":22761,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:55.104Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:55.111Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:24:56.550Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203894682_8wljd2sz3","requestSize":22761,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:24:56.559Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203894682_8wljd2sz3","duration":9,"requestSize":22761,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:24:56.566Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":422,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:24:56.599Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203894682_8wljd2sz3","totalTime":1917,"layerTimings":{"router":58,"transformer":98,"protocol":40,"serverCompatibility":125,"server":1525,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:24:56.617Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203894682_8wljd2sz3","executionId":"req_1756203894682_8wljd2sz3","totalTime":1917,"success":true}}
{"timestamp":"2025-08-26T10:24:56.632Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:24:56.639Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:56.646Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:24:56.653Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:24:56.660Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:24:56.678Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:24:56.686Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203896686_any3q4h6n","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:24:56.699Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:56.705Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203896686_any3q4h6n","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:24:56.711Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:24:56.717Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:24:56.723Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":74,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":75,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",75]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:24:56.730Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203896686_any3q4h6n","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:24:56.752Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203896686_any3q4h6n","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:24:56.823Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203896686_any3q4h6n","hasOutput":true}}
{"timestamp":"2025-08-26T10:24:56.829Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203896686_any3q4h6n","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:24:56.844Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203896686_any3q4h6n","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:56.850Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203896686_any3q4h6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:56.857Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203896686_any3q4h6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:56.872Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203896686_any3q4h6n","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:56.879Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203896686_any3q4h6n","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:24:56.886Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203896686_any3q4h6n","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:24:56.900Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203896686_any3q4h6n","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:24:56.915Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203896686_any3q4h6n","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:24:56.922Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203896686_any3q4h6n","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:24:56.929Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203896686_any3q4h6n","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:24:56.937Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203896686_any3q4h6n","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:24:56.955Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203896686_any3q4h6n","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:24:56.970Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203896686_any3q4h6n","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:24:56.977Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203896686_any3q4h6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:56.984Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203896686_any3q4h6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:24:57.002Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203896686_any3q4h6n","bodySize":29051,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:24:57.009Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":29051,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:24:57.016Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":29051,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:24:57.023Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":29051,"expectedSize":29051}}
{"timestamp":"2025-08-26T10:24:57.029Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":29051,"timeout":600000}}
{"timestamp":"2025-08-26T10:24:57.039Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:24:57.046Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:25:14.819Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203896686_any3q4h6n","requestSize":29051,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:25:14.829Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203896686_any3q4h6n","duration":10,"requestSize":29051,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:25:14.837Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":535,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:25:14.868Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203896686_any3q4h6n","totalTime":18182,"layerTimings":{"router":52,"transformer":100,"protocol":37,"serverCompatibility":63,"server":17863,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T10:25:14.888Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203896686_any3q4h6n","executionId":"req_1756203896686_any3q4h6n","totalTime":18182,"success":true}}
{"timestamp":"2025-08-26T10:25:14.903Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:25:14.909Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:14.916Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:14.923Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:25:14.930Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:25:14.947Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:25:14.956Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203914956_p7l9a3xyf","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:25:14.971Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:14.978Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203914956_p7l9a3xyf","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:25:14.985Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:25:14.991Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:25:14.998Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":75,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":76,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",76]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:25:15.005Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203914956_p7l9a3xyf","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:25:15.028Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203914956_p7l9a3xyf","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:25:15.097Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203914956_p7l9a3xyf","hasOutput":true}}
{"timestamp":"2025-08-26T10:25:15.104Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203914956_p7l9a3xyf","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:25:15.120Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203914956_p7l9a3xyf","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:15.126Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203914956_p7l9a3xyf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:15.133Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203914956_p7l9a3xyf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:15.149Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203914956_p7l9a3xyf","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:15.155Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203914956_p7l9a3xyf","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:25:15.162Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203914956_p7l9a3xyf","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:25:15.177Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203914956_p7l9a3xyf","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:25:15.192Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203914956_p7l9a3xyf","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:25:15.199Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203914956_p7l9a3xyf","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:25:15.206Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203914956_p7l9a3xyf","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:15.214Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203914956_p7l9a3xyf","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:25:15.233Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203914956_p7l9a3xyf","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:25:15.248Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203914956_p7l9a3xyf","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:15.255Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203914956_p7l9a3xyf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:15.262Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203914956_p7l9a3xyf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:15.281Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203914956_p7l9a3xyf","bodySize":24907,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:15.288Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":24907,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:25:15.296Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":24907,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:25:15.303Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":24907,"expectedSize":24907}}
{"timestamp":"2025-08-26T10:25:15.310Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":24907,"timeout":600000}}
{"timestamp":"2025-08-26T10:25:15.319Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:25:15.326Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:25:16.456Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203914956_p7l9a3xyf","requestSize":24907,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:25:16.464Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203914956_p7l9a3xyf","duration":8,"requestSize":24907,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:25:16.476Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":494,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:25:16.507Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203914956_p7l9a3xyf","totalTime":1551,"layerTimings":{"router":57,"transformer":100,"protocol":37,"serverCompatibility":64,"server":1224,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T10:25:16.526Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203914956_p7l9a3xyf","executionId":"req_1756203914956_p7l9a3xyf","totalTime":1551,"success":true}}
{"timestamp":"2025-08-26T10:25:16.540Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:25:16.548Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:16.555Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:16.562Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:25:16.569Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:25:16.586Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:25:16.595Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203916595_b0usel8b2","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:25:16.609Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:16.616Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203916595_b0usel8b2","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:25:16.623Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:25:16.630Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:25:16.637Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":76,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":77,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",77]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:25:16.644Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203916595_b0usel8b2","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:25:16.667Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203916595_b0usel8b2","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:25:16.737Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203916595_b0usel8b2","hasOutput":true}}
{"timestamp":"2025-08-26T10:25:16.743Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203916595_b0usel8b2","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:25:16.756Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203916595_b0usel8b2","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:16.762Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203916595_b0usel8b2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:16.769Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203916595_b0usel8b2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:16.784Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203916595_b0usel8b2","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:25:16.790Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203916595_b0usel8b2","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:25:16.797Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203916595_b0usel8b2","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:25:16.804Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203916595_b0usel8b2","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:25:16.818Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203916595_b0usel8b2","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:25:16.834Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203916595_b0usel8b2","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:25:16.841Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203916595_b0usel8b2","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:25:16.848Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203916595_b0usel8b2","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:16.865Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203916595_b0usel8b2","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:25:16.874Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203916595_b0usel8b2","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:25:16.881Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203916595_b0usel8b2","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:16.888Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203916595_b0usel8b2","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:25:16.894Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203916595_b0usel8b2","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:16.906Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203916595_b0usel8b2","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:25:16.916Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203916595_b0usel8b2","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:25:16.923Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203916595_b0usel8b2","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:25:16.930Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203916595_b0usel8b2","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:16.938Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203916595_b0usel8b2","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:25:16.953Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203916595_b0usel8b2","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:16.959Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203916595_b0usel8b2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:16.966Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203916595_b0usel8b2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:16.985Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203916595_b0usel8b2","bodySize":26189,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:16.993Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":26189,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:25:17.000Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":26189,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:25:17.007Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":26189,"expectedSize":26189}}
{"timestamp":"2025-08-26T10:25:17.014Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":26189,"timeout":600000}}
{"timestamp":"2025-08-26T10:25:17.024Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:25:17.031Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:25:18.877Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203916595_b0usel8b2","requestSize":26189,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:25:18.887Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203916595_b0usel8b2","duration":10,"requestSize":26189,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:25:18.894Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":421,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:25:18.922Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203916595_b0usel8b2","totalTime":2327,"layerTimings":{"router":58,"transformer":97,"protocol":43,"serverCompatibility":128,"server":1936,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T10:25:18.941Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203916595_b0usel8b2","executionId":"req_1756203916595_b0usel8b2","totalTime":2327,"success":true}}
{"timestamp":"2025-08-26T10:25:18.956Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:25:18.962Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:18.968Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:18.975Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:25:18.982Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:25:18.999Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:25:19.007Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203919007_71oj8i7g8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:25:19.022Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:19.029Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203919007_71oj8i7g8","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:25:19.036Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:25:19.043Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:25:19.050Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":77,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":78,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",78]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:25:19.057Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203919007_71oj8i7g8","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:25:19.080Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203919007_71oj8i7g8","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:25:19.152Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203919007_71oj8i7g8","hasOutput":true}}
{"timestamp":"2025-08-26T10:25:19.159Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203919007_71oj8i7g8","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:25:19.172Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203919007_71oj8i7g8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:19.179Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203919007_71oj8i7g8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:19.185Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203919007_71oj8i7g8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:19.199Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203919007_71oj8i7g8","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:19.208Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203919007_71oj8i7g8","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:25:19.216Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203919007_71oj8i7g8","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:25:19.230Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203919007_71oj8i7g8","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:25:19.245Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203919007_71oj8i7g8","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:25:19.253Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203919007_71oj8i7g8","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:25:19.260Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203919007_71oj8i7g8","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:19.269Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203919007_71oj8i7g8","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:25:19.289Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203919007_71oj8i7g8","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:25:19.305Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203919007_71oj8i7g8","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:19.312Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203919007_71oj8i7g8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:19.319Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203919007_71oj8i7g8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:19.336Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203919007_71oj8i7g8","bodySize":26013,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:19.343Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":26013,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:25:19.351Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":26013,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T10:25:19.358Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":26013,"expectedSize":26013}}
{"timestamp":"2025-08-26T10:25:19.364Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":26013,"timeout":600000}}
{"timestamp":"2025-08-26T10:25:19.374Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:25:19.381Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:25:19.940Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:25:19.948Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:19.955Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:19.963Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:25:19.970Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:25:19.989Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:25:19.998Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203919998_16npl084o","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:25:20.013Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:20.019Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203919998_16npl084o","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:25:20.025Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:25:20.032Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:25:20.038Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":78,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":79,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",79]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:25:20.044Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203919998_16npl084o","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:25:20.066Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203919998_16npl084o","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:25:20.135Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203919998_16npl084o","hasOutput":true}}
{"timestamp":"2025-08-26T10:25:20.142Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203919998_16npl084o","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:25:20.155Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203919998_16npl084o","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:20.161Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203919998_16npl084o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:20.169Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203919998_16npl084o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:20.183Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203919998_16npl084o","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:20.189Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203919998_16npl084o","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:25:20.196Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203919998_16npl084o","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:25:20.210Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203919998_16npl084o","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:25:20.224Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203919998_16npl084o","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:25:20.231Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203919998_16npl084o","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:25:20.237Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203919998_16npl084o","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:20.246Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203919998_16npl084o","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:25:20.265Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203919998_16npl084o","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:25:20.279Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203919998_16npl084o","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:20.286Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203919998_16npl084o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:20.293Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203919998_16npl084o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:25:20.310Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":626,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T10:25:20.325Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:25:20.334Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:20.341Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:20.347Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:25:20.354Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:25:20.374Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:25:20.383Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203920383_g3vev01d9","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:25:20.450Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:20.457Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203920383_g3vev01d9","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:25:20.463Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:25:20.470Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:25:20.476Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":79,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":80,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",80]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:25:20.484Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203920383_g3vev01d9","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:25:20.517Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203920383_g3vev01d9","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:25:20.624Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203920383_g3vev01d9","hasOutput":true}}
{"timestamp":"2025-08-26T10:25:20.631Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203920383_g3vev01d9","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:25:20.658Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203920383_g3vev01d9","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:20.665Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203920383_g3vev01d9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:20.673Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203920383_g3vev01d9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:20.700Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203920383_g3vev01d9","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:25:20.708Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203920383_g3vev01d9","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:25:20.715Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203920383_g3vev01d9","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:25:20.722Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203920383_g3vev01d9","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:25:20.750Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203920383_g3vev01d9","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:25:20.776Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203920383_g3vev01d9","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:25:20.783Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203920383_g3vev01d9","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:25:20.791Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203920383_g3vev01d9","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:20.808Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203920383_g3vev01d9","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:25:20.816Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:25:20.823Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:25:20.833Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:25:20.840Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:25:20.850Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203920383_g3vev01d9","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:25:20.857Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203920383_g3vev01d9","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:20.864Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203920383_g3vev01d9","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:25:20.871Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203920383_g3vev01d9","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:20.882Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203920383_g3vev01d9","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:25:20.892Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203920383_g3vev01d9","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:25:20.899Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203920383_g3vev01d9","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:25:20.907Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203920383_g3vev01d9","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:20.914Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203920383_g3vev01d9","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:25:20.941Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203920383_g3vev01d9","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:20.949Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203920383_g3vev01d9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:20.956Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203920383_g3vev01d9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:20.991Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203920383_g3vev01d9","bodySize":158846,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:20.999Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":158846,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:25:21.007Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":158846,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T10:25:21.014Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":158846,"expectedSize":158846}}
{"timestamp":"2025-08-26T10:25:21.021Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":158846,"timeout":600000}}
{"timestamp":"2025-08-26T10:25:21.431Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":510,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:25:21.464Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203919998_16npl084o","totalTime":1466,"layerTimings":{"router":53,"transformer":97,"protocol":35,"serverCompatibility":62,"server":1149,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:25:21.481Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203919998_16npl084o","executionId":"req_1756203919998_16npl084o","totalTime":1466,"success":true}}
{"timestamp":"2025-08-26T10:25:26.592Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203920383_g3vev01d9","requestSize":158846,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:25:26.601Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203920383_g3vev01d9","duration":9,"requestSize":158846,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:25:26.608Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":611,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:25:26.643Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203920383_g3vev01d9","totalTime":6260,"layerTimings":{"router":106,"transformer":160,"protocol":70,"serverCompatibility":185,"server":5663,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:25:26.682Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203920383_g3vev01d9","executionId":"req_1756203920383_g3vev01d9","totalTime":6260,"success":true}}
{"timestamp":"2025-08-26T10:25:26.703Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:25:26.710Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:26.717Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:26.724Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:25:26.731Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:25:26.750Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:25:26.760Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203926760_466fork3a","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:25:26.828Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:26.835Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203926760_466fork3a","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:25:26.841Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:25:26.848Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:25:26.855Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":80,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":81,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",81]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:25:26.862Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203926760_466fork3a","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:25:26.897Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203926760_466fork3a","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:25:27.005Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203926760_466fork3a","hasOutput":true}}
{"timestamp":"2025-08-26T10:25:27.012Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203926760_466fork3a","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:25:27.037Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203926760_466fork3a","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:27.044Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203926760_466fork3a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:27.050Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203926760_466fork3a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:27.075Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203926760_466fork3a","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:27.082Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203926760_466fork3a","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:25:27.088Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203926760_466fork3a","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:25:27.114Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203926760_466fork3a","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:25:27.142Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203926760_466fork3a","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:25:27.149Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203926760_466fork3a","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:25:27.156Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203926760_466fork3a","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:27.165Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203926760_466fork3a","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:25:27.187Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203926760_466fork3a","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:25:27.213Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203926760_466fork3a","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:27.220Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203926760_466fork3a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:27.226Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203926760_466fork3a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:27.261Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203926760_466fork3a","bodySize":158844,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:27.270Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":158844,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:25:27.277Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":158844,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T10:25:27.284Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":158844,"expectedSize":158844}}
{"timestamp":"2025-08-26T10:25:27.291Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":158844,"timeout":600000}}
{"timestamp":"2025-08-26T10:25:27.308Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:25:27.317Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:25:34.818Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203919007_71oj8i7g8","requestSize":26013,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:25:34.827Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203919007_71oj8i7g8","duration":9,"requestSize":26013,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:25:34.834Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":536,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:25:34.864Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203919007_71oj8i7g8","totalTime":15857,"layerTimings":{"router":58,"transformer":100,"protocol":39,"serverCompatibility":68,"server":15525,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T10:25:34.883Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203919007_71oj8i7g8","executionId":"req_1756203919007_71oj8i7g8","totalTime":15857,"success":true}}
{"timestamp":"2025-08-26T10:25:48.318Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203926760_466fork3a","requestSize":158844,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:25:48.327Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203926760_466fork3a","duration":10,"requestSize":158844,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:25:48.335Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":926,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:25:48.374Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203926760_466fork3a","totalTime":21614,"layerTimings":{"router":110,"transformer":159,"protocol":58,"serverCompatibility":91,"server":21123,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:25:48.414Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203926760_466fork3a","executionId":"req_1756203926760_466fork3a","totalTime":21614,"success":true}}
{"timestamp":"2025-08-26T10:25:48.589Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:25:48.596Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:48.603Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:48.609Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:25:48.616Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:25:48.635Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:25:48.644Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203948644_mz2lakqqf","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:25:48.713Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:48.720Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203948644_mz2lakqqf","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:25:48.727Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:25:48.734Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:25:48.742Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":81,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":82,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",82]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:25:48.749Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203948644_mz2lakqqf","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:25:48.783Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203948644_mz2lakqqf","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:25:48.925Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203948644_mz2lakqqf","hasOutput":true}}
{"timestamp":"2025-08-26T10:25:48.932Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203948644_mz2lakqqf","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:25:48.959Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203948644_mz2lakqqf","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:48.966Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203948644_mz2lakqqf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:48.974Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203948644_mz2lakqqf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:49.003Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203948644_mz2lakqqf","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:49.011Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203948644_mz2lakqqf","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:25:49.019Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203948644_mz2lakqqf","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:25:49.049Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203948644_mz2lakqqf","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:25:49.080Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203948644_mz2lakqqf","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:25:49.088Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203948644_mz2lakqqf","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:25:49.096Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203948644_mz2lakqqf","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:49.106Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203948644_mz2lakqqf","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:25:49.130Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203948644_mz2lakqqf","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:25:49.160Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203948644_mz2lakqqf","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:49.168Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203948644_mz2lakqqf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:49.176Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203948644_mz2lakqqf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:49.215Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203948644_mz2lakqqf","bodySize":159816,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:49.224Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":159816,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:25:49.233Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":159816,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T10:25:49.241Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":159816,"expectedSize":159816}}
{"timestamp":"2025-08-26T10:25:49.248Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":159816,"timeout":600000}}
{"timestamp":"2025-08-26T10:25:49.259Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:25:49.266Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:25:52.902Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203948644_mz2lakqqf","requestSize":159816,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:25:52.910Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203948644_mz2lakqqf","duration":8,"requestSize":159816,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:25:52.917Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":696,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:25:52.951Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203948644_mz2lakqqf","totalTime":4307,"layerTimings":{"router":113,"transformer":195,"protocol":68,"serverCompatibility":103,"server":3750,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:25:52.990Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203948644_mz2lakqqf","executionId":"req_1756203948644_mz2lakqqf","totalTime":4307,"success":true}}
{"timestamp":"2025-08-26T10:25:53.011Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:25:53.019Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:53.026Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:53.032Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:25:53.040Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:25:53.058Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:25:53.067Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203953067_aalf4vqcd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:25:53.133Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:53.140Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203953067_aalf4vqcd","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:25:53.147Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:25:53.153Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:25:53.160Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":82,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":83,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",83]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:25:53.166Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203953067_aalf4vqcd","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:25:53.200Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203953067_aalf4vqcd","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:25:53.337Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203953067_aalf4vqcd","hasOutput":true}}
{"timestamp":"2025-08-26T10:25:53.344Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203953067_aalf4vqcd","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:25:53.371Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203953067_aalf4vqcd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:53.379Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203953067_aalf4vqcd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:53.386Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203953067_aalf4vqcd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:53.414Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203953067_aalf4vqcd","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:25:53.421Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203953067_aalf4vqcd","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:25:53.429Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203953067_aalf4vqcd","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:25:53.437Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203953067_aalf4vqcd","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:25:53.464Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203953067_aalf4vqcd","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:25:53.492Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203953067_aalf4vqcd","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:25:53.500Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203953067_aalf4vqcd","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:25:53.507Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203953067_aalf4vqcd","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:53.523Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203953067_aalf4vqcd","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:25:53.533Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:25:53.540Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:25:53.549Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203953067_aalf4vqcd","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:25:53.555Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203953067_aalf4vqcd","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:53.561Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203953067_aalf4vqcd","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:25:53.568Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203953067_aalf4vqcd","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:53.579Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203953067_aalf4vqcd","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:25:53.589Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203953067_aalf4vqcd","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:25:53.597Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203953067_aalf4vqcd","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:25:53.604Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203953067_aalf4vqcd","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:53.611Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203953067_aalf4vqcd","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:25:53.637Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203953067_aalf4vqcd","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:53.644Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203953067_aalf4vqcd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:53.651Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203953067_aalf4vqcd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:53.686Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203953067_aalf4vqcd","bodySize":159817,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:53.694Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":159817,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:25:53.702Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":159817,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T10:25:53.709Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":159817,"expectedSize":159817}}
{"timestamp":"2025-08-26T10:25:53.716Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":159817,"timeout":600000}}
{"timestamp":"2025-08-26T10:25:56.718Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203953067_aalf4vqcd","requestSize":159817,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:25:56.728Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203953067_aalf4vqcd","duration":10,"requestSize":159817,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:25:56.735Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":692,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:25:56.769Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203953067_aalf4vqcd","totalTime":3702,"layerTimings":{"router":106,"transformer":191,"protocol":71,"serverCompatibility":166,"server":3095,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:25:56.808Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203953067_aalf4vqcd","executionId":"req_1756203953067_aalf4vqcd","totalTime":3702,"success":true}}
{"timestamp":"2025-08-26T10:25:57.031Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:25:57.038Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:57.044Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:25:57.050Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:25:57.057Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:25:57.076Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:25:57.085Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203957085_b7bpcj45u","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:25:57.152Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:57.159Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203957085_b7bpcj45u","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:25:57.165Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:25:57.172Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:25:57.179Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":83,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":84,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",84]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:25:57.186Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203957085_b7bpcj45u","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:25:57.225Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203957085_b7bpcj45u","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:25:57.396Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203957085_b7bpcj45u","hasOutput":true}}
{"timestamp":"2025-08-26T10:25:57.403Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203957085_b7bpcj45u","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:25:57.432Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203957085_b7bpcj45u","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:57.439Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203957085_b7bpcj45u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:57.447Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203957085_b7bpcj45u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:57.477Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203957085_b7bpcj45u","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:57.485Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203957085_b7bpcj45u","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:25:57.492Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203957085_b7bpcj45u","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:25:57.523Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203957085_b7bpcj45u","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:25:57.554Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203957085_b7bpcj45u","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:25:57.562Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203957085_b7bpcj45u","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:25:57.568Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203957085_b7bpcj45u","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:25:57.577Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203957085_b7bpcj45u","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:25:57.599Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203957085_b7bpcj45u","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:25:57.628Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203957085_b7bpcj45u","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:25:57.634Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203957085_b7bpcj45u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:57.641Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203957085_b7bpcj45u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:25:57.679Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203957085_b7bpcj45u","bodySize":193039,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:25:57.687Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":193039,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:25:57.694Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":193039,"chunkSize":16384,"estimatedChunks":12}}
{"timestamp":"2025-08-26T10:25:57.701Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":193039,"expectedSize":193039}}
{"timestamp":"2025-08-26T10:25:57.709Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":193039,"timeout":600000}}
{"timestamp":"2025-08-26T10:25:57.718Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:25:57.725Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:26:22.172Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203957085_b7bpcj45u","requestSize":193039,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:26:22.182Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203957085_b7bpcj45u","duration":10,"requestSize":193039,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:26:22.189Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":776,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:26:22.223Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203957085_b7bpcj45u","totalTime":25138,"layerTimings":{"router":109,"transformer":231,"protocol":69,"serverCompatibility":98,"server":24559,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:26:22.268Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203957085_b7bpcj45u","executionId":"req_1756203957085_b7bpcj45u","totalTime":25138,"success":true}}
{"timestamp":"2025-08-26T10:26:22.291Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:26:22.299Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:26:22.306Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:26:22.313Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:26:22.321Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:26:22.341Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:26:22.350Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203982350_hbcyf6qms","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:26:22.416Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:26:22.424Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203982350_hbcyf6qms","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:26:22.430Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:26:22.437Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:26:22.444Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":84,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":85,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",85]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:26:22.451Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203982350_hbcyf6qms","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:26:22.490Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203982350_hbcyf6qms","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:26:22.658Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203982350_hbcyf6qms","hasOutput":true}}
{"timestamp":"2025-08-26T10:26:22.665Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203982350_hbcyf6qms","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:26:22.697Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203982350_hbcyf6qms","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:26:22.704Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203982350_hbcyf6qms","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:22.712Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203982350_hbcyf6qms","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:22.743Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203982350_hbcyf6qms","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:26:22.751Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203982350_hbcyf6qms","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:26:22.758Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203982350_hbcyf6qms","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:26:22.788Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203982350_hbcyf6qms","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:26:22.820Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203982350_hbcyf6qms","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:26:22.827Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203982350_hbcyf6qms","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:26:22.834Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203982350_hbcyf6qms","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:26:22.842Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203982350_hbcyf6qms","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:26:22.866Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203982350_hbcyf6qms","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:26:22.897Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203982350_hbcyf6qms","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:26:22.904Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203982350_hbcyf6qms","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:22.911Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203982350_hbcyf6qms","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:22.950Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203982350_hbcyf6qms","bodySize":193040,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:26:22.958Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":193040,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:26:22.966Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":193040,"chunkSize":16384,"estimatedChunks":12}}
{"timestamp":"2025-08-26T10:26:22.973Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":193040,"expectedSize":193040}}
{"timestamp":"2025-08-26T10:26:22.979Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":193040,"timeout":600000}}
{"timestamp":"2025-08-26T10:26:22.990Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:26:22.999Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:26:27.935Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203982350_hbcyf6qms","requestSize":193040,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:26:27.944Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203982350_hbcyf6qms","duration":9,"requestSize":193040,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:26:27.951Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":758,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:26:27.985Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203982350_hbcyf6qms","totalTime":5635,"layerTimings":{"router":109,"transformer":231,"protocol":69,"serverCompatibility":101,"server":5051,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:26:28.028Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203982350_hbcyf6qms","executionId":"req_1756203982350_hbcyf6qms","totalTime":5635,"success":true}}
{"timestamp":"2025-08-26T10:26:28.349Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:26:28.357Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:26:28.364Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:26:28.371Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:26:28.378Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:26:28.398Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:26:28.408Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203988408_hdmr7i094","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:26:28.477Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:26:28.485Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203988408_hdmr7i094","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:26:28.492Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:26:28.499Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:26:28.505Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":85,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":86,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",86]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:26:28.513Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203988408_hdmr7i094","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:26:28.550Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203988408_hdmr7i094","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:26:28.741Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203988408_hdmr7i094","hasOutput":true}}
{"timestamp":"2025-08-26T10:26:28.748Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203988408_hdmr7i094","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:26:28.778Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203988408_hdmr7i094","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:26:28.786Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203988408_hdmr7i094","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:28.792Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203988408_hdmr7i094","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:28.822Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203988408_hdmr7i094","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:26:28.829Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756203988408_hdmr7i094","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:26:28.835Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203988408_hdmr7i094","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:26:28.842Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203988408_hdmr7i094","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:26:28.871Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203988408_hdmr7i094","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:26:28.902Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203988408_hdmr7i094","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:26:28.910Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203988408_hdmr7i094","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:26:28.917Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203988408_hdmr7i094","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:26:28.935Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203988408_hdmr7i094","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:26:28.945Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756203988408_hdmr7i094","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:26:28.952Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756203988408_hdmr7i094","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:26:28.960Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756203988408_hdmr7i094","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:26:28.968Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756203988408_hdmr7i094","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:26:28.980Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756203988408_hdmr7i094","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:26:28.990Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756203988408_hdmr7i094","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:26:28.998Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756203988408_hdmr7i094","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:26:29.005Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756203988408_hdmr7i094","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:26:29.012Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203988408_hdmr7i094","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:26:29.042Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203988408_hdmr7i094","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:26:29.050Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203988408_hdmr7i094","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:29.056Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203988408_hdmr7i094","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:29.098Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203988408_hdmr7i094","bodySize":193605,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:26:29.106Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":193605,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:26:29.114Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":193605,"chunkSize":16384,"estimatedChunks":12}}
{"timestamp":"2025-08-26T10:26:29.121Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":193605,"expectedSize":193605}}
{"timestamp":"2025-08-26T10:26:29.128Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":193605,"timeout":600000}}
{"timestamp":"2025-08-26T10:26:29.138Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:26:29.145Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:26:32.927Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203988408_hdmr7i094","requestSize":193605,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:26:32.935Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203988408_hdmr7i094","duration":8,"requestSize":193605,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:26:32.942Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":726,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:26:32.974Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203988408_hdmr7i094","totalTime":4566,"layerTimings":{"router":112,"transformer":251,"protocol":71,"serverCompatibility":164,"server":3895,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:26:33.018Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203988408_hdmr7i094","executionId":"req_1756203988408_hdmr7i094","totalTime":4566,"success":true}}
{"timestamp":"2025-08-26T10:26:33.040Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:26:33.047Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:26:33.054Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:26:33.061Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:26:33.068Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:26:33.088Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:26:33.097Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756203993097_7bz9bfjgl","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:26:33.167Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:26:33.175Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756203993097_7bz9bfjgl","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:26:33.182Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:26:33.189Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:26:33.196Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":86,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":87,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",87]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:26:33.203Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756203993097_7bz9bfjgl","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:26:33.242Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756203993097_7bz9bfjgl","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:26:33.436Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756203993097_7bz9bfjgl","hasOutput":true}}
{"timestamp":"2025-08-26T10:26:33.443Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756203993097_7bz9bfjgl","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:26:33.474Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203993097_7bz9bfjgl","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:26:33.482Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203993097_7bz9bfjgl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:33.489Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756203993097_7bz9bfjgl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:33.520Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756203993097_7bz9bfjgl","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:26:33.528Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756203993097_7bz9bfjgl","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:26:33.535Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756203993097_7bz9bfjgl","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:26:33.567Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756203993097_7bz9bfjgl","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:26:33.598Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756203993097_7bz9bfjgl","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:26:33.606Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756203993097_7bz9bfjgl","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:26:33.614Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756203993097_7bz9bfjgl","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:26:33.624Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756203993097_7bz9bfjgl","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:26:33.648Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756203993097_7bz9bfjgl","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:26:33.680Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756203993097_7bz9bfjgl","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:26:33.688Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756203993097_7bz9bfjgl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:33.695Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756203993097_7bz9bfjgl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:26:33.735Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756203993097_7bz9bfjgl","bodySize":193603,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:26:33.743Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":193603,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:26:33.750Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":193603,"chunkSize":16384,"estimatedChunks":12}}
{"timestamp":"2025-08-26T10:26:33.757Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":193603,"expectedSize":193603}}
{"timestamp":"2025-08-26T10:26:33.764Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":193603,"timeout":600000}}
{"timestamp":"2025-08-26T10:26:33.773Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:26:33.781Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:27:01.683Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756203993097_7bz9bfjgl","requestSize":193603,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:27:01.692Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756203993097_7bz9bfjgl","duration":9,"requestSize":193603,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:27:01.699Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":786,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:27:01.731Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756203993097_7bz9bfjgl","totalTime":28634,"layerTimings":{"router":114,"transformer":256,"protocol":70,"serverCompatibility":106,"server":28014,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:27:01.775Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756203993097_7bz9bfjgl","executionId":"req_1756203993097_7bz9bfjgl","totalTime":28634,"success":true}}
{"timestamp":"2025-08-26T10:27:38.309Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:27:38.318Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:27:38.325Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:27:38.332Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:27:38.340Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:27:38.360Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:27:38.370Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204058370_421fg3n23","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:27:38.385Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:27:38.393Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204058370_421fg3n23","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:27:38.400Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:27:38.408Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:27:38.415Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":87,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":88,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",88]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:27:38.423Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204058370_421fg3n23","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:27:38.446Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204058370_421fg3n23","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:27:38.525Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204058370_421fg3n23","hasOutput":true}}
{"timestamp":"2025-08-26T10:27:38.532Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204058370_421fg3n23","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T10:27:38.546Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204058370_421fg3n23","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:27:38.553Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204058370_421fg3n23","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:27:38.561Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204058370_421fg3n23","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:27:38.576Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204058370_421fg3n23","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:27:38.583Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204058370_421fg3n23","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:27:38.591Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204058370_421fg3n23","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:27:38.605Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204058370_421fg3n23","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:27:38.620Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204058370_421fg3n23","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:27:38.627Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204058370_421fg3n23","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:27:38.634Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204058370_421fg3n23","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:27:38.644Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204058370_421fg3n23","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:27:38.666Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204058370_421fg3n23","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:27:38.680Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204058370_421fg3n23","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:27:38.687Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204058370_421fg3n23","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:27:38.695Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204058370_421fg3n23","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T10:27:38.712Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":561,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T10:27:38.730Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:27:38.738Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:27:38.746Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:27:38.753Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:27:38.760Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:27:38.781Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:27:38.790Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204058790_ymexiblor","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:27:38.861Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:27:38.869Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204058790_ymexiblor","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:27:38.876Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:27:38.884Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:27:38.891Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":88,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":89,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",89]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:27:38.898Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204058790_ymexiblor","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:27:38.937Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204058790_ymexiblor","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:27:39.170Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204058790_ymexiblor","hasOutput":true}}
{"timestamp":"2025-08-26T10:27:39.177Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204058790_ymexiblor","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:27:39.206Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204058790_ymexiblor","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:27:39.214Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204058790_ymexiblor","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:27:39.221Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204058790_ymexiblor","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:27:39.253Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204058790_ymexiblor","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:27:39.262Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756204058790_ymexiblor","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:27:39.269Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204058790_ymexiblor","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:27:39.277Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204058790_ymexiblor","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:27:39.306Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204058790_ymexiblor","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:27:39.337Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204058790_ymexiblor","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:27:39.345Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204058790_ymexiblor","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:27:39.352Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204058790_ymexiblor","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:27:39.370Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204058790_ymexiblor","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:27:39.381Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:27:39.388Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:27:39.398Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756204058790_ymexiblor","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:27:39.406Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756204058790_ymexiblor","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:27:39.413Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756204058790_ymexiblor","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:27:39.420Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756204058790_ymexiblor","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:27:39.432Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756204058790_ymexiblor","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:27:39.442Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756204058790_ymexiblor","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:27:39.449Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756204058790_ymexiblor","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:27:39.456Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756204058790_ymexiblor","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:27:39.463Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204058790_ymexiblor","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:27:39.493Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204058790_ymexiblor","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:27:39.501Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204058790_ymexiblor","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:27:39.507Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204058790_ymexiblor","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:27:39.546Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204058790_ymexiblor","bodySize":195063,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:27:39.554Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":195063,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:27:39.561Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":195063,"chunkSize":16384,"estimatedChunks":12}}
{"timestamp":"2025-08-26T10:27:39.568Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":195063,"expectedSize":195063}}
{"timestamp":"2025-08-26T10:27:39.575Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":195063,"timeout":600000}}
{"timestamp":"2025-08-26T10:27:39.584Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:27:39.592Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:27:40.236Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":501,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T10:27:40.269Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204058370_421fg3n23","totalTime":1899,"layerTimings":{"router":62,"transformer":107,"protocol":36,"serverCompatibility":68,"server":1552,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:27:40.287Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204058370_421fg3n23","executionId":"req_1756204058370_421fg3n23","totalTime":1899,"success":true}}
{"timestamp":"2025-08-26T10:27:47.098Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204058790_ymexiblor","requestSize":195063,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:27:47.108Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204058790_ymexiblor","duration":10,"requestSize":195063,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:27:47.116Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":670,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:27:47.150Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204058790_ymexiblor","totalTime":8360,"layerTimings":{"router":116,"transformer":293,"protocol":77,"serverCompatibility":180,"server":7620,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:27:47.194Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204058790_ymexiblor","executionId":"req_1756204058790_ymexiblor","totalTime":8360,"success":true}}
{"timestamp":"2025-08-26T10:27:47.215Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:27:47.223Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:27:47.230Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:27:47.238Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:27:47.245Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:27:47.267Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:27:47.277Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204067277_7lkfjjzr8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:27:47.350Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:27:47.358Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204067277_7lkfjjzr8","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:27:47.365Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:27:47.372Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:27:47.379Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":89,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":90,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",90]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:27:47.386Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204067277_7lkfjjzr8","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:27:47.422Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204067277_7lkfjjzr8","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:27:47.658Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204067277_7lkfjjzr8","hasOutput":true}}
{"timestamp":"2025-08-26T10:27:47.665Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204067277_7lkfjjzr8","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:27:47.696Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204067277_7lkfjjzr8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:27:47.703Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204067277_7lkfjjzr8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:27:47.710Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204067277_7lkfjjzr8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:27:47.743Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204067277_7lkfjjzr8","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:27:47.751Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204067277_7lkfjjzr8","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:27:47.758Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204067277_7lkfjjzr8","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:27:47.789Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204067277_7lkfjjzr8","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:27:47.819Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204067277_7lkfjjzr8","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:27:47.826Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204067277_7lkfjjzr8","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:27:47.833Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204067277_7lkfjjzr8","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:27:47.842Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204067277_7lkfjjzr8","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:27:47.866Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204067277_7lkfjjzr8","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:27:47.897Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204067277_7lkfjjzr8","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:27:47.904Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204067277_7lkfjjzr8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:27:47.911Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204067277_7lkfjjzr8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:27:47.950Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204067277_7lkfjjzr8","bodySize":195061,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:27:47.959Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":195061,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:27:47.967Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":195061,"chunkSize":16384,"estimatedChunks":12}}
{"timestamp":"2025-08-26T10:27:47.974Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":195061,"expectedSize":195061}}
{"timestamp":"2025-08-26T10:27:47.981Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":195061,"timeout":600000}}
{"timestamp":"2025-08-26T10:27:47.992Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:27:47.999Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:28:10.458Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204067277_7lkfjjzr8","requestSize":195061,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:28:10.467Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204067277_7lkfjjzr8","duration":9,"requestSize":195061,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:28:10.474Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":718,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:28:10.510Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204067277_7lkfjjzr8","totalTime":23233,"layerTimings":{"router":115,"transformer":297,"protocol":72,"serverCompatibility":101,"server":22574,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:28:10.556Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204067277_7lkfjjzr8","executionId":"req_1756204067277_7lkfjjzr8","totalTime":23233,"success":true}}
{"timestamp":"2025-08-26T10:28:10.775Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:28:10.782Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:10.789Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:10.796Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:28:10.804Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:28:10.826Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:28:10.835Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204090835_t5ltv8xli","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:28:10.908Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:10.916Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204090835_t5ltv8xli","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:28:10.922Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:28:10.929Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:28:10.936Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":90,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":91,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",91]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:28:10.944Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204090835_t5ltv8xli","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:28:10.984Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204090835_t5ltv8xli","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:28:11.267Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204090835_t5ltv8xli","hasOutput":true}}
{"timestamp":"2025-08-26T10:28:11.274Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204090835_t5ltv8xli","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:28:11.306Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204090835_t5ltv8xli","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:11.314Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204090835_t5ltv8xli","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:11.321Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204090835_t5ltv8xli","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:11.352Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204090835_t5ltv8xli","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:28:11.360Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204090835_t5ltv8xli","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:28:11.367Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204090835_t5ltv8xli","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:28:11.398Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204090835_t5ltv8xli","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:28:11.430Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204090835_t5ltv8xli","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:28:11.438Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204090835_t5ltv8xli","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:28:11.445Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204090835_t5ltv8xli","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:11.454Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204090835_t5ltv8xli","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:28:11.478Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204090835_t5ltv8xli","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:28:11.510Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204090835_t5ltv8xli","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:11.518Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204090835_t5ltv8xli","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:11.526Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204090835_t5ltv8xli","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:11.569Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204090835_t5ltv8xli","bodySize":200259,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:28:11.578Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":200259,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:28:11.585Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":200259,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:28:11.592Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":200259,"expectedSize":200259}}
{"timestamp":"2025-08-26T10:28:11.599Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":200259,"timeout":600000}}
{"timestamp":"2025-08-26T10:28:11.609Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:28:11.615Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:28:16.561Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204090835_t5ltv8xli","requestSize":200259,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:28:16.570Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204090835_t5ltv8xli","duration":9,"requestSize":200259,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:28:16.577Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":677,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:28:16.612Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204090835_t5ltv8xli","totalTime":5777,"layerTimings":{"router":117,"transformer":347,"protocol":70,"serverCompatibility":104,"server":5060,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:28:16.658Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204090835_t5ltv8xli","executionId":"req_1756204090835_t5ltv8xli","totalTime":5777,"success":true}}
{"timestamp":"2025-08-26T10:28:16.680Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:28:16.688Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:16.694Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:16.702Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:28:16.708Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:28:16.732Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:28:16.741Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204096741_45e56wgtu","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:28:16.812Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:16.820Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204096741_45e56wgtu","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:28:16.828Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:28:16.835Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:28:16.842Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":91,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":92,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",92]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:28:16.850Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204096741_45e56wgtu","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:28:16.889Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204096741_45e56wgtu","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:28:17.156Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204096741_45e56wgtu","hasOutput":true}}
{"timestamp":"2025-08-26T10:28:17.163Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204096741_45e56wgtu","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:28:17.193Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204096741_45e56wgtu","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:17.201Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204096741_45e56wgtu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:17.207Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204096741_45e56wgtu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:17.237Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204096741_45e56wgtu","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:28:17.245Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756204096741_45e56wgtu","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:28:17.252Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204096741_45e56wgtu","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:28:17.259Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204096741_45e56wgtu","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:28:17.289Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204096741_45e56wgtu","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:28:17.321Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204096741_45e56wgtu","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:28:17.330Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204096741_45e56wgtu","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:28:17.338Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204096741_45e56wgtu","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:17.358Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204096741_45e56wgtu","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:28:17.368Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756204096741_45e56wgtu","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:28:17.375Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756204096741_45e56wgtu","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:17.382Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756204096741_45e56wgtu","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:28:17.388Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756204096741_45e56wgtu","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:17.400Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756204096741_45e56wgtu","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:28:17.410Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756204096741_45e56wgtu","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:28:17.418Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756204096741_45e56wgtu","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:28:17.425Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756204096741_45e56wgtu","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:17.433Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204096741_45e56wgtu","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:28:17.464Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204096741_45e56wgtu","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:17.471Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204096741_45e56wgtu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:17.478Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204096741_45e56wgtu","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:17.521Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204096741_45e56wgtu","bodySize":200260,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:28:17.530Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":200260,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:28:17.538Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":200260,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:28:17.545Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":200260,"expectedSize":200260}}
{"timestamp":"2025-08-26T10:28:17.552Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":200260,"timeout":600000}}
{"timestamp":"2025-08-26T10:28:17.563Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:28:17.571Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:28:19.216Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204096741_45e56wgtu","requestSize":200260,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:28:19.225Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204096741_45e56wgtu","duration":9,"requestSize":200260,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:28:19.232Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":613,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:28:19.267Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204096741_45e56wgtu","totalTime":2526,"layerTimings":{"router":116,"transformer":328,"protocol":75,"serverCompatibility":167,"server":1764,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:28:19.313Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204096741_45e56wgtu","executionId":"req_1756204096741_45e56wgtu","totalTime":2526,"success":true}}
{"timestamp":"2025-08-26T10:28:19.560Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:28:19.568Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:19.575Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:19.582Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:28:19.590Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:28:19.611Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:28:19.620Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204099620_kfx9bx5rp","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:28:19.700Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:19.708Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204099620_kfx9bx5rp","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:28:19.715Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:28:19.722Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:28:19.729Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":92,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":93,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",93]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:28:19.736Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204099620_kfx9bx5rp","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:28:19.777Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204099620_kfx9bx5rp","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:28:20.063Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204099620_kfx9bx5rp","hasOutput":true}}
{"timestamp":"2025-08-26T10:28:20.070Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204099620_kfx9bx5rp","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:28:20.100Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204099620_kfx9bx5rp","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:20.107Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204099620_kfx9bx5rp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:20.114Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204099620_kfx9bx5rp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:20.144Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204099620_kfx9bx5rp","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:28:20.151Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204099620_kfx9bx5rp","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:28:20.159Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204099620_kfx9bx5rp","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:28:20.190Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204099620_kfx9bx5rp","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:28:20.223Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204099620_kfx9bx5rp","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:28:20.230Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204099620_kfx9bx5rp","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:28:20.238Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204099620_kfx9bx5rp","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:20.248Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204099620_kfx9bx5rp","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:28:20.275Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204099620_kfx9bx5rp","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:28:20.309Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204099620_kfx9bx5rp","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:20.317Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204099620_kfx9bx5rp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:20.324Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204099620_kfx9bx5rp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:20.365Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204099620_kfx9bx5rp","bodySize":202369,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:28:20.373Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":202369,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:28:20.381Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":202369,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:28:20.388Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":202369,"expectedSize":202369}}
{"timestamp":"2025-08-26T10:28:20.395Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":202369,"timeout":600000}}
{"timestamp":"2025-08-26T10:28:20.406Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:28:20.413Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:28:44.052Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204099620_kfx9bx5rp","requestSize":202369,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:28:44.063Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204099620_kfx9bx5rp","duration":11,"requestSize":202369,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:28:44.071Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":991,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:28:44.106Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204099620_kfx9bx5rp","totalTime":24486,"layerTimings":{"router":122,"transformer":349,"protocol":69,"serverCompatibility":112,"server":23758,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:28:44.153Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204099620_kfx9bx5rp","executionId":"req_1756204099620_kfx9bx5rp","totalTime":24486,"success":true}}
{"timestamp":"2025-08-26T10:28:44.177Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:28:44.184Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:44.191Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:44.199Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:28:44.206Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:28:44.228Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:28:44.236Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204124236_5hgiot3sh","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:28:44.307Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:44.315Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204124236_5hgiot3sh","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:28:44.322Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:28:44.330Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:28:44.338Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":93,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":94,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",94]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:28:44.346Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204124236_5hgiot3sh","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:28:44.383Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204124236_5hgiot3sh","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:28:44.680Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204124236_5hgiot3sh","hasOutput":true}}
{"timestamp":"2025-08-26T10:28:44.687Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204124236_5hgiot3sh","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:28:44.717Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204124236_5hgiot3sh","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:44.724Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204124236_5hgiot3sh","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:44.732Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204124236_5hgiot3sh","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:44.765Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204124236_5hgiot3sh","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:28:44.773Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204124236_5hgiot3sh","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:28:44.780Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204124236_5hgiot3sh","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:28:44.811Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204124236_5hgiot3sh","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:28:44.842Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204124236_5hgiot3sh","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:28:44.849Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204124236_5hgiot3sh","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:28:44.857Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204124236_5hgiot3sh","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:44.866Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204124236_5hgiot3sh","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:28:44.891Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204124236_5hgiot3sh","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:28:44.923Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204124236_5hgiot3sh","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:44.931Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204124236_5hgiot3sh","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:44.938Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204124236_5hgiot3sh","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:44.979Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204124236_5hgiot3sh","bodySize":202370,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:28:44.988Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":202370,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:28:44.996Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":202370,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:28:45.003Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":202370,"expectedSize":202370}}
{"timestamp":"2025-08-26T10:28:45.010Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":202370,"timeout":600000}}
{"timestamp":"2025-08-26T10:28:45.023Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:28:45.030Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:28:48.731Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204124236_5hgiot3sh","requestSize":202370,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:28:48.741Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204124236_5hgiot3sh","duration":10,"requestSize":202370,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:28:48.748Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":638,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:28:48.782Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204124236_5hgiot3sh","totalTime":4546,"layerTimings":{"router":116,"transformer":358,"protocol":71,"serverCompatibility":105,"server":3819,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:28:48.828Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204124236_5hgiot3sh","executionId":"req_1756204124236_5hgiot3sh","totalTime":4546,"success":true}}
{"timestamp":"2025-08-26T10:28:49.095Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:28:49.103Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:49.111Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:49.119Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:28:49.127Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:28:49.148Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:28:49.157Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204129157_208ncpdbq","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:28:49.230Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:49.238Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204129157_208ncpdbq","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:28:49.245Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:28:49.252Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:28:49.259Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":94,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":95,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",95]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:28:49.267Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204129157_208ncpdbq","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:28:49.306Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204129157_208ncpdbq","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:28:49.631Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204129157_208ncpdbq","hasOutput":true}}
{"timestamp":"2025-08-26T10:28:49.638Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204129157_208ncpdbq","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:28:49.670Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204129157_208ncpdbq","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:49.677Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204129157_208ncpdbq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:49.684Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204129157_208ncpdbq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:49.714Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204129157_208ncpdbq","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:28:49.721Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756204129157_208ncpdbq","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:28:49.728Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204129157_208ncpdbq","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:28:49.735Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204129157_208ncpdbq","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:28:49.766Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204129157_208ncpdbq","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:28:49.799Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204129157_208ncpdbq","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:28:49.807Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204129157_208ncpdbq","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:28:49.815Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204129157_208ncpdbq","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:49.834Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204129157_208ncpdbq","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:28:49.844Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756204129157_208ncpdbq","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:28:49.851Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756204129157_208ncpdbq","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:49.857Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756204129157_208ncpdbq","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:28:49.864Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756204129157_208ncpdbq","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:49.876Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756204129157_208ncpdbq","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:28:49.886Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756204129157_208ncpdbq","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:28:49.893Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756204129157_208ncpdbq","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:28:49.900Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756204129157_208ncpdbq","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:49.908Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204129157_208ncpdbq","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:28:49.938Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204129157_208ncpdbq","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:49.946Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204129157_208ncpdbq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:49.952Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204129157_208ncpdbq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:49.993Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204129157_208ncpdbq","bodySize":207553,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:28:50.002Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":207553,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:28:50.010Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":207553,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:28:50.018Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":207553,"expectedSize":207553}}
{"timestamp":"2025-08-26T10:28:50.025Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":207553,"timeout":600000}}
{"timestamp":"2025-08-26T10:28:50.034Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:28:50.041Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:28:52.690Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204129157_208ncpdbq","requestSize":207553,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:28:52.699Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204129157_208ncpdbq","duration":9,"requestSize":207553,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:28:52.707Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":617,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:28:52.743Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204129157_208ncpdbq","totalTime":3586,"layerTimings":{"router":118,"transformer":388,"protocol":76,"serverCompatibility":164,"server":2766,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:28:52.790Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204129157_208ncpdbq","executionId":"req_1756204129157_208ncpdbq","totalTime":3586,"success":true}}
{"timestamp":"2025-08-26T10:28:52.812Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:28:52.820Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:52.827Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:28:52.834Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:28:52.842Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:28:52.863Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:28:52.873Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204132873_jcuaqv3dw","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:28:52.940Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:52.948Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204132873_jcuaqv3dw","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:28:52.955Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:28:52.962Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:28:52.969Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":95,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":96,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",96]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:28:52.976Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204132873_jcuaqv3dw","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:28:53.015Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204132873_jcuaqv3dw","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:28:53.343Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204132873_jcuaqv3dw","hasOutput":true}}
{"timestamp":"2025-08-26T10:28:53.350Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204132873_jcuaqv3dw","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:28:53.381Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204132873_jcuaqv3dw","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:53.388Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204132873_jcuaqv3dw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:53.395Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204132873_jcuaqv3dw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:53.426Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204132873_jcuaqv3dw","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:28:53.434Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204132873_jcuaqv3dw","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:28:53.442Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204132873_jcuaqv3dw","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:28:53.474Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204132873_jcuaqv3dw","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:28:53.506Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204132873_jcuaqv3dw","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:28:53.514Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204132873_jcuaqv3dw","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:28:53.521Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204132873_jcuaqv3dw","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:28:53.531Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204132873_jcuaqv3dw","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:28:53.557Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204132873_jcuaqv3dw","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:28:53.591Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204132873_jcuaqv3dw","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:28:53.599Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204132873_jcuaqv3dw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:53.607Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204132873_jcuaqv3dw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:28:53.648Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204132873_jcuaqv3dw","bodySize":207551,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:28:53.657Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":207551,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:28:53.665Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":207551,"chunkSize":16384,"estimatedChunks":13}}
{"timestamp":"2025-08-26T10:28:53.672Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":207551,"expectedSize":207551}}
{"timestamp":"2025-08-26T10:28:53.679Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":207551,"timeout":600000}}
{"timestamp":"2025-08-26T10:28:53.692Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:28:53.699Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:29:17.563Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204132873_jcuaqv3dw","requestSize":207551,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:29:17.572Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204132873_jcuaqv3dw","duration":9,"requestSize":207551,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:29:17.580Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":737,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:29:17.615Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204132873_jcuaqv3dw","totalTime":24742,"layerTimings":{"router":110,"transformer":390,"protocol":72,"serverCompatibility":109,"server":23984,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:29:17.661Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204132873_jcuaqv3dw","executionId":"req_1756204132873_jcuaqv3dw","totalTime":24742,"success":true}}
{"timestamp":"2025-08-26T10:29:17.952Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:29:17.960Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:29:17.967Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:29:17.975Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:29:17.982Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:29:18.004Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:29:18.014Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204158014_lpk27snri","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:29:18.089Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:29:18.097Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204158014_lpk27snri","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:29:18.104Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:29:18.112Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:29:18.120Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":96,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":97,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",97]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:29:18.128Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204158014_lpk27snri","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:29:18.168Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204158014_lpk27snri","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:29:18.527Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204158014_lpk27snri","hasOutput":true}}
{"timestamp":"2025-08-26T10:29:18.534Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204158014_lpk27snri","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:29:18.567Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204158014_lpk27snri","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:29:18.575Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204158014_lpk27snri","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:18.582Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204158014_lpk27snri","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:18.616Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204158014_lpk27snri","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:29:18.624Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204158014_lpk27snri","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:29:18.632Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204158014_lpk27snri","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:29:18.664Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204158014_lpk27snri","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:29:18.698Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204158014_lpk27snri","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:29:18.706Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204158014_lpk27snri","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:29:18.713Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204158014_lpk27snri","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:29:18.722Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204158014_lpk27snri","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:29:18.746Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204158014_lpk27snri","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:29:18.778Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204158014_lpk27snri","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:29:18.786Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204158014_lpk27snri","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:18.794Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204158014_lpk27snri","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:18.838Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204158014_lpk27snri","bodySize":227703,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:29:18.847Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":227703,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:29:18.855Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":227703,"chunkSize":16384,"estimatedChunks":14}}
{"timestamp":"2025-08-26T10:29:18.863Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":227703,"expectedSize":227703}}
{"timestamp":"2025-08-26T10:29:18.870Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":227703,"timeout":600000}}
{"timestamp":"2025-08-26T10:29:18.884Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:29:18.891Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:29:23.630Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204158014_lpk27snri","requestSize":227703,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:29:23.640Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204158014_lpk27snri","duration":10,"requestSize":227703,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:29:23.648Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":638,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:29:23.687Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204158014_lpk27snri","totalTime":5673,"layerTimings":{"router":121,"transformer":424,"protocol":74,"serverCompatibility":106,"server":4865,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T10:29:23.739Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204158014_lpk27snri","executionId":"req_1756204158014_lpk27snri","totalTime":5673,"success":true}}
{"timestamp":"2025-08-26T10:29:23.761Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:29:23.768Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:29:23.775Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:29:23.782Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:29:23.789Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:29:23.811Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:29:23.820Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204163820_rqomx3ylv","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:29:23.898Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:29:23.906Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204163820_rqomx3ylv","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:29:23.914Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:29:23.922Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:29:23.930Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":97,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":98,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",98]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:29:23.938Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204163820_rqomx3ylv","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:29:23.978Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204163820_rqomx3ylv","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:29:24.339Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204163820_rqomx3ylv","hasOutput":true}}
{"timestamp":"2025-08-26T10:29:24.346Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204163820_rqomx3ylv","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:29:24.376Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204163820_rqomx3ylv","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:29:24.384Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204163820_rqomx3ylv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:24.391Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204163820_rqomx3ylv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:24.423Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204163820_rqomx3ylv","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:29:24.431Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756204163820_rqomx3ylv","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:29:24.438Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204163820_rqomx3ylv","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:29:24.446Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204163820_rqomx3ylv","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:29:24.478Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204163820_rqomx3ylv","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:29:24.511Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204163820_rqomx3ylv","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:29:24.519Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204163820_rqomx3ylv","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:29:24.526Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204163820_rqomx3ylv","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:29:24.546Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204163820_rqomx3ylv","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:29:24.556Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:29:24.563Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:29:24.572Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756204163820_rqomx3ylv","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:29:24.580Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756204163820_rqomx3ylv","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:29:24.587Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756204163820_rqomx3ylv","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:29:24.595Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756204163820_rqomx3ylv","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:29:24.607Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756204163820_rqomx3ylv","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:29:24.617Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756204163820_rqomx3ylv","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:29:24.625Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756204163820_rqomx3ylv","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:29:24.632Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756204163820_rqomx3ylv","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:29:24.640Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204163820_rqomx3ylv","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:29:24.673Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204163820_rqomx3ylv","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:29:24.680Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204163820_rqomx3ylv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:24.688Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204163820_rqomx3ylv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:24.730Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204163820_rqomx3ylv","bodySize":227704,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:29:24.739Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":227704,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:29:24.746Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":227704,"chunkSize":16384,"estimatedChunks":14}}
{"timestamp":"2025-08-26T10:29:24.753Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":227704,"expectedSize":227704}}
{"timestamp":"2025-08-26T10:29:24.761Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":227704,"timeout":600000}}
{"timestamp":"2025-08-26T10:29:33.120Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204163820_rqomx3ylv","requestSize":227704,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:29:33.129Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204163820_rqomx3ylv","duration":9,"requestSize":227704,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:29:33.136Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":612,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:29:33.167Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204163820_rqomx3ylv","totalTime":9347,"layerTimings":{"router":126,"transformer":423,"protocol":80,"serverCompatibility":187,"server":8457,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T10:29:33.216Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204163820_rqomx3ylv","executionId":"req_1756204163820_rqomx3ylv","totalTime":9347,"success":true}}
{"timestamp":"2025-08-26T10:29:33.526Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:29:33.534Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:29:33.542Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:29:33.550Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:29:33.557Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:29:33.583Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:29:33.593Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204173593_s7szuuidm","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:29:33.671Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:29:33.680Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204173593_s7szuuidm","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:29:33.687Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:29:33.694Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:29:33.702Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":98,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":99,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",99]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:29:33.710Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204173593_s7szuuidm","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:29:33.751Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204173593_s7szuuidm","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:29:34.144Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204173593_s7szuuidm","hasOutput":true}}
{"timestamp":"2025-08-26T10:29:34.152Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204173593_s7szuuidm","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:29:34.189Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204173593_s7szuuidm","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:29:34.196Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204173593_s7szuuidm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:34.205Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204173593_s7szuuidm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:34.241Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204173593_s7szuuidm","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:29:34.250Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204173593_s7szuuidm","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:29:34.258Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204173593_s7szuuidm","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:29:34.295Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204173593_s7szuuidm","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:29:34.331Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204173593_s7szuuidm","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:29:34.340Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204173593_s7szuuidm","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:29:34.348Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204173593_s7szuuidm","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:29:34.360Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204173593_s7szuuidm","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:29:34.386Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204173593_s7szuuidm","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:29:34.422Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204173593_s7szuuidm","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:29:34.431Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204173593_s7szuuidm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:34.439Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204173593_s7szuuidm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:29:34.490Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204173593_s7szuuidm","bodySize":250079,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:29:34.499Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":250079,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:29:34.507Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":250079,"chunkSize":16384,"estimatedChunks":16}}
{"timestamp":"2025-08-26T10:29:34.515Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":250079,"expectedSize":250079}}
{"timestamp":"2025-08-26T10:29:34.522Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":250079,"timeout":600000}}
{"timestamp":"2025-08-26T10:29:34.534Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:29:34.541Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:30:16.088Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204173593_s7szuuidm","requestSize":250079,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:30:16.097Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204173593_s7szuuidm","duration":9,"requestSize":250079,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:30:16.106Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1356,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:30:16.143Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204173593_s7szuuidm","totalTime":42550,"layerTimings":{"router":124,"transformer":464,"protocol":81,"serverCompatibility":118,"server":41676,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:30:16.197Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204173593_s7szuuidm","executionId":"req_1756204173593_s7szuuidm","totalTime":42550,"success":true}}
{"timestamp":"2025-08-26T10:30:16.221Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:30:16.229Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:30:16.237Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:30:16.243Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:30:16.251Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:30:16.273Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:30:16.284Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204216284_a0butgkn5","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:30:16.358Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:30:16.366Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204216284_a0butgkn5","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:30:16.373Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:30:16.380Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:30:16.387Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":99,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":100,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",100]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:30:16.394Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204216284_a0butgkn5","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:30:16.434Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204216284_a0butgkn5","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:30:16.835Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204216284_a0butgkn5","hasOutput":true}}
{"timestamp":"2025-08-26T10:30:16.843Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204216284_a0butgkn5","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:30:16.876Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204216284_a0butgkn5","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:30:16.884Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204216284_a0butgkn5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:16.892Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204216284_a0butgkn5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:16.927Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204216284_a0butgkn5","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:30:16.936Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204216284_a0butgkn5","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:30:16.944Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204216284_a0butgkn5","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:30:16.978Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204216284_a0butgkn5","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:30:17.012Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204216284_a0butgkn5","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:30:17.020Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204216284_a0butgkn5","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:30:17.028Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204216284_a0butgkn5","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:30:17.038Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204216284_a0butgkn5","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:30:17.064Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204216284_a0butgkn5","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:30:17.098Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204216284_a0butgkn5","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:30:17.105Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204216284_a0butgkn5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:17.112Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204216284_a0butgkn5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:17.156Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204216284_a0butgkn5","bodySize":250080,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:30:17.165Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":250080,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:30:17.173Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":250080,"chunkSize":16384,"estimatedChunks":16}}
{"timestamp":"2025-08-26T10:30:17.181Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":250080,"expectedSize":250080}}
{"timestamp":"2025-08-26T10:30:17.188Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":250080,"timeout":600000}}
{"timestamp":"2025-08-26T10:30:17.197Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:30:17.204Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:30:22.593Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204216284_a0butgkn5","requestSize":250080,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:30:22.603Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204216284_a0butgkn5","duration":10,"requestSize":250080,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:30:22.611Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":662,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:30:22.646Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204216284_a0butgkn5","totalTime":6362,"layerTimings":{"router":116,"transformer":467,"protocol":78,"serverCompatibility":112,"server":5510,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:30:22.698Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204216284_a0butgkn5","executionId":"req_1756204216284_a0butgkn5","totalTime":6362,"success":true}}
{"timestamp":"2025-08-26T10:30:23.036Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:30:23.044Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:30:23.052Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:30:23.059Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:30:23.066Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:30:23.088Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:30:23.098Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204223098_xwjspr7g9","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:30:23.171Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:30:23.179Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204223098_xwjspr7g9","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:30:23.185Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:30:23.192Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:30:23.199Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":100,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":101,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",101]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:30:23.206Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204223098_xwjspr7g9","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:30:23.247Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204223098_xwjspr7g9","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:30:23.660Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204223098_xwjspr7g9","hasOutput":true}}
{"timestamp":"2025-08-26T10:30:23.667Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204223098_xwjspr7g9","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:30:23.699Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204223098_xwjspr7g9","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:30:23.707Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204223098_xwjspr7g9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:23.714Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204223098_xwjspr7g9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:23.750Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204223098_xwjspr7g9","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:30:23.757Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756204223098_xwjspr7g9","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:30:23.765Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204223098_xwjspr7g9","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:30:23.773Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204223098_xwjspr7g9","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:30:23.807Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204223098_xwjspr7g9","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:30:23.841Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204223098_xwjspr7g9","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:30:23.849Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204223098_xwjspr7g9","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:30:23.858Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204223098_xwjspr7g9","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:30:23.876Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204223098_xwjspr7g9","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:30:23.886Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756204223098_xwjspr7g9","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:30:23.893Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756204223098_xwjspr7g9","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:30:23.901Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756204223098_xwjspr7g9","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:30:23.908Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756204223098_xwjspr7g9","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:30:23.920Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756204223098_xwjspr7g9","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:30:23.930Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756204223098_xwjspr7g9","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:30:23.938Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756204223098_xwjspr7g9","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:30:23.945Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756204223098_xwjspr7g9","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:30:23.953Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204223098_xwjspr7g9","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:30:23.989Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204223098_xwjspr7g9","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:30:23.997Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204223098_xwjspr7g9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:24.006Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204223098_xwjspr7g9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:24.052Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204223098_xwjspr7g9","bodySize":255427,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:30:24.061Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":255427,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:30:24.069Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":255427,"chunkSize":16384,"estimatedChunks":16}}
{"timestamp":"2025-08-26T10:30:24.077Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":255427,"expectedSize":255427}}
{"timestamp":"2025-08-26T10:30:24.085Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":255427,"timeout":600000}}
{"timestamp":"2025-08-26T10:30:24.095Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:30:24.102Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:30:32.022Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204223098_xwjspr7g9","requestSize":255427,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:30:32.032Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204223098_xwjspr7g9","duration":10,"requestSize":255427,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:30:32.041Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":656,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:30:32.075Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204223098_xwjspr7g9","totalTime":8977,"layerTimings":{"router":116,"transformer":479,"protocol":85,"serverCompatibility":174,"server":8045,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T10:30:32.130Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204223098_xwjspr7g9","executionId":"req_1756204223098_xwjspr7g9","totalTime":8977,"success":true}}
{"timestamp":"2025-08-26T10:30:32.154Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:30:32.162Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:30:32.169Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:30:32.177Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:30:32.184Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:30:32.208Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:30:32.219Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204232219_d5jx0chzo","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:30:32.292Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:30:32.299Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204232219_d5jx0chzo","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:30:32.307Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:30:32.314Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:30:32.321Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":101,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":102,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",102]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:30:32.328Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204232219_d5jx0chzo","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:30:32.368Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204232219_d5jx0chzo","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:30:32.787Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204232219_d5jx0chzo","hasOutput":true}}
{"timestamp":"2025-08-26T10:30:32.794Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204232219_d5jx0chzo","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:30:32.827Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204232219_d5jx0chzo","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:30:32.834Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204232219_d5jx0chzo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:32.842Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204232219_d5jx0chzo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:32.876Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204232219_d5jx0chzo","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:30:32.883Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204232219_d5jx0chzo","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:30:32.891Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204232219_d5jx0chzo","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:30:32.925Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204232219_d5jx0chzo","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:30:32.959Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204232219_d5jx0chzo","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:30:32.968Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204232219_d5jx0chzo","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:30:32.975Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204232219_d5jx0chzo","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:30:32.985Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204232219_d5jx0chzo","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:30:33.012Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204232219_d5jx0chzo","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:30:33.044Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204232219_d5jx0chzo","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:30:33.052Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204232219_d5jx0chzo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:33.059Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204232219_d5jx0chzo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:30:33.104Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204232219_d5jx0chzo","bodySize":255425,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:30:33.113Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":255425,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:30:33.120Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":255425,"chunkSize":16384,"estimatedChunks":16}}
{"timestamp":"2025-08-26T10:30:33.128Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":255425,"expectedSize":255425}}
{"timestamp":"2025-08-26T10:30:33.135Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":255425,"timeout":600000}}
{"timestamp":"2025-08-26T10:30:33.145Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:30:33.152Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:31:32.704Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:31:32.715Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:31:32.723Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:31:32.731Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:31:32.739Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:31:32.765Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:31:32.775Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204292775_ds58wz8em","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:31:32.846Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:31:32.854Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204292775_ds58wz8em","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:31:32.861Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:31:32.868Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:31:32.875Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":102,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":103,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",103]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:31:32.883Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204292775_ds58wz8em","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:31:32.924Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204292775_ds58wz8em","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:31:33.355Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204292775_ds58wz8em","hasOutput":true}}
{"timestamp":"2025-08-26T10:31:33.362Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204292775_ds58wz8em","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:31:33.396Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204292775_ds58wz8em","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:31:33.404Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204292775_ds58wz8em","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:33.412Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204292775_ds58wz8em","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:33.446Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204292775_ds58wz8em","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:31:33.454Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204292775_ds58wz8em","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:31:33.462Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204292775_ds58wz8em","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T10:31:33.495Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204292775_ds58wz8em","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:31:33.532Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204292775_ds58wz8em","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"modelscope","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:31:33.541Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204292775_ds58wz8em","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:31:33.548Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204292775_ds58wz8em","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:31:33.558Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204292775_ds58wz8em","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:31:33.584Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204292775_ds58wz8em","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:31:33.616Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204292775_ds58wz8em","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:31:33.624Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204292775_ds58wz8em","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:33.630Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204292775_ds58wz8em","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:33.676Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204292775_ds58wz8em","bodySize":255426,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:31:33.686Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":255426,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:31:33.695Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":255426,"chunkSize":16384,"estimatedChunks":16}}
{"timestamp":"2025-08-26T10:31:33.704Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":255426,"expectedSize":255426}}
{"timestamp":"2025-08-26T10:31:33.711Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":255426,"timeout":600000}}
{"timestamp":"2025-08-26T10:31:33.721Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:31:33.729Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:31:37.484Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204232219_d5jx0chzo","requestSize":255425,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:31:37.493Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204232219_d5jx0chzo","duration":9,"requestSize":255425,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:31:37.500Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1449,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:31:37.535Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204232219_d5jx0chzo","totalTime":65316,"layerTimings":{"router":116,"transformer":485,"protocol":75,"serverCompatibility":111,"server":64453,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:31:37.590Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204232219_d5jx0chzo","executionId":"req_1756204232219_d5jx0chzo","totalTime":65316,"success":true}}
{"timestamp":"2025-08-26T10:31:40.991Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204292775_ds58wz8em","requestSize":255426,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:31:40.999Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204292775_ds58wz8em","duration":8,"requestSize":255426,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:31:41.006Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":938,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:31:41.038Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204292775_ds58wz8em","totalTime":8263,"layerTimings":{"router":116,"transformer":498,"protocol":75,"serverCompatibility":113,"server":7385,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T10:31:41.092Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204292775_ds58wz8em","executionId":"req_1756204292775_ds58wz8em","totalTime":8263,"success":true}}
{"timestamp":"2025-08-26T10:31:41.441Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:31:41.449Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:31:41.456Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:31:41.464Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:31:41.471Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:31:41.503Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:31:41.513Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204301513_yaoffls7f","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:31:41.590Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:31:41.599Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204301513_yaoffls7f","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:31:41.607Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:31:41.614Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:31:41.622Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":103,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":104,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",104]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:31:41.630Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204301513_yaoffls7f","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:31:41.672Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204301513_yaoffls7f","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:31:42.128Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204301513_yaoffls7f","hasOutput":true}}
{"timestamp":"2025-08-26T10:31:42.135Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204301513_yaoffls7f","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:31:42.167Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204301513_yaoffls7f","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:31:42.174Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204301513_yaoffls7f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:42.181Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204301513_yaoffls7f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:42.215Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204301513_yaoffls7f","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T10:31:42.223Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756204301513_yaoffls7f","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T10:31:42.231Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204301513_yaoffls7f","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:31:42.238Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204301513_yaoffls7f","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:31:42.272Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204301513_yaoffls7f","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:31:42.307Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204301513_yaoffls7f","selectedPipelineId":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"qwen","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:31:42.315Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204301513_yaoffls7f","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:31:42.322Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204301513_yaoffls7f","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:31:42.343Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204301513_yaoffls7f","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T10:31:42.352Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756204301513_yaoffls7f","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T10:31:42.360Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756204301513_yaoffls7f","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:31:42.367Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756204301513_yaoffls7f","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T10:31:42.374Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756204301513_yaoffls7f","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:31:42.386Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756204301513_yaoffls7f","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T10:31:42.396Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756204301513_yaoffls7f","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T10:31:42.405Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756204301513_yaoffls7f","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T10:31:42.412Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756204301513_yaoffls7f","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:31:42.419Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204301513_yaoffls7f","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:31:42.453Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204301513_yaoffls7f","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:31:42.462Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204301513_yaoffls7f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:42.469Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204301513_yaoffls7f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:42.514Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204301513_yaoffls7f","bodySize":256978,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:31:42.524Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":256978,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:31:42.533Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":256978,"chunkSize":16384,"estimatedChunks":16}}
{"timestamp":"2025-08-26T10:31:42.541Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":256978,"expectedSize":256978}}
{"timestamp":"2025-08-26T10:31:42.549Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":256978,"timeout":600000}}
{"timestamp":"2025-08-26T10:31:42.560Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:31:42.567Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:31:44.364Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204301513_yaoffls7f","requestSize":256978,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:31:44.373Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204301513_yaoffls7f","duration":9,"requestSize":256978,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:31:44.381Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":621,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:31:44.417Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204301513_yaoffls7f","totalTime":2904,"layerTimings":{"router":124,"transformer":522,"protocol":84,"serverCompatibility":173,"server":1922,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T10:31:44.471Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204301513_yaoffls7f","executionId":"req_1756204301513_yaoffls7f","totalTime":2904,"success":true}}
{"timestamp":"2025-08-26T10:31:44.497Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T10:31:44.505Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:31:44.512Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T10:31:44.520Z","level":"INFO","message":"✅ 智能错误恢复策略启用","data":{"intelligentErrorRecovery":true,"transparentErrorHandling":true,"noSilentDegradation":true}}
{"timestamp":"2025-08-26T10:31:44.527Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T10:31:44.550Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T10:31:44.560Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756204304560_j722c6x4p","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T10:31:44.631Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:31:44.638Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756204304560_j722c6x4p","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T10:31:44.646Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,gemini-2.5-pro;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,gemini-2.5-pro","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T10:31:44.654Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T10:31:44.661Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":104,"selectedIndex":2,"selectedPipeline":"shuaihong-gemini-2.5-pro-key0","totalPipelines":3,"position":"3/3","nextIndex":105,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-gemini-2.5-pro-key0",105]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"]}}
{"timestamp":"2025-08-26T10:31:44.669Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756204304560_j722c6x4p","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T10:31:44.710Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756204304560_j722c6x4p","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T10:31:45.164Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756204304560_j722c6x4p","hasOutput":true}}
{"timestamp":"2025-08-26T10:31:45.171Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756204304560_j722c6x4p","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T10:31:45.203Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204304560_j722c6x4p","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:31:45.212Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204304560_j722c6x4p","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:45.221Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756204304560_j722c6x4p","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:45.257Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756204304560_j722c6x4p","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:31:45.266Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756204304560_j722c6x4p","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T10:31:45.275Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756204304560_j722c6x4p","selectedPipeline":"shuaihong-gemini-2.5-pro-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"gemini-2.5-pro","routeUsed":"shuaihong,gemini-2.5-pro"}}
{"timestamp":"2025-08-26T10:31:45.311Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756204304560_j722c6x4p","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T10:31:45.347Z","level":"INFO","message":"🔥 ServerCompatibility层pipeline选择","data":{"requestId":"req_1756204304560_j722c6x4p","selectedPipelineId":"shuaihong-gemini-2.5-pro-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-gemini-2.5-pro-key0"],"extractedProviderType":"shuaihong","usedSelectedPipeline":true}}
{"timestamp":"2025-08-26T10:31:45.356Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756204304560_j722c6x4p","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T10:31:45.364Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756204304560_j722c6x4p","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T10:31:45.375Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756204304560_j722c6x4p","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T10:31:45.402Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756204304560_j722c6x4p","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T10:31:45.440Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756204304560_j722c6x4p","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T10:31:45.449Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756204304560_j722c6x4p","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:45.458Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756204304560_j722c6x4p","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T10:31:45.506Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756204304560_j722c6x4p","bodySize":256976,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T10:31:45.516Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":256976,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T10:31:45.524Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":256976,"chunkSize":16384,"estimatedChunks":16}}
{"timestamp":"2025-08-26T10:31:45.533Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":256976,"expectedSize":256976}}
{"timestamp":"2025-08-26T10:31:45.540Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":256976,"timeout":600000}}
{"timestamp":"2025-08-26T10:31:45.553Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T10:31:45.561Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T10:32:43.783Z","level":"INFO","message":"心跳会话已启动","data":{"sessionId":"req_1756204304560_j722c6x4p","requestSize":256976,"heartbeatInterval":30000,"totalTimeout":600000}}
{"timestamp":"2025-08-26T10:32:43.827Z","level":"INFO","message":"心跳会话已停止","data":{"sessionId":"req_1756204304560_j722c6x4p","duration":44,"requestSize":256976,"totalHeartbeats":0}}
{"timestamp":"2025-08-26T10:32:43.835Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":2125,"isLongTextRequest":true,"heartbeatSessionCleaned":true}}
{"timestamp":"2025-08-26T10:32:43.868Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756204304560_j722c6x4p","totalTime":59308,"layerTimings":{"router":115,"transformer":520,"protocol":82,"serverCompatibility":121,"server":58389,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T10:32:43.922Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756204304560_j722c6x4p","executionId":"req_1756204304560_j722c6x4p","totalTime":59308,"success":true}}
