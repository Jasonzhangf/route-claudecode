{"timestamp":"2025-08-26T00:03:47.377Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T00:03:47.383Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T00:03:47.395Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T00:03:47.401Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T00:03:47.406Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T00:03:47.411Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T00:03:47.414Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T00:03:47.418Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T00:03:47.423Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T00:03:47.428Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T00:03:47.433Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:03:47.438Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:03:47.444Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T00:03:47.450Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T00:03:47.452Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T00:03:47.458Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T00:03:47.463Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T00:03:47.469Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T00:03:47.474Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T00:03:47.480Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T00:03:47.485Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T00:03:47.491Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T00:03:47.497Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":45,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T00:03:47.502Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T00:03:47.512Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T00:03:47.518Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":45,"uptime":0}}
{"timestamp":"2025-08-26T00:03:47.524Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T00:03:47.530Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:08.208Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:08.215Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:08.221Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:08.227Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:08.234Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:08.240Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166648240_mjwx6kiuw","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:08.267Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:08.273Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166648240_mjwx6kiuw","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T00:04:08.296Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166648240_mjwx6kiuw","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:08.311Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166648240_mjwx6kiuw","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:08.317Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166648240_mjwx6kiuw","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T00:04:08.330Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166648240_mjwx6kiuw","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:08.336Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166648240_mjwx6kiuw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:08.340Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166648240_mjwx6kiuw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:08.363Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166648240_mjwx6kiuw","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:08.376Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166648240_mjwx6kiuw","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:08.382Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166648240_mjwx6kiuw","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:08.389Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166648240_mjwx6kiuw","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:08.394Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:08.400Z","level":"INFO","message":"Qwen token即将过期，开始刷新","data":{"authFileName":"[REDACTED]","expiresAt":"2025-08-25T17:49:46.295Z"}}
{"timestamp":"2025-08-26T00:04:08.937Z","level":"INFO","message":"Qwen token刷新成功","data":{"accountIndex":3,"newExpiresAt":"2025-08-26T06:04:08.937Z","hasNewResourceUrl":true}}
{"timestamp":"2025-08-26T00:04:08.948Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756166648240_mjwx6kiuw","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T00:04:08.954Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756166648240_mjwx6kiuw","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:08.961Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756166648240_mjwx6kiuw","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T00:04:08.966Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756166648240_mjwx6kiuw","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:08.977Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756166648240_mjwx6kiuw","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T00:04:08.986Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756166648240_mjwx6kiuw","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T00:04:08.993Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756166648240_mjwx6kiuw","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T00:04:08.999Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756166648240_mjwx6kiuw","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:09.006Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166648240_mjwx6kiuw","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:09.021Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166648240_mjwx6kiuw","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:09.027Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166648240_mjwx6kiuw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:09.033Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166648240_mjwx6kiuw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:09.051Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":1400,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T00:04:10.060Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":479,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T00:04:10.125Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166648240_mjwx6kiuw","totalTime":1885,"layerTimings":{"router":41,"transformer":43,"protocol":17,"serverCompatibility":653,"server":1061,"responseTransform":25},"transformationCount":4}}
{"timestamp":"2025-08-26T00:04:10.142Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166648240_mjwx6kiuw","executionId":"req_1756166648240_mjwx6kiuw","totalTime":1885,"success":true}}
{"timestamp":"2025-08-26T00:04:14.059Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:14.066Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:14.072Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:14.077Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:14.084Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:14.090Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166654090_vi8xgrhwg","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:14.106Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.112Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166654090_vi8xgrhwg","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T00:04:14.135Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166654090_vi8xgrhwg","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:14.148Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166654090_vi8xgrhwg","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:14.153Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166654090_vi8xgrhwg","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T00:04:14.165Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166654090_vi8xgrhwg","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:14.170Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166654090_vi8xgrhwg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:14.176Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166654090_vi8xgrhwg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:14.197Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166654090_vi8xgrhwg","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:14.209Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166654090_vi8xgrhwg","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:14.214Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166654090_vi8xgrhwg","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.220Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166654090_vi8xgrhwg","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:14.233Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:14.238Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:14.243Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:14.248Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:14.253Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:14.259Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166654259_1gn93pqml","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:14.356Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.361Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166654259_1gn93pqml","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:04:14.389Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166654259_1gn93pqml","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:14.410Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166654259_1gn93pqml","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:14.416Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166654259_1gn93pqml","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:04:14.440Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166654259_1gn93pqml","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:14.446Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166654259_1gn93pqml","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:14.450Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166654259_1gn93pqml","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:14.493Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166654259_1gn93pqml","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:14.515Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166654259_1gn93pqml","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:14.521Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166654259_1gn93pqml","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.526Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166654259_1gn93pqml","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:14.532Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166654259_1gn93pqml","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:14.553Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166654259_1gn93pqml","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:14.559Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166654259_1gn93pqml","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:14.565Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166654259_1gn93pqml","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:14.594Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":123733,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:14.600Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":123733,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:14.605Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:14.610Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:14.616Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756166654090_vi8xgrhwg","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T00:04:14.622Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756166654090_vi8xgrhwg","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.627Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756166654090_vi8xgrhwg","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T00:04:14.632Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756166654090_vi8xgrhwg","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.641Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756166654090_vi8xgrhwg","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T00:04:14.649Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756166654090_vi8xgrhwg","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T00:04:14.654Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756166654090_vi8xgrhwg","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T00:04:14.659Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756166654090_vi8xgrhwg","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:14.663Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166654090_vi8xgrhwg","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:14.676Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166654090_vi8xgrhwg","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:14.681Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166654090_vi8xgrhwg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:14.686Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166654090_vi8xgrhwg","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T00:04:14.701Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":798,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T00:04:15.476Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":466,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T00:04:15.539Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166654090_vi8xgrhwg","totalTime":1449,"layerTimings":{"router":30,"transformer":38,"protocol":15,"serverCompatibility":474,"server":823,"responseTransform":25},"transformationCount":4}}
{"timestamp":"2025-08-26T00:04:15.554Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166654090_vi8xgrhwg","executionId":"req_1756166654090_vi8xgrhwg","totalTime":1449,"success":true}}
{"timestamp":"2025-08-26T00:04:24.946Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":943,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:04:24.988Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166654259_1gn93pqml","totalTime":10729,"layerTimings":{"router":108,"transformer":68,"protocol":37,"serverCompatibility":55,"server":10401,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:04:25.021Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166654259_1gn93pqml","executionId":"req_1756166654259_1gn93pqml","totalTime":10729,"success":true}}
{"timestamp":"2025-08-26T00:04:25.039Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:25.046Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:25.051Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:25.057Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:25.064Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:25.071Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166665071_g8a8ww4mo","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:25.187Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:25.193Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166665071_g8a8ww4mo","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:04:25.226Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166665071_g8a8ww4mo","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:25.249Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166665071_g8a8ww4mo","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:25.255Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166665071_g8a8ww4mo","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:04:25.280Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166665071_g8a8ww4mo","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:25.285Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166665071_g8a8ww4mo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:25.291Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166665071_g8a8ww4mo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:25.335Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166665071_g8a8ww4mo","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:25.360Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166665071_g8a8ww4mo","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:25.366Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166665071_g8a8ww4mo","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:25.372Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166665071_g8a8ww4mo","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:25.378Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166665071_g8a8ww4mo","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:25.403Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166665071_g8a8ww4mo","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:25.409Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166665071_g8a8ww4mo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:25.415Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166665071_g8a8ww4mo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:25.451Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":123733,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:25.457Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":123733,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:25.463Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:40.802Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":2793,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:04:40.843Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166665071_g8a8ww4mo","totalTime":15772,"layerTimings":{"router":131,"transformer":72,"protocol":38,"serverCompatibility":62,"server":15401,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T00:04:40.872Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166665071_g8a8ww4mo","executionId":"req_1756166665071_g8a8ww4mo","totalTime":15772,"success":true}}
{"timestamp":"2025-08-26T00:04:41.071Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:41.078Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:41.083Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:41.088Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:41.095Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:41.100Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166681100_zsdq3b4fb","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:41.206Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:41.211Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166681100_zsdq3b4fb","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:04:41.241Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166681100_zsdq3b4fb","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:41.269Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166681100_zsdq3b4fb","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:41.274Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166681100_zsdq3b4fb","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:04:41.296Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166681100_zsdq3b4fb","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:41.302Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166681100_zsdq3b4fb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:41.308Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166681100_zsdq3b4fb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:41.351Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166681100_zsdq3b4fb","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:41.375Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166681100_zsdq3b4fb","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:41.380Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166681100_zsdq3b4fb","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:41.385Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166681100_zsdq3b4fb","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:41.392Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166681100_zsdq3b4fb","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:41.415Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166681100_zsdq3b4fb","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:41.420Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166681100_zsdq3b4fb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:41.426Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166681100_zsdq3b4fb","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:41.457Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":126062,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:41.463Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":126062,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:41.470Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:04:50.519Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1296,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:04:50.563Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166681100_zsdq3b4fb","totalTime":9463,"layerTimings":{"router":117,"transformer":73,"protocol":37,"serverCompatibility":58,"server":9113,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T00:04:50.594Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166681100_zsdq3b4fb","executionId":"req_1756166681100_zsdq3b4fb","totalTime":9463,"success":true}}
{"timestamp":"2025-08-26T00:04:50.612Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:04:50.618Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:50.623Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:04:50.629Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:04:50.636Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:04:50.642Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166690642_x8bawebdl","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:04:50.744Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:50.749Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166690642_x8bawebdl","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:04:50.782Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166690642_x8bawebdl","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:04:50.811Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166690642_x8bawebdl","hasOutput":true}}
{"timestamp":"2025-08-26T00:04:50.816Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166690642_x8bawebdl","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:04:50.840Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166690642_x8bawebdl","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:50.846Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166690642_x8bawebdl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:50.851Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166690642_x8bawebdl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:50.893Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166690642_x8bawebdl","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:04:50.919Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166690642_x8bawebdl","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:04:50.925Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166690642_x8bawebdl","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:04:50.931Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166690642_x8bawebdl","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:04:50.938Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166690642_x8bawebdl","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:04:50.962Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166690642_x8bawebdl","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:04:50.967Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166690642_x8bawebdl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:50.972Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166690642_x8bawebdl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:04:51.003Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":126062,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:51.009Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":126062,"timeout":30000}}
{"timestamp":"2025-08-26T00:04:51.015Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:05:00.304Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1310,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:05:00.343Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166690642_x8bawebdl","totalTime":9701,"layerTimings":{"router":116,"transformer":77,"protocol":36,"serverCompatibility":62,"server":9347,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:05:00.374Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166690642_x8bawebdl","executionId":"req_1756166690642_x8bawebdl","totalTime":9701,"success":true}}
{"timestamp":"2025-08-26T00:05:00.566Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:05:00.572Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:00.578Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:00.584Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:05:00.591Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:05:00.597Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166700597_gn3r1ms5l","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:05:00.705Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:00.711Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166700597_gn3r1ms5l","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:05:00.742Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166700597_gn3r1ms5l","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:05:00.778Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166700597_gn3r1ms5l","hasOutput":true}}
{"timestamp":"2025-08-26T00:05:00.783Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166700597_gn3r1ms5l","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:05:00.807Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166700597_gn3r1ms5l","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:00.813Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166700597_gn3r1ms5l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:00.818Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166700597_gn3r1ms5l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:00.859Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166700597_gn3r1ms5l","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:05:00.883Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166700597_gn3r1ms5l","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:05:00.889Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166700597_gn3r1ms5l","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:00.895Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166700597_gn3r1ms5l","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:05:00.902Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166700597_gn3r1ms5l","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:05:00.924Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166700597_gn3r1ms5l","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:00.930Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166700597_gn3r1ms5l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:00.935Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166700597_gn3r1ms5l","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:00.966Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":128276,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:00.972Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":128276,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:00.977Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:05:07.469Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":530,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:05:07.509Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166700597_gn3r1ms5l","totalTime":6912,"layerTimings":{"router":121,"transformer":84,"protocol":36,"serverCompatibility":59,"server":6551,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:05:07.542Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166700597_gn3r1ms5l","executionId":"req_1756166700597_gn3r1ms5l","totalTime":6912,"success":true}}
{"timestamp":"2025-08-26T00:05:07.562Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:05:07.568Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:07.574Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:07.580Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:05:07.587Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:05:07.594Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166707594_yly06hvvd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:05:07.697Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:07.703Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166707594_yly06hvvd","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:05:07.734Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166707594_yly06hvvd","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:05:07.771Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166707594_yly06hvvd","hasOutput":true}}
{"timestamp":"2025-08-26T00:05:07.776Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166707594_yly06hvvd","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:05:07.799Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166707594_yly06hvvd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:07.805Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166707594_yly06hvvd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:07.810Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166707594_yly06hvvd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:07.852Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166707594_yly06hvvd","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:05:07.876Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166707594_yly06hvvd","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:05:07.881Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166707594_yly06hvvd","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:07.887Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166707594_yly06hvvd","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:05:07.895Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166707594_yly06hvvd","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:05:07.920Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166707594_yly06hvvd","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:07.926Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166707594_yly06hvvd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:07.931Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166707594_yly06hvvd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:07.963Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":128276,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:07.969Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":128276,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:07.976Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:05:12.578Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":533,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:05:12.621Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166707594_yly06hvvd","totalTime":5027,"layerTimings":{"router":117,"transformer":83,"protocol":37,"serverCompatibility":63,"server":4666,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:05:12.656Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166707594_yly06hvvd","executionId":"req_1756166707594_yly06hvvd","totalTime":5027,"success":true}}
{"timestamp":"2025-08-26T00:05:18.108Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:05:18.114Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:18.119Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:18.125Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:05:18.132Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:05:18.139Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166718139_9h57035ir","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:05:18.243Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:18.248Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166718139_9h57035ir","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:05:18.280Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166718139_9h57035ir","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:05:18.328Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166718139_9h57035ir","hasOutput":true}}
{"timestamp":"2025-08-26T00:05:18.334Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166718139_9h57035ir","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:05:18.359Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166718139_9h57035ir","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:18.365Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166718139_9h57035ir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:18.370Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166718139_9h57035ir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:18.414Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166718139_9h57035ir","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:05:18.440Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166718139_9h57035ir","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:05:18.445Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166718139_9h57035ir","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:18.451Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166718139_9h57035ir","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:05:18.459Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166718139_9h57035ir","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:05:18.484Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166718139_9h57035ir","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:18.490Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166718139_9h57035ir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:18.496Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166718139_9h57035ir","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:18.530Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":133832,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:18.536Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":133832,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:18.542Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:05:27.485Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1405,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:05:27.532Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166718139_9h57035ir","totalTime":9393,"layerTimings":{"router":117,"transformer":98,"protocol":39,"serverCompatibility":64,"server":9013,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:05:27.564Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166718139_9h57035ir","executionId":"req_1756166718139_9h57035ir","totalTime":9393,"success":true}}
{"timestamp":"2025-08-26T00:05:27.582Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:05:27.587Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:27.594Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:27.600Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:05:27.607Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:05:27.613Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166727613_gegxan1t8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:05:27.720Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:27.726Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166727613_gegxan1t8","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:05:27.758Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166727613_gegxan1t8","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:05:27.805Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166727613_gegxan1t8","hasOutput":true}}
{"timestamp":"2025-08-26T00:05:27.811Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166727613_gegxan1t8","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:05:27.834Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166727613_gegxan1t8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:27.839Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166727613_gegxan1t8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:27.845Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166727613_gegxan1t8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:27.889Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166727613_gegxan1t8","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:05:27.914Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166727613_gegxan1t8","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:05:27.919Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166727613_gegxan1t8","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:27.925Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166727613_gegxan1t8","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:05:27.932Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166727613_gegxan1t8","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:05:27.956Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166727613_gegxan1t8","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:27.961Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166727613_gegxan1t8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:27.966Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166727613_gegxan1t8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:27.998Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":133832,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:28.004Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":133832,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:28.010Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:05:35.951Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":743,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:05:35.993Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166727613_gegxan1t8","totalTime":8380,"layerTimings":{"router":120,"transformer":95,"protocol":38,"serverCompatibility":61,"server":8003,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T00:05:36.026Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166727613_gegxan1t8","executionId":"req_1756166727613_gegxan1t8","totalTime":8380,"success":true}}
{"timestamp":"2025-08-26T00:05:36.702Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:05:36.709Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:36.715Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:05:36.721Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:05:36.730Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:05:36.737Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166736737_l5m5xvt5n","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:05:36.875Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:36.880Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166736737_l5m5xvt5n","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:05:36.937Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166736737_l5m5xvt5n","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:05:37.037Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166736737_l5m5xvt5n","hasOutput":true}}
{"timestamp":"2025-08-26T00:05:37.043Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166736737_l5m5xvt5n","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:05:37.088Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166736737_l5m5xvt5n","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:37.095Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166736737_l5m5xvt5n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:37.100Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166736737_l5m5xvt5n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:37.185Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166736737_l5m5xvt5n","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:05:37.232Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166736737_l5m5xvt5n","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:05:37.239Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166736737_l5m5xvt5n","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:05:37.245Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166736737_l5m5xvt5n","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:05:37.253Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166736737_l5m5xvt5n","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:05:37.300Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166736737_l5m5xvt5n","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:05:37.306Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166736737_l5m5xvt5n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:37.312Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166736737_l5m5xvt5n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:05:37.393Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":820722,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:37.400Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":820722,"timeout":30000}}
{"timestamp":"2025-08-26T00:05:37.405Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:06:05.905Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:06:05.949Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166736737_l5m5xvt5n","totalTime":29212,"layerTimings":{"router":150,"transformer":195,"protocol":80,"serverCompatibility":108,"server":28617,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T00:06:06.073Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166736737_l5m5xvt5n","executionId":"req_1756166736737_l5m5xvt5n","totalTime":29212,"success":true}}
{"timestamp":"2025-08-26T00:06:06.120Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:06:06.127Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:06:06.133Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:06:06.139Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:06:06.146Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:06:06.152Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166766152_9c9iwg75q","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:06:06.289Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:06:06.296Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166766152_9c9iwg75q","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:06:06.361Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166766152_9c9iwg75q","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:06:06.471Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166766152_9c9iwg75q","hasOutput":true}}
{"timestamp":"2025-08-26T00:06:06.477Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166766152_9c9iwg75q","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:06:06.526Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166766152_9c9iwg75q","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:06:06.533Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166766152_9c9iwg75q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:06:06.540Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166766152_9c9iwg75q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:06:06.633Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166766152_9c9iwg75q","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:06:06.682Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166766152_9c9iwg75q","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:06:06.689Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166766152_9c9iwg75q","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:06:06.695Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166766152_9c9iwg75q","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:06:06.704Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166766152_9c9iwg75q","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:06:06.753Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166766152_9c9iwg75q","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:06:06.760Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166766152_9c9iwg75q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:06:06.766Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166766152_9c9iwg75q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:06:06.849Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":820722,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:06:06.855Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":820722,"timeout":30000}}
{"timestamp":"2025-08-26T00:06:06.862Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:06:37.145Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","timeout":30000,"bodySize":820722,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T00:06:37.158Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756166766152_9c9iwg75q","pipelineId":"default","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T00:06:37.165Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756166766152_9c9iwg75q","failedPipelineId":"default","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T00:06:37.172Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756166766152_9c9iwg75q","recoverability":"recoverable","matchedRule":"network-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T00:06:37.178Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756166766152_9c9iwg75q","fromPipeline":"default","toPipeline":"shuaihong-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T00:06:37.183Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756166766152_9c9iwg75q","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"default"}}
{"timestamp":"2025-08-26T00:06:37.222Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":820722,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:06:37.230Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":820722,"timeout":30000}}
{"timestamp":"2025-08-26T00:06:37.237Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","error":"socket hang up","bodySize":820722,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at Socket.socketCloseListener (node:_http_client:491:27)\n    at Socket.emit (node:events:519:35)\n    at TCP.<anonymous> (node:net:346:12)"}}
{"timestamp":"2025-08-26T00:07:06.748Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T00:07:06.754Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:07:06.759Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T00:07:06.765Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T00:07:06.772Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T00:07:06.778Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756166826778_t0xibtnnf","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T00:07:06.920Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:07:06.927Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756166826778_t0xibtnnf","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T00:07:06.988Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756166826778_t0xibtnnf","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T00:07:07.093Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756166826778_t0xibtnnf","hasOutput":true}}
{"timestamp":"2025-08-26T00:07:07.099Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756166826778_t0xibtnnf","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T00:07:07.149Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166826778_t0xibtnnf","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:07:07.155Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166826778_t0xibtnnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:07:07.162Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756166826778_t0xibtnnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:07:07.255Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756166826778_t0xibtnnf","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T00:07:07.303Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756166826778_t0xibtnnf","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T00:07:07.310Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756166826778_t0xibtnnf","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T00:07:07.316Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756166826778_t0xibtnnf","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T00:07:07.325Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756166826778_t0xibtnnf","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T00:07:07.374Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756166826778_t0xibtnnf","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T00:07:07.380Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756166826778_t0xibtnnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:07:07.386Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756166826778_t0xibtnnf","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T00:07:07.470Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":820722,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T00:07:07.477Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":820722,"timeout":30000}}
{"timestamp":"2025-08-26T00:07:07.483Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","timeout":30000,"bodySize":820722,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T00:07:07.488Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756166766152_9c9iwg75q","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T00:07:07.494Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756166766152_9c9iwg75q","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T00:07:07.499Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756166766152_9c9iwg75q","recoverability":"recoverable","matchedRule":"network-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T00:07:07.505Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756166766152_9c9iwg75q","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":10,"details":"无可用的健康流水线进行切换"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"network-timeout","statusCodes":[408,503,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网络超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网络超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T00:07:07.510Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756166766152_9c9iwg75q","success":false,"recoveryAction":"failed","recoveryTime":10}}
{"timestamp":"2025-08-26T00:07:07.516Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756166766152_9c9iwg75q","failedPipelineId":"default","result":{"success":false,"recoveryAction":"failed","recoveryTime":30351,"details":"无可用的健康流水线进行切换"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"network-timeout","statusCodes":[408,503,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网络超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网络超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T00:07:07.521Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756166766152_9c9iwg75q","success":false,"recoveryAction":"failed","recoveryTime":30351}}
{"timestamp":"2025-08-26T00:07:07.527Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756166766152_9c9iwg75q","failedPipeline":"default","recoveryAction":"failed","details":"无可用的健康流水线进行切换"}}
{"timestamp":"2025-08-26T00:07:07.532Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756166766152_9c9iwg75q","pipelineId":"default","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 无可用的健康流水线进行切换"}}
{"timestamp":"2025-08-26T00:07:07.541Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756166766152_9c9iwg75q","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:289:42)\n    at ClientRequest.emit (node:events:507:28)\n    at Socket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at Socket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":154,"transformer":214,"protocol":87,"serverCompatibility":114},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T00:07:07.547Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756166766152_9c9iwg75q","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T00:07:07.676Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:427:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T00:07:07.686Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","error":"socket hang up","bodySize":820722,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at Socket.socketCloseListener (node:_http_client:491:27)\n    at Socket.emit (node:events:519:35)\n    at TCP.<anonymous> (node:net:346:12)"}}
{"timestamp":"2025-08-26T00:07:07.695Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T00:07:11.971Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T00:07:12.016Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756166826778_t0xibtnnf","totalTime":5238,"layerTimings":{"router":156,"transformer":209,"protocol":87,"serverCompatibility":113,"server":4607,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T00:07:12.137Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756166826778_t0xibtnnf","executionId":"req_1756166826778_t0xibtnnf","totalTime":5238,"success":true}}
{"timestamp":"2025-08-26T01:15:41.690Z","level":"INFO","message":"Received SIGINT, exiting gracefully"}
{"timestamp":"2025-08-26T01:15:41.701Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T01:15:41.705Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T01:15:41.709Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T01:15:41.712Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T01:15:41.716Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:15:41.719Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:15:41.723Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:15:41.727Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:15:41.730Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T01:15:41.734Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:15:41.738Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:15:42.744Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T01:15:47.695Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:15:47.701Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:15:47.712Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:15:47.718Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:15:47.724Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:15:47.729Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:15:47.731Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:15:47.736Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:15:47.741Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:15:47.746Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:15:47.752Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:15:47.757Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:15:47.762Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:15:47.767Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:15:47.769Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:15:47.774Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:15:47.780Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:15:47.786Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:15:47.791Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:15:47.796Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:15:47.802Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:15:47.807Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:15:47.812Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":43,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:15:47.817Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:15:47.826Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:15:47.831Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":43,"uptime":0}}
{"timestamp":"2025-08-26T01:15:47.836Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:15:47.841Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:18:37.860Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:18:37.865Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:18:37.871Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:18:37.876Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:18:37.882Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:18:37.888Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756171117887_tpukwbyb4","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:18:37.913Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:37.918Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756171117887_tpukwbyb4","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:18:37.924Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756171117887_tpukwbyb4","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["qwen-qwen3-coder-plus-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-26T01:18:37.944Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756171117887_tpukwbyb4","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:18:37.958Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756171117887_tpukwbyb4","hasOutput":true}}
{"timestamp":"2025-08-26T01:18:37.963Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756171117887_tpukwbyb4","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:18:37.975Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171117887_tpukwbyb4","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:18:37.980Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171117887_tpukwbyb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:18:37.985Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756171117887_tpukwbyb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:18:38.005Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756171117887_tpukwbyb4","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:18:38.018Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756171117887_tpukwbyb4","providerType":"qwen","compatibilityTag":"qwen","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:18:38.022Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756171117887_tpukwbyb4","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.029Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756171117887_tpukwbyb4","compatibilityTag":"qwen","moduleType":"object"}}
{"timestamp":"2025-08-26T01:18:38.064Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:18:38.070Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:18:38.075Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:18:38.081Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:18:38.087Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:18:38.094Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756171118094_0inaawvwn","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:18:38.223Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.228Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756171118094_0inaawvwn","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T01:18:38.232Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756171118094_0inaawvwn","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["shuaihong-glm-4.5-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-26T01:18:38.291Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756171118094_0inaawvwn","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:18:38.375Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756171118094_0inaawvwn","hasOutput":true}}
{"timestamp":"2025-08-26T01:18:38.380Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756171118094_0inaawvwn","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:18:38.423Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171118094_0inaawvwn","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:18:38.429Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171118094_0inaawvwn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:18:38.435Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756171118094_0inaawvwn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:18:38.517Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756171118094_0inaawvwn","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:18:38.563Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756171118094_0inaawvwn","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:18:38.568Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756171118094_0inaawvwn","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.574Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756171118094_0inaawvwn","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:18:38.580Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756171118094_0inaawvwn","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:18:38.627Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171118094_0inaawvwn","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:18:38.633Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171118094_0inaawvwn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:18:38.640Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756171118094_0inaawvwn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:18:38.720Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":821008,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:18:38.730Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":821008,"timeout":30000}}
{"timestamp":"2025-08-26T01:18:38.735Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:18:38.741Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:18:38.748Z","level":"INFO","message":"🔥🔥 Qwen模型名映射成功 - Context传递","data":{"requestId":"req_1756171117887_tpukwbyb4","originalModel":"qwen3-coder-plus","actualModel":"qwen3-coder-plus","finalRequestModel":"qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:18:38.753Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] Context结构检查","data":{"requestId":"req_1756171117887_tpukwbyb4","hasContext":true,"hasMetadata":true,"hasProtocolConfig":true,"metadataKeys":"[REDACTED]","protocolConfigKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.758Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] metadata存在，检查protocolConfig","data":{"requestId":"req_1756171117887_tpukwbyb4","metadataType":"object","hasProtocolConfig":true,"protocolConfigType":"object"}}
{"timestamp":"2025-08-26T01:18:38.763Z","level":"INFO","message":"🚨 [QWEN-ULTRA-DEBUG] protocolConfig存在，开始注入","data":{"requestId":"req_1756171117887_tpukwbyb4","originalApiKey":"[REDACTED]","newToken":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.772Z","level":"INFO","message":"🔥🔥 [QWEN-DEBUG] HTTP头部详细注入验证","data":{"requestId":"req_1756171117887_tpukwbyb4","before_injection":true,"qwen_headers_object":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"injected_headers":{"User-Agent":"google-api-nodejs-client/9.15.1","X-Goog-Api-Client":"gl-node/22.17.0","Client-Metadata":"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI","Accept":"application/json"},"headers_match":true,"context_metadata_exists":true,"protocolConfig_exists":true}}
{"timestamp":"2025-08-26T01:18:38.779Z","level":"INFO","message":"🚨 [QWEN-INJECT-VERIFY] 注入后完整验证","data":{"requestId":"req_1756171117887_tpukwbyb4","protocolConfig_after_injection":{"hasApiKey":"[REDACTED]","hasCustomHeaders":true,"customHeadersType":"object","customHeadersKeys":"[REDACTED]","customHeadersAsString":"{\n\t\"User-Agent\": \"google-api-nodejs-client/9.15.1\",\n\t\"X-Goog-Api-Client\": \"gl-node/22.17.0\",\n\t\"Client-Metadata\": \"ideType=IDE_UNSPECIFIED,platform=PLATFORM_UNSPECIFIED,pluginType=GEMINI\",\n\t\"Accept\": \"application/json\"\n}"}}}
{"timestamp":"2025-08-26T01:18:38.784Z","level":"INFO","message":"🔥🔥 Qwen HTTP配置注入完成","data":{"requestId":"req_1756171117887_tpukwbyb4","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"https://portal.qwen.ai/v1","customHeaders":["User-Agent","X-Goog-Api-Client","Client-Metadata","Accept"],"resourceUrl":"portal.qwen.ai"}}
{"timestamp":"2025-08-26T01:18:38.789Z","level":"INFO","message":"🔥🔥 Qwen OAuth2认证注入完成","data":{"requestId":"req_1756171117887_tpukwbyb4","authFileName":"[REDACTED]","hasToken":"[REDACTED]","endpoint":"portal.qwen.ai","resourceUrl":"https://portal.qwen.ai/v1/chat/completions","model":"qwen3-coder-plus","finalModel":"qwen3-coder-plus","hasModelField":true,"requestKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:18:38.793Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756171117887_tpukwbyb4","hasCustomHeaders":true,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:18:38.806Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171117887_tpukwbyb4","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:18:38.812Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171117887_tpukwbyb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:18:38.816Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756171117887_tpukwbyb4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:18:38.831Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":543,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T01:18:39.822Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":200,"responseSize":450,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T01:18:39.873Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756171117887_tpukwbyb4","totalTime":1985,"layerTimings":{"router":43,"transformer":38,"protocol":15,"serverCompatibility":796,"server":1032,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T01:18:39.889Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756171117887_tpukwbyb4","executionId":"req_1756171117887_tpukwbyb4","totalTime":1985,"success":true}}
{"timestamp":"2025-08-26T01:19:09.348Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","timeout":30000,"bodySize":821008,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T01:19:09.364Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756171118094_0inaawvwn","pipelineId":"shuaihong-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T01:19:09.373Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756171118094_0inaawvwn","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T01:19:09.381Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756171118094_0inaawvwn","recoverability":"recoverable","matchedRule":"network-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T01:19:09.389Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756171118094_0inaawvwn","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":16,"details":"无可用的健康流水线进行切换"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"network-timeout","statusCodes":[408,503,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网络超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网络超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:19:09.396Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756171118094_0inaawvwn","success":false,"recoveryAction":"failed","recoveryTime":16}}
{"timestamp":"2025-08-26T01:19:09.403Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756171118094_0inaawvwn","failedPipeline":"shuaihong-glm-4.5-key0","recoveryAction":"failed","details":"无可用的健康流水线进行切换"}}
{"timestamp":"2025-08-26T01:19:09.409Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756171118094_0inaawvwn","pipelineId":"shuaihong-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 无可用的健康流水线进行切换"}}
{"timestamp":"2025-08-26T01:19:09.420Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756171118094_0inaawvwn","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:328:42)\n    at ClientRequest.emit (node:events:507:28)\n    at Socket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at Socket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":145,"transformer":178,"protocol":77,"serverCompatibility":104},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:19:09.426Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756171118094_0inaawvwn","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T01:19:09.548Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:427:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:19:09.557Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","error":"socket hang up","bodySize":821008,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at Socket.socketCloseListener (node:_http_client:491:27)\n    at Socket.emit (node:events:519:35)\n    at TCP.<anonymous> (node:net:346:12)"}}
{"timestamp":"2025-08-26T01:19:09.591Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:19:09.597Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:19:09.602Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:19:09.607Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:19:09.613Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:19:09.618Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756171149618_ifo8a3t8m","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:19:09.742Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:19:09.747Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756171149618_ifo8a3t8m","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T01:19:09.752Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756171149618_ifo8a3t8m","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["shuaihong-glm-4.5-key0"],"totalAvailable":1}}
{"timestamp":"2025-08-26T01:19:09.808Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756171149618_ifo8a3t8m","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:19:09.895Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756171149618_ifo8a3t8m","hasOutput":true}}
{"timestamp":"2025-08-26T01:19:09.900Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756171149618_ifo8a3t8m","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:19:09.944Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171149618_ifo8a3t8m","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:19:09.950Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171149618_ifo8a3t8m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:19:09.955Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756171149618_ifo8a3t8m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:19:10.040Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756171149618_ifo8a3t8m","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:19:10.085Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756171149618_ifo8a3t8m","providerType":"shuaihong","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:19:10.090Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756171149618_ifo8a3t8m","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:19:10.096Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756171149618_ifo8a3t8m","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:19:10.102Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756171149618_ifo8a3t8m","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:19:10.144Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756171149618_ifo8a3t8m","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:19:10.150Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756171149618_ifo8a3t8m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:19:10.155Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756171149618_ifo8a3t8m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:19:10.231Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":821008,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:19:10.237Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":821008,"timeout":30000}}
{"timestamp":"2025-08-26T01:19:10.243Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:19:30.383Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":504,"responseSize":165,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:19:30.401Z","level":"ERROR","message":"Server error detected, throwing for retry","data":{"requestId":"req_1756171149618_ifo8a3t8m","status":504,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions","responsePreview":"{\"error\":{\"message\":\"bad response status code 504 (request id: 20250826091910535087592OTsddRKu)\",\"type\":\"openai_error\",\"param\":\"\",\"code\":\"bad_response_status_code\"}}"}}
{"timestamp":"2025-08-26T01:19:30.412Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756171149618_ifo8a3t8m","pipelineId":"shuaihong-glm-4.5-key0","errorMessage":"Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T01:19:30.421Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756171149618_ifo8a3t8m","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":0,"errorMessage":"Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T01:19:30.429Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756171149618_ifo8a3t8m","recoverability":"non_recoverable","matchedRule":"server-internal-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:19:30.437Z","level":"ERROR","message":"🚫 拉黑流水线","data":{"pipelineId":"shuaihong-glm-4.5-key0","reason":"服务器内部错误 - 需要拉黑流水线 (匹配度: 50%)","failureCount":0}}
{"timestamp":"2025-08-26T01:19:30.444Z","level":"ERROR","message":"💀 流水线销毁事件","data":{"pipelineId":"shuaihong-glm-4.5-key0","reason":"不可恢复错误: 服务器内部错误 - 需要拉黑流水线 (匹配度: 50%)","requestId":"req_1756171149618_ifo8a3t8m","timestamp":1756171170444}}
{"timestamp":"2025-08-26T01:19:30.451Z","level":"INFO","message":"Destroying pipeline data","data":{"pipelineId":"shuaihong-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:19:30.460Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756171149618_ifo8a3t8m","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"destroyed","recoveryTime":39,"details":"流水线已销毁，但无其他可用流水线"},"errorClassification":{"recoverability":"non_recoverable","matchedRule":{"name":"server-internal-error","statusCodes":[500],"messageKeywords":"[REDACTED]","recoverability":"non_recoverable","priority":3,"description":"服务器内部错误 - 需要拉黑流水线"},"confidence":0.5,"reason":"服务器内部错误 - 需要拉黑流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:19:30.465Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756171149618_ifo8a3t8m","success":false,"recoveryAction":"destroyed","recoveryTime":39}}
{"timestamp":"2025-08-26T01:19:30.471Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756171149618_ifo8a3t8m","failedPipeline":"shuaihong-glm-4.5-key0","recoveryAction":"destroyed","details":"流水线已销毁，但无其他可用流水线"}}
{"timestamp":"2025-08-26T01:19:30.476Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756171149618_ifo8a3t8m","pipelineId":"shuaihong-glm-4.5-key0","originalError":"Server error: 504 Internal Server Error","recoveryError":"流水线切换恢复失败: 流水线已销毁，但无其他可用流水线"}}
{"timestamp":"2025-08-26T01:19:30.484Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756171149618_ifo8a3t8m","error":"Server error: 504 Internal Server Error","stack":"Error: Server error: 504 Internal Server Error\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:40:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:263:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":141,"transformer":180,"protocol":79,"serverCompatibility":99},"errors":[{"layer":"pipeline","error":"Server error: 504 Internal Server Error","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:19:30.489Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756171149618_ifo8a3t8m","error":"Server error: 504 Internal Server Error"}}
{"timestamp":"2025-08-26T01:19:30.607Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Server error: 504 Internal Server Error","stack":"Error: Pipeline request processing failed: Server error: 504 Internal Server Error\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:427:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:25:06.618Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T01:25:06.621Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T01:25:06.623Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T01:25:06.626Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T01:25:06.628Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T01:25:06.631Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:25:06.634Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:25:06.637Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:25:06.639Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:25:06.642Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T01:25:06.645Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:25:06.647Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:25:07.652Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T01:25:09.222Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:25:09.238Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:25:09.256Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:25:09.262Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:25:09.268Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:25:09.275Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:25:09.277Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:25:09.283Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:25:09.289Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:25:09.294Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:25:09.301Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:25:09.307Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:25:09.312Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:25:09.318Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:25:09.320Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:25:09.327Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:25:09.332Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:25:09.338Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:25:09.344Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:25:09.350Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:25:09.355Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:25:09.361Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:25:09.366Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":46,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:25:09.371Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:25:09.379Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:25:09.385Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":46,"uptime":0}}
{"timestamp":"2025-08-26T01:25:09.390Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:25:09.396Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:25:09.401Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:28:44.965Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T01:28:44.968Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T01:28:44.971Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T01:28:44.974Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T01:28:44.976Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T01:28:44.979Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:28:44.982Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:28:44.984Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T01:28:44.987Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:28:44.989Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T01:28:44.992Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T01:28:44.995Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T01:28:45.998Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T01:28:47.563Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:28:47.578Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:28:47.595Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:28:47.603Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:28:47.609Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:28:47.616Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:28:47.619Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:28:47.624Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:28:47.630Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:28:47.635Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:28:47.641Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:28:47.646Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:28:47.651Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:28:47.656Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:28:47.658Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:28:47.663Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:28:47.668Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:28:47.673Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:28:47.678Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:28:47.683Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:28:47.688Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:28:47.693Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:28:47.697Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":39,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:28:47.703Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:28:47.711Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:28:47.717Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":39,"uptime":0}}
{"timestamp":"2025-08-26T01:28:47.721Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:28:47.727Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:28:47.732Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:32:26.817Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:32:26.823Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:32:26.835Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:32:26.840Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:32:26.845Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:32:26.850Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:32:26.853Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:32:26.858Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:32:26.863Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:32:26.868Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:32:26.873Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:32:26.878Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:32:26.881Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:32:26.885Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:32:26.890Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:32:26.892Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:32:26.897Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:32:26.902Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:32:26.907Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:32:26.911Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:32:26.916Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:32:26.921Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:32:26.925Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:32:26.930Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":38,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:32:26.934Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:32:26.943Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:32:26.947Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":38,"uptime":0}}
{"timestamp":"2025-08-26T01:32:26.952Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:32:26.957Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:32:26.963Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:40:00.556Z","level":"INFO","message":"接收到chat/completions请求","data":{"method":"POST","url":"/v1/chat/completions","hasBody":true}}
{"timestamp":"2025-08-26T01:40:00.563Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"openai","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:40:00.569Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:40:00.576Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:40:00.579Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:40:00.586Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756172400585_i61ajz5ei","protocol":"openai","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:40:00.613Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-sonnet-20241022","virtualModel":"coding","priority":4,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:40:00.619Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756172400585_i61ajz5ei","inputModel":"claude-3-5-sonnet-20241022","mappedModel":"coding"}}
{"timestamp":"2025-08-26T01:40:00.625Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756172400585_i61ajz5ei","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:40:00.650Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756172400585_i61ajz5ei","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:40:00.663Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756172400585_i61ajz5ei","hasOutput":true}}
{"timestamp":"2025-08-26T01:40:00.669Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756172400585_i61ajz5ei","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:40:00.682Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172400585_i61ajz5ei","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:40:00.687Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172400585_i61ajz5ei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:40:00.693Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756172400585_i61ajz5ei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:40:00.713Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756172400585_i61ajz5ei","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:40:00.727Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756172400585_i61ajz5ei","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:40:00.732Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756172400585_i61ajz5ei","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:40:00.738Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756172400585_i61ajz5ei","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:40:00.743Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756172400585_i61ajz5ei","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:40:00.755Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172400585_i61ajz5ei","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:40:00.760Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172400585_i61ajz5ei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:40:00.765Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756172400585_i61ajz5ei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:40:00.780Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":206,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T01:40:00.793Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:40:00.798Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:40:01.056Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":102,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T01:40:01.066Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756172400585_i61ajz5ei","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: glm-4.5\",\"request_id\":\"31618d49-8b14-4fc1-837e-e4e0f763d736\"}}"}}
{"timestamp":"2025-08-26T01:40:01.074Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756172400585_i61ajz5ei","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:40:01.080Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756172400585_i61ajz5ei","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:40:01.086Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756172400585_i61ajz5ei","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:40:01.092Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756172400585_i61ajz5ei","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:40:01.098Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756172400585_i61ajz5ei","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":18,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:40:01.103Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756172400585_i61ajz5ei","success":false,"recoveryAction":"terminal","recoveryTime":18}}
{"timestamp":"2025-08-26T01:40:01.110Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756172400585_i61ajz5ei","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:40:01.114Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756172400585_i61ajz5ei","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:40:01.122Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756172400585_i61ajz5ei","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":50,"transformer":41,"protocol":15,"serverCompatibility":37},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:40:01.128Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756172400585_i61ajz5ei","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:40:01.139Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"openai","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:41:29.158Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:41:29.164Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:41:29.177Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:41:29.182Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:41:29.187Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:41:29.191Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:41:29.193Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:41:29.198Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:41:29.203Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:41:29.209Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:41:29.214Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:41:29.219Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:41:29.221Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:41:29.226Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:41:29.230Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:41:29.233Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:41:29.237Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:41:29.242Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:41:29.247Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:41:29.252Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:41:29.257Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:41:29.261Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:41:29.266Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:41:29.272Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":39,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:41:29.276Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:41:29.285Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:41:29.290Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":39,"uptime":0}}
{"timestamp":"2025-08-26T01:41:29.295Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:41:29.301Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:41:29.306Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:41:55.718Z","level":"INFO","message":"接收到chat/completions请求","data":{"method":"POST","url":"/v1/chat/completions","hasBody":true}}
{"timestamp":"2025-08-26T01:41:55.725Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"openai","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:41:55.730Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:41:55.736Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:41:55.739Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:41:55.745Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756172515745_tmmfq1341","protocol":"openai","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:41:55.774Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-sonnet-20241022","virtualModel":"coding","priority":4,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:41:55.780Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756172515745_tmmfq1341","inputModel":"claude-3-5-sonnet-20241022","mappedModel":"coding"}}
{"timestamp":"2025-08-26T01:41:55.786Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756172515745_tmmfq1341","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:41:55.809Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756172515745_tmmfq1341","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:41:55.821Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756172515745_tmmfq1341","hasOutput":true}}
{"timestamp":"2025-08-26T01:41:55.826Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756172515745_tmmfq1341","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:41:55.840Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172515745_tmmfq1341","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:41:55.846Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172515745_tmmfq1341","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:41:55.852Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756172515745_tmmfq1341","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:41:55.871Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756172515745_tmmfq1341","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:41:55.884Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756172515745_tmmfq1341","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:41:55.888Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756172515745_tmmfq1341","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:41:55.894Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756172515745_tmmfq1341","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:41:55.899Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756172515745_tmmfq1341","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:41:55.911Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172515745_tmmfq1341","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:41:55.916Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172515745_tmmfq1341","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:41:55.920Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756172515745_tmmfq1341","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:41:55.936Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":206,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T01:41:55.949Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:41:55.954Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:41:56.180Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":102,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T01:41:56.187Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756172515745_tmmfq1341","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: glm-4.5\",\"request_id\":\"488fbdec-f095-4989-9f19-6ea1d80d9601\"}}"}}
{"timestamp":"2025-08-26T01:41:56.193Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756172515745_tmmfq1341","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:41:56.198Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756172515745_tmmfq1341","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:41:56.204Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756172515745_tmmfq1341","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:41:56.210Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756172515745_tmmfq1341","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:41:56.215Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756172515745_tmmfq1341","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":17,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:41:56.221Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756172515745_tmmfq1341","success":false,"recoveryAction":"terminal","recoveryTime":17}}
{"timestamp":"2025-08-26T01:41:56.226Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756172515745_tmmfq1341","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:41:56.231Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756172515745_tmmfq1341","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:41:56.239Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756172515745_tmmfq1341","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":49,"transformer":40,"protocol":14,"serverCompatibility":34},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:41:56.244Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756172515745_tmmfq1341","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:41:56.255Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"openai","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:44:06.045Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:44:06.051Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:44:06.064Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:44:06.070Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:44:06.075Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:44:06.080Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:44:06.083Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:44:06.088Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:44:06.093Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:44:06.097Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:44:06.102Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:44:06.107Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:44:06.109Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:44:06.114Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:44:06.119Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:44:06.122Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:44:06.126Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:44:06.131Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:44:06.136Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:44:06.141Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:44:06.145Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:44:06.150Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:44:06.155Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:44:06.160Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":38,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:44:06.165Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:44:06.173Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:44:06.178Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":38,"uptime":0}}
{"timestamp":"2025-08-26T01:44:06.183Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:44:06.189Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:44:06.194Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:46:19.585Z","level":"INFO","message":"接收到chat/completions请求","data":{"method":"POST","url":"/v1/chat/completions","hasBody":true}}
{"timestamp":"2025-08-26T01:46:19.592Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"openai","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:46:19.599Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:46:19.604Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:46:19.607Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:46:19.614Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756172779613_tm6x1z03d","protocol":"openai","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:46:19.640Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-sonnet-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:46:19.645Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756172779613_tm6x1z03d","inputModel":"claude-3-5-sonnet-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:46:19.650Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756172779613_tm6x1z03d","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:46:19.672Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756172779613_tm6x1z03d","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:46:19.684Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756172779613_tm6x1z03d","hasOutput":true}}
{"timestamp":"2025-08-26T01:46:19.690Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756172779613_tm6x1z03d","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:46:19.702Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172779613_tm6x1z03d","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:46:19.709Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172779613_tm6x1z03d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:46:19.714Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756172779613_tm6x1z03d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:46:19.734Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756172779613_tm6x1z03d","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:46:19.747Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756172779613_tm6x1z03d","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:46:19.753Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756172779613_tm6x1z03d","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:46:19.758Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756172779613_tm6x1z03d","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:46:19.763Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756172779613_tm6x1z03d","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:46:19.776Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756172779613_tm6x1z03d","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:46:19.780Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756172779613_tm6x1z03d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:46:19.786Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756172779613_tm6x1z03d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:46:19.801Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":195,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T01:46:19.813Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:46:19.818Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:46:20.144Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T01:46:20.152Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756172779613_tm6x1z03d","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"48de0a4d-6ac9-4b55-97f5-79521f2760a6\"}}"}}
{"timestamp":"2025-08-26T01:46:20.157Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756172779613_tm6x1z03d","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:46:20.162Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756172779613_tm6x1z03d","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:46:20.167Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756172779613_tm6x1z03d","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:46:20.173Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756172779613_tm6x1z03d","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:46:20.178Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756172779613_tm6x1z03d","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":16,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:46:20.184Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756172779613_tm6x1z03d","success":false,"recoveryAction":"terminal","recoveryTime":16}}
{"timestamp":"2025-08-26T01:46:20.189Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756172779613_tm6x1z03d","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:46:20.194Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756172779613_tm6x1z03d","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:46:20.202Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756172779613_tm6x1z03d","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":44,"transformer":38,"protocol":15,"serverCompatibility":36},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:46:20.207Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756172779613_tm6x1z03d","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:46:20.217Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"openai","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleChatCompletions (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:353:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:326:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:53:42.672Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:53:42.678Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:42.684Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:42.690Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:53:42.695Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:53:42.698Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:53:42.704Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173222704_jnctytt3z","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:53:42.718Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:42.723Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173222704_jnctytt3z","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:53:42.728Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173222704_jnctytt3z","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:53:42.750Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173222704_jnctytt3z","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:53:42.767Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173222704_jnctytt3z","hasOutput":true}}
{"timestamp":"2025-08-26T01:53:42.772Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173222704_jnctytt3z","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:53:42.786Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173222704_jnctytt3z","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:42.792Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173222704_jnctytt3z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:53:42.797Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173222704_jnctytt3z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:53:42.819Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173222704_jnctytt3z","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:53:42.833Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173222704_jnctytt3z","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:53:42.839Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173222704_jnctytt3z","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:42.845Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173222704_jnctytt3z","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:53:42.851Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173222704_jnctytt3z","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:53:42.865Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173222704_jnctytt3z","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:42.870Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173222704_jnctytt3z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:53:42.875Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173222704_jnctytt3z","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:53:42.893Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:42.899Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25324,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:42.913Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:53:42.919Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:42.925Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:42.931Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:53:42.936Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:53:42.940Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:53:42.946Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173222946_unwx8sv6m","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:53:43.017Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:43.023Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173222946_unwx8sv6m","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:53:43.028Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173222946_unwx8sv6m","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:53:43.059Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173222946_unwx8sv6m","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:53:43.080Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173222946_unwx8sv6m","hasOutput":true}}
{"timestamp":"2025-08-26T01:53:43.086Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173222946_unwx8sv6m","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:53:43.111Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173222946_unwx8sv6m","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:43.116Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173222946_unwx8sv6m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.121Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173222946_unwx8sv6m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.160Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173222946_unwx8sv6m","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:53:43.183Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173222946_unwx8sv6m","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:53:43.189Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173222946_unwx8sv6m","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:43.194Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173222946_unwx8sv6m","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:53:43.200Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173222946_unwx8sv6m","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:53:43.223Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173222946_unwx8sv6m","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:43.229Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173222946_unwx8sv6m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.234Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173222946_unwx8sv6m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.266Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123015,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:43.272Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123015,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:43.278Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:53:43.283Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:53:43.289Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:53:43.295Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:53:43.655Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:53:43.663Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173222946_unwx8sv6m","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"1559046c-f031-4020-b587-09c060187a7b\"}}"}}
{"timestamp":"2025-08-26T01:53:43.669Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173222946_unwx8sv6m","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:43.675Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173222946_unwx8sv6m","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:43.681Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173222946_unwx8sv6m","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:53:43.687Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756173222946_unwx8sv6m","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:43.692Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173222946_unwx8sv6m","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":17,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:53:43.697Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173222946_unwx8sv6m","success":false,"recoveryAction":"terminal","recoveryTime":17}}
{"timestamp":"2025-08-26T01:53:43.702Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173222946_unwx8sv6m","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:43.707Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173222946_unwx8sv6m","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:43.714Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173222946_unwx8sv6m","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":89,"transformer":70,"protocol":33,"serverCompatibility":57},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:53:43.718Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173222946_unwx8sv6m","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:43.745Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:53:43.764Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:53:43.770Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:43.774Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:53:43.780Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:53:43.784Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:53:43.788Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:53:43.793Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173223793_2e30vq4pk","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:53:43.852Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:43.856Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173223793_2e30vq4pk","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:53:43.861Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173223793_2e30vq4pk","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:53:43.888Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173223793_2e30vq4pk","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:53:43.906Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173223793_2e30vq4pk","hasOutput":true}}
{"timestamp":"2025-08-26T01:53:43.910Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173223793_2e30vq4pk","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:53:43.932Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173223793_2e30vq4pk","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:43.938Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173223793_2e30vq4pk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.943Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173223793_2e30vq4pk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:43.981Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173223793_2e30vq4pk","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:53:44.004Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173223793_2e30vq4pk","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:53:44.010Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173223793_2e30vq4pk","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:53:44.016Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173223793_2e30vq4pk","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:53:44.023Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173223793_2e30vq4pk","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:53:44.045Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173223793_2e30vq4pk","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:53:44.050Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173223793_2e30vq4pk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:44.056Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173223793_2e30vq4pk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:53:44.083Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123015,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:44.089Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123015,"timeout":30000}}
{"timestamp":"2025-08-26T01:53:44.095Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:53:44.100Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:53:44.230Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:53:44.237Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173223793_2e30vq4pk","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"b710c35c-18d6-4e7f-8eaa-0d430443ba56\"}}"}}
{"timestamp":"2025-08-26T01:53:44.243Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173223793_2e30vq4pk","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.248Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173223793_2e30vq4pk","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.254Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173223793_2e30vq4pk","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:53:44.260Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756173223793_2e30vq4pk","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:44.265Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173223793_2e30vq4pk","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":17,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:53:44.271Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173223793_2e30vq4pk","success":false,"recoveryAction":"terminal","recoveryTime":17}}
{"timestamp":"2025-08-26T01:53:44.277Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173223793_2e30vq4pk","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:44.283Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173223793_2e30vq4pk","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.292Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173223793_2e30vq4pk","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":74,"transformer":60,"protocol":33,"serverCompatibility":58},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:53:44.297Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173223793_2e30vq4pk","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.327Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:53:44.335Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:53:44.340Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173222704_jnctytt3z","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"3552ecfc-7fb0-4a44-b3e1-48353465560d\"}}"}}
{"timestamp":"2025-08-26T01:53:44.346Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173222704_jnctytt3z","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.355Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173222704_jnctytt3z","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.360Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173222704_jnctytt3z","recoverability":"terminal","matchedRule":"client-error","confidence":0.5}}
{"timestamp":"2025-08-26T01:53:44.366Z","level":"INFO","message":"⚠️ 终端错误，返回给客户端","data":{"requestId":"req_1756173222704_jnctytt3z","reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:44.371Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173222704_jnctytt3z","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"terminal","recoveryTime":16,"details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"},"errorClassification":{"recoverability":"terminal","matchedRule":{"name":"client-error","statusCodes":[400,413,414,415],"messageKeywords":"[REDACTED]","recoverability":"terminal","priority":1,"description":"客户端错误 - 返回给客户端处理"},"confidence":0.5,"reason":"客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:53:44.377Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173222704_jnctytt3z","success":false,"recoveryAction":"terminal","recoveryTime":16}}
{"timestamp":"2025-08-26T01:53:44.384Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173222704_jnctytt3z","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"terminal","details":"终端错误，无法恢复: 客户端错误 - 返回给客户端处理 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T01:53:44.390Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173222704_jnctytt3z","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Client error: 400 Bad Request","recoveryError":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.399Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173222704_jnctytt3z","error":"Client error: 400 Bad Request","stack":"Error: Client error: 400 Bad Request\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:62:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":32,"transformer":45,"protocol":17,"serverCompatibility":40},"errors":[{"layer":"pipeline","error":"Client error: 400 Bad Request","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:53:44.404Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173222704_jnctytt3z","error":"Client error: 400 Bad Request"}}
{"timestamp":"2025-08-26T01:53:44.420Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Client error: 400 Bad Request","stack":"Error: Pipeline request processing failed: Client error: 400 Bad Request\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:55:59.095Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T01:55:59.102Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T01:55:59.113Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T01:55:59.118Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T01:55:59.123Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T01:55:59.127Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T01:55:59.130Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T01:55:59.134Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T01:55:59.139Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T01:55:59.144Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T01:55:59.150Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:55:59.155Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:55:59.158Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:55:59.163Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T01:55:59.169Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T01:55:59.172Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:55:59.179Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T01:55:59.184Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T01:55:59.190Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T01:55:59.195Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T01:55:59.200Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:55:59.206Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T01:55:59.213Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T01:55:59.217Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":45,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T01:55:59.222Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T01:55:59.231Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T01:55:59.237Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":45,"uptime":0}}
{"timestamp":"2025-08-26T01:55:59.242Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T01:55:59.248Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:55:59.254Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:10.658Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:56:10.664Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:10.670Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:10.676Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:56:10.681Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:56:10.684Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:56:10.690Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173370690_1adhf2nva","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:56:10.714Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:10.719Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173370690_1adhf2nva","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:56:10.725Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173370690_1adhf2nva","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:56:10.745Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173370690_1adhf2nva","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:56:10.758Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173370690_1adhf2nva","hasOutput":true}}
{"timestamp":"2025-08-26T01:56:10.763Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173370690_1adhf2nva","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:56:10.776Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173370690_1adhf2nva","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:10.780Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173370690_1adhf2nva","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:10.785Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173370690_1adhf2nva","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:10.806Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173370690_1adhf2nva","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:56:10.818Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173370690_1adhf2nva","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:56:10.823Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173370690_1adhf2nva","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:10.828Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173370690_1adhf2nva","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:56:10.834Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173370690_1adhf2nva","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:56:10.846Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173370690_1adhf2nva","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:10.851Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173370690_1adhf2nva","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:10.856Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173370690_1adhf2nva","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:10.872Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:10.884Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25324,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:10.897Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:56:10.902Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:10.907Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:10.912Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:56:10.917Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:56:10.920Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:56:10.925Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173370925_5l36yx72a","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:56:10.984Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:10.989Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173370925_5l36yx72a","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:56:10.993Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173370925_5l36yx72a","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:56:11.021Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173370925_5l36yx72a","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:56:11.038Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173370925_5l36yx72a","hasOutput":true}}
{"timestamp":"2025-08-26T01:56:11.043Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173370925_5l36yx72a","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:56:11.064Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173370925_5l36yx72a","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:11.069Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173370925_5l36yx72a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:11.076Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173370925_5l36yx72a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:11.113Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173370925_5l36yx72a","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:56:11.134Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173370925_5l36yx72a","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:56:11.140Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173370925_5l36yx72a","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:11.145Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173370925_5l36yx72a","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:56:11.151Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173370925_5l36yx72a","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:56:11.175Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173370925_5l36yx72a","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:11.181Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173370925_5l36yx72a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:11.186Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173370925_5l36yx72a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:11.216Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.222Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.228Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:56:11.233Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:11.239Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:56:11.244Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:11.610Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:11.626Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173370925_5l36yx72a","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"e0a0ba29-1605-4ff6-bf25-2cc04051ee79\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.633Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173370925_5l36yx72a","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.640Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.648Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370925_5l36yx72a","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:11.654Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370925_5l36yx72a","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T01:56:11.660Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:11.673Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.679Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.774Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:11.784Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173370690_1adhf2nva","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"932b8743-9194-40fc-9451-92c14ff8b68c\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.790Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173370690_1adhf2nva","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.796Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.801Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370690_1adhf2nva","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:11.808Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370690_1adhf2nva","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T01:56:11.813Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:11.821Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.826Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25324,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:11.959Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:11.973Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173370690_1adhf2nva","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"3b6d3eb2-5af0-4f0f-9473-24fbdb24996a\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.981Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.987Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:11.993Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370690_1adhf2nva","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:11.999Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370690_1adhf2nva","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T01:56:12.004Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:12.013Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.018Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25324,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.110Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:12.125Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173370925_5l36yx72a","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"e0ef22a3-1048-4402-93ec-20f308eb8124\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.133Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.140Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.145Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370925_5l36yx72a","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:12.150Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370925_5l36yx72a","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T01:56:12.155Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:12.168Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.173Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.179Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:12.188Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173370690_1adhf2nva","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"d65ef5b7-0ed0-40e9-a937-a9858ebb75bd\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.192Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"shuaihong-glm-4.5-key0","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.197Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.202Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370690_1adhf2nva","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:12.207Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370690_1adhf2nva","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T01:56:12.211Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:12.218Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.223Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25324,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.306Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:12.315Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173370925_5l36yx72a","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"b5eaabce-47a0-464a-b5bb-c35d4667087c\"}}"}}
{"timestamp":"2025-08-26T01:56:12.321Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:12.327Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:12.333Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173370925_5l36yx72a","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:12.338Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173370925_5l36yx72a","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T01:56:12.343Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:12.355Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.361Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.562Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:12.577Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173370690_1adhf2nva","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"19afb982-7ff6-4f93-95cf-b9b25de01dda\"}}"}}
{"timestamp":"2025-08-26T01:56:12.586Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370690_1adhf2nva","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:12.594Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":397,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.602Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370690_1adhf2nva","success":false,"recoveryAction":"failed","recoveryTime":397}}
{"timestamp":"2025-08-26T01:56:12.610Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":623,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.617Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370690_1adhf2nva","success":false,"recoveryAction":"failed","recoveryTime":623}}
{"timestamp":"2025-08-26T01:56:12.625Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":829,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.632Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370690_1adhf2nva","success":false,"recoveryAction":"failed","recoveryTime":829}}
{"timestamp":"2025-08-26T01:56:12.639Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173370690_1adhf2nva","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:12.645Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173370690_1adhf2nva","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Invalid model id: qwen3-coder-plus","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:12.656Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173370690_1adhf2nva","error":"Invalid model id: qwen3-coder-plus","stack":"Error: Invalid model id: qwen3-coder-plus\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":42,"transformer":39,"protocol":17,"serverCompatibility":35},"errors":[{"layer":"pipeline","error":"Invalid model id: qwen3-coder-plus","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:56:12.660Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173370690_1adhf2nva","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:12.674Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Invalid model id: qwen3-coder-plus","stack":"Error: Pipeline request processing failed: Invalid model id: qwen3-coder-plus\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:56:12.710Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:56:12.715Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:12.720Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:12.725Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:56:12.729Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:56:12.732Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:56:12.737Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173372737_luxumv4pr","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:56:12.749Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:12.753Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173372737_luxumv4pr","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:56:12.758Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173372737_luxumv4pr","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:56:12.776Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173372737_luxumv4pr","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:56:12.789Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173372737_luxumv4pr","hasOutput":true}}
{"timestamp":"2025-08-26T01:56:12.793Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173372737_luxumv4pr","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:56:12.805Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173372737_luxumv4pr","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:12.809Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173372737_luxumv4pr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:12.813Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173372737_luxumv4pr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:12.832Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173372737_luxumv4pr","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:56:12.844Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173372737_luxumv4pr","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:56:12.848Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173372737_luxumv4pr","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:12.853Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173372737_luxumv4pr","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:56:12.858Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173372737_luxumv4pr","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:56:12.870Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173372737_luxumv4pr","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:12.874Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173372737_luxumv4pr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:12.878Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173372737_luxumv4pr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:12.895Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19524,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.899Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19524,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:12.904Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:56:12.909Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:12.929Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:12.934Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173370925_5l36yx72a","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"bd3386af-007f-4a1b-8eeb-af92aec554f0\"}}"}}
{"timestamp":"2025-08-26T01:56:12.939Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173370925_5l36yx72a","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:12.943Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":616,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.948Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370925_5l36yx72a","success":false,"recoveryAction":"failed","recoveryTime":616}}
{"timestamp":"2025-08-26T01:56:12.953Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":813,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.958Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370925_5l36yx72a","success":false,"recoveryAction":"failed","recoveryTime":813}}
{"timestamp":"2025-08-26T01:56:12.964Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":1324,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:12.970Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173370925_5l36yx72a","success":false,"recoveryAction":"failed","recoveryTime":1324}}
{"timestamp":"2025-08-26T01:56:12.974Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173370925_5l36yx72a","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:12.979Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173370925_5l36yx72a","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Invalid model id: qwen3-coder-plus","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:12.987Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173370925_5l36yx72a","error":"Invalid model id: qwen3-coder-plus","stack":"Error: Invalid model id: qwen3-coder-plus\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":75,"transformer":59,"protocol":32,"serverCompatibility":58},"errors":[{"layer":"pipeline","error":"Invalid model id: qwen3-coder-plus","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:56:12.992Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173370925_5l36yx72a","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:13.018Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Invalid model id: qwen3-coder-plus","stack":"Error: Pipeline request processing failed: Invalid model id: qwen3-coder-plus\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:56:13.025Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.030Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173372737_luxumv4pr","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"8e426519-18c7-4bf6-8b61-d563fe2c4967\"}}"}}
{"timestamp":"2025-08-26T01:56:13.035Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173372737_luxumv4pr","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.040Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.044Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173372737_luxumv4pr","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:13.049Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173372737_luxumv4pr","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T01:56:13.053Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:13.061Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19524,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.065Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19524,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.076Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:56:13.080Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:13.085Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:13.090Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:56:13.094Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:56:13.097Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:56:13.101Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173373101_4u1k9yabx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:56:13.157Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:13.161Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173373101_4u1k9yabx","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:56:13.166Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173373101_4u1k9yabx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:56:13.192Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173373101_4u1k9yabx","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:56:13.210Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173373101_4u1k9yabx","hasOutput":true}}
{"timestamp":"2025-08-26T01:56:13.214Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173373101_4u1k9yabx","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T01:56:13.234Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173373101_4u1k9yabx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:13.239Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173373101_4u1k9yabx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:13.243Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173373101_4u1k9yabx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:13.279Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173373101_4u1k9yabx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:56:13.298Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173373101_4u1k9yabx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:56:13.303Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173373101_4u1k9yabx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:13.308Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173373101_4u1k9yabx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:56:13.313Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173373101_4u1k9yabx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:56:13.334Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173373101_4u1k9yabx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:13.339Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173373101_4u1k9yabx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:13.343Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173373101_4u1k9yabx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T01:56:13.370Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.374Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.379Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.383Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173372737_luxumv4pr","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"d8381b2f-c25e-4a21-817a-9e3f93a9772f\"}}"}}
{"timestamp":"2025-08-26T01:56:13.389Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.394Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.398Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173372737_luxumv4pr","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:13.402Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173372737_luxumv4pr","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T01:56:13.407Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:13.414Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19524,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.418Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19524,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.423Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:56:13.428Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:13.502Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.509Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373101_4u1k9yabx","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"e279946e-e7f0-4200-ad67-2781b7e18ae8\"}}"}}
{"timestamp":"2025-08-26T01:56:13.514Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173373101_4u1k9yabx","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.520Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.525Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373101_4u1k9yabx","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:13.530Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373101_4u1k9yabx","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T01:56:13.535Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:13.547Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.552Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.557Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.562Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173372737_luxumv4pr","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"53bc04f7-b096-4982-98bf-204d68d1c57b\"}}"}}
{"timestamp":"2025-08-26T01:56:13.566Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.571Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.575Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173372737_luxumv4pr","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:13.580Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173372737_luxumv4pr","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T01:56:13.584Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:13.592Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19524,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.596Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19524,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.676Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.685Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373101_4u1k9yabx","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"6ec226fb-23ce-4350-9c46-3929c7a47bcd\"}}"}}
{"timestamp":"2025-08-26T01:56:13.693Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.701Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.708Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373101_4u1k9yabx","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:13.715Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373101_4u1k9yabx","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T01:56:13.722Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:13.735Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.741Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:13.746Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:13.751Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173372737_luxumv4pr","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"d409a56a-6c6c-4cd2-8f28-42444576b1b5\"}}"}}
{"timestamp":"2025-08-26T01:56:13.756Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173372737_luxumv4pr","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.761Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":190,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:13.765Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173372737_luxumv4pr","success":false,"recoveryAction":"failed","recoveryTime":190}}
{"timestamp":"2025-08-26T01:56:13.770Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":376,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:13.775Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173372737_luxumv4pr","success":false,"recoveryAction":"failed","recoveryTime":376}}
{"timestamp":"2025-08-26T01:56:13.779Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":739,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:13.784Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173372737_luxumv4pr","success":false,"recoveryAction":"failed","recoveryTime":739}}
{"timestamp":"2025-08-26T01:56:13.789Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173372737_luxumv4pr","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:13.794Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173372737_luxumv4pr","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:13.801Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173372737_luxumv4pr","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":27,"transformer":36,"protocol":14,"serverCompatibility":34},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:56:13.806Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173372737_luxumv4pr","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:13.818Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:56:13.830Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T01:56:13.835Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:13.839Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T01:56:13.844Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T01:56:13.848Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T01:56:13.852Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T01:56:13.857Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173373857_hdv9qa3ed","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T01:56:13.869Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:13.873Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173373857_hdv9qa3ed","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T01:56:13.878Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173373857_hdv9qa3ed","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T01:56:13.897Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173373857_hdv9qa3ed","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T01:56:13.911Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173373857_hdv9qa3ed","hasOutput":true}}
{"timestamp":"2025-08-26T01:56:13.915Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173373857_hdv9qa3ed","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T01:56:13.927Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173373857_hdv9qa3ed","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:13.931Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173373857_hdv9qa3ed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:13.936Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173373857_hdv9qa3ed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:13.956Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173373857_hdv9qa3ed","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T01:56:13.968Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173373857_hdv9qa3ed","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T01:56:13.973Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173373857_hdv9qa3ed","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T01:56:13.978Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173373857_hdv9qa3ed","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T01:56:13.983Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173373857_hdv9qa3ed","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T01:56:13.995Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173373857_hdv9qa3ed","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T01:56:14.000Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173373857_hdv9qa3ed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:14.004Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173373857_hdv9qa3ed","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T01:56:14.019Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.023Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19424,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.028Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:14.032Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373101_4u1k9yabx","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"936d3e55-0b2d-4173-8c3c-c7c5802063c7\"}}"}}
{"timestamp":"2025-08-26T01:56:14.037Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.041Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.045Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373101_4u1k9yabx","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:14.050Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373101_4u1k9yabx","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T01:56:14.054Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:14.065Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123065,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.070Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123065,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.075Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T01:56:14.080Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T01:56:14.106Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:14.111Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373857_hdv9qa3ed","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"848f6e8b-242a-485d-88e2-b53cb61ce23f\"}}"}}
{"timestamp":"2025-08-26T01:56:14.116Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173373857_hdv9qa3ed","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.121Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.126Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:14.131Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373857_hdv9qa3ed","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T01:56:14.135Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:14.143Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.147Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19424,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.464Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:14.475Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373857_hdv9qa3ed","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"0f69d8ec-77f9-4981-9294-5c6f13b1ec7a\"}}"}}
{"timestamp":"2025-08-26T01:56:14.484Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.492Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.500Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:14.506Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373857_hdv9qa3ed","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T01:56:14.512Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:14.521Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.526Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19424,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:14.715Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:14.728Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173373101_4u1k9yabx","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"4e5da423-c7a8-43f0-95c4-06e6633043a1\"}}"}}
{"timestamp":"2025-08-26T01:56:14.738Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373101_4u1k9yabx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.746Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":705,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:14.753Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373101_4u1k9yabx","success":false,"recoveryAction":"failed","recoveryTime":705}}
{"timestamp":"2025-08-26T01:56:14.761Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":1060,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:14.769Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373101_4u1k9yabx","success":false,"recoveryAction":"failed","recoveryTime":1060}}
{"timestamp":"2025-08-26T01:56:14.776Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":1256,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:14.782Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373101_4u1k9yabx","success":false,"recoveryAction":"failed","recoveryTime":1256}}
{"timestamp":"2025-08-26T01:56:14.788Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173373101_4u1k9yabx","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:14.793Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173373101_4u1k9yabx","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:14.801Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173373101_4u1k9yabx","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":70,"transformer":58,"protocol":31,"serverCompatibility":51},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:56:14.806Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173373101_4u1k9yabx","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:14.833Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T01:56:14.975Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:14.984Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173373857_hdv9qa3ed","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"571c5578-6131-4582-b36f-9c7cbb002e1d\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:14.990Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"shuaihong-glm-4.5-key0","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:14.995Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:15.000Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","recoverability":"recoverable","matchedRule":"model-not-found","confidence":0.5}}
{"timestamp":"2025-08-26T01:56:15.006Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173373857_hdv9qa3ed","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T01:56:15.011Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T01:56:15.019Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:15.024Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19424,"timeout":30000}}
{"timestamp":"2025-08-26T01:56:15.182Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":111,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T01:56:15.194Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756173373857_hdv9qa3ed","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Invalid model id: qwen3-coder-plus\",\"request_id\":\"ad8ac0f8-eb68-4d77-962f-925d5b6264c2\"}}","extractedErrorMessage":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:15.201Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173373857_hdv9qa3ed","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Invalid model id: qwen3-coder-plus"}}
{"timestamp":"2025-08-26T01:56:15.207Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":212,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"model-not-found","statusCodes":[400,404],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":0,"description":"模型不支持 - 可切换到其他provider重试"},"confidence":0.5,"reason":"模型不支持 - 可切换到其他provider重试 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:15.214Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","success":false,"recoveryAction":"failed","recoveryTime":212}}
{"timestamp":"2025-08-26T01:56:15.220Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":728,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:15.225Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","success":false,"recoveryAction":"failed","recoveryTime":728}}
{"timestamp":"2025-08-26T01:56:15.231Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":1110,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T01:56:15.237Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173373857_hdv9qa3ed","success":false,"recoveryAction":"failed","recoveryTime":1110}}
{"timestamp":"2025-08-26T01:56:15.242Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173373857_hdv9qa3ed","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:15.246Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173373857_hdv9qa3ed","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T01:56:15.254Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173373857_hdv9qa3ed","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:255:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":28,"transformer":38,"protocol":15,"serverCompatibility":34},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T01:56:15.259Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173373857_hdv9qa3ed","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T01:56:15.272Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:04:53.798Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T02:04:53.801Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T02:04:53.804Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T02:04:53.806Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T02:04:53.808Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T02:04:53.812Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:04:53.815Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:04:53.818Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:04:53.821Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:04:53.824Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T02:04:53.826Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:04:53.829Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:04:54.832Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T02:04:56.382Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T02:04:56.389Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T02:04:56.402Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T02:04:56.408Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T02:04:56.413Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T02:04:56.418Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T02:04:56.421Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T02:04:56.426Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T02:04:56.431Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T02:04:56.437Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T02:04:56.443Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:04:56.448Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:04:56.451Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:04:56.456Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T02:04:56.461Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T02:04:56.464Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:04:56.469Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:04:56.474Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T02:04:56.481Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T02:04:56.486Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T02:04:56.492Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:04:56.497Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:04:56.504Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T02:04:56.509Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":45,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T02:04:56.515Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T02:04:56.524Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T02:04:56.530Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":45,"uptime":0}}
{"timestamp":"2025-08-26T02:04:56.536Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T02:04:56.543Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:04:56.549Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:12.837Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:12.842Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:12.847Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:12.852Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:12.857Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:12.860Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:12.866Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173912866_a9qrlt9yl","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:12.890Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:12.894Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173912866_a9qrlt9yl","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:12.899Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173912866_a9qrlt9yl","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:12.919Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173912866_a9qrlt9yl","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:12.933Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173912866_a9qrlt9yl","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:12.938Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173912866_a9qrlt9yl","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:12.950Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173912866_a9qrlt9yl","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:12.955Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173912866_a9qrlt9yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:12.960Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173912866_a9qrlt9yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:12.972Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173912866_a9qrlt9yl","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:12.984Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173912866_a9qrlt9yl","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:12.996Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173912866_a9qrlt9yl","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:13.000Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173912866_a9qrlt9yl","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:13.005Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173912866_a9qrlt9yl","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:13.010Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173912866_a9qrlt9yl","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:13.022Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173912866_a9qrlt9yl","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:13.026Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173912866_a9qrlt9yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:13.031Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173912866_a9qrlt9yl","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:13.046Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25323,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:13.058Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25323,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:13.070Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:13.075Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:13.079Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:13.084Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:13.088Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:13.091Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:13.095Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173913095_lxfkevsx1","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:13.152Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:13.157Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173913095_lxfkevsx1","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:13.161Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173913095_lxfkevsx1","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:13.188Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173913095_lxfkevsx1","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:13.205Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173913095_lxfkevsx1","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:13.210Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173913095_lxfkevsx1","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:05:13.230Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173913095_lxfkevsx1","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:13.235Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173913095_lxfkevsx1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:13.240Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173913095_lxfkevsx1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:13.261Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173913095_lxfkevsx1","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:13.281Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173913095_lxfkevsx1","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:13.303Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173913095_lxfkevsx1","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:13.309Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173913095_lxfkevsx1","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:13.314Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173913095_lxfkevsx1","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:13.320Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173913095_lxfkevsx1","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:13.341Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173913095_lxfkevsx1","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:13.346Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173913095_lxfkevsx1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:13.351Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173913095_lxfkevsx1","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:13.379Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123198,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:13.385Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123198,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:13.391Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:13.396Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:13.403Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:13.407Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:15.411Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":491,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:15.456Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173912866_a9qrlt9yl","totalTime":2590,"layerTimings":{"router":39,"transformer":40,"protocol":20,"serverCompatibility":34,"server":2404,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:15.472Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173912866_a9qrlt9yl","executionId":"req_1756173912866_a9qrlt9yl","totalTime":2590,"success":true}}
{"timestamp":"2025-08-26T02:05:15.538Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:15.543Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:15.548Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:15.553Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:15.558Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:15.561Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:15.566Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173915566_p9uybiihz","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:15.578Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:15.584Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173915566_p9uybiihz","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:15.588Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173915566_p9uybiihz","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:15.607Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173915566_p9uybiihz","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:15.620Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173915566_p9uybiihz","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:15.625Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173915566_p9uybiihz","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:15.638Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173915566_p9uybiihz","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:15.643Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173915566_p9uybiihz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:15.648Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173915566_p9uybiihz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:15.661Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173915566_p9uybiihz","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:15.673Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173915566_p9uybiihz","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:15.686Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173915566_p9uybiihz","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:15.690Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173915566_p9uybiihz","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:15.695Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173915566_p9uybiihz","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:15.701Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173915566_p9uybiihz","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:15.713Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173915566_p9uybiihz","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:15.718Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173915566_p9uybiihz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:15.722Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173915566_p9uybiihz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:15.737Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19523,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:15.742Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19523,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:15.747Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:15.752Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:17.166Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":487,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:17.221Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173915566_p9uybiihz","totalTime":1655,"layerTimings":{"router":29,"transformer":38,"protocol":20,"serverCompatibility":35,"server":1471,"responseTransform":23},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:17.236Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173915566_p9uybiihz","executionId":"req_1756173915566_p9uybiihz","totalTime":1655,"success":true}}
{"timestamp":"2025-08-26T02:05:17.251Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:17.257Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:17.262Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:17.268Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:17.274Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:17.277Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:17.283Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173917283_mwceylgdn","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:17.298Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:17.303Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173917283_mwceylgdn","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:17.308Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173917283_mwceylgdn","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:17.330Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173917283_mwceylgdn","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:17.345Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173917283_mwceylgdn","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:17.350Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173917283_mwceylgdn","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:17.364Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173917283_mwceylgdn","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:17.370Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173917283_mwceylgdn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:17.376Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173917283_mwceylgdn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:17.388Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173917283_mwceylgdn","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:17.400Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173917283_mwceylgdn","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:17.413Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173917283_mwceylgdn","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:17.419Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173917283_mwceylgdn","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:17.424Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173917283_mwceylgdn","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:17.430Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173917283_mwceylgdn","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:17.444Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173917283_mwceylgdn","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:17.450Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173917283_mwceylgdn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:17.455Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173917283_mwceylgdn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:17.472Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19423,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:17.477Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19423,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:17.482Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:17.487Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:18.965Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":705,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:19.014Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173913095_lxfkevsx1","totalTime":5919,"layerTimings":{"router":73,"transformer":58,"protocol":36,"serverCompatibility":55,"server":5636,"responseTransform":22},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:19.045Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173913095_lxfkevsx1","executionId":"req_1756173913095_lxfkevsx1","totalTime":5919,"success":true}}
{"timestamp":"2025-08-26T02:05:19.063Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:19.068Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:19.073Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:19.078Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:19.083Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:19.086Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:19.091Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173919091_tyuqiirn8","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:19.149Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:19.153Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173919091_tyuqiirn8","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:19.159Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173919091_tyuqiirn8","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:19.186Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173919091_tyuqiirn8","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:19.205Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173919091_tyuqiirn8","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:19.210Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173919091_tyuqiirn8","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:05:19.232Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173919091_tyuqiirn8","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:19.237Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173919091_tyuqiirn8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:19.242Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173919091_tyuqiirn8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:19.263Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173919091_tyuqiirn8","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:19.283Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173919091_tyuqiirn8","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:19.304Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173919091_tyuqiirn8","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:19.309Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173919091_tyuqiirn8","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:19.314Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173919091_tyuqiirn8","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:19.321Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173919091_tyuqiirn8","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:19.342Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173919091_tyuqiirn8","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:19.347Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173919091_tyuqiirn8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:19.352Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173919091_tyuqiirn8","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:19.380Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123198,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:19.385Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123198,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:19.390Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":493,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:19.418Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173917283_mwceylgdn","totalTime":2135,"layerTimings":{"router":33,"transformer":43,"protocol":20,"serverCompatibility":38,"server":1945,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:19.430Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173917283_mwceylgdn","executionId":"req_1756173917283_mwceylgdn","totalTime":2135,"success":true}}
{"timestamp":"2025-08-26T02:05:19.438Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:19.443Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:19.451Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:19.456Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:19.461Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:19.466Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:19.471Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:19.474Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:19.479Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173919479_u43c00069","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:19.491Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:19.496Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173919479_u43c00069","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:19.500Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173919479_u43c00069","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:19.519Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173919479_u43c00069","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:19.535Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173919479_u43c00069","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:19.539Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173919479_u43c00069","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:19.552Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173919479_u43c00069","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:19.557Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173919479_u43c00069","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:19.562Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173919479_u43c00069","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:19.575Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173919479_u43c00069","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:19.586Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173919479_u43c00069","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:19.599Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173919479_u43c00069","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:19.604Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173919479_u43c00069","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:19.609Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173919479_u43c00069","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:19.615Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173919479_u43c00069","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:19.626Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173919479_u43c00069","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:19.631Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173919479_u43c00069","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:19.635Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173919479_u43c00069","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:19.651Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":24955,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:19.655Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":24955,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:19.661Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:19.665Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:19.734Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:19.741Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173919479_u43c00069","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"5619cb90-eb64-467f-8a58-b2dcf92bfbac\"}}"}}
{"timestamp":"2025-08-26T02:05:19.749Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173919479_u43c00069","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:19.756Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173919479_u43c00069","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:19.763Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173919479_u43c00069","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:05:19.769Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173919479_u43c00069","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:05:19.775Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173919479_u43c00069","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:05:19.784Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":24955,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:19.789Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":24955,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:21.626Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":497,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:21.650Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173919479_u43c00069","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":true,"newPipelineId":"qwen-qwen3-coder-plus-key0","recoveryAction":"switched","response":{"id":"20250826100520d5c78787ffb84b5b","object":"","created":1756173921,"model":"ZhipuAI/GLM-4.5","system_fingerprint":"","choices":[{"index":0,"delta":{"role":null,"content":"","tool_calls":null,"function_calls":null,"reasoning_content":""},"finish_reason":"stop","message":{"role":"assistant","content":"JSON.stringify Replacement and Console Log Testing","tool_calls":null,"function_calls":null,"reasoning_content":""}}],"usage":{"prompt_tokens":"[REDACTED]","completion_tokens":"[REDACTED]","total_tokens":"[REDACTED]"}},"recoveryTime":1894,"details":"成功切换到流水线 qwen-qwen3-coder-plus-key0"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:05:21.660Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173919479_u43c00069","success":true,"recoveryAction":"switched","newPipelineId":"qwen-qwen3-coder-plus-key0","recoveryTime":1894}}
{"timestamp":"2025-08-26T02:05:21.669Z","level":"INFO","message":"✅ 流水线切换恢复成功","data":{"requestId":"req_1756173919479_u43c00069","originalPipeline":"modelscope-zhipuai-glm-4.5-key0","newPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"switched","recoveryTime":1894}}
{"timestamp":"2025-08-26T02:05:21.705Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173919479_u43c00069","totalTime":2226,"layerTimings":{"router":28,"transformer":40,"protocol":20,"serverCompatibility":35,"server":2046,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:21.721Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173919479_u43c00069","executionId":"req_1756173919479_u43c00069","totalTime":2226,"success":true}}
{"timestamp":"2025-08-26T02:05:21.735Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:21.741Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:21.746Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:21.752Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:21.758Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:21.762Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:21.768Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173921768_s3z1dafpz","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:21.782Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:21.787Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173921768_s3z1dafpz","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:21.792Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173921768_s3z1dafpz","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:21.812Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173921768_s3z1dafpz","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:21.829Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173921768_s3z1dafpz","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:21.835Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173921768_s3z1dafpz","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:21.848Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173921768_s3z1dafpz","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:21.853Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173921768_s3z1dafpz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:21.858Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173921768_s3z1dafpz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:21.870Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173921768_s3z1dafpz","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:21.884Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173921768_s3z1dafpz","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:21.897Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173921768_s3z1dafpz","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:21.902Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173921768_s3z1dafpz","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:21.907Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173921768_s3z1dafpz","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:21.913Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173921768_s3z1dafpz","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:21.925Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173921768_s3z1dafpz","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:21.930Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173921768_s3z1dafpz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:21.935Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173921768_s3z1dafpz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:21.950Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":18401,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:21.956Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":18401,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:21.961Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:21.966Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:23.337Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":652,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:23.383Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173919091_tyuqiirn8","totalTime":4292,"layerTimings":{"router":74,"transformer":62,"protocol":36,"serverCompatibility":54,"server":4006,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:23.417Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173919091_tyuqiirn8","executionId":"req_1756173919091_tyuqiirn8","totalTime":4292,"success":true}}
{"timestamp":"2025-08-26T02:05:23.537Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:23.543Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:23.548Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:23.553Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:23.558Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:23.562Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:23.568Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173923568_u90z95ca9","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:23.631Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:23.637Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173923568_u90z95ca9","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:23.642Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173923568_u90z95ca9","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:23.677Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173923568_u90z95ca9","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:23.707Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173923568_u90z95ca9","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:23.711Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173923568_u90z95ca9","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:05:23.736Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173923568_u90z95ca9","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:23.741Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173923568_u90z95ca9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:23.746Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173923568_u90z95ca9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:23.772Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173923568_u90z95ca9","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:23.797Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173923568_u90z95ca9","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:23.823Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173923568_u90z95ca9","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:23.829Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173923568_u90z95ca9","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:23.834Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173923568_u90z95ca9","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:23.840Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173923568_u90z95ca9","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:23.863Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173923568_u90z95ca9","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:23.868Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173923568_u90z95ca9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:23.873Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173923568_u90z95ca9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:23.907Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":156130,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:23.912Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":156130,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:23.918Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":491,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:23.947Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173921768_s3z1dafpz","totalTime":2179,"layerTimings":{"router":31,"transformer":43,"protocol":21,"serverCompatibility":36,"server":1994,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:23.960Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173921768_s3z1dafpz","executionId":"req_1756173921768_s3z1dafpz","totalTime":2179,"success":true}}
{"timestamp":"2025-08-26T02:05:23.968Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:23.973Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:23.981Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:23.986Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:23.991Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:23.996Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:24.002Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:24.006Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:24.011Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173924011_no6xu0diw","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:24.025Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:24.030Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173924011_no6xu0diw","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:24.036Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173924011_no6xu0diw","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:24.057Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173924011_no6xu0diw","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:24.073Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173924011_no6xu0diw","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:24.078Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173924011_no6xu0diw","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:24.090Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173924011_no6xu0diw","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:24.095Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173924011_no6xu0diw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:24.100Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173924011_no6xu0diw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:24.112Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173924011_no6xu0diw","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:24.124Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173924011_no6xu0diw","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:24.137Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173924011_no6xu0diw","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:24.141Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173924011_no6xu0diw","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:24.146Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173924011_no6xu0diw","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:24.153Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173924011_no6xu0diw","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:24.166Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173924011_no6xu0diw","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:24.170Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173924011_no6xu0diw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:24.175Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173924011_no6xu0diw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:24.191Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":28153,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.196Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":28153,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.201Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:24.206Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:24.275Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:24.282Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173924011_no6xu0diw","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"510ff25e-70a2-4778-b4b6-7bea5c7ec792\"}}"}}
{"timestamp":"2025-08-26T02:05:24.286Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756173924011_no6xu0diw","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.292Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.297Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173924011_no6xu0diw","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:05:24.302Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173924011_no6xu0diw","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:05:24.307Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:05:24.315Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":28153,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.321Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":28153,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.404Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:24.413Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173924011_no6xu0diw","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"8f588312-8b60-4afa-9392-baba907dbc2c\"}}"}}
{"timestamp":"2025-08-26T02:05:24.421Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.428Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.435Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173924011_no6xu0diw","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:05:24.442Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173924011_no6xu0diw","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:05:24.449Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:05:24.460Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":28153,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.467Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":28153,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.576Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:24.587Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173924011_no6xu0diw","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"d2d8ba98-73c0-41d6-86f9-8b31e8fa5de8\"}}"}}
{"timestamp":"2025-08-26T02:05:24.594Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.602Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.609Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756173924011_no6xu0diw","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:05:24.615Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756173924011_no6xu0diw","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:05:24.620Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:05:24.629Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":28153,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.634Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":28153,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:24.962Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:24.978Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756173924011_no6xu0diw","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"10e8fd9a-3014-4168-a75f-c34ccdb81ca4\"}}"}}
{"timestamp":"2025-08-26T02:05:24.987Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756173924011_no6xu0diw","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:24.996Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":394,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:05:25.004Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173924011_no6xu0diw","success":false,"recoveryAction":"failed","recoveryTime":394}}
{"timestamp":"2025-08-26T02:05:25.011Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":583,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:05:25.018Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173924011_no6xu0diw","success":false,"recoveryAction":"failed","recoveryTime":583}}
{"timestamp":"2025-08-26T02:05:25.024Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":732,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:05:25.030Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756173924011_no6xu0diw","success":false,"recoveryAction":"failed","recoveryTime":732}}
{"timestamp":"2025-08-26T02:05:25.036Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756173924011_no6xu0diw","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:05:25.042Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756173924011_no6xu0diw","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:05:25.052Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756173924011_no6xu0diw","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:290:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":32,"transformer":42,"protocol":20,"serverCompatibility":37},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:05:25.058Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756173924011_no6xu0diw","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:05:25.073Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:05:25.088Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:25.092Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:25.097Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:25.102Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:25.107Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:25.111Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:25.116Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173925116_lzzv97f8f","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:25.128Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:25.133Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173925116_lzzv97f8f","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:25.138Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173925116_lzzv97f8f","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:25.156Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173925116_lzzv97f8f","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:25.173Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173925116_lzzv97f8f","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:25.178Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173925116_lzzv97f8f","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:25.190Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173925116_lzzv97f8f","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:25.195Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173925116_lzzv97f8f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:25.199Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173925116_lzzv97f8f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:25.211Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173925116_lzzv97f8f","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:25.224Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173925116_lzzv97f8f","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:25.236Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173925116_lzzv97f8f","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:25.241Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173925116_lzzv97f8f","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:25.246Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173925116_lzzv97f8f","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:25.253Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173925116_lzzv97f8f","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:25.265Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173925116_lzzv97f8f","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:25.270Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173925116_lzzv97f8f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:25.276Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173925116_lzzv97f8f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:25.293Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":26426,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:25.298Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":26426,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:25.304Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:25.309Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:26.531Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":502,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:26.584Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173925116_lzzv97f8f","totalTime":1468,"layerTimings":{"router":28,"transformer":41,"protocol":20,"serverCompatibility":37,"server":1279,"responseTransform":24},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:26.601Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173925116_lzzv97f8f","executionId":"req_1756173925116_lzzv97f8f","totalTime":1468,"success":true}}
{"timestamp":"2025-08-26T02:05:26.615Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:26.620Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:26.625Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:26.630Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:26.635Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:26.640Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:26.645Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173926645_lexy6s70t","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:26.658Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:26.662Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173926645_lexy6s70t","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:26.667Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173926645_lexy6s70t","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:26.686Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173926645_lexy6s70t","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:26.704Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173926645_lexy6s70t","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:26.709Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173926645_lexy6s70t","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:26.721Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173926645_lexy6s70t","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:26.725Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173926645_lexy6s70t","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:26.730Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173926645_lexy6s70t","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:26.743Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173926645_lexy6s70t","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:26.755Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173926645_lexy6s70t","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:26.767Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173926645_lexy6s70t","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:26.772Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173926645_lexy6s70t","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:26.777Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173926645_lexy6s70t","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:26.784Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173926645_lexy6s70t","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:26.797Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173926645_lexy6s70t","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:26.802Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173926645_lexy6s70t","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:26.807Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173926645_lexy6s70t","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:26.824Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25953,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:26.830Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25953,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:26.836Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:26.842Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:28.489Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":498,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:28.539Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173926645_lexy6s70t","totalTime":1894,"layerTimings":{"router":28,"transformer":43,"protocol":20,"serverCompatibility":37,"server":1706,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:28.556Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173926645_lexy6s70t","executionId":"req_1756173926645_lexy6s70t","totalTime":1894,"success":true}}
{"timestamp":"2025-08-26T02:05:28.570Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:28.576Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:28.581Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:28.587Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:28.592Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:28.596Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:28.602Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173928602_x71gu5v13","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:28.615Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:28.620Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173928602_x71gu5v13","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:28.624Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173928602_x71gu5v13","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:28.644Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173928602_x71gu5v13","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:28.663Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173928602_x71gu5v13","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:28.668Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173928602_x71gu5v13","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:28.680Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173928602_x71gu5v13","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:28.685Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173928602_x71gu5v13","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:28.690Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173928602_x71gu5v13","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:28.702Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173928602_x71gu5v13","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:28.714Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173928602_x71gu5v13","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:28.727Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173928602_x71gu5v13","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:28.732Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173928602_x71gu5v13","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:28.737Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173928602_x71gu5v13","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:28.743Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173928602_x71gu5v13","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:28.755Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173928602_x71gu5v13","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:28.760Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173928602_x71gu5v13","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:28.765Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173928602_x71gu5v13","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:28.781Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":34693,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:28.785Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":34693,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:28.790Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:28.795Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:31.984Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":501,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:32.035Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173928602_x71gu5v13","totalTime":3433,"layerTimings":{"router":29,"transformer":44,"protocol":20,"serverCompatibility":36,"server":3245,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:32.053Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173928602_x71gu5v13","executionId":"req_1756173928602_x71gu5v13","totalTime":3433,"success":true}}
{"timestamp":"2025-08-26T02:05:32.066Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:32.071Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:32.076Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:32.081Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:32.087Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:32.092Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:32.097Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173932097_u9r9b1hfc","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:32.109Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:32.114Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173932097_u9r9b1hfc","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:32.119Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173932097_u9r9b1hfc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:32.140Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173932097_u9r9b1hfc","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:32.160Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173932097_u9r9b1hfc","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:32.166Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173932097_u9r9b1hfc","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:05:32.179Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173932097_u9r9b1hfc","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:32.184Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173932097_u9r9b1hfc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:32.189Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173932097_u9r9b1hfc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:32.202Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173932097_u9r9b1hfc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:32.215Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173932097_u9r9b1hfc","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:32.226Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173932097_u9r9b1hfc","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:32.231Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173932097_u9r9b1hfc","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:32.236Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173932097_u9r9b1hfc","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:32.243Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173932097_u9r9b1hfc","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:32.255Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173932097_u9r9b1hfc","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:32.260Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173932097_u9r9b1hfc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:32.264Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173932097_u9r9b1hfc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:05:32.278Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":21700,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:32.283Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":21700,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:32.289Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:32.294Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:32.950Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":965,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:33.005Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173923568_u90z95ca9","totalTime":9437,"layerTimings":{"router":84,"transformer":79,"protocol":46,"serverCompatibility":60,"server":9106,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:33.046Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173923568_u90z95ca9","executionId":"req_1756173923568_u90z95ca9","totalTime":9437,"success":true}}
{"timestamp":"2025-08-26T02:05:33.065Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:05:33.072Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:33.078Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:05:33.083Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:05:33.087Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:05:33.092Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:05:33.098Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756173933098_xfpjj0qh3","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:05:33.160Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:33.165Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756173933098_xfpjj0qh3","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:05:33.170Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756173933098_xfpjj0qh3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:05:33.200Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756173933098_xfpjj0qh3","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:05:33.235Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756173933098_xfpjj0qh3","hasOutput":true}}
{"timestamp":"2025-08-26T02:05:33.241Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756173933098_xfpjj0qh3","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:05:33.267Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173933098_xfpjj0qh3","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:33.273Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173933098_xfpjj0qh3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:33.279Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756173933098_xfpjj0qh3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:33.304Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756173933098_xfpjj0qh3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:05:33.330Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756173933098_xfpjj0qh3","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:05:33.357Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756173933098_xfpjj0qh3","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:05:33.362Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756173933098_xfpjj0qh3","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:05:33.368Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756173933098_xfpjj0qh3","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:05:33.377Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756173933098_xfpjj0qh3","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:05:33.400Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756173933098_xfpjj0qh3","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:05:33.405Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756173933098_xfpjj0qh3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:33.411Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756173933098_xfpjj0qh3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:05:33.442Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":156130,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:33.447Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":156130,"timeout":30000}}
{"timestamp":"2025-08-26T02:05:33.453Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:05:33.458Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:05:33.761Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":507,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:33.816Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173932097_u9r9b1hfc","totalTime":1719,"layerTimings":{"router":30,"transformer":47,"protocol":21,"serverCompatibility":36,"server":1526,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:33.835Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173932097_u9r9b1hfc","executionId":"req_1756173932097_u9r9b1hfc","totalTime":1719,"success":true}}
{"timestamp":"2025-08-26T02:05:43.579Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":889,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:05:43.628Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756173933098_xfpjj0qh3","totalTime":10530,"layerTimings":{"router":78,"transformer":86,"protocol":46,"serverCompatibility":64,"server":10192,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T02:05:43.664Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756173933098_xfpjj0qh3","executionId":"req_1756173933098_xfpjj0qh3","totalTime":10530,"success":true}}
{"timestamp":"2025-08-26T02:06:08.725Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T02:06:08.729Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T02:06:08.732Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T02:06:08.735Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T02:06:08.738Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T02:06:08.742Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:06:08.745Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:06:08.748Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:06:08.751Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:06:08.754Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T02:06:08.757Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:06:08.759Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:06:09.763Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T02:07:35.295Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T02:07:35.302Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T02:07:35.312Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T02:07:35.317Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T02:07:35.322Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T02:07:35.327Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T02:07:35.330Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T02:07:35.334Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T02:07:35.339Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T02:07:35.343Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T02:07:35.349Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:07:35.353Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:07:35.356Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:07:35.361Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T02:07:35.366Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T02:07:35.368Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:07:35.373Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:07:35.377Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T02:07:35.382Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T02:07:35.387Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T02:07:35.392Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:07:35.397Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:07:35.403Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T02:07:35.408Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":40,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T02:07:35.412Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T02:07:35.421Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T02:07:35.427Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":40,"uptime":0}}
{"timestamp":"2025-08-26T02:07:35.432Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T02:07:35.438Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:07:35.443Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:07:41.022Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:07:41.028Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:07:41.033Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:07:41.038Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:07:41.043Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:07:41.046Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:07:41.052Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174061051_59w7g2os5","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:07:41.076Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:07:41.082Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174061051_59w7g2os5","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:07:41.087Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174061051_59w7g2os5","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:07:41.106Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174061051_59w7g2os5","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:07:41.118Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174061051_59w7g2os5","hasOutput":true}}
{"timestamp":"2025-08-26T02:07:41.123Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174061051_59w7g2os5","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:07:41.136Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174061051_59w7g2os5","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:07:41.141Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174061051_59w7g2os5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:07:41.146Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174061051_59w7g2os5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:07:41.158Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174061051_59w7g2os5","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:07:41.171Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174061051_59w7g2os5","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:07:41.184Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174061051_59w7g2os5","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:07:41.189Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174061051_59w7g2os5","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:07:41.194Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174061051_59w7g2os5","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:07:41.199Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174061051_59w7g2os5","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:07:41.212Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174061051_59w7g2os5","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:07:41.216Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174061051_59w7g2os5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:07:41.221Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174061051_59w7g2os5","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:07:41.236Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":542,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:07:41.278Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:07:41.285Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:07:41.290Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:07:41.296Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:07:41.301Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:07:41.304Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:07:41.309Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174061309_dro3i7k7r","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:07:41.433Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:07:41.438Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174061309_dro3i7k7r","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:07:41.442Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174061309_dro3i7k7r","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:07:41.496Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174061309_dro3i7k7r","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:07:41.575Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174061309_dro3i7k7r","hasOutput":true}}
{"timestamp":"2025-08-26T02:07:41.581Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174061309_dro3i7k7r","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:07:41.625Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174061309_dro3i7k7r","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:07:41.631Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174061309_dro3i7k7r","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:07:41.637Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174061309_dro3i7k7r","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:07:41.680Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174061309_dro3i7k7r","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:07:41.725Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174061309_dro3i7k7r","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:07:41.771Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174061309_dro3i7k7r","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:07:41.776Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174061309_dro3i7k7r","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:07:41.782Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174061309_dro3i7k7r","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:07:41.788Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174061309_dro3i7k7r","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:07:41.834Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174061309_dro3i7k7r","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:07:41.840Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174061309_dro3i7k7r","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:07:41.846Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174061309_dro3i7k7r","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:07:41.920Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:07:41.926Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:07:41.933Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:07:41.938Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:07:41.945Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:07:41.950Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:07:43.449Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":499,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T02:07:43.501Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756174061051_59w7g2os5","totalTime":2449,"layerTimings":{"router":43,"transformer":37,"protocol":20,"serverCompatibility":36,"server":2253,"responseTransform":22},"transformationCount":4}}
{"timestamp":"2025-08-26T02:07:43.514Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756174061051_59w7g2os5","executionId":"req_1756174061051_59w7g2os5","totalTime":2449,"success":true}}
{"timestamp":"2025-08-26T02:08:12.358Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821026,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:08:12.369Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174061309_dro3i7k7r","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:08:12.378Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174061309_dro3i7k7r","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:08:12.386Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174061309_dro3i7k7r","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:08:12.393Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174061309_dro3i7k7r","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:08:12.398Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174061309_dro3i7k7r","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:08:12.437Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:12.443Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:12.449Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821026,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:08:41.072Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:08:41.080Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:08:41.086Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:08:41.093Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:08:41.100Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:08:41.103Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:08:41.109Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174121109_7hmpnmj6n","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:08:41.244Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:08:41.249Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174121109_7hmpnmj6n","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:08:41.254Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174121109_7hmpnmj6n","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:08:41.311Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174121109_7hmpnmj6n","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:08:41.390Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174121109_7hmpnmj6n","hasOutput":true}}
{"timestamp":"2025-08-26T02:08:41.395Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174121109_7hmpnmj6n","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:08:41.438Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174121109_7hmpnmj6n","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:08:41.444Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174121109_7hmpnmj6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:08:41.449Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174121109_7hmpnmj6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:08:41.493Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174121109_7hmpnmj6n","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:08:41.541Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174121109_7hmpnmj6n","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:08:41.588Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174121109_7hmpnmj6n","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:08:41.594Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174121109_7hmpnmj6n","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:08:41.600Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174121109_7hmpnmj6n","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:08:41.607Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174121109_7hmpnmj6n","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:08:41.654Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174121109_7hmpnmj6n","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:08:41.659Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174121109_7hmpnmj6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:08:41.664Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174121109_7hmpnmj6n","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:08:41.740Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:41.746Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:41.751Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:08:41.757Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:08:42.847Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821026,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:08:42.860Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174061309_dro3i7k7r","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:08:42.868Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174061309_dro3i7k7r","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:08:42.877Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174061309_dro3i7k7r","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:08:42.884Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174061309_dro3i7k7r","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:08:42.894Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174061309_dro3i7k7r","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:08:42.938Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:42.946Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:08:42.953Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821026,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:09:12.261Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821026,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:09:12.277Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174121109_7hmpnmj6n","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:09:12.286Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174121109_7hmpnmj6n","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:09:12.295Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174121109_7hmpnmj6n","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:09:12.302Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174121109_7hmpnmj6n","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:09:12.308Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174121109_7hmpnmj6n","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:09:12.350Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:09:12.357Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:09:12.363Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821026,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:09:13.021Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":691,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:09:13.036Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174061309_dro3i7k7r","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":true,"newPipelineId":"shuaihong-glm-4.5-key0","recoveryAction":"switched","response":{"id":"2025082610084470d643502b574919","object":"","created":1756174153,"model":"ZhipuAI/GLM-4.5","system_fingerprint":"","choices":[{"index":0,"delta":{"role":null,"content":"","tool_calls":null,"function_calls":null,"reasoning_content":""},"finish_reason":"stop","message":{"role":"assistant","content":"\n我注意到我们之前的对话被系统消息打断了。看起来是一个关于GitHub或代码开发的技术性讨论，但最后一条消息显示了一个错误响应（\"bad response status code 504\"）。\n\n如果您有新的问题或想继续之前的讨论，请告诉我您想要讨论的具体内容，我会很乐意为您提供帮助。\n\n例如，如果您想了解：\n- 特定编程语言或框架的问题\n- 代码调试或优化建议\n- 软件开发最佳实践\n- 或任何其他技术主题\n\n请随时提出您的问题，我会尽力协助您。","tool_calls":null,"function_calls":null,"reasoning_content":""}}],"usage":{"prompt_tokens":"[REDACTED]","completion_tokens":"[REDACTED]","total_tokens":"[REDACTED]"}},"recoveryTime":30168,"details":"成功切换到流水线 shuaihong-glm-4.5-key0"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:09:13.044Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174061309_dro3i7k7r","success":true,"recoveryAction":"switched","newPipelineId":"shuaihong-glm-4.5-key0","recoveryTime":30168}}
{"timestamp":"2025-08-26T02:09:13.052Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174061309_dro3i7k7r","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":true,"newPipelineId":"shuaihong-glm-4.5-key0","recoveryAction":"switched","response":{"id":"2025082610084470d643502b574919","object":"","created":1756174153,"model":"ZhipuAI/GLM-4.5","system_fingerprint":"","choices":[{"index":0,"delta":{"role":null,"content":"","tool_calls":null,"function_calls":null,"reasoning_content":""},"finish_reason":"stop","message":{"role":"assistant","content":"\n我注意到我们之前的对话被系统消息打断了。看起来是一个关于GitHub或代码开发的技术性讨论，但最后一条消息显示了一个错误响应（\"bad response status code 504\"）。\n\n如果您有新的问题或想继续之前的讨论，请告诉我您想要讨论的具体内容，我会很乐意为您提供帮助。\n\n例如，如果您想了解：\n- 特定编程语言或框架的问题\n- 代码调试或优化建议\n- 软件开发最佳实践\n- 或任何其他技术主题\n\n请随时提出您的问题，我会尽力协助您。","tool_calls":null,"function_calls":null,"reasoning_content":""}}],"usage":{"prompt_tokens":"[REDACTED]","completion_tokens":"[REDACTED]","total_tokens":"[REDACTED]"}},"recoveryTime":60674,"details":"成功切换到流水线 shuaihong-glm-4.5-key0"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:09:13.059Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174061309_dro3i7k7r","success":true,"recoveryAction":"switched","newPipelineId":"shuaihong-glm-4.5-key0","recoveryTime":60674}}
{"timestamp":"2025-08-26T02:09:13.067Z","level":"INFO","message":"✅ 流水线切换恢复成功","data":{"requestId":"req_1756174061309_dro3i7k7r","originalPipeline":"modelscope-zhipuai-glm-4.5-key0","newPipeline":"shuaihong-glm-4.5-key0","recoveryAction":"switched","recoveryTime":60674}}
{"timestamp":"2025-08-26T02:09:13.100Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756174061309_dro3i7k7r","totalTime":91791,"layerTimings":{"router":139,"transformer":172,"protocol":84,"serverCompatibility":103,"server":91232,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T02:09:13.219Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756174061309_dro3i7k7r","executionId":"req_1756174061309_dro3i7k7r","totalTime":91791,"success":true}}
{"timestamp":"2025-08-26T02:09:41.638Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:09:41.645Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:09:41.650Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:09:41.656Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:09:41.661Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:09:41.664Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:09:41.670Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174181670_d89t4fchr","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:09:41.792Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:09:41.797Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174181670_d89t4fchr","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:09:41.802Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174181670_d89t4fchr","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:09:41.856Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174181670_d89t4fchr","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:09:41.939Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174181670_d89t4fchr","hasOutput":true}}
{"timestamp":"2025-08-26T02:09:41.944Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174181670_d89t4fchr","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:09:41.987Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174181670_d89t4fchr","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:09:41.991Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174181670_d89t4fchr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:09:41.996Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174181670_d89t4fchr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:09:42.040Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174181670_d89t4fchr","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:09:42.084Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174181670_d89t4fchr","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:09:42.130Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174181670_d89t4fchr","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:09:42.135Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174181670_d89t4fchr","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:09:42.140Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174181670_d89t4fchr","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:09:42.147Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174181670_d89t4fchr","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:09:42.191Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174181670_d89t4fchr","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:09:42.197Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174181670_d89t4fchr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:09:42.202Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174181670_d89t4fchr","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:09:42.279Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821026,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:09:42.286Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821026,"timeout":30000}}
{"timestamp":"2025-08-26T02:09:42.292Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":884,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:09:42.302Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174121109_7hmpnmj6n","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":true,"newPipelineId":"qwen-qwen3-coder-plus-key0","recoveryAction":"switched","response":{"id":"20250826100913bdf2779600054868","object":"","created":1756174182,"model":"ZhipuAI/GLM-4.5","system_fingerprint":"","choices":[{"index":0,"delta":{"role":null,"content":"","tool_calls":null,"function_calls":null,"reasoning_content":""},"finish_reason":"stop","message":{"role":"assistant","content":"\n\n很抱歉，之前的请求似乎遇到了技术问题（状态码504）。如果这是关于特定任务的延续，请告诉我您希望继续的内容或需要协助的具体方向，我会立即为您处理！ 😊","tool_calls":null,"function_calls":null,"reasoning_content":"嗯，用户只是简单地回复了“继续”，这表示他们希望我继续之前的对话或任务。不过，根据之前的对话历史，我注意到最后一次交互时出现了一个错误消息，显示“bad response status code 504 (request id: 20250826080768961893KA9rPw9B)”和“openai_error”类型。\n\n用户可能是在测试系统稳定性，或者希望我忽略这个错误继续之前的话题。考虑到错误是技术性的，而用户没有提供具体上下文，我会以友好方式确认并询问具体需求。\n\n为了保持对话自然，我会：\n1. 简要提及之前的错误状态，但不过度强调\n2. 表明已准备好继续服务\n3. 邀请用户明确需求，避免重复错误\n\n这样既回应了技术问题，又把主动权交还给用户，符合“继续”的指令。"}}],"usage":{"prompt_tokens":"[REDACTED]","completion_tokens":"[REDACTED]","total_tokens":"[REDACTED]"}},"recoveryTime":30016,"details":"成功切换到流水线 qwen-qwen3-coder-plus-key0"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:09:42.307Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174121109_7hmpnmj6n","success":true,"recoveryAction":"switched","newPipelineId":"qwen-qwen3-coder-plus-key0","recoveryTime":30016}}
{"timestamp":"2025-08-26T02:09:42.312Z","level":"INFO","message":"✅ 流水线切换恢复成功","data":{"requestId":"req_1756174121109_7hmpnmj6n","originalPipeline":"modelscope-zhipuai-glm-4.5-key0","newPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"switched","recoveryTime":30016}}
{"timestamp":"2025-08-26T02:09:42.338Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756174121109_7hmpnmj6n","totalTime":61229,"layerTimings":{"router":153,"transformer":171,"protocol":87,"serverCompatibility":106,"server":60655,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T02:09:42.453Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756174121109_7hmpnmj6n","executionId":"req_1756174121109_7hmpnmj6n","totalTime":61229,"success":true}}
{"timestamp":"2025-08-26T02:09:42.465Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:09:42.471Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:10:11.161Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":774,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:10:11.204Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756174181670_d89t4fchr","totalTime":29534,"layerTimings":{"router":139,"transformer":174,"protocol":83,"serverCompatibility":102,"server":28977,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T02:10:11.326Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756174181670_d89t4fchr","executionId":"req_1756174181670_d89t4fchr","totalTime":29534,"success":true}}
{"timestamp":"2025-08-26T02:11:21.217Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:11:21.223Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:11:21.228Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:11:21.234Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:11:21.239Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:11:21.243Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:11:21.250Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174281250_ry50atn1k","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:11:21.263Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:11:21.268Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174281250_ry50atn1k","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:11:21.274Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174281250_ry50atn1k","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:11:21.294Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174281250_ry50atn1k","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:11:21.309Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174281250_ry50atn1k","hasOutput":true}}
{"timestamp":"2025-08-26T02:11:21.313Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174281250_ry50atn1k","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:11:21.325Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174281250_ry50atn1k","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:11:21.330Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174281250_ry50atn1k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:11:21.335Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174281250_ry50atn1k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:11:21.347Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174281250_ry50atn1k","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:11:21.360Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174281250_ry50atn1k","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:11:21.371Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174281250_ry50atn1k","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:11:21.376Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174281250_ry50atn1k","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:11:21.381Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174281250_ry50atn1k","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:11:21.387Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174281250_ry50atn1k","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:11:21.399Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174281250_ry50atn1k","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:11:21.403Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174281250_ry50atn1k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:11:21.408Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174281250_ry50atn1k","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:11:21.422Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":797,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:11:21.456Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:11:21.462Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:11:21.467Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:11:21.472Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:11:21.478Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:11:21.481Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:11:21.486Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174281486_6dj822ztj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:11:21.609Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:11:21.614Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174281486_6dj822ztj","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:11:21.619Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174281486_6dj822ztj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:11:21.671Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174281486_6dj822ztj","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:11:21.761Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174281486_6dj822ztj","hasOutput":true}}
{"timestamp":"2025-08-26T02:11:21.767Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174281486_6dj822ztj","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:11:21.814Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174281486_6dj822ztj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:11:21.820Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174281486_6dj822ztj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:11:21.826Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174281486_6dj822ztj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:11:21.872Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174281486_6dj822ztj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:11:21.916Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174281486_6dj822ztj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:11:21.963Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174281486_6dj822ztj","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:11:21.969Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174281486_6dj822ztj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:11:21.975Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174281486_6dj822ztj","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:11:21.981Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174281486_6dj822ztj","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:11:22.024Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174281486_6dj822ztj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:11:22.029Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174281486_6dj822ztj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:11:22.035Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174281486_6dj822ztj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:11:22.110Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:11:22.117Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:11:22.124Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:11:22.129Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:11:22.137Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:11:22.143Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:11:23.229Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":516,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T02:11:23.275Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756174281250_ry50atn1k","totalTime":2025,"layerTimings":{"router":31,"transformer":39,"protocol":21,"serverCompatibility":35,"server":1848,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T02:11:23.286Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756174281250_ry50atn1k","executionId":"req_1756174281250_ry50atn1k","totalTime":2025,"success":true}}
{"timestamp":"2025-08-26T02:11:52.511Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:11:52.525Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174281486_6dj822ztj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:11:52.535Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:11:52.545Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174281486_6dj822ztj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:11:52.551Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174281486_6dj822ztj","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:11:52.558Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:11:52.597Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:11:52.604Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:11:52.611Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:12:21.300Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:12:21.309Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:12:21.316Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:12:21.322Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:12:21.329Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:12:21.334Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:12:21.341Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174341341_c4eygziid","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:12:21.477Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:12:21.482Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174341341_c4eygziid","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:12:21.487Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174341341_c4eygziid","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:12:21.542Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174341341_c4eygziid","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:12:21.632Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174341341_c4eygziid","hasOutput":true}}
{"timestamp":"2025-08-26T02:12:21.637Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174341341_c4eygziid","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:12:21.681Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174341341_c4eygziid","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:12:21.687Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174341341_c4eygziid","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:12:21.693Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174341341_c4eygziid","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:12:21.737Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174341341_c4eygziid","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:12:21.784Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174341341_c4eygziid","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:12:21.830Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174341341_c4eygziid","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:12:21.836Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174341341_c4eygziid","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:12:21.841Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174341341_c4eygziid","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:12:21.848Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174341341_c4eygziid","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:12:21.892Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174341341_c4eygziid","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:12:21.897Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174341341_c4eygziid","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:12:21.903Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174341341_c4eygziid","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:12:21.978Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:21.985Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:21.991Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:12:21.996Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:12:23.036Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:12:23.048Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:23.057Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:23.066Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174281486_6dj822ztj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:12:23.074Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174281486_6dj822ztj","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:12:23.080Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:12:23.123Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:23.130Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:23.136Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:12:52.432Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:12:52.449Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174341341_c4eygziid","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:52.459Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:52.468Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174341341_c4eygziid","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:12:52.477Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174341341_c4eygziid","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:12:52.484Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:12:52.526Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:52.532Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:52.538Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:12:53.593Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:12:53.611Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:53.621Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:12:53.631Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174281486_6dj822ztj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:12:53.639Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174281486_6dj822ztj","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:12:53.647Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:12:53.688Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:53.695Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:12:53.701Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:13:21.905Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:13:21.914Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:13:21.920Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:13:21.926Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:13:21.932Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:13:21.937Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:13:21.943Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174401943_7txp8b3kd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:13:22.066Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:13:22.071Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174401943_7txp8b3kd","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:13:22.077Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174401943_7txp8b3kd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:13:22.132Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174401943_7txp8b3kd","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:13:22.228Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174401943_7txp8b3kd","hasOutput":true}}
{"timestamp":"2025-08-26T02:13:22.233Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174401943_7txp8b3kd","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:13:22.278Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174401943_7txp8b3kd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:13:22.284Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174401943_7txp8b3kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:13:22.289Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174401943_7txp8b3kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:13:22.333Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174401943_7txp8b3kd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:13:22.378Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174401943_7txp8b3kd","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:13:22.424Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174401943_7txp8b3kd","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:13:22.429Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174401943_7txp8b3kd","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:13:22.435Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174401943_7txp8b3kd","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:13:22.442Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174401943_7txp8b3kd","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:13:22.485Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174401943_7txp8b3kd","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:13:22.491Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174401943_7txp8b3kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:13:22.497Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174401943_7txp8b3kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:13:22.570Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:22.577Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:22.586Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:13:22.592Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:13:22.941Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:13:22.954Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:22.962Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:22.968Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174341341_c4eygziid","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:13:22.975Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174341341_c4eygziid","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:13:22.982Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:13:23.022Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:23.028Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:23.034Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:13:24.116Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:13:24.141Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174281486_6dj822ztj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:24.152Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30531,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:13:24.161Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174281486_6dj822ztj","success":false,"recoveryAction":"failed","recoveryTime":30531}}
{"timestamp":"2025-08-26T02:13:24.169Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":61112,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:13:24.178Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174281486_6dj822ztj","success":false,"recoveryAction":"failed","recoveryTime":61112}}
{"timestamp":"2025-08-26T02:13:24.185Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91650,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:13:24.191Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174281486_6dj822ztj","success":false,"recoveryAction":"failed","recoveryTime":91650}}
{"timestamp":"2025-08-26T02:13:24.197Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174281486_6dj822ztj","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:13:24.203Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174281486_6dj822ztj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:13:24.212Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174281486_6dj822ztj","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":140,"transformer":183,"protocol":85,"serverCompatibility":103},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:13:24.217Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174281486_6dj822ztj","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:24.333Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:13:24.343Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:13:53.034Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:13:53.045Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174401943_7txp8b3kd","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:53.053Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:53.060Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174401943_7txp8b3kd","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:13:53.068Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174401943_7txp8b3kd","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:13:53.074Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:13:53.115Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:53.121Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:53.127Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:13:53.455Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:13:53.473Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:53.484Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:13:53.493Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174341341_c4eygziid","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:13:53.501Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174341341_c4eygziid","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:13:53.509Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:13:53.551Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:53.558Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:13:53.564Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:14:23.127Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:14:23.135Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:14:23.141Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:14:23.147Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:14:23.153Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:14:23.158Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:14:23.164Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174463164_3flxesoxa","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:14:23.301Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:14:23.307Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174463164_3flxesoxa","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:14:23.312Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174463164_3flxesoxa","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:14:23.372Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174463164_3flxesoxa","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:14:23.475Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174463164_3flxesoxa","hasOutput":true}}
{"timestamp":"2025-08-26T02:14:23.481Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174463164_3flxesoxa","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:14:23.532Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174463164_3flxesoxa","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:14:23.538Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174463164_3flxesoxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:14:23.544Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174463164_3flxesoxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:14:23.595Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174463164_3flxesoxa","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:14:23.639Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174463164_3flxesoxa","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:14:23.684Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174463164_3flxesoxa","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:14:23.691Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174463164_3flxesoxa","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:14:23.697Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174463164_3flxesoxa","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:14:23.704Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174463164_3flxesoxa","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:14:23.748Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174463164_3flxesoxa","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:14:23.754Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174463164_3flxesoxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:14:23.759Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174463164_3flxesoxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:14:23.834Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:23.841Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:23.847Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:14:23.853Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:23.858Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:23.864Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174401943_7txp8b3kd","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:14:23.869Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174401943_7txp8b3kd","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:14:23.874Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:14:23.909Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:23.915Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:23.922Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:14:23.931Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:14:23.936Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:14:24.000Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:14:24.007Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174341341_c4eygziid","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:24.014Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30530,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:14:24.020Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174341341_c4eygziid","success":false,"recoveryAction":"failed","recoveryTime":30530}}
{"timestamp":"2025-08-26T02:14:24.026Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":61064,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:14:24.031Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174341341_c4eygziid","success":false,"recoveryAction":"failed","recoveryTime":61064}}
{"timestamp":"2025-08-26T02:14:24.037Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174341341_c4eygziid","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91578,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:14:24.042Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174341341_c4eygziid","success":false,"recoveryAction":"failed","recoveryTime":91578}}
{"timestamp":"2025-08-26T02:14:24.047Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174341341_c4eygziid","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:14:24.053Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174341341_c4eygziid","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:14:24.061Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174341341_c4eygziid","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":152,"transformer":182,"protocol":85,"serverCompatibility":102},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:14:24.066Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174341341_c4eygziid","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:24.179Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:14:24.188Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:14:54.525Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:14:54.532Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174463164_3flxesoxa","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:54.539Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:54.546Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174463164_3flxesoxa","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:14:54.552Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174463164_3flxesoxa","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:14:54.559Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:14:54.600Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:54.608Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:54.614Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:14:55.760Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:14:55.770Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:55.777Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:14:55.784Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174401943_7txp8b3kd","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:14:55.791Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174401943_7txp8b3kd","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:14:55.798Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:14:55.844Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:55.850Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:14:55.855Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:15:25.013Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:15:25.024Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:25.033Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:25.040Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174463164_3flxesoxa","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:15:25.048Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174463164_3flxesoxa","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:15:25.054Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:15:25.093Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:25.100Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:25.106Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:15:25.262Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:15:25.270Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:15:25.277Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:15:25.285Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:15:25.291Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:15:25.296Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:15:25.302Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174525302_e247ktf5s","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:15:25.442Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:15:25.448Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174525302_e247ktf5s","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:15:25.454Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174525302_e247ktf5s","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:15:25.509Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174525302_e247ktf5s","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:15:25.610Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174525302_e247ktf5s","hasOutput":true}}
{"timestamp":"2025-08-26T02:15:25.615Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174525302_e247ktf5s","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:15:25.662Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174525302_e247ktf5s","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:15:25.668Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174525302_e247ktf5s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:15:25.674Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174525302_e247ktf5s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:15:25.722Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174525302_e247ktf5s","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:15:25.770Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174525302_e247ktf5s","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:15:25.818Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174525302_e247ktf5s","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:15:25.825Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174525302_e247ktf5s","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:15:25.831Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174525302_e247ktf5s","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:15:25.839Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174525302_e247ktf5s","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:15:25.885Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174525302_e247ktf5s","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:15:25.892Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174525302_e247ktf5s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:15:25.897Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174525302_e247ktf5s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:15:25.973Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:25.980Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:25.987Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:15:25.992Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:15:26.265Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:15:26.274Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174401943_7txp8b3kd","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:26.282Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30505,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:15:26.291Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174401943_7txp8b3kd","success":false,"recoveryAction":"failed","recoveryTime":30505}}
{"timestamp":"2025-08-26T02:15:26.298Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":62440,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:15:26.304Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174401943_7txp8b3kd","success":false,"recoveryAction":"failed","recoveryTime":62440}}
{"timestamp":"2025-08-26T02:15:26.309Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":93256,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:15:26.315Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174401943_7txp8b3kd","success":false,"recoveryAction":"failed","recoveryTime":93256}}
{"timestamp":"2025-08-26T02:15:26.320Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174401943_7txp8b3kd","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:15:26.325Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174401943_7txp8b3kd","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:15:26.334Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174401943_7txp8b3kd","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":139,"transformer":190,"protocol":84,"serverCompatibility":101},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:15:26.339Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174401943_7txp8b3kd","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:26.459Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:15:26.468Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:15:56.104Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:15:56.111Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:56.117Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:56.123Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174463164_3flxesoxa","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:15:56.129Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174463164_3flxesoxa","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:15:56.135Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:15:56.177Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:56.184Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:56.190Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:15:56.581Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:15:56.588Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174525302_e247ktf5s","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:56.594Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:15:56.600Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174525302_e247ktf5s","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:15:56.605Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174525302_e247ktf5s","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:15:56.611Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:15:56.652Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:56.660Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:15:56.666Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:16:26.666Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:16:26.673Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174463164_3flxesoxa","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:26.679Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30562,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:16:26.685Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174463164_3flxesoxa","success":false,"recoveryAction":"failed","recoveryTime":30562}}
{"timestamp":"2025-08-26T02:16:26.691Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":61658,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:16:26.697Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174463164_3flxesoxa","success":false,"recoveryAction":"failed","recoveryTime":61658}}
{"timestamp":"2025-08-26T02:16:26.702Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":92163,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:16:26.708Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174463164_3flxesoxa","success":false,"recoveryAction":"failed","recoveryTime":92163}}
{"timestamp":"2025-08-26T02:16:26.713Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174463164_3flxesoxa","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:16:26.718Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174463164_3flxesoxa","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:16:26.727Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174463164_3flxesoxa","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":156,"transformer":206,"protocol":90,"serverCompatibility":102},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:16:26.733Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174463164_3flxesoxa","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:26.861Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:16:26.871Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:16:27.089Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:16:27.097Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:27.102Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:27.108Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174525302_e247ktf5s","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:16:27.114Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174525302_e247ktf5s","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:16:27.119Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:16:27.161Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:27.168Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:27.174Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:16:29.533Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:16:29.540Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:16:29.546Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:16:29.551Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:16:29.557Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:16:29.562Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:16:29.568Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174589568_d04bpqfxx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:16:29.707Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:16:29.713Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174589568_d04bpqfxx","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:16:29.718Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174589568_d04bpqfxx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:16:29.783Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174589568_d04bpqfxx","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:16:29.894Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174589568_d04bpqfxx","hasOutput":true}}
{"timestamp":"2025-08-26T02:16:29.900Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174589568_d04bpqfxx","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:16:29.945Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174589568_d04bpqfxx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:16:29.951Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174589568_d04bpqfxx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:16:29.958Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174589568_d04bpqfxx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:16:30.009Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174589568_d04bpqfxx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:16:30.062Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174589568_d04bpqfxx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:16:30.112Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174589568_d04bpqfxx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:16:30.118Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174589568_d04bpqfxx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:16:30.124Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174589568_d04bpqfxx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:16:30.132Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174589568_d04bpqfxx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:16:30.181Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174589568_d04bpqfxx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:16:30.187Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174589568_d04bpqfxx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:16:30.193Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174589568_d04bpqfxx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:16:30.280Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:30.288Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:30.296Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:16:30.302Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:16:57.618Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:16:57.631Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:57.640Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:16:57.648Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174525302_e247ktf5s","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:16:57.656Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174525302_e247ktf5s","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:16:57.663Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:16:57.703Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:57.710Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:16:57.716Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:17:00.645Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:17:00.657Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174589568_d04bpqfxx","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:00.665Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:00.672Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174589568_d04bpqfxx","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:17:00.678Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174589568_d04bpqfxx","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:17:00.683Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:17:00.722Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:00.728Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:00.734Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:17:28.160Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:17:28.173Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174525302_e247ktf5s","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:28.182Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30542,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:17:28.191Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174525302_e247ktf5s","success":false,"recoveryAction":"failed","recoveryTime":30542}}
{"timestamp":"2025-08-26T02:17:28.199Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":61097,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:17:28.207Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174525302_e247ktf5s","success":false,"recoveryAction":"failed","recoveryTime":61097}}
{"timestamp":"2025-08-26T02:17:28.213Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91619,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:17:28.219Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174525302_e247ktf5s","success":false,"recoveryAction":"failed","recoveryTime":91619}}
{"timestamp":"2025-08-26T02:17:28.225Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174525302_e247ktf5s","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:17:28.231Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174525302_e247ktf5s","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:17:28.239Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174525302_e247ktf5s","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":158,"transformer":196,"protocol":90,"serverCompatibility":108},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:17:28.244Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174525302_e247ktf5s","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:28.362Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:17:28.370Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:17:31.149Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:17:31.161Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:31.171Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:17:31.179Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174589568_d04bpqfxx","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:17:31.186Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174589568_d04bpqfxx","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:17:31.193Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:17:31.234Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:31.241Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:31.247Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:17:37.997Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:17:38.005Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:17:38.010Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:17:38.017Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:17:38.022Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:17:38.027Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:17:38.033Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174658033_th32z5mvk","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:17:38.157Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:17:38.163Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174658033_th32z5mvk","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:17:38.168Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174658033_th32z5mvk","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:17:38.224Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174658033_th32z5mvk","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:17:38.327Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174658033_th32z5mvk","hasOutput":true}}
{"timestamp":"2025-08-26T02:17:38.332Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174658033_th32z5mvk","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:17:38.376Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174658033_th32z5mvk","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:17:38.382Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174658033_th32z5mvk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:17:38.387Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174658033_th32z5mvk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:17:38.430Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174658033_th32z5mvk","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:17:38.478Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174658033_th32z5mvk","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:17:38.523Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174658033_th32z5mvk","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:17:38.529Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174658033_th32z5mvk","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:17:38.534Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174658033_th32z5mvk","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:17:38.542Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174658033_th32z5mvk","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:17:38.585Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174658033_th32z5mvk","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:17:38.591Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174658033_th32z5mvk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:17:38.596Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174658033_th32z5mvk","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:17:38.669Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:38.676Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:17:38.684Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:17:38.690Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:18:01.635Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:18:01.646Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:01.653Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:01.661Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174589568_d04bpqfxx","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:18:01.669Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174589568_d04bpqfxx","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:18:01.676Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:18:01.715Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:01.721Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:01.727Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:18:09.060Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:18:09.074Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174658033_th32z5mvk","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:09.083Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:09.090Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174658033_th32z5mvk","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:18:09.099Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174658033_th32z5mvk","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:18:09.106Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:18:09.148Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:09.154Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:09.161Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:18:32.128Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:18:32.140Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174589568_d04bpqfxx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:32.149Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30496,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:18:32.158Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174589568_d04bpqfxx","success":false,"recoveryAction":"failed","recoveryTime":30496}}
{"timestamp":"2025-08-26T02:18:32.165Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":60994,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:18:32.172Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174589568_d04bpqfxx","success":false,"recoveryAction":"failed","recoveryTime":60994}}
{"timestamp":"2025-08-26T02:18:32.177Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91512,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:18:32.182Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174589568_d04bpqfxx","success":false,"recoveryAction":"failed","recoveryTime":91512}}
{"timestamp":"2025-08-26T02:18:32.187Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174589568_d04bpqfxx","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:18:32.193Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174589568_d04bpqfxx","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:18:32.201Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174589568_d04bpqfxx","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":157,"transformer":214,"protocol":98,"serverCompatibility":113},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:18:32.207Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174589568_d04bpqfxx","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:32.324Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:18:32.333Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:18:39.574Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:18:39.586Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:39.596Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:18:39.604Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174658033_th32z5mvk","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:18:39.613Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174658033_th32z5mvk","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:18:39.620Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:18:39.660Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:39.666Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:39.672Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:18:56.524Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:18:56.533Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:18:56.539Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:18:56.546Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:18:56.552Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:18:56.557Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:18:56.564Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174736564_0soxr0tjn","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:18:56.688Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:18:56.693Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174736564_0soxr0tjn","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:18:56.698Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174736564_0soxr0tjn","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:18:56.749Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174736564_0soxr0tjn","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:18:56.853Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174736564_0soxr0tjn","hasOutput":true}}
{"timestamp":"2025-08-26T02:18:56.860Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174736564_0soxr0tjn","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:18:56.903Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174736564_0soxr0tjn","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:18:56.909Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174736564_0soxr0tjn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:18:56.915Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174736564_0soxr0tjn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:18:56.959Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174736564_0soxr0tjn","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:18:57.005Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174736564_0soxr0tjn","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:18:57.049Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174736564_0soxr0tjn","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:18:57.055Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174736564_0soxr0tjn","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:18:57.060Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174736564_0soxr0tjn","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:18:57.068Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174736564_0soxr0tjn","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:18:57.111Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174736564_0soxr0tjn","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:18:57.116Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174736564_0soxr0tjn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:18:57.121Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174736564_0soxr0tjn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:18:57.196Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:57.202Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:18:57.209Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:18:57.214Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:19:10.040Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:19:10.052Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:10.059Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:10.067Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174658033_th32z5mvk","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:19:10.074Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174658033_th32z5mvk","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:19:10.081Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:19:10.119Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:10.127Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:10.133Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:19:27.667Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:19:27.678Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174736564_0soxr0tjn","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:27.686Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:27.694Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174736564_0soxr0tjn","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:19:27.702Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174736564_0soxr0tjn","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:19:27.708Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:19:27.748Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:27.755Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:27.761Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:19:40.542Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:19:40.560Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174658033_th32z5mvk","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:40.571Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30512,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:19:40.581Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174658033_th32z5mvk","success":false,"recoveryAction":"failed","recoveryTime":30512}}
{"timestamp":"2025-08-26T02:19:40.589Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":60993,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:19:40.599Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174658033_th32z5mvk","success":false,"recoveryAction":"failed","recoveryTime":60993}}
{"timestamp":"2025-08-26T02:19:40.607Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91524,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:19:40.614Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174658033_th32z5mvk","success":false,"recoveryAction":"failed","recoveryTime":91524}}
{"timestamp":"2025-08-26T02:19:40.621Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174658033_th32z5mvk","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:19:40.627Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174658033_th32z5mvk","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:19:40.636Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174658033_th32z5mvk","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":144,"transformer":194,"protocol":86,"serverCompatibility":100},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:19:40.642Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174658033_th32z5mvk","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:40.760Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:19:40.768Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:19:58.110Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:19:58.120Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:58.128Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:19:58.136Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174736564_0soxr0tjn","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:19:58.143Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174736564_0soxr0tjn","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:19:58.150Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:19:58.189Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:58.195Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:19:58.200Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:20:28.601Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:20:28.612Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:20:28.621Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:20:28.627Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174736564_0soxr0tjn","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:20:28.634Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174736564_0soxr0tjn","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:20:28.641Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:20:28.681Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:20:28.688Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:20:28.694Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:20:31.660Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:20:31.667Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:20:31.673Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:20:31.679Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:20:31.685Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:20:31.690Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:20:31.696Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174831696_sv5seuidj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:20:31.819Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:20:31.824Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174831696_sv5seuidj","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:20:31.828Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174831696_sv5seuidj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:20:31.880Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174831696_sv5seuidj","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:20:31.987Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174831696_sv5seuidj","hasOutput":true}}
{"timestamp":"2025-08-26T02:20:31.993Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174831696_sv5seuidj","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:20:32.037Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174831696_sv5seuidj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:20:32.043Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174831696_sv5seuidj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:20:32.049Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174831696_sv5seuidj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:20:32.096Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174831696_sv5seuidj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:20:32.142Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174831696_sv5seuidj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:20:32.188Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174831696_sv5seuidj","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:20:32.194Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174831696_sv5seuidj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:20:32.199Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174831696_sv5seuidj","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:20:32.207Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174831696_sv5seuidj","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:20:32.250Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174831696_sv5seuidj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:20:32.255Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174831696_sv5seuidj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:20:32.261Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174831696_sv5seuidj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:20:32.337Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:20:32.343Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:20:32.350Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:20:32.357Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:20:59.103Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:20:59.110Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174736564_0soxr0tjn","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:20:59.116Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30495,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:20:59.121Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174736564_0soxr0tjn","success":false,"recoveryAction":"failed","recoveryTime":30495}}
{"timestamp":"2025-08-26T02:20:59.127Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":60999,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:20:59.132Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174736564_0soxr0tjn","success":false,"recoveryAction":"failed","recoveryTime":60999}}
{"timestamp":"2025-08-26T02:20:59.138Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91452,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:20:59.143Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174736564_0soxr0tjn","success":false,"recoveryAction":"failed","recoveryTime":91452}}
{"timestamp":"2025-08-26T02:20:59.148Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174736564_0soxr0tjn","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:20:59.153Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174736564_0soxr0tjn","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:20:59.161Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174736564_0soxr0tjn","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":140,"transformer":194,"protocol":84,"serverCompatibility":100},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:20:59.167Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174736564_0soxr0tjn","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:20:59.284Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:20:59.293Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:21:02.736Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:21:02.747Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174831696_sv5seuidj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:21:02.755Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:21:02.763Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174831696_sv5seuidj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:21:02.770Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174831696_sv5seuidj","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:21:02.777Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:21:02.818Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:21:02.825Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:21:02.830Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:21:33.255Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:21:33.276Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:21:33.285Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:21:33.293Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174831696_sv5seuidj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:21:33.301Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174831696_sv5seuidj","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:21:33.310Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:21:33.353Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:21:33.361Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:21:33.366Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:22:03.792Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:22:03.802Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:03.811Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:03.818Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174831696_sv5seuidj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:22:03.825Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174831696_sv5seuidj","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:22:03.831Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:22:03.871Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:03.878Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:03.883Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:22:07.362Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:22:07.369Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:22:07.376Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:22:07.382Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:22:07.388Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:22:07.393Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:22:07.399Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756174927399_5rh3txotp","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:22:07.524Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:22:07.529Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756174927399_5rh3txotp","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:22:07.535Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756174927399_5rh3txotp","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:22:07.589Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756174927399_5rh3txotp","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:22:07.700Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756174927399_5rh3txotp","hasOutput":true}}
{"timestamp":"2025-08-26T02:22:07.707Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756174927399_5rh3txotp","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:22:07.752Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174927399_5rh3txotp","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:22:07.758Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174927399_5rh3txotp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:22:07.764Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756174927399_5rh3txotp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:22:07.810Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756174927399_5rh3txotp","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:22:07.855Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756174927399_5rh3txotp","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:22:07.900Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756174927399_5rh3txotp","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:22:07.906Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756174927399_5rh3txotp","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:22:07.912Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756174927399_5rh3txotp","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:22:07.921Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756174927399_5rh3txotp","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:22:07.965Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756174927399_5rh3txotp","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:22:07.971Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756174927399_5rh3txotp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:22:07.976Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756174927399_5rh3txotp","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:22:08.051Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:08.058Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:08.064Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:22:08.070Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:22:34.279Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:22:34.287Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174831696_sv5seuidj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:34.294Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30483,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:22:34.301Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174831696_sv5seuidj","success":false,"recoveryAction":"failed","recoveryTime":30483}}
{"timestamp":"2025-08-26T02:22:34.307Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":61022,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:22:34.314Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174831696_sv5seuidj","success":false,"recoveryAction":"failed","recoveryTime":61022}}
{"timestamp":"2025-08-26T02:22:34.319Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":91564,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:22:34.325Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174831696_sv5seuidj","success":false,"recoveryAction":"failed","recoveryTime":91564}}
{"timestamp":"2025-08-26T02:22:34.331Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174831696_sv5seuidj","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:22:34.337Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174831696_sv5seuidj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:22:34.345Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174831696_sv5seuidj","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":140,"transformer":197,"protocol":87,"serverCompatibility":101},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:22:34.351Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174831696_sv5seuidj","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:34.469Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:22:34.478Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:22:38.528Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:22:38.538Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756174927399_5rh3txotp","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:38.544Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:22:38.552Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174927399_5rh3txotp","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:22:38.559Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174927399_5rh3txotp","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:22:38.565Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:22:38.604Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:38.610Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:22:38.616Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:23:09.054Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:23:09.081Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:23:09.092Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:23:09.102Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174927399_5rh3txotp","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:23:09.112Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174927399_5rh3txotp","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:23:09.121Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:23:09.162Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:09.168Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:09.175Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:23:16.112Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":400,"responseSize":107,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:23:16.136Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756174927399_5rh3txotp","status":400,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1210\",\"message\":\"API 调用参数有误，请检查文档。\"},\"request_id\":\"8d65ac02-269b-40ac-aa65-2118e7c04047\"}","extractedErrorMessage":"API 调用参数有误，请检查文档。"}}
{"timestamp":"2025-08-26T02:23:16.147Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"shuaihong-glm-4.5-key0","error":"API 调用参数有误，请检查文档。"}}
{"timestamp":"2025-08-26T02:23:16.158Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"API 调用参数有误，请检查文档。"}}
{"timestamp":"2025-08-26T02:23:16.167Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756174927399_5rh3txotp","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T02:23:16.175Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756174927399_5rh3txotp","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:23:16.183Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:23:16.223Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:16.229Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:43.233Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:23:43.242Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:23:43.248Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:23:43.255Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:23:43.261Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:23:43.268Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:23:43.275Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756175023275_vbkllsdqd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:23:43.406Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:23:43.412Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756175023275_vbkllsdqd","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:23:43.417Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756175023275_vbkllsdqd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:23:43.469Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756175023275_vbkllsdqd","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:23:43.581Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756175023275_vbkllsdqd","hasOutput":true}}
{"timestamp":"2025-08-26T02:23:43.586Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756175023275_vbkllsdqd","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:23:43.630Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175023275_vbkllsdqd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:23:43.636Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175023275_vbkllsdqd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:23:43.642Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756175023275_vbkllsdqd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:23:43.685Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756175023275_vbkllsdqd","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:23:43.733Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756175023275_vbkllsdqd","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:23:43.779Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756175023275_vbkllsdqd","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:23:43.785Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756175023275_vbkllsdqd","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:23:43.792Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756175023275_vbkllsdqd","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:23:43.801Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756175023275_vbkllsdqd","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:23:43.848Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175023275_vbkllsdqd","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:23:43.854Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175023275_vbkllsdqd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:23:43.860Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756175023275_vbkllsdqd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:23:43.940Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:43.948Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:23:43.954Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:23:43.960Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:23:46.713Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:23:46.726Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756174927399_5rh3txotp","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:23:46.733Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30575,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T02:23:46.739Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174927399_5rh3txotp","success":false,"recoveryAction":"failed","recoveryTime":30575}}
{"timestamp":"2025-08-26T02:23:46.745Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":37653,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:23:46.752Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174927399_5rh3txotp","success":false,"recoveryAction":"failed","recoveryTime":37653}}
{"timestamp":"2025-08-26T02:23:46.757Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":68213,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:23:46.763Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756174927399_5rh3txotp","success":false,"recoveryAction":"failed","recoveryTime":68213}}
{"timestamp":"2025-08-26T02:23:46.769Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756174927399_5rh3txotp","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:23:46.775Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756174927399_5rh3txotp","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:23:46.785Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756174927399_5rh3txotp","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":143,"transformer":205,"protocol":86,"serverCompatibility":104},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:23:46.792Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756174927399_5rh3txotp","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:23:46.919Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:23:46.929Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:24:14.396Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:24:14.405Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756175023275_vbkllsdqd","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:24:14.411Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:24:14.417Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175023275_vbkllsdqd","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:24:14.423Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175023275_vbkllsdqd","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:24:14.429Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:24:14.467Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:14.474Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:14.480Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:24:15.544Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:24:15.552Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175023275_vbkllsdqd","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"5c58fdce-5ea0-480e-8ebf-c2ba5485b246\"}"}}
{"timestamp":"2025-08-26T02:24:15.558Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:24:15.564Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:24:15.570Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175023275_vbkllsdqd","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:24:15.576Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175023275_vbkllsdqd","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:24:15.581Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:24:15.619Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:15.625Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:16.648Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:24:16.660Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175023275_vbkllsdqd","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"ec31a1a7-c444-4eb4-a0b7-3136d8ca1ada\"}"}}
{"timestamp":"2025-08-26T02:24:16.668Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:24:16.675Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:24:16.683Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175023275_vbkllsdqd","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:24:16.688Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175023275_vbkllsdqd","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:24:16.694Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:24:16.731Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:16.737Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:24:46.943Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"bodySize":821879,"isLongTextRequest":true,"suggestion":"长文本请求可能需要更长超时时间"}}
{"timestamp":"2025-08-26T02:24:46.954Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175023275_vbkllsdqd","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:24:46.963Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30288,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:24:46.973Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175023275_vbkllsdqd","success":false,"recoveryAction":"failed","recoveryTime":30288}}
{"timestamp":"2025-08-26T02:24:46.982Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":31418,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:24:46.990Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175023275_vbkllsdqd","success":false,"recoveryAction":"failed","recoveryTime":31418}}
{"timestamp":"2025-08-26T02:24:46.997Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":32586,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:24:47.004Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175023275_vbkllsdqd","success":false,"recoveryAction":"failed","recoveryTime":32586}}
{"timestamp":"2025-08-26T02:24:47.010Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756175023275_vbkllsdqd","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:24:47.015Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756175023275_vbkllsdqd","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:24:47.022Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756175023275_vbkllsdqd","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:355:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":147,"transformer":201,"protocol":86,"serverCompatibility":109},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:24:47.028Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756175023275_vbkllsdqd","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:24:47.147Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:24:47.155Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":821879,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:25:17.237Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T02:25:17.246Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:25:17.252Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:25:17.257Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:25:17.264Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:25:17.270Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:25:17.276Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756175117276_iy6yw01h0","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:25:17.399Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:25:17.404Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756175117276_iy6yw01h0","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T02:25:17.409Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756175117276_iy6yw01h0","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:25:17.461Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756175117276_iy6yw01h0","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:25:17.575Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756175117276_iy6yw01h0","hasOutput":true}}
{"timestamp":"2025-08-26T02:25:17.581Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756175117276_iy6yw01h0","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T02:25:17.628Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175117276_iy6yw01h0","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:25:17.634Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175117276_iy6yw01h0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:25:17.640Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756175117276_iy6yw01h0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:25:17.685Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756175117276_iy6yw01h0","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:25:17.729Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756175117276_iy6yw01h0","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:25:17.774Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756175117276_iy6yw01h0","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:25:17.779Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756175117276_iy6yw01h0","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:25:17.784Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756175117276_iy6yw01h0","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:25:17.792Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756175117276_iy6yw01h0","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:25:17.835Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175117276_iy6yw01h0","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:25:17.840Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175117276_iy6yw01h0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:25:17.845Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756175117276_iy6yw01h0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T02:25:17.919Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:17.926Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:17.932Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:25:17.938Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:25:20.161Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:25:20.173Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175117276_iy6yw01h0","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"2498d072-8922-4276-91f3-a4ead376899e\"}"}}
{"timestamp":"2025-08-26T02:25:20.179Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756175117276_iy6yw01h0","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:20.184Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:20.189Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175117276_iy6yw01h0","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:25:20.195Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175117276_iy6yw01h0","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:25:20.201Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:25:20.240Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:20.246Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:21.145Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:25:21.159Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175117276_iy6yw01h0","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"4feb7518-e4d1-4e27-b821-e91fc77cc283\"}"}}
{"timestamp":"2025-08-26T02:25:21.168Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:21.176Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:21.184Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175117276_iy6yw01h0","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:25:21.192Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175117276_iy6yw01h0","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:25:21.199Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:25:21.237Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:21.242Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:22.003Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:25:22.019Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175117276_iy6yw01h0","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"dfc73fe9-34ad-4422-b372-31f315bcd07d\"}"}}
{"timestamp":"2025-08-26T02:25:22.028Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:22.036Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:22.043Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175117276_iy6yw01h0","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T02:25:22.051Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175117276_iy6yw01h0","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:25:22.058Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:25:22.098Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":821879,"isLongTextRequest":true,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:22.104Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":821879,"timeout":30000}}
{"timestamp":"2025-08-26T02:25:23.009Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":122,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T02:25:23.019Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756175117276_iy6yw01h0","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"1302\",\"message\":\"您当前使用该API的并发数过高，请降低并发，或联系客服增加限额。\"},\"request_id\":\"6bd311f2-8ce6-4734-a48f-224ee0b909cb\"}"}}
{"timestamp":"2025-08-26T02:25:23.027Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175117276_iy6yw01h0","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:23.034Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":998,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:25:23.040Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175117276_iy6yw01h0","success":false,"recoveryAction":"failed","recoveryTime":998}}
{"timestamp":"2025-08-26T02:25:23.046Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":1870,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:25:23.053Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175117276_iy6yw01h0","success":false,"recoveryAction":"failed","recoveryTime":1870}}
{"timestamp":"2025-08-26T02:25:23.059Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":2875,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:25:23.064Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175117276_iy6yw01h0","success":false,"recoveryAction":"failed","recoveryTime":2875}}
{"timestamp":"2025-08-26T02:25:23.070Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756175117276_iy6yw01h0","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:25:23.075Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756175117276_iy6yw01h0","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:25:23.084Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756175117276_iy6yw01h0","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:290:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":139,"transformer":207,"protocol":84,"serverCompatibility":100},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:25:23.090Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756175117276_iy6yw01h0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T02:25:23.209Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:35:48.647Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T02:35:48.651Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T02:35:48.655Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T02:35:48.658Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T02:35:48.661Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T02:35:48.665Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:35:48.668Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:35:48.672Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T02:35:48.675Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:35:48.678Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T02:35:48.681Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T02:35:48.684Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T02:35:49.687Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T02:35:51.248Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T02:35:51.254Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T02:35:51.265Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T02:35:51.271Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T02:35:51.276Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T02:35:51.281Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T02:35:51.283Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T02:35:51.288Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T02:35:51.294Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T02:35:51.299Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T02:35:51.305Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:35:51.310Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:35:51.313Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:35:51.319Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T02:35:51.324Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T02:35:51.327Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:35:51.332Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T02:35:51.337Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T02:35:51.343Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T02:35:51.349Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T02:35:51.354Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:35:51.360Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T02:35:51.366Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T02:35:51.371Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":44,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T02:35:51.377Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T02:35:51.386Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T02:35:51.392Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":44,"uptime":0}}
{"timestamp":"2025-08-26T02:35:51.397Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T02:35:51.403Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:35:51.409Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:38:06.378Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages","hasBody":true}}
{"timestamp":"2025-08-26T02:38:06.384Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:38:06.390Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T02:38:06.396Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T02:38:06.402Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T02:38:06.405Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T02:38:06.411Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756175886411_2ybggbdqj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T02:38:06.436Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:38:06.442Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756175886411_2ybggbdqj","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T02:38:06.448Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T02:38:06.454Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T02:38:06.460Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756175886411_2ybggbdqj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T02:38:06.482Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756175886411_2ybggbdqj","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T02:38:06.494Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756175886411_2ybggbdqj","hasOutput":true}}
{"timestamp":"2025-08-26T02:38:06.500Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756175886411_2ybggbdqj","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T02:38:06.514Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175886411_2ybggbdqj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:38:06.520Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175886411_2ybggbdqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:38:06.525Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756175886411_2ybggbdqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:38:06.539Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756175886411_2ybggbdqj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T02:38:06.552Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756175886411_2ybggbdqj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T02:38:06.565Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756175886411_2ybggbdqj","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T02:38:06.571Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756175886411_2ybggbdqj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T02:38:06.577Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756175886411_2ybggbdqj","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T02:38:06.583Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756175886411_2ybggbdqj","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T02:38:06.595Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756175886411_2ybggbdqj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T02:38:06.599Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756175886411_2ybggbdqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:38:06.604Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756175886411_2ybggbdqj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T02:38:06.618Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":703,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:38:06.631Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T02:38:06.636Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T02:38:36.788Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"originalTimeout":30000,"bodySize":703,"isLongTextRequest":false,"suggestion":"考虑检查网络连接"}}
{"timestamp":"2025-08-26T02:38:36.802Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756175886411_2ybggbdqj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:38:36.811Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:38:36.819Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175886411_2ybggbdqj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:38:36.827Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175886411_2ybggbdqj","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T02:38:36.834Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:38:36.844Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":703,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:38:36.852Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":703,"isLongTextRequest":false,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:39:07.062Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"originalTimeout":30000,"bodySize":703,"isLongTextRequest":false,"suggestion":"考虑检查网络连接"}}
{"timestamp":"2025-08-26T02:39:07.073Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:39:07.083Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:39:07.091Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175886411_2ybggbdqj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:39:07.097Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175886411_2ybggbdqj","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T02:39:07.103Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:39:07.113Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":703,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:39:07.120Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":703,"isLongTextRequest":false,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:39:37.282Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"originalTimeout":30000,"bodySize":703,"isLongTextRequest":false,"suggestion":"考虑检查网络连接"}}
{"timestamp":"2025-08-26T02:39:37.288Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"shuaihong-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:39:37.293Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:39:37.299Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756175886411_2ybggbdqj","recoverability":"recoverable","matchedRule":"gateway-timeout","confidence":0.5}}
{"timestamp":"2025-08-26T02:39:37.304Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756175886411_2ybggbdqj","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T02:39:37.310Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T02:39:37.318Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":703,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T02:39:37.324Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":703,"isLongTextRequest":false,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T02:40:07.486Z","level":"ERROR","message":"HTTP请求超时","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","timeout":30000,"originalTimeout":30000,"bodySize":703,"isLongTextRequest":false,"suggestion":"考虑检查网络连接"}}
{"timestamp":"2025-08-26T02:40:07.498Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756175886411_2ybggbdqj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:40:07.507Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":30214,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:40:07.516Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175886411_2ybggbdqj","success":false,"recoveryAction":"failed","recoveryTime":30214}}
{"timestamp":"2025-08-26T02:40:07.524Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":60441,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:40:07.532Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175886411_2ybggbdqj","success":false,"recoveryAction":"failed","recoveryTime":60441}}
{"timestamp":"2025-08-26T02:40:07.540Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":90729,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"gateway-timeout","statusCodes":[502,504],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":1,"description":"网关超时或连接问题 - 可通过切换流水线恢复"},"confidence":0.5,"reason":"网关超时或连接问题 - 可通过切换流水线恢复 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T02:40:07.547Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756175886411_2ybggbdqj","success":false,"recoveryAction":"failed","recoveryTime":90729}}
{"timestamp":"2025-08-26T02:40:07.553Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756175886411_2ybggbdqj","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:40:07.559Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756175886411_2ybggbdqj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Request timeout after 30000ms","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T02:40:07.570Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756175886411_2ybggbdqj","error":"Request timeout after 30000ms","stack":"Error: Request timeout after 30000ms\n    at ClientRequest.<anonymous> (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:371:42)\n    at ClientRequest.emit (node:events:507:28)\n    at TLSSocket.emitRequestTimeout (node:_http_client:863:9)\n    at Object.onceWrapper (node:events:621:28)\n    at TLSSocket.emit (node:events:519:35)\n    at Socket._onTimeout (node:net:604:8)\n    at listOnTimeout (node:internal/timers:608:17)\n    at process.processTimers (node:internal/timers:543:7)","layerTimings":{"router":57,"transformer":40,"protocol":21,"serverCompatibility":38},"errors":[{"layer":"pipeline","error":"Request timeout after 30000ms","timestamp":{}}]}}
{"timestamp":"2025-08-26T02:40:07.575Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756175886411_2ybggbdqj","error":"Request timeout after 30000ms"}}
{"timestamp":"2025-08-26T02:40:07.587Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Request timeout after 30000ms","stack":"Error: Pipeline request processing failed: Request timeout after 30000ms\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T02:40:07.595Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","error":"socket hang up","bodySize":703,"isLongTextRequest":false,"stack":"Error: socket hang up\n    at TLSSocket.socketCloseListener (node:_http_client:491:27)\n    at TLSSocket.emit (node:events:519:35)\n    at node:net:346:12\n    at TCP.done (node:_tls_wrap:649:7)"}}
{"timestamp":"2025-08-26T04:24:53.208Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T04:24:53.214Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T04:24:53.225Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T04:24:53.230Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T04:24:53.236Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T04:24:53.241Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T04:24:53.244Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T04:24:53.248Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T04:24:53.253Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T04:24:53.257Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-26T04:24:53.263Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:24:53.268Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:24:53.270Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:24:53.276Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T04:24:53.281Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T04:24:53.284Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:24:53.289Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:24:53.294Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T04:24:53.300Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T04:24:53.305Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T04:24:53.310Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:24:53.315Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:24:53.321Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T04:24:53.327Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":43,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T04:24:53.333Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T04:24:53.342Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T04:24:53.348Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":43,"uptime":0}}
{"timestamp":"2025-08-26T04:24:53.354Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json"}}
{"timestamp":"2025-08-26T04:24:53.361Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:24:53.368Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:11.101Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:11.106Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:11.111Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:11.116Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:11.121Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:11.124Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:11.130Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182311130_y0p7e5rpm","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:11.155Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:11.159Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182311130_y0p7e5rpm","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:11.165Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:11.170Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:11.175Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182311130_y0p7e5rpm","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:11.194Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182311130_y0p7e5rpm","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:11.210Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182311130_y0p7e5rpm","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:11.214Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182311130_y0p7e5rpm","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:25:11.226Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182311130_y0p7e5rpm","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:11.231Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182311130_y0p7e5rpm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:11.235Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182311130_y0p7e5rpm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:11.248Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182311130_y0p7e5rpm","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:11.253Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182311130_y0p7e5rpm","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:11.257Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182311130_y0p7e5rpm","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:11.269Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182311130_y0p7e5rpm","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:11.282Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182311130_y0p7e5rpm","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:11.286Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182311130_y0p7e5rpm","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:11.292Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182311130_y0p7e5rpm","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:11.296Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182311130_y0p7e5rpm","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:11.309Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182311130_y0p7e5rpm","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:11.313Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182311130_y0p7e5rpm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:11.318Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182311130_y0p7e5rpm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:11.335Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182311130_y0p7e5rpm","bodySize":25323,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:11.340Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25323,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:11.353Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25323,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:25:11.358Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25323,"expectedSize":25323}}
{"timestamp":"2025-08-26T04:25:11.363Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25323,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:11.376Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:11.383Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:11.388Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:11.393Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:11.398Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:11.401Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:11.406Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182311406_ipjmsvvey","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:11.470Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:11.475Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182311406_ipjmsvvey","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:11.480Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:11.486Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:11.492Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182311406_ipjmsvvey","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:11.520Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182311406_ipjmsvvey","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:11.539Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182311406_ipjmsvvey","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:11.544Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182311406_ipjmsvvey","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:25:11.567Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182311406_ipjmsvvey","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:11.572Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182311406_ipjmsvvey","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:11.577Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182311406_ipjmsvvey","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:11.601Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182311406_ipjmsvvey","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:11.607Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182311406_ipjmsvvey","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:11.613Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182311406_ipjmsvvey","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:11.638Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182311406_ipjmsvvey","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:11.664Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182311406_ipjmsvvey","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:11.670Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182311406_ipjmsvvey","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:11.676Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182311406_ipjmsvvey","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:11.683Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182311406_ipjmsvvey","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:11.707Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182311406_ipjmsvvey","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:11.712Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182311406_ipjmsvvey","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:11.718Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182311406_ipjmsvvey","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:11.748Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182311406_ipjmsvvey","bodySize":123445,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:11.754Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123445,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:11.761Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123445,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:25:11.766Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123445,"expectedSize":123445}}
{"timestamp":"2025-08-26T04:25:11.772Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123445,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:11.779Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:11.785Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:11.790Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:11.796Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:13.309Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":496,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:13.354Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182311130_y0p7e5rpm","totalTime":2224,"layerTimings":{"router":51,"transformer":40,"protocol":29,"serverCompatibility":35,"server":2012,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T04:25:13.372Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182311130_y0p7e5rpm","executionId":"req_1756182311130_y0p7e5rpm","totalTime":2224,"success":true}}
{"timestamp":"2025-08-26T04:25:13.412Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:13.418Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:13.423Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:13.428Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:13.432Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:13.435Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:13.440Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182313440_a30xbk63q","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:13.451Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:13.456Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182313440_a30xbk63q","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:13.460Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:13.465Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:13.469Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182313440_a30xbk63q","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:13.488Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182313440_a30xbk63q","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:13.501Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182313440_a30xbk63q","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:13.506Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182313440_a30xbk63q","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:25:13.518Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182313440_a30xbk63q","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:13.523Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182313440_a30xbk63q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:13.527Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182313440_a30xbk63q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:13.539Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182313440_a30xbk63q","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:13.544Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182313440_a30xbk63q","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:13.549Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182313440_a30xbk63q","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:13.561Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182313440_a30xbk63q","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:13.572Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182313440_a30xbk63q","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:13.577Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182313440_a30xbk63q","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:13.582Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182313440_a30xbk63q","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:13.588Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182313440_a30xbk63q","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:13.602Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182313440_a30xbk63q","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:13.606Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182313440_a30xbk63q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:13.611Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182313440_a30xbk63q","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:13.627Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182313440_a30xbk63q","bodySize":19523,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:13.631Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19523,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:13.636Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19523,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:25:13.641Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19523,"expectedSize":19523}}
{"timestamp":"2025-08-26T04:25:13.646Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19523,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:13.651Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:13.656Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:14.924Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":489,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:14.975Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182313440_a30xbk63q","totalTime":1535,"layerTimings":{"router":36,"transformer":38,"protocol":29,"serverCompatibility":37,"server":1339,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T04:25:14.992Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182313440_a30xbk63q","executionId":"req_1756182313440_a30xbk63q","totalTime":1535,"success":true}}
{"timestamp":"2025-08-26T04:25:15.007Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:15.013Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:15.019Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:15.025Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:15.030Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:15.034Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:15.039Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182315039_eet4l58le","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:15.053Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:15.057Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182315039_eet4l58le","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:15.062Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:15.067Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:15.073Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182315039_eet4l58le","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:15.093Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182315039_eet4l58le","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:15.108Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182315039_eet4l58le","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:15.112Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182315039_eet4l58le","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:25:15.125Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182315039_eet4l58le","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:15.130Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182315039_eet4l58le","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:15.135Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182315039_eet4l58le","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:15.148Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182315039_eet4l58le","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:15.153Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182315039_eet4l58le","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:15.158Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182315039_eet4l58le","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:15.170Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182315039_eet4l58le","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:15.182Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182315039_eet4l58le","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:15.187Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182315039_eet4l58le","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:15.192Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182315039_eet4l58le","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:15.197Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182315039_eet4l58le","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:15.210Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182315039_eet4l58le","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:15.214Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182315039_eet4l58le","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:15.219Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182315039_eet4l58le","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:15.233Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182315039_eet4l58le","bodySize":19423,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:15.238Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19423,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:15.243Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19423,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:25:15.247Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19423,"expectedSize":19423}}
{"timestamp":"2025-08-26T04:25:15.252Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19423,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:15.256Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:15.261Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:15.986Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":652,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:16.043Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182311406_ipjmsvvey","totalTime":4637,"layerTimings":{"router":92,"transformer":64,"protocol":55,"serverCompatibility":63,"server":4294,"responseTransform":26},"transformationCount":4}}
{"timestamp":"2025-08-26T04:25:16.075Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182311406_ipjmsvvey","executionId":"req_1756182311406_ipjmsvvey","totalTime":4637,"success":true}}
{"timestamp":"2025-08-26T04:25:16.095Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:16.101Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:16.107Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:16.113Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:16.119Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:16.123Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:16.129Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182316129_x986peynj","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:16.196Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:16.202Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182316129_x986peynj","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:16.207Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:16.212Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:16.217Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182316129_x986peynj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:16.247Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182316129_x986peynj","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:16.268Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182316129_x986peynj","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:16.274Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182316129_x986peynj","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:25:16.296Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182316129_x986peynj","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:16.301Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182316129_x986peynj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:16.306Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182316129_x986peynj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:16.327Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182316129_x986peynj","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:16.331Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182316129_x986peynj","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:16.337Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182316129_x986peynj","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:16.357Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182316129_x986peynj","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:16.379Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182316129_x986peynj","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:16.385Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182316129_x986peynj","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:16.389Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182316129_x986peynj","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:16.395Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182316129_x986peynj","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:16.416Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182316129_x986peynj","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:16.421Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182316129_x986peynj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:16.426Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182316129_x986peynj","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:25:16.452Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182316129_x986peynj","bodySize":123445,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:16.458Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123445,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:16.463Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123445,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:25:16.468Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123445,"expectedSize":123445}}
{"timestamp":"2025-08-26T04:25:16.472Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123445,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:16.478Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":500,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:16.504Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182315039_eet4l58le","totalTime":1465,"layerTimings":{"router":41,"transformer":40,"protocol":30,"serverCompatibility":34,"server":1268,"responseTransform":13},"transformationCount":4}}
{"timestamp":"2025-08-26T04:25:16.517Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182315039_eet4l58le","executionId":"req_1756182315039_eet4l58le","totalTime":1465,"success":true}}
{"timestamp":"2025-08-26T04:25:16.525Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:16.529Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:16.537Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:25:16.542Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:16.547Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:25:16.552Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:25:16.557Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:25:16.560Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:25:16.565Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182316565_tlwphl5av","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:25:16.578Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:16.583Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182316565_tlwphl5av","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:25:16.588Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:25:16.592Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:25:16.597Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182316565_tlwphl5av","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:25:16.616Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182316565_tlwphl5av","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:25:16.632Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182316565_tlwphl5av","hasOutput":true}}
{"timestamp":"2025-08-26T04:25:16.637Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182316565_tlwphl5av","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:25:16.649Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182316565_tlwphl5av","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:16.655Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182316565_tlwphl5av","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:16.659Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182316565_tlwphl5av","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:16.672Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182316565_tlwphl5av","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:16.677Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182316565_tlwphl5av","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:25:16.682Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182316565_tlwphl5av","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:25:16.694Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182316565_tlwphl5av","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:25:16.706Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182316565_tlwphl5av","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:25:16.711Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182316565_tlwphl5av","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:25:16.716Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182316565_tlwphl5av","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:25:16.721Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182316565_tlwphl5av","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:25:16.734Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182316565_tlwphl5av","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:25:16.738Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182316565_tlwphl5av","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:16.743Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182316565_tlwphl5av","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:25:16.758Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182316565_tlwphl5av","bodySize":24955,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:16.763Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":24955,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:16.767Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":24955,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:25:16.772Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":24955,"expectedSize":24955}}
{"timestamp":"2025-08-26T04:25:16.777Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":24955,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:16.782Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:25:16.787Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:25:17.092Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:17.109Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756182316129_x986peynj","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"40ca5110-cdf9-4f26-b9b2-52ae32a65b92\"}}"}}
{"timestamp":"2025-08-26T04:25:17.119Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756182316129_x986peynj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.127Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":0,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.134Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756182316129_x986peynj","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T04:25:17.139Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756182316129_x986peynj","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:25:17.145Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T04:25:17.159Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182316129_x986peynj","bodySize":123445,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:17.166Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123445,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:17.172Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123445,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:25:17.179Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123445,"expectedSize":123445}}
{"timestamp":"2025-08-26T04:25:17.185Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123445,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:17.303Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:17.311Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756182316129_x986peynj","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"2cc3586e-90c6-4725-b5e0-74969c745592\"}}"}}
{"timestamp":"2025-08-26T04:25:17.317Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.323Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":1,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.329Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756182316129_x986peynj","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T04:25:17.335Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756182316129_x986peynj","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:25:17.341Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T04:25:17.352Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182316129_x986peynj","bodySize":123445,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:17.358Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123445,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:17.364Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123445,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:25:17.370Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123445,"expectedSize":123445}}
{"timestamp":"2025-08-26T04:25:17.375Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123445,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:17.507Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:17.517Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756182316129_x986peynj","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"82ce0072-3e81-4ef5-b4e5-36706a886aae\"}}"}}
{"timestamp":"2025-08-26T04:25:17.525Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"shuaihong-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.531Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.537Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756182316129_x986peynj","recoverability":"recoverable","matchedRule":"rate-limiting","confidence":0.5}}
{"timestamp":"2025-08-26T04:25:17.543Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756182316129_x986peynj","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:25:17.548Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"modelscope-zhipuai-glm-4.5-key0"}}
{"timestamp":"2025-08-26T04:25:17.560Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756182316129_x986peynj","bodySize":123445,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:25:17.565Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123445,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:25:17.571Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123445,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:25:17.576Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123445,"expectedSize":123445}}
{"timestamp":"2025-08-26T04:25:17.580Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123445,"timeout":600000}}
{"timestamp":"2025-08-26T04:25:17.704Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":429,"responseSize":100,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:17.714Z","level":"WARN","message":"Rate limit detected, throwing for retry","data":{"requestId":"req_1756182316129_x986peynj","status":429,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions","responsePreview":"{\"errors\":{\"message\":\"Request limit exceeded.\",\"request_id\":\"a52dc62d-d1c0-4d82-bb89-75016fe32e5f\"}}"}}
{"timestamp":"2025-08-26T04:25:17.722Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756182316129_x986peynj","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.730Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":199,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T04:25:17.737Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756182316129_x986peynj","success":false,"recoveryAction":"failed","recoveryTime":199}}
{"timestamp":"2025-08-26T04:25:17.744Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":421,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T04:25:17.750Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756182316129_x986peynj","success":false,"recoveryAction":"failed","recoveryTime":421}}
{"timestamp":"2025-08-26T04:25:17.756Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756182316129_x986peynj","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":629,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"rate-limiting","statusCodes":[429],"messageKeywords":"[REDACTED]","recoverability":"recoverable","priority":2,"description":"流控限制 - 可切换到其他流水线"},"confidence":0.5,"reason":"流控限制 - 可切换到其他流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T04:25:17.762Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756182316129_x986peynj","success":false,"recoveryAction":"failed","recoveryTime":629}}
{"timestamp":"2025-08-26T04:25:17.767Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756182316129_x986peynj","failedPipeline":"modelscope-zhipuai-glm-4.5-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:25:17.771Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756182316129_x986peynj","pipelineId":"modelscope-zhipuai-glm-4.5-key0","originalError":"Rate limit exceeded: 429","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:25:17.779Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756182316129_x986peynj","error":"Rate limit exceeded: 429","stack":"Error: Rate limit exceeded: 429\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:52:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:340:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":95,"transformer":66,"protocol":46,"serverCompatibility":53},"errors":[{"layer":"pipeline","error":"Rate limit exceeded: 429","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:25:17.784Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756182316129_x986peynj","error":"Rate limit exceeded: 429"}}
{"timestamp":"2025-08-26T04:25:17.812Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: Rate limit exceeded: 429","stack":"Error: Pipeline request processing failed: Rate limit exceeded: 429\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:25:18.070Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":497,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:25:18.102Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182316565_tlwphl5av","totalTime":1537,"layerTimings":{"router":38,"transformer":40,"protocol":30,"serverCompatibility":36,"server":1339,"responseTransform":15},"transformationCount":4}}
{"timestamp":"2025-08-26T04:25:18.118Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182316565_tlwphl5av","executionId":"req_1756182316565_tlwphl5av","totalTime":1537,"success":true}}
{"timestamp":"2025-08-26T04:27:48.792Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T04:27:48.796Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T04:27:48.799Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T04:27:48.802Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T04:27:48.804Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T04:27:48.808Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:27:48.811Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:27:48.814Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:27:48.817Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:27:48.820Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T04:27:48.823Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:27:48.826Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:27:49.829Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T04:28:06.331Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T04:28:06.338Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T04:28:06.350Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T04:28:06.355Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T04:28:06.361Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T04:28:06.366Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T04:28:06.369Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T04:28:06.374Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T04:28:06.380Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T04:28:06.385Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-26T04:28:06.391Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:28:06.396Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:28:06.400Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:28:06.406Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T04:28:06.411Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T04:28:06.413Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:28:06.419Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:28:06.424Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T04:28:06.430Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T04:28:06.435Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T04:28:06.440Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:28:06.446Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:28:06.451Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T04:28:06.456Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":43,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T04:28:06.461Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T04:28:06.470Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T04:28:06.475Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":43,"uptime":0}}
{"timestamp":"2025-08-26T04:28:06.480Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json"}}
{"timestamp":"2025-08-26T04:28:06.487Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:28:06.492Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:28:31.371Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages","hasBody":true}}
{"timestamp":"2025-08-26T04:28:31.379Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:28:31.385Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:28:31.392Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:28:31.398Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:28:31.401Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:28:31.408Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182511407_czrzaxvna","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:28:31.434Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:28:31.440Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182511407_czrzaxvna","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:28:31.446Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:28:31.452Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:28:31.458Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:28:31.464Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182511407_czrzaxvna","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:28:31.486Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182511407_czrzaxvna","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:28:31.497Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182511407_czrzaxvna","hasOutput":true}}
{"timestamp":"2025-08-26T04:28:31.502Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182511407_czrzaxvna","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:28:31.515Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182511407_czrzaxvna","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:28:31.521Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182511407_czrzaxvna","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:28:31.526Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182511407_czrzaxvna","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:28:31.539Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182511407_czrzaxvna","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:28:31.544Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182511407_czrzaxvna","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:28:31.549Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182511407_czrzaxvna","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:28:31.560Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182511407_czrzaxvna","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:28:31.574Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182511407_czrzaxvna","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:28:31.578Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182511407_czrzaxvna","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:28:31.585Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182511407_czrzaxvna","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:28:31.590Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182511407_czrzaxvna","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:28:31.602Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182511407_czrzaxvna","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:28:31.608Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182511407_czrzaxvna","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:28:31.613Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182511407_czrzaxvna","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:28:31.628Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":166,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:28:31.641Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:28:31.646Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:28:33.431Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":695,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:28:33.472Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182511407_czrzaxvna","totalTime":2064,"layerTimings":{"router":65,"transformer":37,"protocol":28,"serverCompatibility":37,"server":1835,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T04:28:33.484Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182511407_czrzaxvna","executionId":"req_1756182511407_czrzaxvna","totalTime":2064,"success":true}}
{"timestamp":"2025-08-26T04:28:59.951Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages","hasBody":true}}
{"timestamp":"2025-08-26T04:28:59.958Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:28:59.964Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:28:59.970Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:28:59.976Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:28:59.980Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:28:59.986Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182539986_8qtnhrkl3","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:29:00.000Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:29:00.006Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182539986_8qtnhrkl3","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:29:00.013Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:29:00.019Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:29:00.025Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:29:00.032Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182539986_8qtnhrkl3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:29:00.056Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182539986_8qtnhrkl3","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:29:00.068Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182539986_8qtnhrkl3","hasOutput":true}}
{"timestamp":"2025-08-26T04:29:00.074Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182539986_8qtnhrkl3","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:29:00.088Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182539986_8qtnhrkl3","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:29:00.094Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182539986_8qtnhrkl3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:00.099Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182539986_8qtnhrkl3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:00.113Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182539986_8qtnhrkl3","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:29:00.119Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182539986_8qtnhrkl3","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:29:00.124Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182539986_8qtnhrkl3","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:29:00.136Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182539986_8qtnhrkl3","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:29:00.149Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182539986_8qtnhrkl3","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:29:00.154Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182539986_8qtnhrkl3","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:29:00.159Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182539986_8qtnhrkl3","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:29:00.165Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182539986_8qtnhrkl3","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:29:00.178Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182539986_8qtnhrkl3","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:29:00.183Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182539986_8qtnhrkl3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:00.188Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182539986_8qtnhrkl3","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:00.203Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":166,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:29:00.210Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:29:00.215Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:29:02.319Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":674,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:29:02.368Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182539986_8qtnhrkl3","totalTime":2381,"layerTimings":{"router":57,"transformer":40,"protocol":31,"serverCompatibility":37,"server":2153,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T04:29:02.380Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182539986_8qtnhrkl3","executionId":"req_1756182539986_8qtnhrkl3","totalTime":2381,"success":true}}
{"timestamp":"2025-08-26T04:29:37.257Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages","hasBody":true}}
{"timestamp":"2025-08-26T04:29:37.264Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:29:37.271Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:29:37.277Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:29:37.283Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:29:37.287Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:29:37.293Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756182577293_y10j1jzcv","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:29:37.307Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:29:37.312Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756182577293_y10j1jzcv","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:29:37.318Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:29:37.323Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:29:37.329Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:29:37.334Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756182577293_y10j1jzcv","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:29:37.355Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756182577293_y10j1jzcv","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:29:37.367Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756182577293_y10j1jzcv","hasOutput":true}}
{"timestamp":"2025-08-26T04:29:37.373Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756182577293_y10j1jzcv","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:29:37.385Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182577293_y10j1jzcv","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:29:37.390Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182577293_y10j1jzcv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:37.396Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756182577293_y10j1jzcv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:37.409Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756182577293_y10j1jzcv","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:29:37.415Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756182577293_y10j1jzcv","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:29:37.420Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756182577293_y10j1jzcv","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:29:37.432Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756182577293_y10j1jzcv","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:29:37.445Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756182577293_y10j1jzcv","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:29:37.450Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756182577293_y10j1jzcv","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:29:37.456Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756182577293_y10j1jzcv","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:29:37.462Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756182577293_y10j1jzcv","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:29:37.474Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756182577293_y10j1jzcv","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:29:37.478Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756182577293_y10j1jzcv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:37.483Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756182577293_y10j1jzcv","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:29:37.497Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":166,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:29:37.503Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:29:37.508Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:29:39.395Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":687,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:29:39.440Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756182577293_y10j1jzcv","totalTime":2147,"layerTimings":{"router":48,"transformer":38,"protocol":31,"serverCompatibility":36,"server":1933,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T04:29:39.454Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756182577293_y10j1jzcv","executionId":"req_1756182577293_y10j1jzcv","totalTime":2147,"success":true}}
{"timestamp":"2025-08-26T04:30:44.215Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T04:30:44.219Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T04:30:44.222Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T04:30:44.225Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T04:30:44.228Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T04:30:44.232Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:30:44.235Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:30:44.237Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:30:44.240Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:30:44.243Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T04:30:44.246Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:30:44.249Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:30:45.252Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T04:43:26.625Z","level":"INFO","message":"启用文件日志记录","data":{"port":5510,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T04:43:26.632Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T04:43:26.644Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T04:43:26.649Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T04:43:26.655Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T04:43:26.660Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T04:43:26.662Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T04:43:26.667Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T04:43:26.673Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T04:43:26.678Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T04:43:26.684Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:26.690Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:26.693Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:26.698Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5510,"modulesInitialized":true}}
{"timestamp":"2025-08-26T04:43:26.704Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T04:43:26.707Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:43:26.713Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:43:26.719Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T04:43:26.727Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T04:43:26.733Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T04:43:26.740Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:43:26.745Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:43:26.752Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5510,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T04:43:26.757Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":50,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T04:43:26.763Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5510,"totalPipelines":26}}
{"timestamp":"2025-08-26T04:43:26.773Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"uptime":0}}
{"timestamp":"2025-08-26T04:43:26.780Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5510,"initializationTime":50,"uptime":0}}
{"timestamp":"2025-08-26T04:43:26.786Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5510,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T04:43:26.793Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:26.799Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:36.047Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:43:36.054Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:36.059Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:36.065Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:36.071Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:36.075Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:36.081Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183416081_dz3b87z6d","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:43:36.109Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:36.115Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183416081_dz3b87z6d","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:43:36.121Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:43:36.127Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:43:36.133Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:43:36.139Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183416081_dz3b87z6d","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:43:36.160Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183416081_dz3b87z6d","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:43:36.175Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183416081_dz3b87z6d","hasOutput":true}}
{"timestamp":"2025-08-26T04:43:36.180Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183416081_dz3b87z6d","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:43:36.193Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183416081_dz3b87z6d","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:36.199Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183416081_dz3b87z6d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.204Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183416081_dz3b87z6d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.217Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183416081_dz3b87z6d","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:36.222Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183416081_dz3b87z6d","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:43:36.227Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183416081_dz3b87z6d","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:43:36.240Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183416081_dz3b87z6d","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:43:36.252Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183416081_dz3b87z6d","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:43:36.257Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183416081_dz3b87z6d","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:36.263Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183416081_dz3b87z6d","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:43:36.269Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183416081_dz3b87z6d","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:43:36.283Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183416081_dz3b87z6d","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:36.288Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183416081_dz3b87z6d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.293Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183416081_dz3b87z6d","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.309Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":1399,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:43:36.325Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:43:36.330Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:36.335Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:36.340Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:36.345Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:36.348Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:36.353Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183416353_cg5mgpab0","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:43:36.366Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:36.371Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183416353_cg5mgpab0","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:43:36.375Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:43:36.380Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:43:36.385Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":1,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":2,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",2]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:43:36.389Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183416353_cg5mgpab0","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:43:36.408Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183416353_cg5mgpab0","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:43:36.420Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183416353_cg5mgpab0","hasOutput":true}}
{"timestamp":"2025-08-26T04:43:36.425Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183416353_cg5mgpab0","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:43:36.437Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183416353_cg5mgpab0","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:36.441Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183416353_cg5mgpab0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.446Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183416353_cg5mgpab0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.458Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183416353_cg5mgpab0","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:43:36.463Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183416353_cg5mgpab0","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:43:36.469Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183416353_cg5mgpab0","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:43:36.473Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183416353_cg5mgpab0","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:43:36.485Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183416353_cg5mgpab0","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:43:36.497Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183416353_cg5mgpab0","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:43:36.502Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183416353_cg5mgpab0","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:36.507Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183416353_cg5mgpab0","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:43:36.513Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183416353_cg5mgpab0","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:43:36.524Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183416353_cg5mgpab0","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:36.529Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183416353_cg5mgpab0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.534Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183416353_cg5mgpab0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:36.548Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":2563,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:43:36.555Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:36.560Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:36.565Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:36.570Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:36.710Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:36.720Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183416353_cg5mgpab0","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"0510e952-e125-9530-9160-57a6e35e09b0\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.725Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183416353_cg5mgpab0","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.731Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.736Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183416353_cg5mgpab0","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:36.742Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183416353_cg5mgpab0","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:43:36.752Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:36.762Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":2563,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:43:36.850Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:36.858Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183416353_cg5mgpab0","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"4fbda0b0-468e-916e-b8bc-70bdc06cbafe\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.863Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.868Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:36.873Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183416353_cg5mgpab0","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:36.879Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183416353_cg5mgpab0","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:43:36.885Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:36.895Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":2563,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:43:36.999Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:37.008Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183416353_cg5mgpab0","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"957a3b1c-d245-93d6-906a-3a650fc924f8\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.015Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.021Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.026Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183416353_cg5mgpab0","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:37.031Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183416353_cg5mgpab0","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:43:37.036Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:37.043Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":2563,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:43:37.135Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:37.144Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183416353_cg5mgpab0","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"f2fad185-95d5-911b-a0af-4db17ccf722b\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.149Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183416353_cg5mgpab0","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.154Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":133,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:37.160Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183416353_cg5mgpab0","success":false,"recoveryAction":"failed","recoveryTime":133}}
{"timestamp":"2025-08-26T04:43:37.165Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":297,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:37.170Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183416353_cg5mgpab0","success":false,"recoveryAction":"failed","recoveryTime":297}}
{"timestamp":"2025-08-26T04:43:37.175Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":444,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:37.179Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183416353_cg5mgpab0","success":false,"recoveryAction":"failed","recoveryTime":444}}
{"timestamp":"2025-08-26T04:43:37.184Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183416353_cg5mgpab0","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:43:37.188Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183416353_cg5mgpab0","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:43:37.198Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183416353_cg5mgpab0","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":43,"transformer":36,"protocol":35,"serverCompatibility":35},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:43:37.203Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183416353_cg5mgpab0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:37.215Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:43:37.606Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":506,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:37.639Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183416081_dz3b87z6d","totalTime":1558,"layerTimings":{"router":65,"transformer":40,"protocol":31,"serverCompatibility":38,"server":1325,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T04:43:37.651Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183416081_dz3b87z6d","executionId":"req_1756183416081_dz3b87z6d","totalTime":1558,"success":true}}
{"timestamp":"2025-08-26T04:43:38.480Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:43:38.486Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:38.491Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:38.497Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:38.502Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:38.506Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:38.512Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183418512_mlz9k5llz","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:43:38.526Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:38.531Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183418512_mlz9k5llz","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:43:38.536Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:43:38.541Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:43:38.546Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":2,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":3,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",3]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:43:38.552Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183418512_mlz9k5llz","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:43:38.571Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183418512_mlz9k5llz","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:43:38.584Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183418512_mlz9k5llz","hasOutput":true}}
{"timestamp":"2025-08-26T04:43:38.588Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183418512_mlz9k5llz","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:43:38.600Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183418512_mlz9k5llz","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:38.605Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183418512_mlz9k5llz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:38.610Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183418512_mlz9k5llz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:38.623Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183418512_mlz9k5llz","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:38.628Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183418512_mlz9k5llz","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:43:38.632Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183418512_mlz9k5llz","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:43:38.645Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183418512_mlz9k5llz","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:43:38.656Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183418512_mlz9k5llz","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:43:38.661Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183418512_mlz9k5llz","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:38.667Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183418512_mlz9k5llz","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:43:38.673Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183418512_mlz9k5llz","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:43:38.685Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183418512_mlz9k5llz","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:38.689Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183418512_mlz9k5llz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:38.694Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183418512_mlz9k5llz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:43:38.709Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":789,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:43:38.721Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:43:38.727Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:38.732Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:38.737Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:38.741Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:38.745Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:38.750Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183418750_3bg0kjfjm","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:43:38.841Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:38.846Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183418750_3bg0kjfjm","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T04:43:38.851Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:43:38.855Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:43:38.861Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":3,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":4,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",4]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:43:38.866Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183418750_3bg0kjfjm","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:43:38.894Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183418750_3bg0kjfjm","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:43:38.914Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183418750_3bg0kjfjm","hasOutput":true}}
{"timestamp":"2025-08-26T04:43:38.919Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183418750_3bg0kjfjm","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:43:38.940Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183418750_3bg0kjfjm","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:38.945Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183418750_3bg0kjfjm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:38.951Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183418750_3bg0kjfjm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:38.973Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183418750_3bg0kjfjm","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:38.979Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183418750_3bg0kjfjm","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:43:38.984Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183418750_3bg0kjfjm","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:43:39.006Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183418750_3bg0kjfjm","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:43:39.029Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183418750_3bg0kjfjm","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:43:39.034Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183418750_3bg0kjfjm","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:39.040Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183418750_3bg0kjfjm","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:43:39.046Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183418750_3bg0kjfjm","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:43:39.069Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183418750_3bg0kjfjm","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:39.076Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183418750_3bg0kjfjm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:39.081Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183418750_3bg0kjfjm","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:39.114Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183418750_3bg0kjfjm","bodySize":120510,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:39.121Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":120510,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:43:39.126Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":120510,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:43:39.132Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":120510,"expectedSize":120510}}
{"timestamp":"2025-08-26T04:43:39.137Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":120510,"timeout":600000}}
{"timestamp":"2025-08-26T04:43:39.144Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:39.149Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:39.155Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:39.161Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:41.717Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":389,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:43:41.761Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183418512_mlz9k5llz","totalTime":3249,"layerTimings":{"router":46,"transformer":36,"protocol":29,"serverCompatibility":36,"server":3043,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T04:43:41.774Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183418512_mlz9k5llz","executionId":"req_1756183418512_mlz9k5llz","totalTime":3249,"success":true}}
{"timestamp":"2025-08-26T04:43:46.841Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":1316,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:43:46.899Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183418750_3bg0kjfjm","totalTime":8149,"layerTimings":{"router":123,"transformer":62,"protocol":51,"serverCompatibility":57,"server":7786,"responseTransform":26},"transformationCount":4}}
{"timestamp":"2025-08-26T04:43:46.932Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183418750_3bg0kjfjm","executionId":"req_1756183418750_3bg0kjfjm","totalTime":8149,"success":true}}
{"timestamp":"2025-08-26T04:43:46.949Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:43:46.955Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:46.961Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:43:46.966Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:43:46.972Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:43:46.975Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5510,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:43:46.981Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183426981_vdtu49bvx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:43:47.072Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","priority":2,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:47.077Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183426981_vdtu49bvx","inputModel":"claude-sonnet-4-20250514","mappedModel":"webSearch"}}
{"timestamp":"2025-08-26T04:43:47.081Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"webSearch","routeEntry":"shuaihong,glm-4.5;qwen,qwen3-coder-plus;modelscope,ZhipuAI/GLM-4.5","allRoutes":["shuaihong,glm-4.5","qwen,qwen3-coder-plus","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:43:47.086Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"webSearch","generatedPipelines":["shuaihong-glm-4.5-key0","qwen-qwen3-coder-plus-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:43:47.091Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":4,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":5,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",5]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:43:47.096Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183426981_vdtu49bvx","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:43:47.124Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183426981_vdtu49bvx","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:43:47.144Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183426981_vdtu49bvx","hasOutput":true}}
{"timestamp":"2025-08-26T04:43:47.149Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183426981_vdtu49bvx","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:43:47.170Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183426981_vdtu49bvx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:47.176Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183426981_vdtu49bvx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:47.182Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183426981_vdtu49bvx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:47.203Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183426981_vdtu49bvx","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:43:47.208Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183426981_vdtu49bvx","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:43:47.213Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183426981_vdtu49bvx","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:43:47.218Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183426981_vdtu49bvx","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"webSearch","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:43:47.238Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183426981_vdtu49bvx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:43:47.259Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183426981_vdtu49bvx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:43:47.264Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183426981_vdtu49bvx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:43:47.270Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183426981_vdtu49bvx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:43:47.276Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183426981_vdtu49bvx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:43:47.299Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183426981_vdtu49bvx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:43:47.305Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183426981_vdtu49bvx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:47.310Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183426981_vdtu49bvx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:43:47.338Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183426981_vdtu49bvx","bodySize":120511,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:47.344Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":120511,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:43:47.350Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":120511,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:43:47.355Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":120511,"expectedSize":120511}}
{"timestamp":"2025-08-26T04:43:47.360Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":120511,"timeout":600000}}
{"timestamp":"2025-08-26T04:43:47.365Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:43:47.370Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:43:47.615Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:43:47.632Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183426981_vdtu49bvx","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"a2e4eaef-da3d-9412-9ad5-df71826cee40\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:47.641Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183426981_vdtu49bvx","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:47.649Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:47.655Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183426981_vdtu49bvx","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:47.661Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183426981_vdtu49bvx","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:43:47.667Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:47.681Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183426981_vdtu49bvx","bodySize":120511,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:47.688Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":120511,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:43:47.693Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":120511,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:43:47.699Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":120511,"expectedSize":120511}}
{"timestamp":"2025-08-26T04:43:47.704Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":120511,"timeout":600000}}
{"timestamp":"2025-08-26T04:43:47.709Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://portal.qwen.ai/v1/chat/***","error":"socket hang up","bodySize":120511,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketOnEnd (node:_http_client:542:25)\n    at TLSSocket.emit (node:events:519:35)\n    at endReadableNT (node:internal/streams/readable:1701:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)"}}
{"timestamp":"2025-08-26T04:43:47.714Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"socket hang up"}}
{"timestamp":"2025-08-26T04:43:47.718Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"socket hang up"}}
{"timestamp":"2025-08-26T04:43:47.723Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183426981_vdtu49bvx","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:47.728Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183426981_vdtu49bvx","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:43:47.733Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:47.745Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183426981_vdtu49bvx","bodySize":120511,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:47.750Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":120511,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:43:47.755Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":120511,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:43:47.760Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":120511,"expectedSize":120511}}
{"timestamp":"2025-08-26T04:43:47.766Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":120511,"timeout":600000}}
{"timestamp":"2025-08-26T04:43:48.056Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:43:48.070Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183426981_vdtu49bvx","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"e9b8d738-8473-9d14-9ba9-86518d1f4807\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.080Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.088Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.096Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183426981_vdtu49bvx","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:43:48.103Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183426981_vdtu49bvx","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:43:48.109Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:43:48.124Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183426981_vdtu49bvx","bodySize":120511,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:43:48.130Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":120511,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:43:48.135Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":120511,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:43:48.140Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":120511,"expectedSize":120511}}
{"timestamp":"2025-08-26T04:43:48.146Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":120511,"timeout":600000}}
{"timestamp":"2025-08-26T04:43:48.281Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:43:48.296Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183426981_vdtu49bvx","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"4de18108-45a4-9957-89da-92838c32e168\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.307Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183426981_vdtu49bvx","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.317Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":229,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:48.324Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183426981_vdtu49bvx","success":false,"recoveryAction":"failed","recoveryTime":229}}
{"timestamp":"2025-08-26T04:43:48.331Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":613,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:48.337Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183426981_vdtu49bvx","success":false,"recoveryAction":"failed","recoveryTime":613}}
{"timestamp":"2025-08-26T04:43:48.343Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":694,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:43:48.349Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183426981_vdtu49bvx","success":false,"recoveryAction":"failed","recoveryTime":694}}
{"timestamp":"2025-08-26T04:43:48.354Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183426981_vdtu49bvx","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:43:48.359Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183426981_vdtu49bvx","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:43:48.367Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183426981_vdtu49bvx","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":122,"transformer":63,"protocol":51,"serverCompatibility":56},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:43:48.373Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183426981_vdtu49bvx","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:43:48.403Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:44:24.069Z","level":"INFO","message":"Received SIGINT, exiting gracefully"}
{"timestamp":"2025-08-26T04:44:24.075Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T04:44:24.079Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T04:44:24.083Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T04:44:24.087Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T04:44:24.092Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:44:24.096Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:44:24.099Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:44:24.102Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:44:24.106Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T04:44:24.109Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:44:24.113Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:44:25.117Z","level":"INFO","message":"优雅关闭完成"}
