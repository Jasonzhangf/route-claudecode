{"timestamp":"2025-08-26T04:24:08.017Z","level":"INFO","message":"启用文件日志记录","data":{"port":5506,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T04:24:08.023Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T04:24:08.035Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T04:24:08.041Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T04:24:08.046Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T04:24:08.051Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T04:24:08.053Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T04:24:08.059Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T04:24:08.064Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T04:24:08.068Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":false}}
{"timestamp":"2025-08-26T04:24:08.074Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:24:08.079Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:24:08.081Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:24:08.086Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5506,"modulesInitialized":true}}
{"timestamp":"2025-08-26T04:24:08.091Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T04:24:08.093Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:24:08.098Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:24:08.102Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T04:24:08.108Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T04:24:08.112Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T04:24:08.117Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:24:08.122Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:24:08.127Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5506,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T04:24:08.131Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":38,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T04:24:08.136Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5506,"totalPipelines":26}}
{"timestamp":"2025-08-26T04:24:08.144Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5506,"uptime":0}}
{"timestamp":"2025-08-26T04:24:08.149Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5506,"initializationTime":38,"uptime":0}}
{"timestamp":"2025-08-26T04:24:08.154Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5506,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json"}}
{"timestamp":"2025-08-26T04:24:08.160Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:24:08.164Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:24:43.121Z","level":"INFO","message":"Received SIGTERM, exiting gracefully"}
{"timestamp":"2025-08-26T04:24:43.125Z","level":"INFO","message":"开始优雅关闭流程"}
{"timestamp":"2025-08-26T04:24:43.127Z","level":"INFO","message":"正在停止PipelineLifecycleManager..."}
{"timestamp":"2025-08-26T04:24:43.130Z","level":"INFO","message":"停止Pipeline系统"}
{"timestamp":"2025-08-26T04:24:43.133Z","level":"INFO","message":"停止Pipeline服务器"}
{"timestamp":"2025-08-26T04:24:43.136Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:24:43.139Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:24:43.141Z","level":"INFO","message":"清理Pipeline服务器资源"}
{"timestamp":"2025-08-26T04:24:43.144Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:24:43.147Z","level":"INFO","message":"兼容性管理器清理完成"}
{"timestamp":"2025-08-26T04:24:43.150Z","level":"INFO","message":"Pipeline服务器资源清理完成"}
{"timestamp":"2025-08-26T04:24:43.152Z","level":"INFO","message":"Pipeline服务器已停止"}
{"timestamp":"2025-08-26T04:24:44.156Z","level":"INFO","message":"优雅关闭完成"}
{"timestamp":"2025-08-26T04:31:57.992Z","level":"INFO","message":"启用文件日志记录","data":{"port":5506,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T04:31:57.999Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T04:31:58.011Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T04:31:58.016Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T04:31:58.021Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T04:31:58.025Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T04:31:58.027Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T04:31:58.032Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T04:31:58.036Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T04:31:58.040Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T04:31:58.046Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:31:58.050Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:31:58.052Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:31:58.057Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5506,"modulesInitialized":true}}
{"timestamp":"2025-08-26T04:31:58.062Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T04:31:58.064Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:31:58.070Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:31:58.075Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T04:31:58.080Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T04:31:58.085Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T04:31:58.090Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:31:58.095Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:31:58.101Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5506,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T04:31:58.106Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":42,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T04:31:58.111Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5506,"totalPipelines":26}}
{"timestamp":"2025-08-26T04:31:58.119Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5506,"uptime":0}}
{"timestamp":"2025-08-26T04:31:58.124Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5506,"initializationTime":42,"uptime":0}}
{"timestamp":"2025-08-26T04:31:58.129Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5506,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T04:31:58.135Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:31:58.140Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:07.843Z","level":"INFO","message":"启用文件日志记录","data":{"port":5506,"debugLogsPath":"./test-debug-logs"}}
{"timestamp":"2025-08-26T04:37:07.849Z","level":"INFO","message":"🔧 Loading configuration with direct reading (no conversions)","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json"}}
{"timestamp":"2025-08-26T04:37:07.862Z","level":"INFO","message":"🔍 Detected complex routing format, expanding providers","data":{"hasComplexRouting":true,"hasSecurity":true,"routerCategories":12,"securityCategories":6}}
{"timestamp":"2025-08-26T04:37:07.868Z","level":"INFO","message":"🔧 Expanding multi-provider routing configuration","data":{"routerCategories":12,"securityCategories":6,"totalProviders":4}}
{"timestamp":"2025-08-26T04:37:07.874Z","level":"INFO","message":"✅ Provider routing expansion completed","data":{"primaryProviders":17,"securityProviders":9,"totalExpanded":26}}
{"timestamp":"2025-08-26T04:37:07.879Z","level":"INFO","message":"🔍 Validating expanded routing configuration"}
{"timestamp":"2025-08-26T04:37:07.882Z","level":"INFO","message":"✅ Routing validation completed","data":{"totalProviders":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"warnings":0}}
{"timestamp":"2025-08-26T04:37:07.888Z","level":"INFO","message":"✅ Complex routing expanded successfully","data":{"totalProviders":26,"primaryProviders":17,"securityProviders":9,"categories":{"default":{"primary":3,"security":1,"models":["qwen3-coder-plus","glm-4.5","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"longContext":{"primary":3,"security":2,"models":["gemini-2.5-pro","glm-4.5","qwen-long","qwen3-30b-a3b-instruct-2507-mlx"]},"imageProcessing":{"primary":2,"security":2,"models":["gemini-2.5-pro","gpt-4o","qwen3-coder-plus","glm-4.5v"]},"webSearch":{"primary":3,"security":1,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","seed-oss-36b-instruct"]},"reasoning":{"primary":3,"security":1,"models":["qwen3-coder-plus","gpt-5","ZhipuAI/GLM-4.5","qwen3-4b-thinking-2507-mlx"]},"coding":{"primary":3,"security":2,"models":["glm-4.5","qwen3-coder-plus","ZhipuAI/GLM-4.5","gemini-2.5-pro","nextcoder-32b-mlx"]}},"providers":{"qwen":{"categories":["default","longContext","webSearch","reasoning","coding","imageProcessing"],"models":["qwen3-coder-plus","qwen-long"],"isPrimary":true,"isSecurity":true},"shuaihong":{"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"models":["glm-4.5","gemini-2.5-pro","gpt-4o","gpt-5"],"isPrimary":true,"isSecurity":true},"modelscope":{"categories":["default","webSearch","reasoning","coding"],"models":["ZhipuAI/GLM-4.5"],"isPrimary":true,"isSecurity":false},"lmstudio":{"categories":["default","coding","longContext","imageProcessing","webSearch","reasoning"],"models":["seed-oss-36b-instruct","nextcoder-32b-mlx","qwen3-30b-a3b-instruct-2507-mlx","glm-4.5v","qwen3-4b-thinking-2507-mlx"],"isPrimary":false,"isSecurity":true}}}}
{"timestamp":"2025-08-26T04:37:07.894Z","level":"INFO","message":"✅ Configuration loaded successfully with direct reading","data":{"userProviders":4,"routerRules":12}}
{"timestamp":"2025-08-26T04:37:07.900Z","level":"INFO","message":"PipelineLifecycleManager初始化开始","data":{"userConfigPath":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","systemConfigPath":"/Users/fanzhang/.route-claudecode/config/system-config.json","hasProviders":true,"debugEnabled":true}}
{"timestamp":"2025-08-26T04:37:07.906Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:07.912Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:07.915Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:07.921Z","level":"INFO","message":"PipelineLifecycleManager初始化完成","data":{"totalProviders":4,"serverPort":5506,"modulesInitialized":true}}
{"timestamp":"2025-08-26T04:37:07.927Z","level":"INFO","message":"开始初始化Pipeline服务器"}
{"timestamp":"2025-08-26T04:37:07.930Z","level":"INFO","message":"开始初始化Pipeline服务器","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:37:07.937Z","level":"INFO","message":"生成新的流水线路由表","data":{"configName":"runtime-config","hasProviders":true}}
{"timestamp":"2025-08-26T04:37:07.942Z","level":"INFO","message":"使用展开后的路由配置生成流水线","data":{"primaryProviders":17,"securityProviders":9}}
{"timestamp":"2025-08-26T04:37:07.949Z","level":"INFO","message":"Runtime路由表生成完成","data":{"totalPipelines":26,"categoriesCount":6,"categories":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"hasExpandedRouting":true}}
{"timestamp":"2025-08-26T04:37:07.955Z","level":"INFO","message":"流水线路由表生成成功","data":{"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"]}}
{"timestamp":"2025-08-26T04:37:07.961Z","level":"INFO","message":"✅ Creating router from runtime routing table","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:37:07.968Z","level":"INFO","message":"PipelineRouter initialized","data":{"routeCount":6,"defaultRoute":"default"}}
{"timestamp":"2025-08-26T04:37:07.975Z","level":"INFO","message":"HTTP服务器实例创建成功","data":{"port":5506,"host":"0.0.0.0"}}
{"timestamp":"2025-08-26T04:37:07.981Z","level":"INFO","message":"Pipeline服务器初始化成功","data":{"initializationTime":51,"totalPipelines":26,"virtualModels":["default","longContext","imageProcessing","webSearch","reasoning","coding"],"routerInitialized":true,"serverCreated":true}}
{"timestamp":"2025-08-26T04:37:07.986Z","level":"INFO","message":"启动Pipeline服务器","data":{"port":5506,"totalPipelines":26}}
{"timestamp":"2025-08-26T04:37:07.995Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5506,"uptime":0}}
{"timestamp":"2025-08-26T04:37:08.000Z","level":"INFO","message":"Pipeline服务器启动成功","data":{"port":5506,"initializationTime":51,"uptime":0}}
{"timestamp":"2025-08-26T04:37:08.005Z","level":"INFO","message":"RCC Server started with pipeline system","data":{"port":5506,"host":"0.0.0.0","config":"/Users/fanzhang/.route-claudecode/config/multi-provider-hybrid-v4.json","debug":true}}
{"timestamp":"2025-08-26T04:37:08.011Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:08.016Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:32.595Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:32.600Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:32.605Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:32.610Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:32.615Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:32.618Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:32.624Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183052623_mbtfffxyo","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:32.647Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:32.652Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183052623_mbtfffxyo","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:32.658Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:32.662Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:32.667Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":0,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":1,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",1]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:32.672Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183052623_mbtfffxyo","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:32.693Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183052623_mbtfffxyo","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:32.707Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183052623_mbtfffxyo","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:32.711Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183052623_mbtfffxyo","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:32.724Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183052623_mbtfffxyo","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:32.729Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183052623_mbtfffxyo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:32.733Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183052623_mbtfffxyo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:32.745Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183052623_mbtfffxyo","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:32.750Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183052623_mbtfffxyo","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:32.754Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183052623_mbtfffxyo","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:37:32.766Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183052623_mbtfffxyo","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:32.778Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183052623_mbtfffxyo","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:32.783Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183052623_mbtfffxyo","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:32.789Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183052623_mbtfffxyo","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:32.794Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183052623_mbtfffxyo","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:32.808Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183052623_mbtfffxyo","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:32.813Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183052623_mbtfffxyo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:32.817Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183052623_mbtfffxyo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:32.834Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183052623_mbtfffxyo","bodySize":25323,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:32.840Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":25323,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:32.853Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25323,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:32.858Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25323,"expectedSize":25323}}
{"timestamp":"2025-08-26T04:37:32.863Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":25323,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:32.877Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:32.884Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:32.890Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:32.897Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:32.902Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:32.906Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:32.911Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183052911_8mdev915f","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:32.971Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:32.976Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183052911_8mdev915f","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:32.980Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:32.985Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:32.989Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":1,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":2,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",2]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:32.994Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183052911_8mdev915f","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:33.021Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183052911_8mdev915f","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:33.040Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183052911_8mdev915f","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:33.045Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183052911_8mdev915f","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:37:33.068Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183052911_8mdev915f","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:33.072Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183052911_8mdev915f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:33.077Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183052911_8mdev915f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:33.097Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183052911_8mdev915f","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:37:33.102Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183052911_8mdev915f","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:37:33.106Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183052911_8mdev915f","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:33.111Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183052911_8mdev915f","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:37:33.131Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183052911_8mdev915f","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:33.152Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183052911_8mdev915f","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:33.156Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183052911_8mdev915f","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:33.161Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183052911_8mdev915f","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:33.167Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183052911_8mdev915f","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:33.188Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183052911_8mdev915f","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:33.192Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183052911_8mdev915f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:33.197Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183052911_8mdev915f","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:33.224Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183052911_8mdev915f","bodySize":123492,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:33.230Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":123492,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:33.235Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123492,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:37:33.240Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123492,"expectedSize":123492}}
{"timestamp":"2025-08-26T04:37:33.245Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":123492,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:33.251Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:33.255Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:33.260Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:33.265Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:33.515Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:33.532Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183052911_8mdev915f","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"31630a83-80b1-9757-8fc0-ae5838e0c12c\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:33.539Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183052911_8mdev915f","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:33.546Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183052911_8mdev915f","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:33.552Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183052911_8mdev915f","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:33.558Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183052911_8mdev915f","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:37:33.564Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183052911_8mdev915f","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:33.577Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183052911_8mdev915f","bodySize":123492,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:33.583Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":123492,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:33.588Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123492,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:37:33.593Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123492,"expectedSize":123492}}
{"timestamp":"2025-08-26T04:37:33.598Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":123492,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:33.602Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://portal.qwen.ai/v1/chat/***","error":"socket hang up","bodySize":123492,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketOnEnd (node:_http_client:542:25)\n    at TLSSocket.emit (node:events:519:35)\n    at endReadableNT (node:internal/streams/readable:1701:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)"}}
{"timestamp":"2025-08-26T04:37:33.608Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183052911_8mdev915f","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"socket hang up"}}
{"timestamp":"2025-08-26T04:37:33.613Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183052911_8mdev915f","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"socket hang up"}}
{"timestamp":"2025-08-26T04:37:33.617Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183052911_8mdev915f","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:33.622Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183052911_8mdev915f","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:37:33.626Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183052911_8mdev915f","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:33.638Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183052911_8mdev915f","bodySize":123492,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:33.644Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":123492,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:33.648Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123492,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:37:33.653Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123492,"expectedSize":123492}}
{"timestamp":"2025-08-26T04:37:33.658Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":123492,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:33.904Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:33.921Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183052911_8mdev915f","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"b34adfeb-8355-9a86-868c-a48d5ca4bc0d\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:33.929Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183052911_8mdev915f","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:33.937Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183052911_8mdev915f","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:33.945Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183052911_8mdev915f","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:33.952Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183052911_8mdev915f","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:37:33.959Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183052911_8mdev915f","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:33.972Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183052911_8mdev915f","bodySize":123492,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:33.978Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":123492,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:33.983Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123492,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:37:33.989Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123492,"expectedSize":123492}}
{"timestamp":"2025-08-26T04:37:33.994Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":123492,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:33.999Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://portal.qwen.ai/v1/chat/***","error":"socket hang up","bodySize":123492,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketOnEnd (node:_http_client:542:25)\n    at TLSSocket.emit (node:events:519:35)\n    at endReadableNT (node:internal/streams/readable:1701:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)"}}
{"timestamp":"2025-08-26T04:37:34.005Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183052911_8mdev915f","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"socket hang up"}}
{"timestamp":"2025-08-26T04:37:34.010Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183052911_8mdev915f","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":73,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:34.015Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183052911_8mdev915f","success":false,"recoveryAction":"failed","recoveryTime":73}}
{"timestamp":"2025-08-26T04:37:34.020Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183052911_8mdev915f","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":407,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:34.025Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183052911_8mdev915f","success":false,"recoveryAction":"failed","recoveryTime":407}}
{"timestamp":"2025-08-26T04:37:34.030Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183052911_8mdev915f","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":484,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:34.035Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183052911_8mdev915f","success":false,"recoveryAction":"failed","recoveryTime":484}}
{"timestamp":"2025-08-26T04:37:34.040Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183052911_8mdev915f","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:37:34.045Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183052911_8mdev915f","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:37:34.052Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183052911_8mdev915f","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":89,"transformer":63,"protocol":50,"serverCompatibility":52},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:37:34.057Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183052911_8mdev915f","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:34.085Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:37:34.105Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:34.110Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:34.115Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:34.120Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:34.125Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:34.128Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:34.133Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183054133_25rk0bqei","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:34.189Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:34.193Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183054133_25rk0bqei","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:34.198Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:34.202Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:34.207Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":2,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":3,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",3]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:34.211Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183054133_25rk0bqei","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:34.238Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183054133_25rk0bqei","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:34.257Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183054133_25rk0bqei","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:34.261Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183054133_25rk0bqei","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:37:34.282Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183054133_25rk0bqei","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:34.287Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183054133_25rk0bqei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:34.291Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183054133_25rk0bqei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:34.311Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183054133_25rk0bqei","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:34.316Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183054133_25rk0bqei","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:34.320Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183054133_25rk0bqei","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:37:34.340Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183054133_25rk0bqei","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:34.361Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183054133_25rk0bqei","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:34.366Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183054133_25rk0bqei","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:34.371Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183054133_25rk0bqei","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:34.376Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183054133_25rk0bqei","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:34.397Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183054133_25rk0bqei","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:34.401Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183054133_25rk0bqei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:34.406Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183054133_25rk0bqei","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:34.433Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183054133_25rk0bqei","bodySize":123483,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:34.438Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":123483,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:34.443Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123483,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:37:34.448Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123483,"expectedSize":123483}}
{"timestamp":"2025-08-26T04:37:34.452Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":123483,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:34.457Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:34.462Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:34.573Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":495,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:34.619Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183052623_mbtfffxyo","totalTime":1995,"layerTimings":{"router":56,"transformer":40,"protocol":28,"serverCompatibility":38,"server":1777,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T04:37:34.635Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183052623_mbtfffxyo","executionId":"req_1756183052623_mbtfffxyo","totalTime":1995,"success":true}}
{"timestamp":"2025-08-26T04:37:34.669Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:34.675Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:34.680Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:34.684Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:34.689Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:34.693Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:34.697Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183054697_ytuvzdbn7","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:34.710Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:34.714Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183054697_ytuvzdbn7","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:34.719Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:34.724Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:34.728Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":3,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":4,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",4]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:34.733Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183054697_ytuvzdbn7","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:34.752Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183054697_ytuvzdbn7","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:34.767Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183054697_ytuvzdbn7","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:34.771Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183054697_ytuvzdbn7","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:34.782Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183054697_ytuvzdbn7","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:34.787Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183054697_ytuvzdbn7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:34.792Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183054697_ytuvzdbn7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:34.803Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183054697_ytuvzdbn7","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:34.808Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183054697_ytuvzdbn7","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:34.813Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183054697_ytuvzdbn7","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:37:34.825Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183054697_ytuvzdbn7","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:34.837Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183054697_ytuvzdbn7","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:34.842Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183054697_ytuvzdbn7","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:34.848Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183054697_ytuvzdbn7","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:34.853Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183054697_ytuvzdbn7","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:34.865Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183054697_ytuvzdbn7","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:34.870Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183054697_ytuvzdbn7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:34.875Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183054697_ytuvzdbn7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:34.889Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183054697_ytuvzdbn7","bodySize":19523,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:34.894Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19523,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:34.899Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19523,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:34.903Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19523,"expectedSize":19523}}
{"timestamp":"2025-08-26T04:37:34.908Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19523,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:34.913Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:34.917Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:35.865Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":491,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:35.910Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183054697_ytuvzdbn7","totalTime":1213,"layerTimings":{"router":43,"transformer":37,"protocol":29,"serverCompatibility":35,"server":1014,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T04:37:35.924Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183054697_ytuvzdbn7","executionId":"req_1756183054697_ytuvzdbn7","totalTime":1213,"success":true}}
{"timestamp":"2025-08-26T04:37:35.938Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:35.943Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:35.948Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:35.952Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:35.957Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:35.960Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:35.965Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183055965_ahnlhvf7s","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:35.976Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:35.981Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183055965_ahnlhvf7s","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:35.985Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:35.991Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:35.995Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":4,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":5,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",5]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:36.000Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183055965_ahnlhvf7s","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:36.018Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183055965_ahnlhvf7s","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:36.033Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183055965_ahnlhvf7s","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:36.037Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183055965_ahnlhvf7s","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:36.049Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183055965_ahnlhvf7s","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:36.053Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183055965_ahnlhvf7s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:36.058Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183055965_ahnlhvf7s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:36.070Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183055965_ahnlhvf7s","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:37:36.075Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183055965_ahnlhvf7s","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:37:36.080Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183055965_ahnlhvf7s","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:36.085Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183055965_ahnlhvf7s","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:37:36.097Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183055965_ahnlhvf7s","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:36.108Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183055965_ahnlhvf7s","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:36.113Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183055965_ahnlhvf7s","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:36.118Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183055965_ahnlhvf7s","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:36.123Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183055965_ahnlhvf7s","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:36.134Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183055965_ahnlhvf7s","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:36.139Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183055965_ahnlhvf7s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:36.143Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183055965_ahnlhvf7s","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:36.158Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183055965_ahnlhvf7s","bodySize":19424,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:36.163Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:36.168Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19424,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:36.173Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19424,"expectedSize":19424}}
{"timestamp":"2025-08-26T04:37:36.177Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":19424,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:36.182Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:36.187Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:36.381Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:36.397Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183055965_ahnlhvf7s","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"93959d32-a7c3-95c4-87ee-8375a6fa6bb3\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:36.405Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183055965_ahnlhvf7s","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:36.414Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183055965_ahnlhvf7s","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:36.422Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183055965_ahnlhvf7s","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:36.429Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183055965_ahnlhvf7s","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:37:36.435Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183055965_ahnlhvf7s","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:36.445Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183055965_ahnlhvf7s","bodySize":19424,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:36.450Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:36.455Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19424,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:36.460Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19424,"expectedSize":19424}}
{"timestamp":"2025-08-26T04:37:36.465Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":19424,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:36.574Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:36.587Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183055965_ahnlhvf7s","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"1e504392-a53f-961e-9221-83e963396f27\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:36.594Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183055965_ahnlhvf7s","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:36.602Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183055965_ahnlhvf7s","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:36.608Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183055965_ahnlhvf7s","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:36.615Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183055965_ahnlhvf7s","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:37:36.622Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183055965_ahnlhvf7s","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:36.631Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183055965_ahnlhvf7s","bodySize":19424,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:36.636Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:36.641Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19424,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:36.647Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19424,"expectedSize":19424}}
{"timestamp":"2025-08-26T04:37:36.652Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":19424,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:38.732Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":500,"responseSize":167,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:38.744Z","level":"ERROR","message":"Server error detected, throwing for retry","data":{"requestId":"req_1756183055965_ahnlhvf7s","status":500,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"internal_server_error\",\"message\":\"call qwen chat auth error\",\"param\":null,\"type\":\"server_error\"},\"request_id\":\"e4dcc118-b6e3-94e3-b671-6837aead9212\"}"}}
{"timestamp":"2025-08-26T04:37:38.754Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183055965_ahnlhvf7s","newPipelineId":"shuaihong-glm-4.5-key0","error":"Server error: 500 Internal Server Error"}}
{"timestamp":"2025-08-26T04:37:38.763Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183055965_ahnlhvf7s","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"Server error: 500 Internal Server Error"}}
{"timestamp":"2025-08-26T04:37:38.771Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183055965_ahnlhvf7s","recoverability":"non_recoverable","matchedRule":"server-internal-error","confidence":0.5}}
{"timestamp":"2025-08-26T04:37:38.779Z","level":"ERROR","message":"🚫 拉黑流水线","data":{"pipelineId":"shuaihong-glm-4.5-key0","reason":"服务器内部错误 - 需要拉黑流水线 (匹配度: 50%)","failureCount":1}}
{"timestamp":"2025-08-26T04:37:38.786Z","level":"ERROR","message":"💀 流水线销毁事件","data":{"pipelineId":"shuaihong-glm-4.5-key0","reason":"不可恢复错误: 服务器内部错误 - 需要拉黑流水线 (匹配度: 50%)","requestId":"req_1756183055965_ahnlhvf7s","timestamp":1756183058786}}
{"timestamp":"2025-08-26T04:37:38.792Z","level":"INFO","message":"Destroying pipeline data","data":{"pipelineId":"shuaihong-glm-4.5-key0"}}
{"timestamp":"2025-08-26T04:37:38.801Z","level":"INFO","message":"💥 销毁故障流水线并切换","data":{"requestId":"req_1756183055965_ahnlhvf7s","destroyedPipeline":"shuaihong-glm-4.5-key0","newPipeline":"qwen-qwen3-coder-plus-key0","reason":"服务器内部错误 - 需要拉黑流水线 (匹配度: 50%)"}}
{"timestamp":"2025-08-26T04:37:38.806Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183055965_ahnlhvf7s","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:38.815Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183055965_ahnlhvf7s","bodySize":19424,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:38.820Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:38.826Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19424,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:38.831Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19424,"expectedSize":19424}}
{"timestamp":"2025-08-26T04:37:38.836Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":19424,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:39.021Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:39.035Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183055965_ahnlhvf7s","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"01c44226-77f8-9255-8cc5-a03522ae0c09\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:39.042Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183055965_ahnlhvf7s","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"destroyed","recoveryTime":279,"details":"流水线已销毁，但切换到新流水线 qwen-qwen3-coder-plus-key0 也失败了"},"errorClassification":{"recoverability":"non_recoverable","matchedRule":{"name":"server-internal-error","statusCodes":[500],"messageKeywords":"[REDACTED]","recoverability":"non_recoverable","priority":4,"description":"服务器内部错误 - 需要拉黑流水线"},"confidence":0.5,"reason":"服务器内部错误 - 需要拉黑流水线 (匹配度: 50%)"}}}
{"timestamp":"2025-08-26T04:37:39.050Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183055965_ahnlhvf7s","success":false,"recoveryAction":"destroyed","recoveryTime":279}}
{"timestamp":"2025-08-26T04:37:39.056Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183055965_ahnlhvf7s","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"destroyed","recoveryTime":2454,"details":"流水线已销毁，但切换到新流水线 qwen-qwen3-coder-plus-key0 也失败了"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:39.063Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183055965_ahnlhvf7s","success":false,"recoveryAction":"destroyed","recoveryTime":2454}}
{"timestamp":"2025-08-26T04:37:39.070Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183055965_ahnlhvf7s","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"destroyed","recoveryTime":2656,"details":"流水线已销毁，但切换到新流水线 qwen-qwen3-coder-plus-key0 也失败了"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:39.076Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183055965_ahnlhvf7s","success":false,"recoveryAction":"destroyed","recoveryTime":2656}}
{"timestamp":"2025-08-26T04:37:39.082Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183055965_ahnlhvf7s","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"destroyed","details":"流水线已销毁，但切换到新流水线 qwen-qwen3-coder-plus-key0 也失败了"}}
{"timestamp":"2025-08-26T04:37:39.087Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183055965_ahnlhvf7s","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 流水线已销毁，但切换到新流水线 qwen-qwen3-coder-plus-key0 也失败了"}}
{"timestamp":"2025-08-26T04:37:39.094Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183055965_ahnlhvf7s","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":42,"transformer":38,"protocol":35,"serverCompatibility":33},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:37:39.099Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183055965_ahnlhvf7s","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:39.111Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:37:39.125Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:39.130Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:39.135Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:39.140Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:39.145Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:39.149Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:39.154Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183059154_15rn6p3dn","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:39.166Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:39.171Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183059154_15rn6p3dn","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:39.175Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:39.180Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:39.185Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":5,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":6,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",6]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:39.189Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183059154_15rn6p3dn","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:39.209Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183059154_15rn6p3dn","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:39.224Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183059154_15rn6p3dn","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:39.229Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183059154_15rn6p3dn","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:39.241Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183059154_15rn6p3dn","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:39.245Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183059154_15rn6p3dn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:39.250Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183059154_15rn6p3dn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:39.261Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183059154_15rn6p3dn","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:39.266Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183059154_15rn6p3dn","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:39.270Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183059154_15rn6p3dn","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:37:39.283Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183059154_15rn6p3dn","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:39.294Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183059154_15rn6p3dn","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:39.299Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183059154_15rn6p3dn","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:39.304Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183059154_15rn6p3dn","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:39.310Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183059154_15rn6p3dn","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:39.322Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183059154_15rn6p3dn","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:39.327Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183059154_15rn6p3dn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:39.332Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183059154_15rn6p3dn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:39.347Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183059154_15rn6p3dn","bodySize":24947,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:39.352Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":24947,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:39.356Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":24947,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:39.361Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":24947,"expectedSize":24947}}
{"timestamp":"2025-08-26T04:37:39.365Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":24947,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:39.371Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:39.376Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:41.095Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":609,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:41.138Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183054133_25rk0bqei","totalTime":7005,"layerTimings":{"router":85,"transformer":60,"protocol":45,"serverCompatibility":52,"server":6709,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T04:37:41.167Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183054133_25rk0bqei","executionId":"req_1756183054133_25rk0bqei","totalTime":7005,"success":true}}
{"timestamp":"2025-08-26T04:37:41.286Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:41.292Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:41.297Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:41.303Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:41.308Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:41.312Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:41.317Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183061317_rz9xi4pre","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:41.387Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:41.394Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183061317_rz9xi4pre","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:41.399Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:41.406Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:41.412Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":6,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":7,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",7]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:41.418Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183061317_rz9xi4pre","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:41.455Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183061317_rz9xi4pre","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:41.490Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183061317_rz9xi4pre","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:41.498Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183061317_rz9xi4pre","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:37:41.527Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183061317_rz9xi4pre","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:41.534Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183061317_rz9xi4pre","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:41.539Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183061317_rz9xi4pre","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:41.568Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183061317_rz9xi4pre","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:41.574Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183061317_rz9xi4pre","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:41.580Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183061317_rz9xi4pre","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:37:41.607Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183061317_rz9xi4pre","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:41.633Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183061317_rz9xi4pre","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:41.638Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183061317_rz9xi4pre","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:41.644Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183061317_rz9xi4pre","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:41.650Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183061317_rz9xi4pre","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:41.676Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183061317_rz9xi4pre","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:41.681Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183061317_rz9xi4pre","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:41.687Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183061317_rz9xi4pre","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:41.722Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183061317_rz9xi4pre","bodySize":156483,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:41.728Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":156483,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:41.734Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":156483,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T04:37:41.740Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":156483,"expectedSize":156483}}
{"timestamp":"2025-08-26T04:37:41.745Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":156483,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:41.751Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:41.756Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:44.299Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":378,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:44.350Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183059154_15rn6p3dn","totalTime":5196,"layerTimings":{"router":42,"transformer":40,"protocol":29,"serverCompatibility":35,"server":4992,"responseTransform":22},"transformationCount":4}}
{"timestamp":"2025-08-26T04:37:44.373Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183059154_15rn6p3dn","executionId":"req_1756183059154_15rn6p3dn","totalTime":5196,"success":true}}
{"timestamp":"2025-08-26T04:37:44.388Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:44.394Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:44.399Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:44.405Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:44.412Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:44.417Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:44.422Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183064422_gif55o1nz","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:44.435Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:44.440Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183064422_gif55o1nz","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:44.446Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:44.451Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:44.458Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":7,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":8,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",8]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:44.462Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183064422_gif55o1nz","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:44.482Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183064422_gif55o1nz","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:44.500Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183064422_gif55o1nz","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:44.505Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183064422_gif55o1nz","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:44.517Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183064422_gif55o1nz","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:44.522Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183064422_gif55o1nz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:44.528Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183064422_gif55o1nz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:44.540Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183064422_gif55o1nz","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:37:44.545Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183064422_gif55o1nz","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:37:44.549Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183064422_gif55o1nz","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:44.554Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183064422_gif55o1nz","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:37:44.566Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183064422_gif55o1nz","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:44.579Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183064422_gif55o1nz","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:44.583Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183064422_gif55o1nz","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:44.588Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183064422_gif55o1nz","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:44.595Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183064422_gif55o1nz","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:44.608Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183064422_gif55o1nz","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:44.613Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183064422_gif55o1nz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:44.618Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183064422_gif55o1nz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:44.632Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183064422_gif55o1nz","bodySize":18402,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:44.637Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":18402,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:44.642Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":18402,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:44.647Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":18402,"expectedSize":18402}}
{"timestamp":"2025-08-26T04:37:44.652Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":18402,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:44.658Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:44.663Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:44.914Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:44.931Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183064422_gif55o1nz","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"56b1ae65-f5ab-919d-b01d-664d0843f094\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:44.939Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183064422_gif55o1nz","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:44.948Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183064422_gif55o1nz","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:44.955Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183064422_gif55o1nz","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:44.962Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183064422_gif55o1nz","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:37:44.969Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183064422_gif55o1nz","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:44.979Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183064422_gif55o1nz","bodySize":18402,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:44.985Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":18402,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:44.991Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":18402,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:44.996Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":18402,"expectedSize":18402}}
{"timestamp":"2025-08-26T04:37:45.001Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":18402,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:45.153Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:45.169Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183064422_gif55o1nz","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"e0a0bf4b-f5ed-9c27-85a3-8012e99641f5\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:45.178Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183064422_gif55o1nz","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:45.185Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183064422_gif55o1nz","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:45.193Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183064422_gif55o1nz","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:45.199Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183064422_gif55o1nz","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:37:45.206Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183064422_gif55o1nz","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:45.215Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183064422_gif55o1nz","bodySize":18402,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:45.220Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":18402,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:45.225Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":18402,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:45.229Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":18402,"expectedSize":18402}}
{"timestamp":"2025-08-26T04:37:45.234Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":18402,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:45.413Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:45.429Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183064422_gif55o1nz","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"3c5c1618-3942-9c76-8dd5-09c594c585a5\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:45.437Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183064422_gif55o1nz","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:45.445Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183064422_gif55o1nz","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:45.453Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183064422_gif55o1nz","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:45.461Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183064422_gif55o1nz","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:37:45.468Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183064422_gif55o1nz","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:45.479Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183064422_gif55o1nz","bodySize":18402,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:45.485Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":18402,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:45.490Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":18402,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:45.496Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":18402,"expectedSize":18402}}
{"timestamp":"2025-08-26T04:37:45.502Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":18402,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:45.640Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:45.654Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183064422_gif55o1nz","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"51b27e5b-9113-985d-929c-8418101cafea\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:45.662Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183064422_gif55o1nz","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:45.669Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183064422_gif55o1nz","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":224,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:45.676Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183064422_gif55o1nz","success":false,"recoveryAction":"failed","recoveryTime":224}}
{"timestamp":"2025-08-26T04:37:45.681Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183064422_gif55o1nz","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":496,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:45.687Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183064422_gif55o1nz","success":false,"recoveryAction":"failed","recoveryTime":496}}
{"timestamp":"2025-08-26T04:37:45.692Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183064422_gif55o1nz","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":744,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:45.698Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183064422_gif55o1nz","success":false,"recoveryAction":"failed","recoveryTime":744}}
{"timestamp":"2025-08-26T04:37:45.703Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183064422_gif55o1nz","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:37:45.708Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183064422_gif55o1nz","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:37:45.715Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183064422_gif55o1nz","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":48,"transformer":42,"protocol":34,"serverCompatibility":37},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:37:45.720Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183064422_gif55o1nz","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:45.732Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:37:45.745Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:45.750Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:45.754Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:45.759Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:45.763Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:45.767Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:45.772Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183065772_xi2cmt8nq","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:45.784Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:45.789Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183065772_xi2cmt8nq","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:45.793Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:45.798Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:45.802Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":8,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":9,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",9]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:45.807Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183065772_xi2cmt8nq","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:45.827Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183065772_xi2cmt8nq","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:45.845Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183065772_xi2cmt8nq","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:45.850Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183065772_xi2cmt8nq","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:45.863Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183065772_xi2cmt8nq","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:45.868Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183065772_xi2cmt8nq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:45.873Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183065772_xi2cmt8nq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:45.886Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183065772_xi2cmt8nq","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:45.891Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183065772_xi2cmt8nq","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:45.896Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183065772_xi2cmt8nq","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:37:45.909Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183065772_xi2cmt8nq","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:45.921Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183065772_xi2cmt8nq","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:45.927Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183065772_xi2cmt8nq","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:45.932Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183065772_xi2cmt8nq","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:45.938Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183065772_xi2cmt8nq","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:45.951Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183065772_xi2cmt8nq","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:45.956Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183065772_xi2cmt8nq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:45.961Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183065772_xi2cmt8nq","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:45.977Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183065772_xi2cmt8nq","bodySize":28145,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:45.982Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":28145,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:45.987Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":28145,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:45.992Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":28145,"expectedSize":28145}}
{"timestamp":"2025-08-26T04:37:45.996Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":28145,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:46.002Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:46.007Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:50.421Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":383,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:50.469Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183065772_xi2cmt8nq","totalTime":4697,"layerTimings":{"router":42,"transformer":44,"protocol":31,"serverCompatibility":37,"server":4484,"responseTransform":19},"transformationCount":4}}
{"timestamp":"2025-08-26T04:37:50.487Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183065772_xi2cmt8nq","executionId":"req_1756183065772_xi2cmt8nq","totalTime":4697,"success":true}}
{"timestamp":"2025-08-26T04:37:50.503Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:50.509Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:50.515Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:50.522Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:50.527Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:50.532Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:50.538Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183070538_lc5gk0hrx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:50.552Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:50.558Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183070538_lc5gk0hrx","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:50.564Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:50.569Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:50.574Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":9,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":10,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",10]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:50.579Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183070538_lc5gk0hrx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:50.599Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183070538_lc5gk0hrx","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:50.619Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183070538_lc5gk0hrx","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:50.625Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183070538_lc5gk0hrx","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:50.637Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183070538_lc5gk0hrx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:50.643Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183070538_lc5gk0hrx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:50.648Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183070538_lc5gk0hrx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:50.661Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183070538_lc5gk0hrx","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:50.666Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183070538_lc5gk0hrx","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:50.671Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183070538_lc5gk0hrx","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:37:50.685Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183070538_lc5gk0hrx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:50.699Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183070538_lc5gk0hrx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:50.704Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183070538_lc5gk0hrx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:50.709Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183070538_lc5gk0hrx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:50.717Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183070538_lc5gk0hrx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:50.731Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183070538_lc5gk0hrx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:50.736Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183070538_lc5gk0hrx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:50.741Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183070538_lc5gk0hrx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:50.757Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183070538_lc5gk0hrx","bodySize":26426,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:50.763Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":26426,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:50.768Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":26426,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:50.773Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":26426,"expectedSize":26426}}
{"timestamp":"2025-08-26T04:37:50.778Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":26426,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:50.784Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:50.789Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:52.974Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":503,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:53.026Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183070538_lc5gk0hrx","totalTime":2488,"layerTimings":{"router":47,"transformer":46,"protocol":32,"serverCompatibility":41,"server":2259,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T04:37:53.043Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183070538_lc5gk0hrx","executionId":"req_1756183070538_lc5gk0hrx","totalTime":2488,"success":true}}
{"timestamp":"2025-08-26T04:37:53.057Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:53.062Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:53.067Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:53.072Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:53.077Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:53.082Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:53.087Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183073087_bacqliruz","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:53.100Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:53.104Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183073087_bacqliruz","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:53.109Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:53.114Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:53.119Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":10,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":11,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",11]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:53.124Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183073087_bacqliruz","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:53.143Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183073087_bacqliruz","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:53.162Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183073087_bacqliruz","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:53.167Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183073087_bacqliruz","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:53.178Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183073087_bacqliruz","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:53.183Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183073087_bacqliruz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:53.188Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183073087_bacqliruz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:53.201Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183073087_bacqliruz","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:37:53.205Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183073087_bacqliruz","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:37:53.210Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183073087_bacqliruz","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:53.215Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183073087_bacqliruz","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:37:53.227Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183073087_bacqliruz","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:53.240Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183073087_bacqliruz","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:53.245Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183073087_bacqliruz","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:53.250Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183073087_bacqliruz","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:53.257Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183073087_bacqliruz","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:53.269Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183073087_bacqliruz","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:53.274Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183073087_bacqliruz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:53.278Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183073087_bacqliruz","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:53.294Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183073087_bacqliruz","bodySize":25954,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:53.298Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25954,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:53.303Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25954,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:53.308Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25954,"expectedSize":25954}}
{"timestamp":"2025-08-26T04:37:53.313Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25954,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:53.319Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:53.324Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:53.484Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:53.498Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183073087_bacqliruz","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"0c295233-11ba-9bcb-a7f2-4f57533e1e90\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:53.508Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183073087_bacqliruz","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:53.518Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183073087_bacqliruz","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:53.525Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183073087_bacqliruz","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:53.532Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183073087_bacqliruz","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:37:53.539Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183073087_bacqliruz","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:53.549Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183073087_bacqliruz","bodySize":25954,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:53.555Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25954,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:53.561Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25954,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:53.567Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25954,"expectedSize":25954}}
{"timestamp":"2025-08-26T04:37:53.572Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25954,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:53.694Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:53.708Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183073087_bacqliruz","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"fe33481a-7d2a-91cf-9340-d209ae19efc4\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:53.716Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183073087_bacqliruz","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:53.724Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183073087_bacqliruz","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:53.731Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183073087_bacqliruz","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:53.737Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183073087_bacqliruz","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:37:53.743Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183073087_bacqliruz","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:53.752Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183073087_bacqliruz","bodySize":25954,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:53.757Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25954,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:53.762Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25954,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:53.766Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25954,"expectedSize":25954}}
{"timestamp":"2025-08-26T04:37:53.771Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25954,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:53.922Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:53.938Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183073087_bacqliruz","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"e2f262bb-5ed9-9173-ad7e-8176723e948e\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:53.946Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183073087_bacqliruz","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:53.953Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183073087_bacqliruz","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:53.961Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183073087_bacqliruz","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:53.967Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183073087_bacqliruz","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:37:53.974Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183073087_bacqliruz","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:53.983Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183073087_bacqliruz","bodySize":25954,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:53.989Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25954,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:53.995Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25954,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:37:54.000Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25954,"expectedSize":25954}}
{"timestamp":"2025-08-26T04:37:54.005Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25954,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:54.114Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:54.126Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183073087_bacqliruz","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"7ddff471-4f05-97cb-95e1-cdfac63c29f7\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:54.134Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183073087_bacqliruz","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:54.142Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183073087_bacqliruz","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":189,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:54.148Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183073087_bacqliruz","success":false,"recoveryAction":"failed","recoveryTime":189}}
{"timestamp":"2025-08-26T04:37:54.155Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183073087_bacqliruz","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":431,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:54.163Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183073087_bacqliruz","success":false,"recoveryAction":"failed","recoveryTime":431}}
{"timestamp":"2025-08-26T04:37:54.169Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183073087_bacqliruz","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":651,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:54.175Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183073087_bacqliruz","success":false,"recoveryAction":"failed","recoveryTime":651}}
{"timestamp":"2025-08-26T04:37:54.181Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183073087_bacqliruz","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:37:54.186Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183073087_bacqliruz","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:37:54.194Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183073087_bacqliruz","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":43,"transformer":43,"protocol":34,"serverCompatibility":37},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:37:54.199Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183073087_bacqliruz","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:54.214Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:37:54.227Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:54.232Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:54.237Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:54.242Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:54.246Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:54.251Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:54.256Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183074256_ldg6yyzxo","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:54.270Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:54.276Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183074256_ldg6yyzxo","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:54.280Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:54.285Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:54.290Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":11,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":12,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",12]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:54.295Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183074256_ldg6yyzxo","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:54.314Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183074256_ldg6yyzxo","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:54.336Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183074256_ldg6yyzxo","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:54.342Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183074256_ldg6yyzxo","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:54.357Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183074256_ldg6yyzxo","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:54.362Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183074256_ldg6yyzxo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:54.368Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183074256_ldg6yyzxo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:54.382Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183074256_ldg6yyzxo","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:54.387Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183074256_ldg6yyzxo","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:54.393Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183074256_ldg6yyzxo","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:37:54.408Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183074256_ldg6yyzxo","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:54.422Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183074256_ldg6yyzxo","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:54.427Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183074256_ldg6yyzxo","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:54.433Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183074256_ldg6yyzxo","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:54.441Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183074256_ldg6yyzxo","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:54.455Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183074256_ldg6yyzxo","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:54.460Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183074256_ldg6yyzxo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:54.465Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183074256_ldg6yyzxo","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:54.484Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183074256_ldg6yyzxo","bodySize":34685,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:54.489Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":34685,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:54.496Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":34685,"chunkSize":16384,"estimatedChunks":3}}
{"timestamp":"2025-08-26T04:37:54.503Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":34685,"expectedSize":34685}}
{"timestamp":"2025-08-26T04:37:54.508Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":34685,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:54.515Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:54.522Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:54.870Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":2665,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:54.906Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183061317_rz9xi4pre","totalTime":13589,"layerTimings":{"router":111,"transformer":94,"protocol":62,"serverCompatibility":64,"server":13198,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T04:37:54.940Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183061317_rz9xi4pre","executionId":"req_1756183061317_rz9xi4pre","totalTime":13589,"success":true}}
{"timestamp":"2025-08-26T04:37:54.961Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:54.968Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:54.974Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:54.980Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:54.986Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:54.991Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:54.998Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183074998_7y22jssl9","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:55.068Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:55.074Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183074998_7y22jssl9","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:55.080Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:55.086Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:55.091Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":12,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":13,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",13]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:55.096Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183074998_7y22jssl9","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:55.127Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183074998_7y22jssl9","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:55.163Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183074998_7y22jssl9","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:55.169Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183074998_7y22jssl9","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:37:55.194Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183074998_7y22jssl9","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:55.199Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183074998_7y22jssl9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:55.205Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183074998_7y22jssl9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:55.230Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183074998_7y22jssl9","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:55.236Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183074998_7y22jssl9","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:55.241Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183074998_7y22jssl9","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:37:55.267Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183074998_7y22jssl9","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:55.293Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183074998_7y22jssl9","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:55.299Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183074998_7y22jssl9","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:55.305Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183074998_7y22jssl9","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:55.313Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183074998_7y22jssl9","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:55.336Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183074998_7y22jssl9","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:55.342Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183074998_7y22jssl9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:55.347Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183074998_7y22jssl9","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:37:55.381Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183074998_7y22jssl9","bodySize":156483,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:55.387Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":156483,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:37:55.392Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":156483,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T04:37:55.397Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":156483,"expectedSize":156483}}
{"timestamp":"2025-08-26T04:37:55.402Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":156483,"timeout":600000}}
{"timestamp":"2025-08-26T04:37:55.409Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:55.414Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:58.564Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":386,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:37:58.613Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183074256_ldg6yyzxo","totalTime":4357,"layerTimings":{"router":46,"transformer":50,"protocol":35,"serverCompatibility":42,"server":4122,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T04:37:58.631Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183074256_ldg6yyzxo","executionId":"req_1756183074256_ldg6yyzxo","totalTime":4357,"success":true}}
{"timestamp":"2025-08-26T04:37:58.644Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:58.648Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:58.654Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:58.659Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:58.664Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:58.669Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:58.675Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183078675_x2epdm1ff","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:58.688Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:58.693Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183078675_x2epdm1ff","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:58.697Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:58.702Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:58.707Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":13,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":14,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",14]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:58.711Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183078675_x2epdm1ff","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:58.730Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183078675_x2epdm1ff","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:58.750Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183078675_x2epdm1ff","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:58.755Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183078675_x2epdm1ff","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:58.767Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183078675_x2epdm1ff","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:58.772Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183078675_x2epdm1ff","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:58.777Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183078675_x2epdm1ff","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:58.789Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183078675_x2epdm1ff","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:37:58.794Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183078675_x2epdm1ff","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:37:58.799Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183078675_x2epdm1ff","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:58.804Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183078675_x2epdm1ff","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:37:58.817Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183078675_x2epdm1ff","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:58.829Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183078675_x2epdm1ff","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:58.834Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183078675_x2epdm1ff","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:58.839Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183078675_x2epdm1ff","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:58.846Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183078675_x2epdm1ff","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:58.859Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183078675_x2epdm1ff","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:58.863Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183078675_x2epdm1ff","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:58.868Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183078675_x2epdm1ff","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:58.883Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":7542,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:37:58.888Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:58.894Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:37:59.002Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:37:59.017Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183078675_x2epdm1ff","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"6f1b218b-2959-9c1f-b80d-743240d5685a\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.025Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183078675_x2epdm1ff","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.033Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183078675_x2epdm1ff","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.040Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183078675_x2epdm1ff","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:59.048Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183078675_x2epdm1ff","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:37:59.054Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183078675_x2epdm1ff","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:59.063Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":7542,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:37:59.154Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:37:59.168Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183078675_x2epdm1ff","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"01d7ac22-23a8-9f86-b351-1578ef398aaa\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.177Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183078675_x2epdm1ff","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.184Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183078675_x2epdm1ff","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.192Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183078675_x2epdm1ff","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:59.198Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183078675_x2epdm1ff","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:37:59.204Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183078675_x2epdm1ff","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:59.214Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":7542,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:37:59.309Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:37:59.324Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183078675_x2epdm1ff","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"37c8520e-f825-9b23-a8cc-9cc89a43a877\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.332Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183078675_x2epdm1ff","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.339Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183078675_x2epdm1ff","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.345Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183078675_x2epdm1ff","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:37:59.352Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183078675_x2epdm1ff","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:37:59.358Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183078675_x2epdm1ff","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:37:59.367Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":7542,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:37:59.451Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:37:59.464Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183078675_x2epdm1ff","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"dbca6b45-d9c2-9285-b824-6ce8e9ba0adf\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.472Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183078675_x2epdm1ff","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.479Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183078675_x2epdm1ff","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":140,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:59.486Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183078675_x2epdm1ff","success":false,"recoveryAction":"failed","recoveryTime":140}}
{"timestamp":"2025-08-26T04:37:59.494Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183078675_x2epdm1ff","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":310,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:59.500Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183078675_x2epdm1ff","success":false,"recoveryAction":"failed","recoveryTime":310}}
{"timestamp":"2025-08-26T04:37:59.506Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183078675_x2epdm1ff","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":473,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:37:59.513Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183078675_x2epdm1ff","success":false,"recoveryAction":"failed","recoveryTime":473}}
{"timestamp":"2025-08-26T04:37:59.518Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183078675_x2epdm1ff","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:37:59.523Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183078675_x2epdm1ff","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:37:59.532Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183078675_x2epdm1ff","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":42,"transformer":45,"protocol":36,"serverCompatibility":37},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:37:59.538Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183078675_x2epdm1ff","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:37:59.549Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:37:59.561Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:37:59.566Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:59.570Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:37:59.575Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:37:59.580Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:37:59.585Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:37:59.590Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183079590_dqoymds34","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:37:59.601Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:59.606Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183079590_dqoymds34","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:37:59.612Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:37:59.617Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:37:59.622Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":14,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":15,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",15]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:37:59.627Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183079590_dqoymds34","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:37:59.647Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183079590_dqoymds34","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:37:59.668Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183079590_dqoymds34","hasOutput":true}}
{"timestamp":"2025-08-26T04:37:59.673Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183079590_dqoymds34","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:37:59.685Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183079590_dqoymds34","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:59.690Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183079590_dqoymds34","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:59.695Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183079590_dqoymds34","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:59.706Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183079590_dqoymds34","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:37:59.711Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183079590_dqoymds34","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:37:59.716Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183079590_dqoymds34","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:37:59.727Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183079590_dqoymds34","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:37:59.739Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183079590_dqoymds34","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:37:59.744Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183079590_dqoymds34","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:37:59.749Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183079590_dqoymds34","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:37:59.757Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183079590_dqoymds34","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:37:59.769Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183079590_dqoymds34","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:37:59.773Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183079590_dqoymds34","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:59.778Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183079590_dqoymds34","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:37:59.792Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":2899,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:37:59.798Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:37:59.803Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:01.986Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":375,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:38:02.041Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183079590_dqoymds34","totalTime":2451,"layerTimings":{"router":45,"transformer":45,"protocol":27,"serverCompatibility":37,"server":2235,"responseTransform":24},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:02.056Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183079590_dqoymds34","executionId":"req_1756183079590_dqoymds34","totalTime":2451,"success":true}}
{"timestamp":"2025-08-26T04:38:02.070Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:02.076Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:02.082Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:02.087Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:02.092Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:02.098Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:02.103Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183082103_uhknrhg8o","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:02.117Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:02.122Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183082103_uhknrhg8o","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:02.127Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:02.132Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:02.136Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":15,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":16,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",16]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:02.142Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183082103_uhknrhg8o","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:02.161Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183082103_uhknrhg8o","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:02.185Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183082103_uhknrhg8o","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:02.190Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183082103_uhknrhg8o","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:02.203Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183082103_uhknrhg8o","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:02.208Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183082103_uhknrhg8o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:02.213Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183082103_uhknrhg8o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:02.226Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183082103_uhknrhg8o","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:02.230Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183082103_uhknrhg8o","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:02.235Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183082103_uhknrhg8o","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:38:02.249Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183082103_uhknrhg8o","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:02.262Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183082103_uhknrhg8o","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:02.267Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183082103_uhknrhg8o","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:02.272Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183082103_uhknrhg8o","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:02.280Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183082103_uhknrhg8o","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:02.293Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183082103_uhknrhg8o","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:02.298Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183082103_uhknrhg8o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:02.303Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183082103_uhknrhg8o","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:02.320Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183082103_uhknrhg8o","bodySize":40529,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:02.325Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":40529,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:02.330Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":40529,"chunkSize":16384,"estimatedChunks":3}}
{"timestamp":"2025-08-26T04:38:02.335Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":40529,"expectedSize":40529}}
{"timestamp":"2025-08-26T04:38:02.340Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":40529,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:02.346Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:02.351Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:03.720Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":924,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:03.777Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183074998_7y22jssl9","totalTime":8779,"layerTimings":{"router":105,"transformer":86,"protocol":56,"serverCompatibility":64,"server":8404,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:03.816Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183074998_7y22jssl9","executionId":"req_1756183074998_7y22jssl9","totalTime":8779,"success":true}}
{"timestamp":"2025-08-26T04:38:04.310Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":505,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:04.368Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183082103_uhknrhg8o","totalTime":2265,"layerTimings":{"router":44,"transformer":50,"protocol":32,"serverCompatibility":40,"server":2039,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:04.389Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183082103_uhknrhg8o","executionId":"req_1756183082103_uhknrhg8o","totalTime":2265,"success":true}}
{"timestamp":"2025-08-26T04:38:33.166Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:33.173Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:33.180Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:33.186Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:33.191Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:33.198Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:33.204Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183113204_4sv09lxno","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:33.218Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:33.223Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183113204_4sv09lxno","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:33.228Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:33.233Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:33.239Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":16,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":17,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",17]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:33.244Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183113204_4sv09lxno","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:33.262Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183113204_4sv09lxno","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:33.286Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183113204_4sv09lxno","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:33.290Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183113204_4sv09lxno","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:33.303Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183113204_4sv09lxno","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:33.308Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183113204_4sv09lxno","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:33.313Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183113204_4sv09lxno","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:33.326Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183113204_4sv09lxno","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:38:33.331Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183113204_4sv09lxno","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:38:33.336Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183113204_4sv09lxno","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:33.341Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183113204_4sv09lxno","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:38:33.353Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183113204_4sv09lxno","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:33.365Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183113204_4sv09lxno","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:33.370Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183113204_4sv09lxno","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:33.375Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183113204_4sv09lxno","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:33.383Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183113204_4sv09lxno","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:33.395Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183113204_4sv09lxno","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:33.400Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183113204_4sv09lxno","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:33.404Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183113204_4sv09lxno","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:33.419Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183113204_4sv09lxno","bodySize":25324,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:33.425Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:33.431Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25324,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:33.436Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25324,"expectedSize":25324}}
{"timestamp":"2025-08-26T04:38:33.441Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25324,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:33.452Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:33.457Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:33.462Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:33.466Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:33.471Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:33.477Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:33.482Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183113482_6o31vx1t7","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:33.538Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:33.543Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183113482_6o31vx1t7","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:33.548Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:33.553Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:33.558Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":17,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":18,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",18]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:33.563Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183113482_6o31vx1t7","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:33.590Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183113482_6o31vx1t7","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:33.624Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183113482_6o31vx1t7","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:33.630Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183113482_6o31vx1t7","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:38:33.651Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183113482_6o31vx1t7","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:33.657Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183113482_6o31vx1t7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:33.663Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183113482_6o31vx1t7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:33.685Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183113482_6o31vx1t7","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:33.690Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183113482_6o31vx1t7","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:33.696Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183113482_6o31vx1t7","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:38:33.717Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183113482_6o31vx1t7","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:33.739Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183113482_6o31vx1t7","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:33.744Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183113482_6o31vx1t7","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:33.750Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183113482_6o31vx1t7","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:33.759Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183113482_6o31vx1t7","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:33.780Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183113482_6o31vx1t7","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:33.785Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183113482_6o31vx1t7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:33.790Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183113482_6o31vx1t7","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:33.816Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183113482_6o31vx1t7","bodySize":123483,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:33.822Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":123483,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:33.827Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123483,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:38:33.833Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123483,"expectedSize":123483}}
{"timestamp":"2025-08-26T04:38:33.838Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":123483,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:33.845Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:33.851Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:33.857Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:33.862Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:34.072Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:34.087Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183113204_4sv09lxno","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"7294244f-2475-9990-a4fa-e77d10cdfe52\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.094Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183113204_4sv09lxno","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.101Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183113204_4sv09lxno","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.107Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183113204_4sv09lxno","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:34.113Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183113204_4sv09lxno","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:38:34.118Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183113204_4sv09lxno","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:34.128Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183113204_4sv09lxno","bodySize":25324,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:34.133Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:34.139Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25324,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:34.145Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25324,"expectedSize":25324}}
{"timestamp":"2025-08-26T04:38:34.150Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25324,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:34.274Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:34.289Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183113204_4sv09lxno","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"76c43ab2-2684-902a-807e-4132b2d8700f\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.297Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183113204_4sv09lxno","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.305Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183113204_4sv09lxno","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.312Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183113204_4sv09lxno","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:34.320Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183113204_4sv09lxno","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:38:34.326Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183113204_4sv09lxno","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:34.336Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183113204_4sv09lxno","bodySize":25324,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:34.342Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:34.348Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25324,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:34.353Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25324,"expectedSize":25324}}
{"timestamp":"2025-08-26T04:38:34.358Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25324,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:34.497Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:34.513Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183113204_4sv09lxno","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"7e6f8544-5e8e-9182-ba8d-83d3eed2af25\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.521Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183113204_4sv09lxno","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.528Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183113204_4sv09lxno","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.535Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183113204_4sv09lxno","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:34.542Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183113204_4sv09lxno","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:38:34.548Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183113204_4sv09lxno","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:34.557Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183113204_4sv09lxno","bodySize":25324,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:34.562Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25324,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:34.567Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25324,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:34.572Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25324,"expectedSize":25324}}
{"timestamp":"2025-08-26T04:38:34.577Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25324,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:34.692Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:34.707Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183113204_4sv09lxno","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"a38cd274-421b-9447-91df-3ae30a8ddba3\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.714Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183113204_4sv09lxno","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.721Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183113204_4sv09lxno","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":193,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:34.729Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183113204_4sv09lxno","success":false,"recoveryAction":"failed","recoveryTime":193}}
{"timestamp":"2025-08-26T04:38:34.736Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183113204_4sv09lxno","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":431,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:34.743Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183113204_4sv09lxno","success":false,"recoveryAction":"failed","recoveryTime":431}}
{"timestamp":"2025-08-26T04:38:34.749Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183113204_4sv09lxno","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":648,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:34.756Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183113204_4sv09lxno","success":false,"recoveryAction":"failed","recoveryTime":648}}
{"timestamp":"2025-08-26T04:38:34.761Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183113204_4sv09lxno","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:34.767Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183113204_4sv09lxno","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:34.775Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183113204_4sv09lxno","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":45,"transformer":48,"protocol":35,"serverCompatibility":37},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:38:34.780Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183113204_4sv09lxno","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:34.794Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:38:34.829Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:34.835Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:34.840Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:34.846Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:34.852Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:34.858Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:34.863Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183114863_uzyc090cw","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:34.876Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:34.881Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183114863_uzyc090cw","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:34.886Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:34.891Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:34.895Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":18,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":19,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",19]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:34.900Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183114863_uzyc090cw","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:34.918Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183114863_uzyc090cw","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:34.943Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183114863_uzyc090cw","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:34.947Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183114863_uzyc090cw","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:34.960Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183114863_uzyc090cw","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:34.965Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183114863_uzyc090cw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:34.970Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183114863_uzyc090cw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:34.982Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183114863_uzyc090cw","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:34.987Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183114863_uzyc090cw","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:34.993Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183114863_uzyc090cw","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:38:35.005Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183114863_uzyc090cw","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:35.017Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183114863_uzyc090cw","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:35.022Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183114863_uzyc090cw","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:35.027Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183114863_uzyc090cw","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:35.035Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183114863_uzyc090cw","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:35.047Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183114863_uzyc090cw","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:35.052Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183114863_uzyc090cw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:35.057Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183114863_uzyc090cw","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:35.071Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183114863_uzyc090cw","bodySize":19523,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:35.077Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":19523,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:35.082Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19523,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:35.087Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19523,"expectedSize":19523}}
{"timestamp":"2025-08-26T04:38:35.092Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":19523,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:35.097Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:35.102Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:38.740Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":503,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:38.773Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183114863_uzyc090cw","totalTime":3910,"layerTimings":{"router":43,"transformer":49,"protocol":30,"serverCompatibility":37,"server":3695,"responseTransform":16},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:38.789Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183114863_uzyc090cw","executionId":"req_1756183114863_uzyc090cw","totalTime":3910,"success":true}}
{"timestamp":"2025-08-26T04:38:38.802Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:38.808Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:38.814Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:38.820Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:38.827Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:38.834Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:38.841Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183118841_25oi3nmex","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:38.856Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:38.863Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183118841_25oi3nmex","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:38.868Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:38.875Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:38.881Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":19,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":20,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",20]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:38.887Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183118841_25oi3nmex","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:38.912Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183118841_25oi3nmex","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:38.941Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183118841_25oi3nmex","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:38.947Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183118841_25oi3nmex","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:38.961Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183118841_25oi3nmex","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:38.969Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183118841_25oi3nmex","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:38.975Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183118841_25oi3nmex","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:38.991Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183118841_25oi3nmex","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:38:38.997Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183118841_25oi3nmex","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:38:39.003Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183118841_25oi3nmex","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:39.009Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183118841_25oi3nmex","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:38:39.024Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183118841_25oi3nmex","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:39.039Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183118841_25oi3nmex","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:39.045Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183118841_25oi3nmex","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:39.052Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183118841_25oi3nmex","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:39.062Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183118841_25oi3nmex","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:39.077Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183118841_25oi3nmex","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:39.085Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183118841_25oi3nmex","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:39.091Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183118841_25oi3nmex","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:39.108Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183118841_25oi3nmex","bodySize":19424,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:39.113Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:39.120Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19424,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:39.126Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19424,"expectedSize":19424}}
{"timestamp":"2025-08-26T04:38:39.131Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":19424,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:39.138Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:39.143Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:39.230Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:39.241Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183118841_25oi3nmex","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"d08f4c00-4523-9fed-ac1c-51034c9174ec\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.248Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183118841_25oi3nmex","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.254Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183118841_25oi3nmex","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.260Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183118841_25oi3nmex","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:39.265Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183118841_25oi3nmex","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:38:39.271Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183118841_25oi3nmex","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:39.279Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183118841_25oi3nmex","bodySize":19424,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:39.285Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:39.290Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19424,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:39.295Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19424,"expectedSize":19424}}
{"timestamp":"2025-08-26T04:38:39.300Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":19424,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:39.402Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:39.416Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183118841_25oi3nmex","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"f2bf17bc-3da9-9510-b6c3-2e7e401de067\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.423Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183118841_25oi3nmex","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.430Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183118841_25oi3nmex","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.437Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183118841_25oi3nmex","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:39.443Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183118841_25oi3nmex","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:38:39.450Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183118841_25oi3nmex","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:39.461Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183118841_25oi3nmex","bodySize":19424,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:39.466Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:39.472Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19424,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:39.477Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19424,"expectedSize":19424}}
{"timestamp":"2025-08-26T04:38:39.482Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":19424,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:39.593Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:39.606Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183118841_25oi3nmex","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"af886a8e-eff5-9608-bdf0-175c9aab68ab\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.614Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183118841_25oi3nmex","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.620Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183118841_25oi3nmex","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.627Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183118841_25oi3nmex","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:39.633Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183118841_25oi3nmex","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:38:39.639Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183118841_25oi3nmex","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:39.648Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183118841_25oi3nmex","bodySize":19424,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:39.654Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":19424,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:39.660Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":19424,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:39.665Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":19424,"expectedSize":19424}}
{"timestamp":"2025-08-26T04:38:39.670Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":19424,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:39.788Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:39.803Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183118841_25oi3nmex","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"ad0b79dd-29fb-936c-8538-2014f84a437f\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.810Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183118841_25oi3nmex","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.817Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183118841_25oi3nmex","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":197,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:39.822Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183118841_25oi3nmex","success":false,"recoveryAction":"failed","recoveryTime":197}}
{"timestamp":"2025-08-26T04:38:39.828Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183118841_25oi3nmex","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":398,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:39.834Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183118841_25oi3nmex","success":false,"recoveryAction":"failed","recoveryTime":398}}
{"timestamp":"2025-08-26T04:38:39.840Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183118841_25oi3nmex","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":586,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:39.846Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183118841_25oi3nmex","success":false,"recoveryAction":"failed","recoveryTime":586}}
{"timestamp":"2025-08-26T04:38:39.851Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183118841_25oi3nmex","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:39.856Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183118841_25oi3nmex","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:39.864Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183118841_25oi3nmex","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":55,"transformer":58,"protocol":42,"serverCompatibility":47},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:38:39.869Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183118841_25oi3nmex","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:39.883Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:38:39.896Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:39.900Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:39.905Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:39.910Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:39.914Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:39.921Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:39.926Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183119926_o3luaufnn","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:39.938Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:39.943Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183119926_o3luaufnn","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:39.948Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:39.953Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:39.958Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":20,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":21,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",21]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:39.963Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183119926_o3luaufnn","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:39.982Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183119926_o3luaufnn","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:40.010Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183119926_o3luaufnn","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:40.015Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183119926_o3luaufnn","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:40.030Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183119926_o3luaufnn","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:40.035Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183119926_o3luaufnn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:40.040Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183119926_o3luaufnn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:40.053Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183119926_o3luaufnn","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:40.058Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183119926_o3luaufnn","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:40.063Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183119926_o3luaufnn","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:38:40.075Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183119926_o3luaufnn","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:40.088Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183119926_o3luaufnn","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:40.093Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183119926_o3luaufnn","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:40.099Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183119926_o3luaufnn","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:40.107Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183119926_o3luaufnn","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:40.119Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183119926_o3luaufnn","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:40.124Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183119926_o3luaufnn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:40.129Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183119926_o3luaufnn","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:40.145Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183119926_o3luaufnn","bodySize":24947,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:40.150Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":24947,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:40.155Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":24947,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:40.160Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":24947,"expectedSize":24947}}
{"timestamp":"2025-08-26T04:38:40.165Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":24947,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:40.171Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:40.176Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:40.181Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":609,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:40.212Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183113482_6o31vx1t7","totalTime":6730,"layerTimings":{"router":88,"transformer":76,"protocol":49,"serverCompatibility":57,"server":6400,"responseTransform":17},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:40.239Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183113482_6o31vx1t7","executionId":"req_1756183113482_6o31vx1t7","totalTime":6730,"success":true}}
{"timestamp":"2025-08-26T04:38:40.255Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:40.260Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:40.266Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:40.271Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:40.276Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:40.283Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:40.288Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183120288_xtc7eni04","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:40.349Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:40.354Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183120288_xtc7eni04","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:40.359Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:40.364Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:40.369Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":21,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":22,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",22]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:40.375Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183120288_xtc7eni04","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:40.401Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183120288_xtc7eni04","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:40.437Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183120288_xtc7eni04","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:40.442Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183120288_xtc7eni04","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:38:40.465Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183120288_xtc7eni04","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:40.471Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183120288_xtc7eni04","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:40.476Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183120288_xtc7eni04","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:40.497Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183120288_xtc7eni04","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:40.503Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183120288_xtc7eni04","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:40.508Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183120288_xtc7eni04","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:38:40.530Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183120288_xtc7eni04","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:40.552Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183120288_xtc7eni04","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:40.558Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183120288_xtc7eni04","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:40.565Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183120288_xtc7eni04","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:40.574Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183120288_xtc7eni04","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:40.596Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183120288_xtc7eni04","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:40.602Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183120288_xtc7eni04","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:40.609Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183120288_xtc7eni04","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:40.637Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183120288_xtc7eni04","bodySize":123491,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:40.642Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":123491,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:40.647Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":123491,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:38:40.652Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":123491,"expectedSize":123491}}
{"timestamp":"2025-08-26T04:38:40.657Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":123491,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:40.663Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:40.668Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:41.990Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":383,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:42.042Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183119926_o3luaufnn","totalTime":2116,"layerTimings":{"router":44,"transformer":55,"protocol":29,"serverCompatibility":39,"server":1888,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:42.062Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183119926_o3luaufnn","executionId":"req_1756183119926_o3luaufnn","totalTime":2116,"success":true}}
{"timestamp":"2025-08-26T04:38:42.077Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:42.082Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:42.088Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:42.094Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:42.100Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:42.107Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:42.113Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183122113_7nlulchxa","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:42.126Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:42.132Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183122113_7nlulchxa","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:42.137Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:42.143Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:42.148Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":22,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":23,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",23]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:42.153Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183122113_7nlulchxa","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:42.172Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183122113_7nlulchxa","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:42.201Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183122113_7nlulchxa","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:42.207Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183122113_7nlulchxa","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:42.220Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183122113_7nlulchxa","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:42.225Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183122113_7nlulchxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:42.230Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183122113_7nlulchxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:42.243Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183122113_7nlulchxa","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:38:42.248Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183122113_7nlulchxa","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:38:42.253Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183122113_7nlulchxa","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:42.258Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183122113_7nlulchxa","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:38:42.271Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183122113_7nlulchxa","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:42.284Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183122113_7nlulchxa","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:42.289Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183122113_7nlulchxa","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:42.295Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183122113_7nlulchxa","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:42.304Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183122113_7nlulchxa","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:42.316Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183122113_7nlulchxa","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:42.321Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183122113_7nlulchxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:42.326Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183122113_7nlulchxa","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:42.340Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183122113_7nlulchxa","bodySize":18402,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:42.346Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":18402,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:42.351Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":18402,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:42.356Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":18402,"expectedSize":18402}}
{"timestamp":"2025-08-26T04:38:42.361Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":18402,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:42.367Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:42.373Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:42.445Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:42.458Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183122113_7nlulchxa","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"cccd7c93-e709-9b8e-939e-2625c2cced90\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:42.466Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183122113_7nlulchxa","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:42.473Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183122113_7nlulchxa","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:42.480Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183122113_7nlulchxa","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:42.486Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183122113_7nlulchxa","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:38:42.494Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183122113_7nlulchxa","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:42.503Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183122113_7nlulchxa","bodySize":18402,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:42.509Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":18402,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:42.514Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":18402,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:42.520Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":18402,"expectedSize":18402}}
{"timestamp":"2025-08-26T04:38:42.527Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":18402,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:42.652Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:42.667Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183122113_7nlulchxa","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"311b36ac-0ef1-97d1-8dbb-257201011a73\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:42.675Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183122113_7nlulchxa","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:42.682Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183122113_7nlulchxa","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:42.688Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183122113_7nlulchxa","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:42.695Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183122113_7nlulchxa","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:38:42.702Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183122113_7nlulchxa","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:42.712Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183122113_7nlulchxa","bodySize":18402,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:42.717Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":18402,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:42.723Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":18402,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:42.728Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":18402,"expectedSize":18402}}
{"timestamp":"2025-08-26T04:38:42.733Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":18402,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:42.822Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:42.836Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183122113_7nlulchxa","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"424c110e-11a6-95b4-9f07-d067e60143f4\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:42.844Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183122113_7nlulchxa","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:42.850Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183122113_7nlulchxa","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:42.857Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183122113_7nlulchxa","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:42.863Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183122113_7nlulchxa","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:38:42.869Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183122113_7nlulchxa","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:42.878Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183122113_7nlulchxa","bodySize":18402,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:42.885Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":18402,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:42.890Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":18402,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:42.897Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":18402,"expectedSize":18402}}
{"timestamp":"2025-08-26T04:38:42.903Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":18402,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:42.995Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:43.006Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183122113_7nlulchxa","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"e65dda58-2068-9d2d-ad6b-abfe607a7a44\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:43.012Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183122113_7nlulchxa","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:43.018Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183122113_7nlulchxa","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":168,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:43.025Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183122113_7nlulchxa","success":false,"recoveryAction":"failed","recoveryTime":168}}
{"timestamp":"2025-08-26T04:38:43.031Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183122113_7nlulchxa","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":349,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:43.037Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183122113_7nlulchxa","success":false,"recoveryAction":"failed","recoveryTime":349}}
{"timestamp":"2025-08-26T04:38:43.043Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183122113_7nlulchxa","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":570,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:43.049Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183122113_7nlulchxa","success":false,"recoveryAction":"failed","recoveryTime":570}}
{"timestamp":"2025-08-26T04:38:43.055Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183122113_7nlulchxa","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:43.061Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183122113_7nlulchxa","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:43.070Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183122113_7nlulchxa","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":46,"transformer":56,"protocol":35,"serverCompatibility":40},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:38:43.076Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183122113_7nlulchxa","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:43.092Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:38:43.107Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:43.113Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:43.119Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:43.125Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:43.131Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:43.138Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:43.144Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183123144_r4m764kmx","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:43.157Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:43.162Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183123144_r4m764kmx","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:43.168Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:43.173Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:43.178Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":23,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":24,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",24]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:43.184Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183123144_r4m764kmx","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:43.205Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183123144_r4m764kmx","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:43.233Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183123144_r4m764kmx","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:43.239Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183123144_r4m764kmx","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:43.255Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183123144_r4m764kmx","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:43.260Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183123144_r4m764kmx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:43.266Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183123144_r4m764kmx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:43.279Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183123144_r4m764kmx","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:43.284Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183123144_r4m764kmx","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:43.289Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183123144_r4m764kmx","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:38:43.302Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183123144_r4m764kmx","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:43.315Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183123144_r4m764kmx","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:43.320Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183123144_r4m764kmx","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:43.326Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183123144_r4m764kmx","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:43.335Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183123144_r4m764kmx","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:43.347Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183123144_r4m764kmx","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:43.352Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183123144_r4m764kmx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:43.357Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183123144_r4m764kmx","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:43.373Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183123144_r4m764kmx","bodySize":28145,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:43.378Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":28145,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:43.383Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":28145,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:43.388Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":28145,"expectedSize":28145}}
{"timestamp":"2025-08-26T04:38:43.393Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":28145,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:43.399Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:43.404Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:44.830Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":738,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:44.890Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183120288_xtc7eni04","totalTime":4602,"layerTimings":{"router":93,"transformer":79,"protocol":49,"serverCompatibility":61,"server":4254,"responseTransform":22},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:44.924Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183120288_xtc7eni04","executionId":"req_1756183120288_xtc7eni04","totalTime":4602,"success":true}}
{"timestamp":"2025-08-26T04:38:45.038Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:45.043Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:45.049Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:45.054Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:45.060Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:45.067Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:45.073Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183125073_3yucg07rc","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:45.134Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:45.139Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183125073_3yucg07rc","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:45.143Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:45.148Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:45.153Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":24,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":25,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",25]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:45.158Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183125073_3yucg07rc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:45.185Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183125073_3yucg07rc","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:45.232Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183125073_3yucg07rc","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:45.237Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183125073_3yucg07rc","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:38:45.260Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183125073_3yucg07rc","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:45.265Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183125073_3yucg07rc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:45.270Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183125073_3yucg07rc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:45.292Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183125073_3yucg07rc","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:45.298Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183125073_3yucg07rc","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:45.303Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183125073_3yucg07rc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:38:45.323Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183125073_3yucg07rc","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:45.346Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183125073_3yucg07rc","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:45.352Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183125073_3yucg07rc","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:45.358Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183125073_3yucg07rc","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:45.367Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183125073_3yucg07rc","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:45.388Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183125073_3yucg07rc","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:45.394Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183125073_3yucg07rc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:45.400Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183125073_3yucg07rc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:45.427Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183125073_3yucg07rc","bodySize":124056,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:45.432Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":124056,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:45.438Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":124056,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:38:45.443Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":124056,"expectedSize":124056}}
{"timestamp":"2025-08-26T04:38:45.448Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":124056,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:45.453Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":385,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:45.481Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183123144_r4m764kmx","totalTime":2337,"layerTimings":{"router":48,"transformer":58,"protocol":31,"serverCompatibility":40,"server":2105,"responseTransform":14},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:45.496Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183123144_r4m764kmx","executionId":"req_1756183123144_r4m764kmx","totalTime":2337,"success":true}}
{"timestamp":"2025-08-26T04:38:45.504Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:45.510Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:45.518Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:45.523Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:45.528Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:45.533Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:45.538Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:45.546Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:45.551Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183125551_1vd3927oc","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:45.563Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:45.568Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183125551_1vd3927oc","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:45.574Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:45.579Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:45.585Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":25,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":26,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",26]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:45.590Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183125551_1vd3927oc","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:45.611Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183125551_1vd3927oc","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:45.641Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183125551_1vd3927oc","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:45.648Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183125551_1vd3927oc","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:45.662Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183125551_1vd3927oc","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:45.668Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183125551_1vd3927oc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:45.673Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183125551_1vd3927oc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:45.686Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183125551_1vd3927oc","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:38:45.692Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183125551_1vd3927oc","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:38:45.698Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183125551_1vd3927oc","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:45.703Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183125551_1vd3927oc","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:38:45.717Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183125551_1vd3927oc","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:45.732Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183125551_1vd3927oc","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:45.737Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183125551_1vd3927oc","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:45.744Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183125551_1vd3927oc","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:45.753Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183125551_1vd3927oc","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:45.767Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183125551_1vd3927oc","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:45.772Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183125551_1vd3927oc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:45.777Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183125551_1vd3927oc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:45.794Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183125551_1vd3927oc","bodySize":26427,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:45.799Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":26427,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:45.804Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":26427,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:45.809Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":26427,"expectedSize":26427}}
{"timestamp":"2025-08-26T04:38:45.814Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":26427,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:45.820Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:45.826Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:45.907Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:45.921Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183125551_1vd3927oc","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"623a8dc2-45ce-9502-8e53-0a49169edef9\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:45.930Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183125551_1vd3927oc","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:45.937Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183125551_1vd3927oc","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:45.945Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183125551_1vd3927oc","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:45.952Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183125551_1vd3927oc","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:38:45.958Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183125551_1vd3927oc","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:45.967Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183125551_1vd3927oc","bodySize":26427,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:45.973Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":26427,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:45.978Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":26427,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:45.983Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":26427,"expectedSize":26427}}
{"timestamp":"2025-08-26T04:38:45.988Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":26427,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:46.117Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:46.127Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183125551_1vd3927oc","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"3aea0740-a56d-909e-94d0-f738d7b2c321\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:46.132Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183125551_1vd3927oc","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:46.139Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183125551_1vd3927oc","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:46.145Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183125551_1vd3927oc","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:46.151Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183125551_1vd3927oc","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:38:46.157Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183125551_1vd3927oc","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:46.165Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183125551_1vd3927oc","bodySize":26427,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:46.171Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":26427,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:46.177Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":26427,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:46.182Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":26427,"expectedSize":26427}}
{"timestamp":"2025-08-26T04:38:46.187Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":26427,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:46.276Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:46.288Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183125551_1vd3927oc","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"62945aa6-89f7-90d7-95d3-24a49036bc84\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:46.295Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183125551_1vd3927oc","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:46.303Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183125551_1vd3927oc","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:46.311Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183125551_1vd3927oc","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:46.318Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183125551_1vd3927oc","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:38:46.325Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183125551_1vd3927oc","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:46.333Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183125551_1vd3927oc","bodySize":26427,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:46.339Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":26427,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:46.344Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":26427,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:46.349Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":26427,"expectedSize":26427}}
{"timestamp":"2025-08-26T04:38:46.354Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":26427,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:46.449Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:46.463Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183125551_1vd3927oc","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"7a5d0014-3edc-9b9a-9fc2-96aae98f3a3b\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:46.471Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183125551_1vd3927oc","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:46.479Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183125551_1vd3927oc","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":176,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:46.486Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183125551_1vd3927oc","success":false,"recoveryAction":"failed","recoveryTime":176}}
{"timestamp":"2025-08-26T04:38:46.492Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183125551_1vd3927oc","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":353,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:46.498Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183125551_1vd3927oc","success":false,"recoveryAction":"failed","recoveryTime":353}}
{"timestamp":"2025-08-26T04:38:46.505Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183125551_1vd3927oc","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":568,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:46.511Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183125551_1vd3927oc","success":false,"recoveryAction":"failed","recoveryTime":568}}
{"timestamp":"2025-08-26T04:38:46.517Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183125551_1vd3927oc","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:46.522Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183125551_1vd3927oc","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:46.531Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183125551_1vd3927oc","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":46,"transformer":60,"protocol":39,"serverCompatibility":44},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:38:46.536Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183125551_1vd3927oc","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:46.550Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:38:46.563Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:46.568Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:46.573Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:46.578Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:46.583Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:46.590Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:46.596Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183126596_mqtdv89ls","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:46.609Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:46.614Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183126596_mqtdv89ls","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:46.619Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:46.624Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:46.629Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":26,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":27,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",27]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:46.634Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183126596_mqtdv89ls","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:46.652Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183126596_mqtdv89ls","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:46.682Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183126596_mqtdv89ls","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:46.688Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183126596_mqtdv89ls","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:46.702Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183126596_mqtdv89ls","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:46.707Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183126596_mqtdv89ls","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:46.712Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183126596_mqtdv89ls","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:46.725Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183126596_mqtdv89ls","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:46.730Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183126596_mqtdv89ls","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:46.735Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183126596_mqtdv89ls","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:38:46.747Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183126596_mqtdv89ls","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:46.760Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183126596_mqtdv89ls","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:46.765Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183126596_mqtdv89ls","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:46.771Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183126596_mqtdv89ls","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:46.780Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183126596_mqtdv89ls","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:46.793Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183126596_mqtdv89ls","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:46.798Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183126596_mqtdv89ls","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:46.803Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183126596_mqtdv89ls","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:46.818Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183126596_mqtdv89ls","bodySize":25945,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:46.823Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":25945,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:46.828Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25945,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:38:46.833Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25945,"expectedSize":25945}}
{"timestamp":"2025-08-26T04:38:46.838Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":25945,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:46.843Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:46.849Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:48.564Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":652,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:48.624Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183125073_3yucg07rc","totalTime":3551,"layerTimings":{"router":92,"transformer":90,"protocol":47,"serverCompatibility":59,"server":3195,"responseTransform":24},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:48.658Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183125073_3yucg07rc","executionId":"req_1756183125073_3yucg07rc","totalTime":3551,"success":true}}
{"timestamp":"2025-08-26T04:38:48.675Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:48.682Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:48.688Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:48.694Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:48.700Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:48.709Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:48.715Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183128715_wuthx9fgc","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:48.780Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:48.786Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183128715_wuthx9fgc","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:48.792Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:48.798Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:48.803Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":27,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":28,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",28]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:48.808Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183128715_wuthx9fgc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:48.837Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183128715_wuthx9fgc","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:48.886Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183128715_wuthx9fgc","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:48.892Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183128715_wuthx9fgc","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:38:48.914Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183128715_wuthx9fgc","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:48.919Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183128715_wuthx9fgc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:48.924Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183128715_wuthx9fgc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:48.945Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183128715_wuthx9fgc","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:48.951Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183128715_wuthx9fgc","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:48.957Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183128715_wuthx9fgc","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:38:48.979Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183128715_wuthx9fgc","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:49.001Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183128715_wuthx9fgc","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:49.007Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183128715_wuthx9fgc","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:49.014Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183128715_wuthx9fgc","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:49.025Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183128715_wuthx9fgc","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:49.049Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183128715_wuthx9fgc","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:49.055Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183128715_wuthx9fgc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:49.061Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183128715_wuthx9fgc","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:49.091Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183128715_wuthx9fgc","bodySize":124056,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:49.098Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":124056,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:49.104Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":124056,"chunkSize":16384,"estimatedChunks":8}}
{"timestamp":"2025-08-26T04:38:49.110Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":124056,"expectedSize":124056}}
{"timestamp":"2025-08-26T04:38:49.116Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":124056,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:49.123Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:49.130Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:51.517Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":768,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:51.574Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183128715_wuthx9fgc","totalTime":2859,"layerTimings":{"router":100,"transformer":93,"protocol":49,"serverCompatibility":64,"server":2483,"responseTransform":25},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:51.609Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183128715_wuthx9fgc","executionId":"req_1756183128715_wuthx9fgc","totalTime":2859,"success":true}}
{"timestamp":"2025-08-26T04:38:51.728Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:51.735Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:51.740Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:51.746Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:51.751Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:51.759Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:51.766Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183131766_kmm9ybuq0","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:51.827Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:51.832Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183131766_kmm9ybuq0","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:51.837Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:51.842Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:51.848Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":28,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":29,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",29]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:51.854Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183131766_kmm9ybuq0","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:51.885Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183131766_kmm9ybuq0","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:51.946Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183131766_kmm9ybuq0","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:51.952Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183131766_kmm9ybuq0","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:38:51.977Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183131766_kmm9ybuq0","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:51.983Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183131766_kmm9ybuq0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:51.989Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183131766_kmm9ybuq0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:52.014Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183131766_kmm9ybuq0","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:38:52.020Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183131766_kmm9ybuq0","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:38:52.025Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183131766_kmm9ybuq0","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:52.031Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183131766_kmm9ybuq0","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:38:52.054Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183131766_kmm9ybuq0","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:52.079Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183131766_kmm9ybuq0","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:52.085Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183131766_kmm9ybuq0","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:52.091Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183131766_kmm9ybuq0","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:52.101Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183131766_kmm9ybuq0","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:52.127Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183131766_kmm9ybuq0","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:52.132Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183131766_kmm9ybuq0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:52.137Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183131766_kmm9ybuq0","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:52.170Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183131766_kmm9ybuq0","bodySize":157112,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:52.176Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":157112,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:52.182Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":157112,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T04:38:52.189Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":157112,"expectedSize":157112}}
{"timestamp":"2025-08-26T04:38:52.194Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":157112,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:52.201Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:52.206Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:52.507Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:52.518Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183131766_kmm9ybuq0","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"4306a655-49fb-94a7-a725-f0d27595f82c\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:52.525Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183131766_kmm9ybuq0","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:52.531Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183131766_kmm9ybuq0","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:52.538Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183131766_kmm9ybuq0","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:52.544Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183131766_kmm9ybuq0","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:38:52.550Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183131766_kmm9ybuq0","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:52.563Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183131766_kmm9ybuq0","bodySize":157112,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:52.570Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":157112,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:52.576Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":157112,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T04:38:52.581Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":157112,"expectedSize":157112}}
{"timestamp":"2025-08-26T04:38:52.587Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":157112,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:52.594Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://portal.qwen.ai/v1/chat/***","error":"socket hang up","bodySize":157112,"isLongTextRequest":true,"stack":"Error: socket hang up\n    at TLSSocket.socketOnEnd (node:_http_client:542:25)\n    at TLSSocket.emit (node:events:519:35)\n    at endReadableNT (node:internal/streams/readable:1701:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)"}}
{"timestamp":"2025-08-26T04:38:52.600Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183131766_kmm9ybuq0","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"socket hang up"}}
{"timestamp":"2025-08-26T04:38:52.607Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183131766_kmm9ybuq0","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"socket hang up"}}
{"timestamp":"2025-08-26T04:38:52.614Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183131766_kmm9ybuq0","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:52.620Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183131766_kmm9ybuq0","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:38:52.626Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183131766_kmm9ybuq0","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:52.641Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183131766_kmm9ybuq0","bodySize":157112,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:52.648Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":157112,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:52.655Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":157112,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T04:38:52.661Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":157112,"expectedSize":157112}}
{"timestamp":"2025-08-26T04:38:52.667Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":157112,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:52.909Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:52.926Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183131766_kmm9ybuq0","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"60302bcd-b3c8-9241-a49f-3e705207f946\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:52.936Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183131766_kmm9ybuq0","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:52.944Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183131766_kmm9ybuq0","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:52.951Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183131766_kmm9ybuq0","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:52.957Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183131766_kmm9ybuq0","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:38:52.964Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183131766_kmm9ybuq0","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:52.980Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183131766_kmm9ybuq0","bodySize":157112,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:52.986Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":157112,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:52.992Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":157112,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T04:38:52.998Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":157112,"expectedSize":157112}}
{"timestamp":"2025-08-26T04:38:53.003Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":157112,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:53.008Z","level":"ERROR","message":"HTTP请求失败","data":{"url":"https://portal.qwen.ai/v1/chat/***","error":"write EPIPE","bodySize":157112,"isLongTextRequest":true,"stack":"Error: write EPIPE\n    at WriteWrap.onWriteComplete [as oncomplete] (node:internal/stream_base_commons:87:19)\n    at writevGeneric (node:internal/stream_base_commons:137:26)\n    at Socket._writeGeneric (node:net:964:11)\n    at Socket._writev (node:net:973:8)\n    at doWrite (node:internal/streams/writable:594:12)\n    at clearBuffer (node:internal/streams/writable:773:5)\n    at Writable.uncork (node:internal/streams/writable:529:7)\n    at ClientRequest._flushOutput (node:_http_outgoing:1168:10)\n    at ClientRequest._flush (node:_http_outgoing:1140:22)\n    at onSocketNT (node:_http_client:921:9)"}}
{"timestamp":"2025-08-26T04:38:53.014Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183131766_kmm9ybuq0","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"write EPIPE"}}
{"timestamp":"2025-08-26T04:38:53.019Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183131766_kmm9ybuq0","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":75,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:53.024Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183131766_kmm9ybuq0","success":false,"recoveryAction":"failed","recoveryTime":75}}
{"timestamp":"2025-08-26T04:38:53.029Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183131766_kmm9ybuq0","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":422,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:53.034Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183131766_kmm9ybuq0","success":false,"recoveryAction":"failed","recoveryTime":422}}
{"timestamp":"2025-08-26T04:38:53.039Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183131766_kmm9ybuq0","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":508,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:53.044Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183131766_kmm9ybuq0","success":false,"recoveryAction":"failed","recoveryTime":508}}
{"timestamp":"2025-08-26T04:38:53.050Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183131766_kmm9ybuq0","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:53.055Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183131766_kmm9ybuq0","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:53.063Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183131766_kmm9ybuq0","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":95,"transformer":111,"protocol":59,"serverCompatibility":67},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:38:53.068Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183131766_kmm9ybuq0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:53.101Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:38:53.121Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:53.128Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:53.134Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:53.140Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:53.145Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:53.153Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:53.159Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183133159_u9my3x406","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:53.221Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:53.227Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183133159_u9my3x406","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:53.232Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:53.237Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:53.242Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":29,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":30,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",30]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:53.248Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183133159_u9my3x406","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:53.280Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183133159_u9my3x406","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:53.344Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183133159_u9my3x406","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:53.350Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183133159_u9my3x406","direction":"anthropic-to-openai","outputSize":7}}
{"timestamp":"2025-08-26T04:38:53.375Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183133159_u9my3x406","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:53.381Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183133159_u9my3x406","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:53.386Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183133159_u9my3x406","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:53.411Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183133159_u9my3x406","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:53.418Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183133159_u9my3x406","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:53.424Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183133159_u9my3x406","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:38:53.449Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183133159_u9my3x406","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:53.475Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183133159_u9my3x406","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:53.481Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183133159_u9my3x406","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:53.488Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183133159_u9my3x406","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:53.500Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183133159_u9my3x406","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:53.526Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183133159_u9my3x406","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:53.532Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183133159_u9my3x406","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:53.537Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183133159_u9my3x406","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":7}}}
{"timestamp":"2025-08-26T04:38:53.570Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183133159_u9my3x406","bodySize":157103,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:53.576Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":157103,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:53.582Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":157103,"chunkSize":16384,"estimatedChunks":10}}
{"timestamp":"2025-08-26T04:38:53.588Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":157103,"expectedSize":157103}}
{"timestamp":"2025-08-26T04:38:53.594Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":157103,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:53.600Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:53.605Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:54.602Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":383,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:54.657Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183126596_mqtdv89ls","totalTime":8061,"layerTimings":{"router":44,"transformer":57,"protocol":29,"serverCompatibility":41,"server":7828,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:54.676Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183126596_mqtdv89ls","executionId":"req_1756183126596_mqtdv89ls","totalTime":8061,"success":true}}
{"timestamp":"2025-08-26T04:38:54.690Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:54.695Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:54.701Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:54.707Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:54.712Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:54.720Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:54.727Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183134727_vlf90665m","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:54.739Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:54.745Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183134727_vlf90665m","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:54.750Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:54.755Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:54.760Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":30,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":31,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",31]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:54.765Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183134727_vlf90665m","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:54.786Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183134727_vlf90665m","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:54.819Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183134727_vlf90665m","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:54.824Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183134727_vlf90665m","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:54.838Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183134727_vlf90665m","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:54.844Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183134727_vlf90665m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:54.849Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183134727_vlf90665m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:54.863Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183134727_vlf90665m","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:54.869Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183134727_vlf90665m","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:54.874Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183134727_vlf90665m","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:38:54.887Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183134727_vlf90665m","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:54.900Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183134727_vlf90665m","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:54.905Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183134727_vlf90665m","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:54.911Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183134727_vlf90665m","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:54.921Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183134727_vlf90665m","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:54.934Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183134727_vlf90665m","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:54.940Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183134727_vlf90665m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:54.945Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183134727_vlf90665m","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:54.961Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183134727_vlf90665m","bodySize":34693,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:54.967Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":34693,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:38:54.972Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":34693,"chunkSize":16384,"estimatedChunks":3}}
{"timestamp":"2025-08-26T04:38:54.977Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":34693,"expectedSize":34693}}
{"timestamp":"2025-08-26T04:38:54.982Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":34693,"timeout":600000}}
{"timestamp":"2025-08-26T04:38:54.989Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:54.994Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:56.443Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":497,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:38:56.489Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183134727_vlf90665m","totalTime":1762,"layerTimings":{"router":45,"transformer":61,"protocol":33,"serverCompatibility":42,"server":1519,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T04:38:56.509Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183134727_vlf90665m","executionId":"req_1756183134727_vlf90665m","totalTime":1762,"success":true}}
{"timestamp":"2025-08-26T04:38:56.522Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:56.529Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:56.535Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:56.541Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:56.548Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:56.557Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:56.565Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183136565_0r463un8a","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:56.582Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:56.588Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183136565_0r463un8a","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:56.595Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:56.602Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:56.609Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":31,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":32,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",32]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:56.615Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183136565_0r463un8a","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:56.640Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183136565_0r463un8a","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:56.678Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183136565_0r463un8a","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:56.684Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183136565_0r463un8a","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:56.700Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183136565_0r463un8a","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:56.707Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183136565_0r463un8a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:56.714Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183136565_0r463un8a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:56.731Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183136565_0r463un8a","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:38:56.738Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183136565_0r463un8a","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:38:56.744Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183136565_0r463un8a","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:56.750Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183136565_0r463un8a","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:38:56.766Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183136565_0r463un8a","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:56.781Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183136565_0r463un8a","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:56.788Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183136565_0r463un8a","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:56.796Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183136565_0r463un8a","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:56.807Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183136565_0r463un8a","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:56.824Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183136565_0r463un8a","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:56.831Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183136565_0r463un8a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:56.838Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183136565_0r463un8a","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:56.857Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":7542,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:38:56.867Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:56.874Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:38:57.034Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:38:57.044Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183136565_0r463un8a","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"d567e216-0913-9ef3-8f98-6a3c13cdeb27\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.050Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183136565_0r463un8a","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.055Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183136565_0r463un8a","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.061Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183136565_0r463un8a","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:57.067Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183136565_0r463un8a","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:38:57.073Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183136565_0r463un8a","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:57.082Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":7542,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:38:57.206Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:38:57.216Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183136565_0r463un8a","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"a09338ad-bf6b-9559-8e2e-65e3c8ab8dac\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.223Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183136565_0r463un8a","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.229Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183136565_0r463un8a","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.235Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183136565_0r463un8a","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:57.241Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183136565_0r463un8a","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:38:57.247Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183136565_0r463un8a","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:57.255Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":7542,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:38:57.354Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:38:57.371Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183136565_0r463un8a","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"1b09e180-5b00-9310-96a6-3a38766d40fc\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.380Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183136565_0r463un8a","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.387Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183136565_0r463un8a","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.394Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183136565_0r463un8a","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:38:57.400Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183136565_0r463un8a","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:38:57.407Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183136565_0r463un8a","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:38:57.416Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":7542,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T04:38:57.503Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:38:57.519Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183136565_0r463un8a","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"3e9a777e-213a-94d1-bc8f-c7d20f06dfc3\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.527Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183136565_0r463un8a","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.534Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183136565_0r463un8a","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":147,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:57.542Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183136565_0r463un8a","success":false,"recoveryAction":"failed","recoveryTime":147}}
{"timestamp":"2025-08-26T04:38:57.548Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183136565_0r463un8a","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":319,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:57.555Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183136565_0r463un8a","success":false,"recoveryAction":"failed","recoveryTime":319}}
{"timestamp":"2025-08-26T04:38:57.561Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183136565_0r463un8a","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":506,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:38:57.567Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183136565_0r463un8a","success":false,"recoveryAction":"failed","recoveryTime":506}}
{"timestamp":"2025-08-26T04:38:57.573Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183136565_0r463un8a","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:57.579Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183136565_0r463un8a","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:38:57.587Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183136565_0r463un8a","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":59,"transformer":69,"protocol":45,"serverCompatibility":52},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:38:57.592Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183136565_0r463un8a","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:38:57.605Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:38:57.618Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:38:57.623Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:57.629Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:38:57.634Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:38:57.639Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:38:57.648Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:38:57.654Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183137654_y13zala2u","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:38:57.666Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:57.671Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183137654_y13zala2u","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:38:57.676Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:38:57.681Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:38:57.686Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":32,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":33,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",33]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:38:57.692Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183137654_y13zala2u","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:38:57.711Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183137654_y13zala2u","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:38:57.744Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183137654_y13zala2u","hasOutput":true}}
{"timestamp":"2025-08-26T04:38:57.749Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183137654_y13zala2u","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:38:57.762Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183137654_y13zala2u","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:57.767Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183137654_y13zala2u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:57.773Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183137654_y13zala2u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:57.785Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183137654_y13zala2u","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:38:57.791Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183137654_y13zala2u","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:38:57.796Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183137654_y13zala2u","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:38:57.809Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183137654_y13zala2u","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:38:57.821Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183137654_y13zala2u","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:38:57.826Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183137654_y13zala2u","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:38:57.832Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183137654_y13zala2u","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:38:57.843Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183137654_y13zala2u","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:38:57.855Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183137654_y13zala2u","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:38:57.860Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183137654_y13zala2u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:57.865Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183137654_y13zala2u","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:38:57.881Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":2899,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T04:38:57.888Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:38:57.893Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:39:00.709Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":367,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T04:39:00.761Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183137654_y13zala2u","totalTime":3107,"layerTimings":{"router":45,"transformer":58,"protocol":31,"serverCompatibility":41,"server":2870,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T04:39:00.777Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183137654_y13zala2u","executionId":"req_1756183137654_y13zala2u","totalTime":3107,"success":true}}
{"timestamp":"2025-08-26T04:39:00.792Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:39:00.798Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:39:00.803Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:39:00.809Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:39:00.814Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:39:00.823Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:39:00.829Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183140829_tphr32zi4","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:39:00.843Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:39:00.848Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183140829_tphr32zi4","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:39:00.853Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:39:00.858Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:39:00.864Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":33,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":34,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",34]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:39:00.869Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183140829_tphr32zi4","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:39:00.888Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183140829_tphr32zi4","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:39:00.923Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183140829_tphr32zi4","hasOutput":true}}
{"timestamp":"2025-08-26T04:39:00.929Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183140829_tphr32zi4","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:39:00.942Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183140829_tphr32zi4","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:39:00.947Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183140829_tphr32zi4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:00.952Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183140829_tphr32zi4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:00.965Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183140829_tphr32zi4","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:39:00.970Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183140829_tphr32zi4","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:39:00.975Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183140829_tphr32zi4","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T04:39:00.987Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183140829_tphr32zi4","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:39:01.000Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183140829_tphr32zi4","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:39:01.005Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183140829_tphr32zi4","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:39:01.011Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183140829_tphr32zi4","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:39:01.021Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183140829_tphr32zi4","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:39:01.035Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183140829_tphr32zi4","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:39:01.040Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183140829_tphr32zi4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:01.046Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183140829_tphr32zi4","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:01.063Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183140829_tphr32zi4","bodySize":40529,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:39:01.068Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":40529,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:39:01.073Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":40529,"chunkSize":16384,"estimatedChunks":3}}
{"timestamp":"2025-08-26T04:39:01.078Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":40529,"expectedSize":40529}}
{"timestamp":"2025-08-26T04:39:01.083Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","bodySize":40529,"timeout":600000}}
{"timestamp":"2025-08-26T04:39:01.089Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:39:01.094Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:39:03.835Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":510,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:39:03.884Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183140829_tphr32zi4","totalTime":3055,"layerTimings":{"router":46,"transformer":62,"protocol":30,"serverCompatibility":42,"server":2813,"responseTransform":20},"transformationCount":4}}
{"timestamp":"2025-08-26T04:39:03.905Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183140829_tphr32zi4","executionId":"req_1756183140829_tphr32zi4","totalTime":3055,"success":true}}
{"timestamp":"2025-08-26T04:39:03.919Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:39:03.925Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:39:03.931Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:39:03.936Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:39:03.941Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:39:03.950Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:39:03.956Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183143956_yuz4oy1zh","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:39:03.968Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:39:03.979Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183143956_yuz4oy1zh","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:39:03.984Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:39:03.990Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:39:03.996Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":34,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":35,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",35]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:39:04.002Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183143956_yuz4oy1zh","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:39:04.023Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183143956_yuz4oy1zh","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:39:04.062Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183143956_yuz4oy1zh","hasOutput":true}}
{"timestamp":"2025-08-26T04:39:04.068Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183143956_yuz4oy1zh","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:39:04.083Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183143956_yuz4oy1zh","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:39:04.089Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183143956_yuz4oy1zh","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:04.094Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183143956_yuz4oy1zh","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:04.107Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183143956_yuz4oy1zh","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T04:39:04.113Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756183143956_yuz4oy1zh","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T04:39:04.118Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183143956_yuz4oy1zh","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:39:04.124Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183143956_yuz4oy1zh","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T04:39:04.136Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183143956_yuz4oy1zh","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:39:04.149Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183143956_yuz4oy1zh","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:39:04.155Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183143956_yuz4oy1zh","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:39:04.161Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183143956_yuz4oy1zh","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:39:04.172Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183143956_yuz4oy1zh","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:39:04.185Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183143956_yuz4oy1zh","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:39:04.191Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183143956_yuz4oy1zh","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:04.196Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183143956_yuz4oy1zh","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:04.213Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183143956_yuz4oy1zh","bodySize":25117,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:39:04.218Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25117,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:39:04.224Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25117,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:39:04.229Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25117,"expectedSize":25117}}
{"timestamp":"2025-08-26T04:39:04.234Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25117,"timeout":600000}}
{"timestamp":"2025-08-26T04:39:04.240Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:39:04.245Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:39:04.611Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:39:04.628Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183143956_yuz4oy1zh","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"350849a6-bf8f-9cd3-a048-b8cb97e93be1\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:04.636Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756183143956_yuz4oy1zh","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:04.644Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183143956_yuz4oy1zh","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:04.653Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183143956_yuz4oy1zh","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:39:04.661Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183143956_yuz4oy1zh","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T04:39:04.667Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183143956_yuz4oy1zh","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:39:04.677Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183143956_yuz4oy1zh","bodySize":25117,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:39:04.683Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25117,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:39:04.689Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25117,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:39:04.695Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25117,"expectedSize":25117}}
{"timestamp":"2025-08-26T04:39:04.701Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25117,"timeout":600000}}
{"timestamp":"2025-08-26T04:39:04.853Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:39:04.868Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183143956_yuz4oy1zh","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"0f58ef79-3fb8-9155-b3b1-fe32ce2128cb\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:04.876Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183143956_yuz4oy1zh","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:04.884Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183143956_yuz4oy1zh","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:04.892Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183143956_yuz4oy1zh","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:39:04.900Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183143956_yuz4oy1zh","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T04:39:04.906Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183143956_yuz4oy1zh","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:39:04.916Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183143956_yuz4oy1zh","bodySize":25117,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:39:04.922Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25117,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:39:04.927Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25117,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:39:04.933Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25117,"expectedSize":25117}}
{"timestamp":"2025-08-26T04:39:04.938Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25117,"timeout":600000}}
{"timestamp":"2025-08-26T04:39:05.084Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:39:05.103Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183143956_yuz4oy1zh","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"54c7e21c-8167-9bfe-b761-5e4adeddf04b\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:05.113Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183143956_yuz4oy1zh","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:05.122Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756183143956_yuz4oy1zh","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:05.130Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756183143956_yuz4oy1zh","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T04:39:05.137Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756183143956_yuz4oy1zh","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T04:39:05.143Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756183143956_yuz4oy1zh","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T04:39:05.153Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183143956_yuz4oy1zh","bodySize":25117,"originalTimeout":120000,"adjustedTimeout":600000,"endpoint":"https://portal.qwen.ai/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:39:05.160Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":25117,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:39:05.166Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":25117,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:39:05.172Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":25117,"expectedSize":25117}}
{"timestamp":"2025-08-26T04:39:05.178Z","level":"INFO","message":"长文本请求已发送","data":{"url":"https://portal.qwen.ai/v1/chat/***","bodySize":25117,"timeout":600000}}
{"timestamp":"2025-08-26T04:39:05.287Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:39:05.301Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756183143956_yuz4oy1zh","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"867c508b-8328-9030-95d0-6f6292a4e70f\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:05.310Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756183143956_yuz4oy1zh","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:05.318Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183143956_yuz4oy1zh","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":196,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:39:05.324Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183143956_yuz4oy1zh","success":false,"recoveryAction":"failed","recoveryTime":196}}
{"timestamp":"2025-08-26T04:39:05.331Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183143956_yuz4oy1zh","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":447,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:39:05.337Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183143956_yuz4oy1zh","success":false,"recoveryAction":"failed","recoveryTime":447}}
{"timestamp":"2025-08-26T04:39:05.343Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756183143956_yuz4oy1zh","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":699,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T04:39:05.349Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756183143956_yuz4oy1zh","success":false,"recoveryAction":"failed","recoveryTime":699}}
{"timestamp":"2025-08-26T04:39:05.355Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756183143956_yuz4oy1zh","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:39:05.361Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756183143956_yuz4oy1zh","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T04:39:05.370Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756183143956_yuz4oy1zh","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":54,"transformer":68,"protocol":37,"serverCompatibility":44},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T04:39:05.376Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756183143956_yuz4oy1zh","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T04:39:05.392Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{"timestamp":"2025-08-26T04:39:05.405Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages?beta=true","hasBody":true}}
{"timestamp":"2025-08-26T04:39:05.411Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:39:05.416Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T04:39:05.422Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T04:39:05.428Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T04:39:05.438Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T04:39:05.445Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756183145445_e2lhk43kd","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T04:39:05.460Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-5-haiku-20241022","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:39:05.466Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756183145445_e2lhk43kd","inputModel":"claude-3-5-haiku-20241022","mappedModel":"default"}}
{"timestamp":"2025-08-26T04:39:05.471Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T04:39:05.477Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T04:39:05.482Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":35,"selectedIndex":2,"selectedPipeline":"shuaihong-glm-4.5-key0","totalPipelines":3,"position":"3/3","nextIndex":36,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",36]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T04:39:05.488Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756183145445_e2lhk43kd","selectedPipeline":"shuaihong-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T04:39:05.508Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756183145445_e2lhk43kd","providerType":"shuaihong","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T04:39:05.546Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756183145445_e2lhk43kd","hasOutput":true}}
{"timestamp":"2025-08-26T04:39:05.551Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756183145445_e2lhk43kd","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T04:39:05.565Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183145445_e2lhk43kd","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:39:05.570Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183145445_e2lhk43kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:05.576Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756183145445_e2lhk43kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:05.589Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756183145445_e2lhk43kd","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:39:05.595Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756183145445_e2lhk43kd","selectedPipelineId":"shuaihong-glm-4.5-key0","providerType":"shuaihong","finalEndpoint":"http://ai.shuaihong.xyz:3939/v1","matchingProviderUrl":"http://ai.shuaihong.xyz:3939/v1","providerInfoEndpoint":"https://ai.shuaihong.fun/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T04:39:05.602Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756183145445_e2lhk43kd","selectedPipeline":"shuaihong-glm-4.5-key0","selectedProvider":"shuaihong","originalModel":"claude-3-5-haiku-20241022","virtualModel":"default","actualModel":"glm-4.5","routeUsed":"shuaihong,glm-4.5"}}
{"timestamp":"2025-08-26T04:39:05.615Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756183145445_e2lhk43kd","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T04:39:05.629Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756183145445_e2lhk43kd","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T04:39:05.635Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756183145445_e2lhk43kd","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T04:39:05.642Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756183145445_e2lhk43kd","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T04:39:05.653Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756183145445_e2lhk43kd","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T04:39:05.668Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756183145445_e2lhk43kd","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T04:39:05.674Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756183145445_e2lhk43kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:05.681Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756183145445_e2lhk43kd","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T04:39:05.698Z","level":"INFO","message":"检测到大型请求，启用长文本处理模式","data":{"requestId":"req_1756183145445_e2lhk43kd","bodySize":16996,"originalTimeout":30000,"adjustedTimeout":600000,"endpoint":"http://ai.shuaihong.xyz:3939/v1/chat/completions"}}
{"timestamp":"2025-08-26T04:39:05.704Z","level":"INFO","message":"发起HTTP请求","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","method":"POST","bodySize":16996,"isLongTextRequest":true,"timeout":600000,"specialHandling":"chunked_transfer_with_extended_timeout","expectedDuration":"up_to_10_minutes"}}
{"timestamp":"2025-08-26T04:39:05.710Z","level":"INFO","message":"开始分块写入大型请求体","data":{"totalSize":16996,"chunkSize":16384,"estimatedChunks":2}}
{"timestamp":"2025-08-26T04:39:05.716Z","level":"INFO","message":"大型请求体写入完成","data":{"totalWritten":16996,"expectedSize":16996}}
{"timestamp":"2025-08-26T04:39:05.721Z","level":"INFO","message":"长文本请求已发送","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","bodySize":16996,"timeout":600000}}
{"timestamp":"2025-08-26T04:39:05.729Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T04:39:05.735Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T04:39:06.926Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":1924,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:39:06.985Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183133159_u9my3x406","totalTime":13826,"layerTimings":{"router":97,"transformer":114,"protocol":57,"serverCompatibility":71,"server":13420,"responseTransform":23},"transformationCount":4}}
{"timestamp":"2025-08-26T04:39:07.025Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183133159_u9my3x406","executionId":"req_1756183133159_u9my3x406","totalTime":13826,"success":true}}
{"timestamp":"2025-08-26T04:39:07.291Z","level":"INFO","message":"HTTP请求完成","data":{"url":"http://ai.shuaihong.xyz:3939/v1/chat/***","statusCode":200,"responseSize":376,"isLongTextRequest":true}}
{"timestamp":"2025-08-26T04:39:07.340Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756183145445_e2lhk43kd","totalTime":1895,"layerTimings":{"router":49,"transformer":65,"protocol":34,"serverCompatibility":47,"server":1633,"responseTransform":21},"transformationCount":4}}
{"timestamp":"2025-08-26T04:39:07.357Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756183145445_e2lhk43kd","executionId":"req_1756183145445_e2lhk43kd","totalTime":1895,"success":true}}
{"timestamp":"2025-08-26T05:24:35.755Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages","hasBody":true}}
{"timestamp":"2025-08-26T05:24:35.762Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T05:24:35.769Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T05:24:35.776Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T05:24:35.782Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T05:24:35.792Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T05:24:35.800Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756185875800_gwnixmjff","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T05:24:35.815Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-3-haiku-20240307","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T05:24:35.821Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756185875800_gwnixmjff","inputModel":"claude-3-haiku-20240307","mappedModel":"default"}}
{"timestamp":"2025-08-26T05:24:35.828Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T05:24:35.835Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T05:24:35.841Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":36,"selectedIndex":0,"selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","totalPipelines":3,"position":"1/3","nextIndex":37,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",37]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T05:24:35.848Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756185875800_gwnixmjff","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T05:24:35.869Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756185875800_gwnixmjff","providerType":"modelscope","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T05:24:35.904Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756185875800_gwnixmjff","hasOutput":true}}
{"timestamp":"2025-08-26T05:24:35.910Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756185875800_gwnixmjff","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T05:24:35.922Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756185875800_gwnixmjff","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T05:24:35.928Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756185875800_gwnixmjff","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T05:24:35.933Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756185875800_gwnixmjff","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T05:24:35.946Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756185875800_gwnixmjff","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","hasSystemProviderInfo":true,"systemProviderInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions"}}
{"timestamp":"2025-08-26T05:24:35.952Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756185875800_gwnixmjff","selectedPipelineId":"modelscope-zhipuai-glm-4.5-key0","providerType":"modelscope","finalEndpoint":"https://api-inference.modelscope.cn/v1","matchingProviderUrl":"https://api-inference.modelscope.cn/v1","providerInfoEndpoint":"https://api-inference.modelscope.cn/v1/chat/completions","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T05:24:35.958Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756185875800_gwnixmjff","selectedPipeline":"modelscope-zhipuai-glm-4.5-key0","selectedProvider":"modelscope","originalModel":"claude-3-haiku-20240307","virtualModel":"default","actualModel":"ZhipuAI/GLM-4.5","routeUsed":"modelscope,ZhipuAI/GLM-4.5"}}
{"timestamp":"2025-08-26T05:24:35.970Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756185875800_gwnixmjff","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T05:24:35.982Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756185875800_gwnixmjff","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T05:24:35.987Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756185875800_gwnixmjff","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T05:24:35.994Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756185875800_gwnixmjff","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T05:24:36.004Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756185875800_gwnixmjff","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T05:24:36.017Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756185875800_gwnixmjff","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T05:24:36.022Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756185875800_gwnixmjff","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T05:24:36.028Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756185875800_gwnixmjff","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T05:24:36.043Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","method":"POST","bodySize":171,"isLongTextRequest":false,"timeout":30000}}
{"timestamp":"2025-08-26T05:24:36.050Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T05:24:36.055Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T05:24:38.981Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://api-inference.modelscope.cn/v1/chat/***","statusCode":200,"responseSize":625,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T05:24:39.045Z","level":"INFO","message":"Request processing completed successfully","data":{"requestId":"req_1756185875800_gwnixmjff","totalTime":3245,"layerTimings":{"router":56,"transformer":60,"protocol":31,"serverCompatibility":42,"server":2994,"responseTransform":18},"transformationCount":4}}
{"timestamp":"2025-08-26T05:24:39.061Z","level":"INFO","message":"流水线处理完成","data":{"requestId":"req_1756185875800_gwnixmjff","executionId":"req_1756185875800_gwnixmjff","totalTime":3245,"success":true}}
{"timestamp":"2025-08-26T05:24:58.273Z","level":"INFO","message":"接收到messages请求","data":{"method":"POST","url":"/v1/messages","hasBody":true}}
{"timestamp":"2025-08-26T05:24:58.279Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T05:24:58.286Z","level":"INFO","message":"通过流水线处理请求","data":{"protocol":"anthropic","hasInput":true,"router":true}}
{"timestamp":"2025-08-26T05:24:58.292Z","level":"INFO","message":"🚀 智能流水线切换系统已初始化","data":{"maxRetries":3,"blacklistThreshold":5,"enableAggressiveRecovery":true}}
{"timestamp":"2025-08-26T05:24:58.299Z","level":"INFO","message":"Decoupled execution management disabled, using legacy pipeline switching"}
{"timestamp":"2025-08-26T05:24:58.310Z","level":"INFO","message":"Console日志捕获已启用","data":{"port":5506,"module":"console-capture"}}
{"timestamp":"2025-08-26T05:24:58.317Z","level":"INFO","message":"Starting pipeline request processing","data":{"requestId":"req_1756185898317_c882tker2","protocol":"anthropic","hasInput":true,"executionContext":"[CONTEXT_PRESENT]"}}
{"timestamp":"2025-08-26T05:24:58.332Z","level":"INFO","message":"Virtual model mapping completed","data":{"inputModel":"claude-sonnet-4-20250514","virtualModel":"default","priority":99,"tokenCount":"[REDACTED]"}}
{"timestamp":"2025-08-26T05:24:58.338Z","level":"INFO","message":"Model mapping completed","data":{"requestId":"req_1756185898317_c882tker2","inputModel":"claude-sonnet-4-20250514","mappedModel":"default"}}
{"timestamp":"2025-08-26T05:24:58.344Z","level":"INFO","message":"🔧 解析路由配置","data":{"mappedModel":"default","routeEntry":"qwen,qwen3-coder-plus;shuaihong,glm-4.5;modelscope,ZhipuAI/GLM-4.5","allRoutes":["qwen,qwen3-coder-plus","shuaihong,glm-4.5","modelscope,ZhipuAI/GLM-4.5"]}}
{"timestamp":"2025-08-26T05:24:58.351Z","level":"INFO","message":"🔧 Pipeline生成完成","data":{"mappedModel":"default","generatedPipelines":["qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0","modelscope-zhipuai-glm-4.5-key0"],"totalCount":3}}
{"timestamp":"2025-08-26T05:24:58.358Z","level":"INFO","message":"🔄 Round Robin负载均衡选择","data":{"routeKey":"[REDACTED]","currentIndex":37,"selectedIndex":1,"selectedPipeline":"qwen-qwen3-coder-plus-key0","totalPipelines":3,"position":"2/3","nextIndex":38,"allCounters":[["modelscope-zhipuai-glm-4.5-key0,qwen-qwen3-coder-plus-key0,shuaihong-glm-4.5-key0",38]],"sortedPipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"]}}
{"timestamp":"2025-08-26T05:24:58.365Z","level":"INFO","message":"Round-robin load balancer selected pipeline","data":{"requestId":"req_1756185898317_c882tker2","selectedPipeline":"qwen-qwen3-coder-plus-key0","availablePipelines":["modelscope-zhipuai-glm-4.5-key0","qwen-qwen3-coder-plus-key0","shuaihong-glm-4.5-key0"],"totalAvailable":3}}
{"timestamp":"2025-08-26T05:24:58.386Z","level":"INFO","message":"Transformer layer processing","data":{"requestId":"req_1756185898317_c882tker2","providerType":"qwen","providerProtocol":"openai","hasInput":true}}
{"timestamp":"2025-08-26T05:24:58.424Z","level":"INFO","message":"Anthropic-to-OpenAI transformation completed","data":{"requestId":"req_1756185898317_c882tker2","hasOutput":true}}
{"timestamp":"2025-08-26T05:24:58.430Z","level":"INFO","message":"Transformer layer completed","data":{"requestId":"req_1756185898317_c882tker2","direction":"anthropic-to-openai","outputSize":6}}
{"timestamp":"2025-08-26T05:24:58.444Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756185898317_c882tker2","step":"transformer-to-protocol","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T05:24:58.450Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756185898317_c882tker2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T05:24:58.456Z","level":"INFO","message":"✅ [Pipeline] Transformer输出验证通过","data":{"requestId":"req_1756185898317_c882tker2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T05:24:58.469Z","level":"INFO","message":"🔍 端点解析调试","data":{"requestId":"req_1756185898317_c882tker2","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","hasSystemProviderInfo":false}}
{"timestamp":"2025-08-26T05:24:58.475Z","level":"INFO","message":"🔧 创建动态provider配置","data":{"requestId":"req_1756185898317_c882tker2","providerType":"qwen","matchingProviderName":"qwen","matchingProviderUrl":"https://portal.qwen.ai/v1"}}
{"timestamp":"2025-08-26T05:24:58.480Z","level":"INFO","message":"🔥 端点解析结果","data":{"requestId":"req_1756185898317_c882tker2","selectedPipelineId":"qwen-qwen3-coder-plus-key0","providerType":"qwen","finalEndpoint":"https://portal.qwen.ai/v1","matchingProviderUrl":"https://portal.qwen.ai/v1","providerInfoEndpoint":"https://portal.qwen.ai/v1","resolutionPath":"user-config"}}
{"timestamp":"2025-08-26T05:24:58.486Z","level":"INFO","message":"Protocol layer model mapping","data":{"requestId":"req_1756185898317_c882tker2","selectedPipeline":"qwen-qwen3-coder-plus-key0","selectedProvider":"qwen","originalModel":"claude-sonnet-4-20250514","virtualModel":"default","actualModel":"qwen3-coder-plus","routeUsed":"qwen,qwen3-coder-plus"}}
{"timestamp":"2025-08-26T05:24:58.498Z","level":"INFO","message":"✅ [Pipeline] Protocol输出验证通过（非Anthropic格式）","data":{"requestId":"req_1756185898317_c882tker2","hasModel":true,"hasMessages":true,"isOpenAIFormat":true}}
{"timestamp":"2025-08-26T05:24:58.511Z","level":"INFO","message":"🔧 使用新统一配置的serverCompatibility","data":{"requestId":"req_1756185898317_c882tker2","providerType":"modelscope","compatibilityTag":"passthrough","hasOptions":true,"architecture":"unified-format"}}
{"timestamp":"2025-08-26T05:24:58.516Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 检查原始context的protocolConfig","data":{"requestId":"req_1756185898317_c882tker2","hasOriginalMetadata":true,"hasOriginalProtocolConfig":true,"originalProtocolConfigKeys":"[REDACTED]","hasOriginalCustomHeaders":false,"originalCustomHeadersKeys":"[REDACTED]"}}
{"timestamp":"2025-08-26T05:24:58.523Z","level":"INFO","message":"兼容性模块加载成功","data":{"requestId":"req_1756185898317_c882tker2","compatibilityTag":"passthrough","moduleType":"object"}}
{"timestamp":"2025-08-26T05:24:58.535Z","level":"INFO","message":"🔥🔥 [COMPATIBILITY-CONTEXT-FIX] 复制protocolConfig回原始context","data":{"requestId":"req_1756185898317_c882tker2","hasCustomHeaders":false,"customHeadersKeys":"[REDACTED]","contextSynchronized":true}}
{"timestamp":"2025-08-26T05:24:58.548Z","level":"INFO","message":"🔍 [格式验证] Transformer → Protocol 验证开始","data":{"requestId":"req_1756185898317_c882tker2","step":"compatibility-to-server","dataType":"object","validatorId":"protocol-transformer-validator"}}
{"timestamp":"2025-08-26T05:24:58.553Z","level":"INFO","message":"✅ [格式验证] Transformer → Protocol 验证通过","data":{"requestId":"req_1756185898317_c882tker2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T05:24:58.559Z","level":"INFO","message":"✅ [Pipeline] ServerCompatibility输出验证通过","data":{"requestId":"req_1756185898317_c882tker2","format":"openai-request","summary":{"hasRequiredFields":true,"hasValidStructure":true,"hasValidToolCalls":true,"fieldCount":6}}}
{"timestamp":"2025-08-26T05:24:58.574Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":174,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T05:24:58.581Z","level":"INFO","message":"Loaded blacklist persistence data","data":{"counters":0,"blocks":0,"file":"/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/data/pipeline-blacklist.json"}}
{"timestamp":"2025-08-26T05:24:58.587Z","level":"INFO","message":"Precise pipeline blacklist manager initialized","data":{"enabled":true,"destroyRulesCount":3,"enabledDestroyRules":0,"activeCounters":0,"temporaryBlocks":0}}
{"timestamp":"2025-08-26T05:24:58.720Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T05:24:58.736Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756185898317_c882tker2","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"635dd51b-6671-9da7-b178-60a5c798c47e\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:58.745Z","level":"ERROR","message":"🔥 Server层发生错误，启动智能流水线切换恢复","data":{"requestId":"req_1756185898317_c882tker2","pipelineId":"qwen-qwen3-coder-plus-key0","errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:58.752Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756185898317_c882tker2","failedPipelineId":"qwen-qwen3-coder-plus-key0","retryCount":0,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:58.758Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756185898317_c882tker2","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T05:24:58.765Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756185898317_c882tker2","fromPipeline":"qwen-qwen3-coder-plus-key0","toPipeline":"modelscope-zhipuai-glm-4.5-key0","retryCount":1}}
{"timestamp":"2025-08-26T05:24:58.771Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756185898317_c882tker2","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T05:24:58.779Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":174,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T05:24:58.862Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T05:24:58.873Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756185898317_c882tker2","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"c72ccc38-d90f-9d6c-b309-d57f64a41932\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:58.880Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756185898317_c882tker2","newPipelineId":"modelscope-zhipuai-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:58.887Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756185898317_c882tker2","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","retryCount":1,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:58.893Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756185898317_c882tker2","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T05:24:58.899Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756185898317_c882tker2","fromPipeline":"modelscope-zhipuai-glm-4.5-key0","toPipeline":"shuaihong-glm-4.5-key0","retryCount":2}}
{"timestamp":"2025-08-26T05:24:58.905Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756185898317_c882tker2","newPipelineId":"shuaihong-glm-4.5-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T05:24:58.914Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":174,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T05:24:58.996Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T05:24:59.008Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756185898317_c882tker2","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"b44977d1-65d7-94fd-9229-908e8ab48e9e\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:59.016Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756185898317_c882tker2","newPipelineId":"shuaihong-glm-4.5-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:59.023Z","level":"INFO","message":"🔄 开始流水线错误恢复","data":{"requestId":"req_1756185898317_c882tker2","failedPipelineId":"shuaihong-glm-4.5-key0","retryCount":2,"errorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:59.031Z","level":"INFO","message":"🎯 错误分类完成","data":{"requestId":"req_1756185898317_c882tker2","recoverability":"recoverable","matchedRule":"default","confidence":0.1}}
{"timestamp":"2025-08-26T05:24:59.038Z","level":"INFO","message":"🔀 切换流水线重试","data":{"requestId":"req_1756185898317_c882tker2","fromPipeline":"shuaihong-glm-4.5-key0","toPipeline":"qwen-qwen3-coder-plus-key0","retryCount":3}}
{"timestamp":"2025-08-26T05:24:59.044Z","level":"INFO","message":"🔄 使用新流水线重新执行Server层请求","data":{"requestId":"req_1756185898317_c882tker2","newPipelineId":"qwen-qwen3-coder-plus-key0","previousPipelineId":"qwen-qwen3-coder-plus-key0"}}
{"timestamp":"2025-08-26T05:24:59.052Z","level":"INFO","message":"发起HTTP请求","data":{"url":"https://portal.qwen.ai/v1/chat/***","method":"POST","bodySize":174,"isLongTextRequest":false,"timeout":120000}}
{"timestamp":"2025-08-26T05:24:59.141Z","level":"INFO","message":"HTTP请求完成","data":{"url":"https://portal.qwen.ai/v1/chat/***","statusCode":401,"responseSize":182,"isLongTextRequest":false}}
{"timestamp":"2025-08-26T05:24:59.153Z","level":"ERROR","message":"Client error detected","data":{"requestId":"req_1756185898317_c882tker2","status":401,"endpoint":"https://portal.qwen.ai/v1/chat/completions","responsePreview":"{\"error\":{\"code\":\"invalid_api_key\",\"message\":\"invalid access token or token expired\",\"param\":null,\"type\":\"invalid_request_error\"},\"request_id\":\"a6e6ddef-0325-9537-a559-cfaee269d16f\"}","extractedErrorMessage":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:59.159Z","level":"ERROR","message":"❌ 流水线切换失败","data":{"requestId":"req_1756185898317_c882tker2","newPipelineId":"qwen-qwen3-coder-plus-key0","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:59.166Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756185898317_c882tker2","failedPipelineId":"shuaihong-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":143,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T05:24:59.173Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756185898317_c882tker2","success":false,"recoveryAction":"failed","recoveryTime":143}}
{"timestamp":"2025-08-26T05:24:59.179Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756185898317_c882tker2","failedPipelineId":"modelscope-zhipuai-glm-4.5-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":292,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T05:24:59.185Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756185898317_c882tker2","success":false,"recoveryAction":"failed","recoveryTime":292}}
{"timestamp":"2025-08-26T05:24:59.192Z","level":"INFO","message":"🔄 流水线恢复事件","data":{"requestId":"req_1756185898317_c882tker2","failedPipelineId":"qwen-qwen3-coder-plus-key0","result":{"success":false,"recoveryAction":"failed","recoveryTime":440,"details":"所有流水线切换尝试均失败"},"errorClassification":{"recoverability":"recoverable","matchedRule":{"name":"default","recoverability":"recoverable","priority":999,"description":"默认分类规则"},"confidence":0.1,"reason":"未匹配任何具体规则，使用默认可恢复分类"}}}
{"timestamp":"2025-08-26T05:24:59.198Z","level":"INFO","message":"✅ 流水线恢复完成","data":{"requestId":"req_1756185898317_c882tker2","success":false,"recoveryAction":"failed","recoveryTime":440}}
{"timestamp":"2025-08-26T05:24:59.203Z","level":"ERROR","message":"❌ 流水线切换恢复失败","data":{"requestId":"req_1756185898317_c882tker2","failedPipeline":"qwen-qwen3-coder-plus-key0","recoveryAction":"failed","details":"所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T05:24:59.208Z","level":"ERROR","message":"❌ 流水线切换系统执行失败","data":{"requestId":"req_1756185898317_c882tker2","pipelineId":"qwen-qwen3-coder-plus-key0","originalError":"invalid access token or token expired","recoveryError":"流水线切换恢复失败: 所有流水线切换尝试均失败"}}
{"timestamp":"2025-08-26T05:24:59.217Z","level":"ERROR","message":"Request processing failed","data":{"requestId":"req_1756185898317_c882tker2","error":"invalid access token or token expired","stack":"Error: invalid access token or token expired\n    at HttpRequestHandler.checkResponseStatusAndThrow (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/http-request-handler.js:89:19)\n    at PipelineLayersProcessor.processServerLayer (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/modules/pipeline-layers.js:339:33)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:321:28)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)","layerTimings":{"router":55,"transformer":65,"protocol":37,"serverCompatibility":44},"errors":[{"layer":"pipeline","error":"invalid access token or token expired","timestamp":{}}]}}
{"timestamp":"2025-08-26T05:24:59.223Z","level":"WARN","message":"Request failed","data":{"requestId":"req_1756185898317_c882tker2","error":"invalid access token or token expired"}}
{"timestamp":"2025-08-26T05:24:59.236Z","level":"ERROR","message":"流水线处理失败","data":{"protocol":"anthropic","error":"Pipeline request processing failed: invalid access token or token expired","stack":"Error: Pipeline request processing failed: invalid access token or token expired\n    at PipelineRequestProcessor.processRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-request-processor.js:485:19)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async PipelineServerManager.processRequestThroughPipeline (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:516:28)\n    at async PipelineServerManager.handleAnthropicMessages (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:469:28)\n    at async Object.handler (/opt/homebrew/lib/node_modules/route-claude-code/dist/pipeline/pipeline-server-manager.js:329:13)\n    at async HTTPServer.executeRoute (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:373:9)\n    at async HTTPServer.handleRequest (/opt/homebrew/lib/node_modules/route-claude-code/dist/server/http-server.js:236:13)"}}
{
	"timestamp": "2025-08-26T08:06:58.228Z",
	"port": 5506,
	"requestId": "sim_1756195618228_ld40tr3xo",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Hello, how are you?"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.239Z",
	"port": 5506,
	"requestId": "sim_1756195618228_ld40tr3xo",
	"output": {
		"id": "msg_sim_1756195618228_ld40tr3xo",
		"type": "message",
		"role": "assistant",
		"content": [
			{
				"type": "text",
				"text": "This is a mock response for your request with model claude-3-sonnet-20240229. Your message was: \"Hello, how are you?\""
			}
		],
		"model": "claude-3-sonnet-20240229",
		"stop_reason": "end_turn",
		"usage": {
			"input_tokens": 13,
			"output_tokens": 50
		}
	},
	"processingTime": 11,
	"validation": {
		"inputValidation": {
			"success": true,
			"processingTime": 1.1
		},
		"outputValidation": {
			"success": true,
			"processingTime": 1.1
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:58.244Z",
	"port": 5506,
	"requestId": "sim_1756195618244_f6zfgl41r",
	"input": {
		"model": "claude-3-opus-20240229",
		"max_tokens": 2000,
		"system": "You are a helpful assistant.",
		"messages": [
			{
				"role": "user",
				"content": "Explain quantum computing"
			}
		],
		"temperature": 0.7
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.272Z",
	"port": 5506,
	"requestId": "sim_1756195618244_f6zfgl41r",
	"processingTime": 28,
	"error": {
		"name": "InputValidationError",
		"message": "字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000",
		"code": "FIELD_VALIDATION_FAILED",
		"stack": "InputValidationError: 字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000\n    at ClientInputValidator.handleValidationFailure (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:179:29)\n    at ClientInputValidator.handleValidationFailure [as validateClaudeCodeRequest] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:127:14)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:66:50)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:211:38)\n    at Promise.finally.completed (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)\n    at _callCircusTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:949:3)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)\n    at jestAdapter (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:497:12)",
		"details": {
			"module": "client.input.validation",
			"field": "max_tokens",
			"expected": "one of: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000",
			"actual": "invalid enum value",
			"value": "see originalData",
			"path": "max_tokens",
			"message": "字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000",
			"code": "FIELD_VALIDATION_FAILED",
			"timestamp": 1756195618248
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000"
			]
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:58.277Z",
	"port": 5506,
	"requestId": "sim_1756195618277_wguxah3bm",
	"input": {
		"model": "claude-3-haiku-20240307",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "What is the capital of France?"
			},
			{
				"role": "assistant",
				"content": "The capital of France is Paris."
			},
			{
				"role": "user",
				"content": "What is its population?"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.281Z",
	"port": 5506,
	"requestId": "sim_1756195618277_wguxah3bm",
	"output": {
		"id": "msg_sim_1756195618277_wguxah3bm",
		"type": "message",
		"role": "assistant",
		"content": [
			{
				"type": "text",
				"text": "This is a mock response for your request with model claude-3-haiku-20240307. Your message was: \"What is the capital of France?\""
			}
		],
		"model": "claude-3-haiku-20240307",
		"stop_reason": "end_turn",
		"usage": {
			"input_tokens": 45,
			"output_tokens": 50
		}
	},
	"processingTime": 4,
	"validation": {
		"inputValidation": {
			"success": true,
			"processingTime": 0.4
		},
		"outputValidation": {
			"success": true,
			"processingTime": 0.4
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:58.285Z",
	"port": 5506,
	"requestId": "sim_1756195618285_e1gt98eur",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": 2000,
		"messages": [
			{
				"role": "user",
				"content": "What is the weather like in New York?"
			}
		],
		"tools": [
			{
				"name": "get_weather",
				"description": "Get current weather information",
				"input_schema": {
					"type": "object",
					"properties": {
						"location": {
							"type": "string"
						},
						"unit": {
							"type": "string",
							"enum": [
								"celsius",
								"fahrenheit"
							]
						}
					},
					"required": [
						"location"
					]
				}
			}
		],
		"tool_choice": {
			"type": "auto"
		}
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.294Z",
	"port": 5506,
	"requestId": "sim_1756195618285_e1gt98eur",
	"processingTime": 9,
	"error": {
		"name": "InputValidationError",
		"message": "字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000",
		"code": "FIELD_VALIDATION_FAILED",
		"stack": "InputValidationError: 字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000\n    at ClientInputValidator.handleValidationFailure (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:179:29)\n    at ClientInputValidator.handleValidationFailure [as validateClaudeCodeRequest] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:127:14)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:66:50)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:274:38)\n    at Promise.finally.completed (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)\n    at _callCircusTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:949:3)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)\n    at jestAdapter (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:497:12)",
		"details": {
			"module": "client.input.validation",
			"field": "max_tokens",
			"expected": "one of: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000",
			"actual": "invalid enum value",
			"value": "see originalData",
			"path": "max_tokens",
			"message": "字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000",
			"code": "FIELD_VALIDATION_FAILED",
			"timestamp": 1756195618289
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"字段 'max_tokens' 的值必须是枚举值之一: 1, 1000, 4096, 8192, 16384, 32768, 65536, 100000, 200000"
			]
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:58.299Z",
	"port": 5506,
	"requestId": "sim_1756195618299_iyuc9d0qh",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": 1000,
		"stream": true,
		"messages": [
			{
				"role": "user",
				"content": "Write a short story"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.303Z",
	"port": 5506,
	"requestId": "sim_1756195618299_iyuc9d0qh",
	"output": {
		"id": "msg_sim_1756195618299_iyuc9d0qh",
		"type": "message",
		"role": "assistant",
		"content": [
			{
				"type": "text",
				"text": "This is a mock response for your request with model claude-3-sonnet-20240229. Your message was: \"Write a short story\""
			}
		],
		"model": "claude-3-sonnet-20240229",
		"stop_reason": "end_turn",
		"usage": {
			"input_tokens": 13,
			"output_tokens": 50
		}
	},
	"processingTime": 4,
	"validation": {
		"inputValidation": {
			"success": true,
			"processingTime": 0.4
		},
		"outputValidation": {
			"success": true,
			"processingTime": 0.4
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:58.307Z",
	"port": 5506,
	"requestId": "sim_1756195618307_5icob9me3",
	"input": {
		"model": "claude-3-opus-20240229",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Hello"
			}
		],
		"metadata": {
			"user_id": "user_123",
			"conversation_id": "conv_456"
		}
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.312Z",
	"port": 5506,
	"requestId": "sim_1756195618307_5icob9me3",
	"output": {
		"id": "msg_sim_1756195618307_5icob9me3",
		"type": "message",
		"role": "assistant",
		"content": [
			{
				"type": "text",
				"text": "This is a mock response for your request with model claude-3-opus-20240229. Your message was: \"Hello\""
			}
		],
		"model": "claude-3-opus-20240229",
		"stop_reason": "end_turn",
		"usage": {
			"input_tokens": 9,
			"output_tokens": 50
		}
	},
	"processingTime": 5,
	"validation": {
		"inputValidation": {
			"success": true,
			"processingTime": 0.5
		},
		"outputValidation": {
			"success": true,
			"processingTime": 0.5
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:58.321Z",
	"port": 5506,
	"requestId": "sim_1756195618321_541l4kcu6",
	"input": {
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Hello"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.328Z",
	"port": 5506,
	"requestId": "sim_1756195618321_541l4kcu6",
	"processingTime": 7,
	"error": {
		"name": "InputValidationError",
		"message": "字段 'model' 是必需的",
		"code": "FIELD_VALIDATION_FAILED",
		"stack": "InputValidationError: 字段 'model' 是必需的\n    at ClientInputValidator.handleValidationFailure (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:179:29)\n    at ClientInputValidator.handleValidationFailure [as validateClaudeCodeRequest] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:127:14)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:66:50)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:337:38)\n    at Promise.finally.completed (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)\n    at _callCircusTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:949:3)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)\n    at jestAdapter (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:497:12)",
		"details": {
			"module": "client.input.validation",
			"field": "model",
			"expected": "valid value",
			"actual": "invalid value",
			"value": "see originalData",
			"path": "model",
			"message": "字段 'model' 是必需的",
			"code": "FIELD_VALIDATION_FAILED",
			"timestamp": 1756195618324
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"字段 'model' 是必需的"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"字段 'model' 是必需的"
			]
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:58.332Z",
	"port": 5506,
	"requestId": "sim_1756195618332_qwsketxwd",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": "invalid_number",
		"messages": [
			{
				"role": "user",
				"content": "Hello"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.340Z",
	"port": 5506,
	"requestId": "sim_1756195618332_qwsketxwd",
	"processingTime": 8,
	"error": {
		"name": "InputValidationError",
		"message": "字段 'max_tokens' 类型不匹配，期望: number, 实际: string",
		"code": "FIELD_VALIDATION_FAILED",
		"stack": "InputValidationError: 字段 'max_tokens' 类型不匹配，期望: number, 实际: string\n    at ClientInputValidator.handleValidationFailure (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:179:29)\n    at ClientInputValidator.handleValidationFailure [as validateClaudeCodeRequest] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:127:14)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:66:50)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:361:38)\n    at Promise.finally.completed (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)\n    at _callCircusTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:949:3)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)\n    at jestAdapter (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:497:12)",
		"details": {
			"module": "client.input.validation",
			"field": "max_tokens",
			"expected": "number",
			"actual": "string",
			"value": "see originalData",
			"path": "max_tokens",
			"message": "字段 'max_tokens' 类型不匹配，期望: number, 实际: string",
			"code": "FIELD_VALIDATION_FAILED",
			"timestamp": 1756195618336
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"字段 'max_tokens' 类型不匹配，期望: number, 实际: string"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"字段 'max_tokens' 类型不匹配，期望: number, 实际: string"
			]
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:58.344Z",
	"port": 5506,
	"requestId": "sim_1756195618344_amgm576a6",
	"input": {
		"model": "claude-3-haiku-20240307",
		"max_tokens": 8192,
		"messages": [
			{
				"role": "user",
				"content": "Hello"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.351Z",
	"port": 5506,
	"requestId": "sim_1756195618344_amgm576a6",
	"processingTime": 7,
	"error": {
		"name": "InputValidationError",
		"message": "claude-3-haiku model only supports max_tokens up to 4096",
		"code": "MODEL_TOKEN_LIMIT_EXCEEDED",
		"stack": "InputValidationError: claude-3-haiku model only supports max_tokens up to 4096\n    at ClientInputValidator.validateBusinessLogic (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:259:13)\n    at ClientInputValidator.validateBusinessLogic [as validateClaudeCodeRequest] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:131:12)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:66:50)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:384:38)\n    at Promise.finally.completed (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)\n    at _callCircusTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:949:3)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)\n    at jestAdapter (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:497:12)",
		"details": {
			"module": "client.input.validation",
			"field": "max_tokens",
			"expected": "≤ 4096 for claude-3-haiku",
			"actual": "8192",
			"value": 8192,
			"path": "max_tokens",
			"message": "claude-3-haiku model only supports max_tokens up to 4096",
			"code": "MODEL_TOKEN_LIMIT_EXCEEDED",
			"timestamp": 1756195618348
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"claude-3-haiku model only supports max_tokens up to 4096"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"claude-3-haiku model only supports max_tokens up to 4096"
			]
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:58.355Z",
	"port": 5506,
	"requestId": "sim_1756195618355_3hpkods6w",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Hello"
			}
		],
		"tools": [
			{
				"name": "get_weather",
				"description": "Get weather",
				"input_schema": {
					"type": "object",
					"properties": {}
				}
			}
		],
		"tool_choice": {
			"type": "tool",
			"name": "get_temperature"
		}
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.362Z",
	"port": 5506,
	"requestId": "sim_1756195618355_3hpkods6w",
	"processingTime": 7,
	"error": {
		"name": "InputValidationError",
		"message": "tool 'get_temperature' specified in tool_choice but not defined in tools array",
		"code": "TOOL_NOT_FOUND",
		"stack": "InputValidationError: tool 'get_temperature' specified in tool_choice but not defined in tools array\n    at ClientInputValidator.validateBusinessLogic (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:276:15)\n    at ClientInputValidator.validateBusinessLogic [as validateClaudeCodeRequest] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:131:12)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:66:50)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:417:38)\n    at Promise.finally.completed (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)\n    at _callCircusTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:949:3)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)\n    at jestAdapter (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:497:12)",
		"details": {
			"module": "client.input.validation",
			"field": "tool_choice.name",
			"expected": "existing tool name",
			"actual": "get_temperature",
			"value": "get_temperature",
			"path": "tool_choice.name",
			"message": "tool 'get_temperature' specified in tool_choice but not defined in tools array",
			"code": "TOOL_NOT_FOUND",
			"timestamp": 1756195618359
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"tool 'get_temperature' specified in tool_choice but not defined in tools array"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"tool 'get_temperature' specified in tool_choice but not defined in tools array"
			]
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:58.366Z",
	"port": 5506,
	"requestId": "sim_1756195618366_0r903nuqq",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Hello"
			},
			{
				"role": "user",
				"content": "How are you?"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:58.372Z",
	"port": 5506,
	"requestId": "sim_1756195618366_0r903nuqq",
	"processingTime": 6,
	"error": {
		"name": "InputValidationError",
		"message": "consecutive messages with role 'user' are not allowed",
		"code": "INVALID_MESSAGE_SEQUENCE",
		"stack": "InputValidationError: consecutive messages with role 'user' are not allowed\n    at ClientInputValidator.validateBusinessLogic (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:295:17)\n    at ClientInputValidator.validateBusinessLogic [as validateClaudeCodeRequest] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/input-validator.ts:131:12)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:66:50)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:443:38)\n    at Promise.finally.completed (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)\n    at _callCircusTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:949:3)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)\n    at jestAdapter (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:497:12)",
		"details": {
			"module": "client.input.validation",
			"field": "messages[1].role",
			"expected": "alternating roles",
			"actual": "consecutive user",
			"value": "user",
			"path": "messages[1].role",
			"message": "consecutive messages with role 'user' are not allowed",
			"code": "INVALID_MESSAGE_SEQUENCE",
			"timestamp": 1756195618369
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"consecutive messages with role 'user' are not allowed"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"consecutive messages with role 'user' are not allowed"
			]
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:59.549Z",
	"port": 5506,
	"requestId": "sim_1756195619549_iee6p7km3",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Test output validation"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:59.552Z",
	"port": 5506,
	"requestId": "sim_1756195619549_iee6p7km3",
	"output": {
		"id": "msg_test_123",
		"type": "message",
		"role": "assistant",
		"content": [
			{
				"type": "text",
				"text": "This is a valid response"
			}
		],
		"model": "claude-3-sonnet-20240229",
		"stop_reason": "end_turn",
		"usage": {
			"input_tokens": 10,
			"output_tokens": 5
		}
	},
	"processingTime": 3,
	"validation": {
		"inputValidation": {
			"success": true,
			"processingTime": 0.30000000000000004
		},
		"outputValidation": {
			"success": true,
			"processingTime": 0.30000000000000004
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:59.556Z",
	"port": 5506,
	"requestId": "sim_1756195619556_raa4l1cq9",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Test invalid output"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:59.572Z",
	"port": 5506,
	"requestId": "sim_1756195619556_raa4l1cq9",
	"processingTime": 16,
	"error": {
		"name": "OutputValidationError",
		"message": "字段 'id' 是必需的",
		"code": "OUTPUT_FIELD_VALIDATION_FAILED",
		"stack": "OutputValidationError: 字段 'id' 是必需的\n    at ClientOutputValidator.handleValidationFailure (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/output-validator.ts:210:29)\n    at ClientOutputValidator.handleValidationFailure [as validateClaudeCodeResponse] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/output-validator.ts:126:14)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:77:48)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:616:38)\n    at Promise.finally.completed (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)\n    at _callCircusTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:949:3)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)\n    at jestAdapter (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:497:12)",
		"details": {
			"module": "client.output.validation",
			"field": "id",
			"expected": "valid value",
			"actual": "invalid value",
			"value": "see originalData",
			"path": "id",
			"message": "字段 'id' 是必需的",
			"code": "OUTPUT_FIELD_VALIDATION_FAILED",
			"timestamp": 1756195619560
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"字段 'id' 是必需的"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"字段 'id' 是必需的"
			]
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:59.575Z",
	"port": 5506,
	"requestId": "sim_1756195619575_d71xowm4n",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Test business logic validation"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:59.583Z",
	"port": 5506,
	"requestId": "sim_1756195619575_d71xowm4n",
	"processingTime": 8,
	"error": {
		"name": "OutputValidationError",
		"message": "text content cannot be empty",
		"code": "EMPTY_TEXT_CONTENT",
		"stack": "OutputValidationError: text content cannot be empty\n    at ClientOutputValidator.validateOutputBusinessLogic (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/output-validator.ts:294:17)\n    at ClientOutputValidator.validateOutputBusinessLogic [as validateClaudeCodeResponse] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/output-validator.ts:130:12)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:77:48)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:656:38)\n    at Promise.finally.completed (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)\n    at _callCircusTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:949:3)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)\n    at jestAdapter (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:497:12)",
		"details": {
			"module": "client.output.validation",
			"field": "content[0].text",
			"expected": "non-empty string",
			"actual": "empty or missing",
			"value": "",
			"path": "content[0].text",
			"message": "text content cannot be empty",
			"code": "EMPTY_TEXT_CONTENT",
			"timestamp": 1756195619579
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"text content cannot be empty"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"text content cannot be empty"
			]
		}
	}
}
{
	"timestamp": "2025-08-26T08:06:59.586Z",
	"port": 5506,
	"requestId": "sim_1756195619586_xa2but8pd",
	"input": {
		"model": "claude-3-sonnet-20240229",
		"max_tokens": 1000,
		"messages": [
			{
				"role": "user",
				"content": "Test token validation"
			}
		]
	},
	"metadata": {
		"userAgent": "ClaudeCodeRequestSimulator/4.0.0",
		"clientIP": "127.0.0.1",
		"sessionId": "test_session",
		"conversationId": "test_conversation"
	}
}
{
	"timestamp": "2025-08-26T08:06:59.592Z",
	"port": 5506,
	"requestId": "sim_1756195619586_xa2but8pd",
	"processingTime": 6,
	"error": {
		"name": "OutputValidationError",
		"message": "input_tokens cannot be negative",
		"code": "NEGATIVE_INPUT_TOKENS",
		"stack": "OutputValidationError: input_tokens cannot be negative\n    at ClientOutputValidator.validateOutputBusinessLogic (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/output-validator.ts:337:15)\n    at ClientOutputValidator.validateOutputBusinessLogic [as validateClaudeCodeResponse] (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/validation/output-validator.ts:130:12)\n    at ClaudeCodeRequestSimulator.simulateRequest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:77:48)\n    at Object.<anonymous> (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/src/client/__tests__/claude-code-request-simulator.test.ts:695:38)\n    at Promise.finally.completed (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1559:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1499:10)\n    at _callCircusTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1009:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:949:3)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:839:13)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at _runTestsForDescribeBlock (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:829:11)\n    at run (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:757:3)\n    at runAndTransformResultsToJestFormat (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/jestAdapterInit.js:1920:21)\n    at jestAdapter (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/fanzhang/Documents/github/route-claudecode/workspace/main-development/node_modules/jest-runner/build/testWorker.js:497:12)",
		"details": {
			"module": "client.output.validation",
			"field": "usage.input_tokens",
			"expected": "non-negative number",
			"actual": "-5",
			"value": -5,
			"path": "usage.input_tokens",
			"message": "input_tokens cannot be negative",
			"code": "NEGATIVE_INPUT_TOKENS",
			"timestamp": 1756195619589
		}
	},
	"validation": {
		"inputValidation": {
			"success": false,
			"errors": [
				"input_tokens cannot be negative"
			]
		},
		"outputValidation": {
			"success": false,
			"errors": [
				"input_tokens cannot be negative"
			]
		}
	}
}
