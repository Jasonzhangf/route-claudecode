# ğŸš€ Claude Code Router å®Œæ•´äº¤ä»˜è§„æ ¼ v2.0
> å…¨é¢æµ‹è¯•æµç¨‹æŒ‡å¼• + æƒé™ç®¡ç† + ä»£ç é£é™©å®¡æ ¸ä½“ç³»

## ğŸ“‹ äº¤ä»˜æ¦‚è¿° (DELIVERY OVERVIEW)

### ğŸ¯ æ ¸å¿ƒåŸåˆ™
- **çœŸå®æ€§åŸåˆ™**: æ‰€æœ‰æµ‹è¯•å¿…é¡»ä½¿ç”¨çœŸå®æ•°æ®å’ŒçœŸå®å“åº”ï¼Œä¸¥ç¦æ¨¡æ‹Ÿ
- **å®Œæ•´æ€§åŸåˆ™**: è¦†ç›–5å±‚æµ‹è¯•æµç¨‹ï¼Œæ— é—æ¼
- **æƒé™ç®¡ç†**: æ‰§è¡Œå‰å®Œæ•´æƒé™å®¡æ‰¹ï¼Œé¿å…ä¸­é€”æš‚åœ
- **é£é™©æ§åˆ¶**: é€šè¿‡ä»£ç é£é™©å®¡æ ¸ä¸“å®¶éªŒæ”¶

### âš ï¸ ç»å¯¹ç¦ä»¤
- ğŸš« **ç¦æ­¢æ¨¡æ‹Ÿç«¯åˆ°ç«¯æµ‹è¯•** - å¿…é¡»ä½¿ç”¨ `rcc code --port` çœŸå®è¿æ¥
- ğŸš« **ç¦æ­¢æ¨¡æ‹Ÿå“åº”** - æ‰€æœ‰å“åº”å¿…é¡»çœŸå®äº§ç”Ÿ
- ğŸš« **ç¦æ­¢ç»•è¿‡æƒé™å®¡æ ¸** - æ‰§è¡Œå‰å¿…é¡»è·å¾—ç”¨æˆ·å®Œæ•´æˆæƒ
- ğŸš« **ç¦æ­¢ç‰ˆæœ¬ä¸ä¸€è‡´æµ‹è¯•** - æœ¬åœ°ç‰ˆæœ¬ä¸å…¨å±€ç‰ˆæœ¬å†²çªæ—¶å¿…é¡»ä½¿ç”¨å…¨å±€ç‰ˆæœ¬
- ğŸš« **ç¦æ­¢å¿½ç•¥å®¢æˆ·ç«¯è¿æ¥é”™è¯¯** - çŠ¶æ€é”™è¯¯å¿…é¡»æ­£ç¡®è¯„åˆ†å’Œå¤„ç†

### ğŸ” æœ€é«˜ä¼˜å…ˆçº§æµ‹è¯•è§„åˆ™ (HIGHEST PRIORITY TEST RULES)

#### ğŸ·ï¸ ç‰ˆæœ¬ä¸€è‡´æ€§å¼ºåˆ¶æ£€æŸ¥ (MANDATORY VERSION CONSISTENCY CHECK)

**è§„åˆ™çº§åˆ«**: P0 - æœ€é«˜ä¼˜å…ˆçº§ï¼Œè¿åå°†ç«‹å³ä¸­æ­¢æµ‹è¯•

##### ç‰ˆæœ¬æ£€æŸ¥æµç¨‹ (Version Check Process)
```bash
# 1. æ£€æŸ¥å…¨å±€å®‰è£…ç‰ˆæœ¬
npm list -g route-claudecode

# 2. æ£€æŸ¥æœ¬åœ°å¼€å‘ç‰ˆæœ¬  
node -e "console.log(require('./package.json').version)"

# 3. å¼ºåˆ¶ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥
./scripts/version-consistency-check.sh
```

##### ç‰ˆæœ¬å†²çªå¤„ç†è§„åˆ™ (Version Conflict Resolution Rules)

**åœºæ™¯1: æœ¬åœ°ç‰ˆæœ¬ = å…¨å±€ç‰ˆæœ¬**
```bash
# âœ… å…è®¸ç»§ç»­æµ‹è¯•
æœ¬åœ°ç‰ˆæœ¬: v2.8.0
å…¨å±€ç‰ˆæœ¬: v2.8.0
å¤„ç†æ–¹å¼: ç»§ç»­ä½¿ç”¨æœ¬åœ°å¼€å‘ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•
```

**åœºæ™¯2: æœ¬åœ°ç‰ˆæœ¬ â‰  å…¨å±€ç‰ˆæœ¬**
```bash
# âŒ å¼ºåˆ¶ä½¿ç”¨å…¨å±€ç‰ˆæœ¬
æœ¬åœ°ç‰ˆæœ¬: v2.8.1
å…¨å±€ç‰ˆæœ¬: v2.8.0
å¤„ç†æ–¹å¼: å¼ºåˆ¶åˆ‡æ¢åˆ°å…¨å±€å®‰è£…ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•
è‡ªåŠ¨æ“ä½œ: ä¸´æ—¶é‡å‘½åæœ¬åœ° node_modulesï¼Œä½¿ç”¨å…¨å±€ç‰ˆæœ¬
```

**åœºæ™¯3: æ— å…¨å±€å®‰è£…**
```bash
# âŒ æ‹’ç»æµ‹è¯•
æœ¬åœ°ç‰ˆæœ¬: v2.8.1
å…¨å±€ç‰ˆæœ¬: æœªå®‰è£…
å¤„ç†æ–¹å¼: è¦æ±‚å…ˆè¿›è¡Œå…¨å±€å®‰è£…ï¼Œç¡®ä¿ç‰ˆæœ¬ä¸€è‡´
é”™è¯¯ä¿¡æ¯: "Global installation required for delivery testing"
```

##### å¼ºåˆ¶æ‰§è¡Œæœºåˆ¶ (Enforcement Mechanism)

**ç‰ˆæœ¬æ£€æŸ¥è„šæœ¬**: `./scripts/version-consistency-check.sh`
```bash
#!/bin/bash
# ç‰ˆæœ¬ä¸€è‡´æ€§å¼ºåˆ¶æ£€æŸ¥è„šæœ¬

# è·å–æœ¬åœ°ç‰ˆæœ¬
LOCAL_VERSION=$(node -e "console.log(require('./package.json').version)")

# è·å–å…¨å±€ç‰ˆæœ¬  
GLOBAL_VERSION=$(npm list -g route-claudecode --depth=0 2>/dev/null | grep route-claudecode | cut -d'@' -f2 || echo "NOT_INSTALLED")

echo "æœ¬åœ°ç‰ˆæœ¬: $LOCAL_VERSION"
echo "å…¨å±€ç‰ˆæœ¬: $GLOBAL_VERSION"

if [[ "$GLOBAL_VERSION" == "NOT_INSTALLED" ]]; then
    echo "âŒ é”™è¯¯: å…¨å±€æœªå®‰è£… route-claudecode"
    echo "è¯·å…ˆæ‰§è¡Œ: npm install -g route-claudecode@$LOCAL_VERSION" 
    exit 1
fi

if [[ "$LOCAL_VERSION" != "$GLOBAL_VERSION" ]]; then
    echo "âš ï¸  ç‰ˆæœ¬å†²çªæ£€æµ‹åˆ°!"
    echo "æ ¹æ®æœ€é«˜ä¼˜å…ˆçº§è§„åˆ™ï¼Œå¼ºåˆ¶ä½¿ç”¨å…¨å±€ç‰ˆæœ¬: $GLOBAL_VERSION"
    
    # ä¸´æ—¶å¤‡ä»½æœ¬åœ° node_modules
    if [[ -d "node_modules" ]]; then
        mv node_modules node_modules.backup.$(date +%s)
        echo "å·²å¤‡ä»½æœ¬åœ° node_modules"
    fi
    
    # å¼ºåˆ¶ä½¿ç”¨å…¨å±€ç‰ˆæœ¬æ ‡è®°
    echo "USING_GLOBAL_VERSION=$GLOBAL_VERSION" > .test-version-override
    echo "âœ… å·²åˆ‡æ¢åˆ°å…¨å±€ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•"
else
    echo "âœ… ç‰ˆæœ¬ä¸€è‡´ï¼Œç»§ç»­ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬"
fi
```

##### æµ‹è¯•æ‰§è¡Œçº¦æŸ (Test Execution Constraints)

**æ‰€æœ‰æµ‹è¯•è„šæœ¬å¿…é¡»é¦–å…ˆæ‰§è¡Œç‰ˆæœ¬æ£€æŸ¥**:
```bash
# comprehensive-delivery-test.sh å¼€å¤´å¿…é¡»æ·»åŠ 
./scripts/version-consistency-check.sh || exit 1

# permission-review.sh å¼€å¤´å¿…é¡»æ·»åŠ   
./scripts/version-consistency-check.sh || exit 1

# æ‰€æœ‰å…¶ä»–æµ‹è¯•è„šæœ¬åŒæ ·è¦æ±‚
```

##### ç‰ˆæœ¬æ¢å¤æœºåˆ¶ (Version Recovery Mechanism)

**æµ‹è¯•å®Œæˆåçš„æ¸…ç†**:
```bash
# ./scripts/test-cleanup.sh
if [[ -f ".test-version-override" ]]; then
    echo "æ¢å¤æœ¬åœ°å¼€å‘ç¯å¢ƒ..."
    
    # æ¢å¤æœ¬åœ° node_modules
    BACKUP_DIR=$(ls -t node_modules.backup.* 2>/dev/null | head -1)
    if [[ -n "$BACKUP_DIR" ]]; then
        mv "$BACKUP_DIR" node_modules
        echo "å·²æ¢å¤æœ¬åœ° node_modules"
    fi
    
    # æ¸…ç†ç‰ˆæœ¬è¦†ç›–æ ‡è®°
    rm -f .test-version-override
    echo "ç¯å¢ƒæ¢å¤å®Œæˆ"
fi
```

##### é›†æˆåˆ°æƒé™å®¡æ ¸ (Integration with Permission Review)

**åœ¨æƒé™å®¡æ ¸æ¸…å•ä¸­æ·»åŠ ç‰ˆæœ¬æ£€æŸ¥**:
```
## ç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥ (HIGHEST PRIORITY)
- [ ] å·²æ‰§è¡Œç‰ˆæœ¬ä¸€è‡´æ€§æ£€æŸ¥
- [ ] ç‰ˆæœ¬å†²çªå·²æŒ‰è§„åˆ™å¤„ç†
- [ ] æµ‹è¯•ä½¿ç”¨ç‰ˆæœ¬å·²ç¡®è®¤æ— è¯¯
- [ ] ç‰ˆæœ¬æ¢å¤æœºåˆ¶å·²å‡†å¤‡å°±ç»ª
```

## ğŸ”„ å®Œæ•´æµ‹è¯•æµç¨‹æŒ‡å¼• (COMPREHENSIVE TEST PROCESS GUIDE)

### ğŸ“Š æµ‹è¯•å±‚çº§æ¶æ„
```
ç¬¬1å±‚: å•å…ƒæµ‹è¯• (Unit Tests)
ç¬¬2å±‚: é»‘ç›’æµ‹è¯• (Blackbox Tests)  
ç¬¬3å±‚: å…­å±‚æ¶æ„å•å±‚æµ‹è¯• (Single Layer Tests)
ç¬¬4å±‚: ç«¯åˆ°ç«¯æ¨¡æ‹Ÿæµ‹è¯• (E2E Simulation Tests)
ç¬¬5å±‚: çœŸå®ç«¯åˆ°ç«¯æµ‹è¯• (Real E2E Tests)
```

---

## ğŸ§ª ç¬¬1å±‚ï¼šå•å…ƒæµ‹è¯• (Unit Tests)

### ğŸ¯ æµ‹è¯•ç›®æ ‡
- åŸºæœ¬è¯­æ³•æ­£ç¡®æ€§éªŒè¯
- å‡½æ•°å®šä¹‰è¦†ç›–åŠŸèƒ½æµ‹è¯•
- æ¨¡å—å¯¼å…¥å¯¼å‡ºéªŒè¯

### ğŸ“ æµ‹è¯•èŒƒå›´

#### A. è¯­æ³•æµ‹è¯• (Syntax Tests)
```bash
# æ‰§è¡Œè¯­æ³•æ£€æŸ¥è„šæœ¬
./test-runner.sh --category syntax

# è¦†ç›–æ–‡ä»¶
- TypeScriptç¼–è¯‘éªŒè¯
- ESLintè§„åˆ™æ£€æŸ¥
- å¯¼å…¥è·¯å¾„æœ‰æ•ˆæ€§
```

#### B. å‡½æ•°å®šä¹‰è¦†ç›–æµ‹è¯• (Function Coverage Tests)
```bash
# æ‰§è¡Œå‡½æ•°è¦†ç›–æµ‹è¯•
./test-runner.sh --category function-coverage

# éªŒè¯å†…å®¹
- æ‰€æœ‰å¯¼å‡ºå‡½æ•°å¯è°ƒç”¨
- å‚æ•°ç±»å‹æ­£ç¡®æ€§
- è¿”å›å€¼ç±»å‹åŒ¹é…
- å¼‚å¸¸å¤„ç†æœºåˆ¶
```

#### C. æ¨¡å—å®Œæ•´æ€§æµ‹è¯• (Module Integrity Tests)
```bash
# æ‰§è¡Œæ¨¡å—å®Œæ•´æ€§æ£€æŸ¥
./test-runner.sh --category module-integrity

# æ£€æŸ¥é¡¹ç›®
- æ‰€æœ‰ä¾èµ–æ¨¡å—å­˜åœ¨
- å¾ªç¯ä¾èµ–æ£€æµ‹
- æ¨¡å—æ¥å£æ ‡å‡†åŒ–
```

### âœ… é€šè¿‡æ ‡å‡†
- [ ] æ‰€æœ‰TypeScriptç¼–è¯‘é€šè¿‡ï¼Œé›¶é”™è¯¯
- [ ] ESLintæ£€æŸ¥é€šè¿‡ï¼Œé›¶è­¦å‘Š
- [ ] å‡½æ•°è¦†ç›–ç‡ â‰¥ 95%
- [ ] æ¨¡å—å¯¼å…¥å¯¼å‡º100%æ­£ç¡®

---

## âš« ç¬¬2å±‚ï¼šé»‘ç›’æµ‹è¯• (Blackbox Tests)

### ğŸ¯ æµ‹è¯•ç›®æ ‡
- æ¯ä¸ªå•å…ƒæ ¹æ®çœŸå®æ•°æ®è¿›è¡Œè¾“å…¥è¾“å‡ºæµ‹è¯•
- éªŒè¯å•å…ƒåŠŸèƒ½æ­£ç¡®æ€§ï¼Œä¸å…³å¿ƒå†…éƒ¨å®ç°

### ğŸ“ æµ‹è¯•èŒƒå›´

#### A. è¾“å…¥å¤„ç†å•å…ƒæµ‹è¯• (Input Processing Unit Tests)
```bash
# æ‰§è¡Œè¾“å…¥å¤„ç†é»‘ç›’æµ‹è¯•
./test-runner.sh --category input-blackbox

# æµ‹è¯•æ–‡ä»¶: test/blackbox/test-input-processing-units.js
```

**æµ‹è¯•ç”¨ä¾‹**:
- Anthropicè¾“å…¥å¤„ç†å™¨ (`src/input/anthropic/processor.ts`)
- OpenAIè¾“å…¥å¤„ç†å™¨ (`src/input/openai/processor.ts`)
- è¯·æ±‚éªŒè¯å™¨
- é€Ÿç‡é™åˆ¶å™¨

**éªŒè¯æ ‡å‡†**:
```javascript
// ç¤ºä¾‹æµ‹è¯•ç»“æ„
describe('Anthropicè¾“å…¥å¤„ç†å™¨é»‘ç›’æµ‹è¯•', () => {
  test('ä½¿ç”¨çœŸå®Claudeè¯·æ±‚æ•°æ®', async () => {
    const realInput = loadRealData('anthropic-request-sample.json');
    const result = await anthropicProcessor.process(realInput);
    expect(result).toMatchSchema(expectedOutputSchema);
  });
});
```

#### B. è·¯ç”±å†³ç­–å•å…ƒæµ‹è¯• (Routing Logic Unit Tests)
```bash
# æ‰§è¡Œè·¯ç”±é€»è¾‘é»‘ç›’æµ‹è¯•
./test-runner.sh --category routing-blackbox

# æµ‹è¯•æ–‡ä»¶: test/blackbox/test-routing-logic-units.js
```

**æµ‹è¯•ç”¨ä¾‹**:
- Provideré€‰æ‹©å™¨
- æ¨¡å‹æ˜ å°„å™¨
- è´Ÿè½½å‡è¡¡å™¨
- æ•…éšœè½¬ç§»å™¨

#### C. è½¬æ¢å™¨å•å…ƒæµ‹è¯• (Transformer Unit Tests)
```bash
# æ‰§è¡Œè½¬æ¢å™¨é»‘ç›’æµ‹è¯•
./test-runner.sh --category transformer-blackbox

# æµ‹è¯•æ–‡ä»¶: test/blackbox/test-transformer-units.js
```

**æµ‹è¯•ç”¨ä¾‹**:
- OpenAIè½¬æ¢å™¨ (`src/transformers/openai.ts`)
- Geminiè½¬æ¢å™¨ (`src/transformers/gemini.ts`)
- å“åº”è½¬æ¢å™¨
- å·¥å…·è°ƒç”¨è½¬æ¢å™¨

#### D. Providerå•å…ƒæµ‹è¯• (Provider Unit Tests)
```bash
# æ‰§è¡ŒProvideré»‘ç›’æµ‹è¯•
./test-runner.sh --category provider-blackbox

# æµ‹è¯•æ–‡ä»¶: test/blackbox/test-provider-units.js
```

**æµ‹è¯•ç”¨ä¾‹**:
- CodeWhisperer Provider
- OpenAI Provider  
- Gemini Provider
- è¿æ¥ç®¡ç†å™¨

### âœ… é€šè¿‡æ ‡å‡†
- [ ] æ‰€æœ‰å•å…ƒä½¿ç”¨çœŸå®æ•°æ®æµ‹è¯•é€šè¿‡
- [ ] è¾“å…¥è¾“å‡ºæ ¼å¼100%ç¬¦åˆé¢„æœŸ
- [ ] é”™è¯¯å¤„ç†æœºåˆ¶æœ‰æ•ˆæ€§éªŒè¯
- [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯•é€šè¿‡

---

## ğŸ—ï¸ ç¬¬3å±‚ï¼šå…­å±‚æ¶æ„å•å±‚æµ‹è¯• (Single Layer Architecture Tests)

### ğŸ¯ æµ‹è¯•ç›®æ ‡
- æ¯ä¸ªæ¶æ„å±‚è¿›è¡Œé€»è¾‘è¾“å…¥è¾“å‡ºçš„é»‘ç›’æµ‹è¯•
- éªŒè¯å±‚é—´æ¥å£çš„æ ‡å‡†åŒ–å’Œä¸€è‡´æ€§

### ğŸ“ æµ‹è¯•èŒƒå›´

#### ğŸŒ Layer 1: å®¢æˆ·ç«¯æ¥å…¥å±‚æµ‹è¯• (Client Access Layer Tests)
```bash
# æ‰§è¡Œå®¢æˆ·ç«¯æ¥å…¥å±‚æµ‹è¯•
./test-runner.sh --category layer1-client-access

# æµ‹è¯•æ–‡ä»¶: test/single-layer/test-client-access-layer.js
```

**æµ‹è¯•è¦†ç›–**:
- HTTP APIæ¥å£éªŒè¯
- è®¤è¯æœºåˆ¶æµ‹è¯•
- é€Ÿç‡é™åˆ¶éªŒè¯
- è¯·æ±‚éªŒè¯é€»è¾‘
- é”™è¯¯å“åº”æ ¼å¼

**çœŸå®æ•°æ®è¾“å…¥**:
- æ ‡å‡†OpenAIæ ¼å¼è¯·æ±‚
- Anthropicæ ¼å¼è¯·æ±‚
- æ— æ•ˆè®¤è¯è¯·æ±‚
- è¶…é€Ÿç‡é™åˆ¶è¯·æ±‚

#### ğŸ§­ Layer 2: è·¯ç”±å†³ç­–å±‚æµ‹è¯• (Routing Decision Layer Tests)
```bash
# æ‰§è¡Œè·¯ç”±å†³ç­–å±‚æµ‹è¯•
./test-runner.sh --category layer2-routing-decision

# æµ‹è¯•æ–‡ä»¶: test/single-layer/test-routing-decision-layer.js
```

**æµ‹è¯•è¦†ç›–**:
- ç±»åˆ«è·¯ç”±é€»è¾‘ (default, background, thinking, longcontext, search)
- Provideré€‰æ‹©ç®—æ³•
- è´Ÿè½½å‡è¡¡ç­–ç•¥
- æ•…éšœè½¬ç§»æœºåˆ¶
- æ¨¡å‹æ˜ å°„å‡†ç¡®æ€§

#### ğŸ”§ Layer 3: é¢„å¤„ç†å±‚æµ‹è¯• (Preprocessing Layer Tests)
```bash
# æ‰§è¡Œé¢„å¤„ç†å±‚æµ‹è¯•
./test-runner.sh --category layer3-preprocessing

# æµ‹è¯•æ–‡ä»¶: test/single-layer/test-preprocessing-layer.js
```

**æµ‹è¯•è¦†ç›–**:
- æ ¼å¼å…¼å®¹æ€§å¤„ç†
- è¡¥ä¸ç³»ç»Ÿåº”ç”¨
- æ¨¡å‹ç‰¹å®šä¿®å¤
- è¯·æ±‚è½¬æ¢å‡†ç¡®æ€§

#### ğŸ”„ Layer 4: åè®®è½¬æ¢å±‚æµ‹è¯• (Protocol Transformation Layer Tests)
```bash
# æ‰§è¡Œåè®®è½¬æ¢å±‚æµ‹è¯•
./test-runner.sh --category layer4-protocol-transformation

# æµ‹è¯•æ–‡ä»¶: test/single-layer/test-protocol-transformation-layer.js
```

**æµ‹è¯•è¦†ç›–**:
- OpenAI/Anthropic/Geminiåè®®è½¬æ¢
- å·¥å…·è°ƒç”¨æ ¼å¼å¤„ç†
- æµå¼åè®®å¤„ç†
- å“åº”æ ¼å¼æ ‡å‡†åŒ–

#### ğŸ”Œ Layer 5: Providerè¿æ¥å±‚æµ‹è¯• (Provider Connection Layer Tests)
```bash
# æ‰§è¡ŒProviderè¿æ¥å±‚æµ‹è¯•
./test-runner.sh --category layer5-provider-connection

# æµ‹è¯•æ–‡ä»¶: test/single-layer/test-provider-connection-layer.js
```

**æµ‹è¯•è¦†ç›–**:
- å„Providerè¿æ¥ç®¡ç†
- è¿æ¥æ± ä¼˜åŒ–
- é‡è¿æœºåˆ¶
- è¶…æ—¶å¤„ç†

#### ğŸ“¤ Layer 6: å“åº”åå¤„ç†å±‚æµ‹è¯• (Response Post-processing Layer Tests)
```bash
# æ‰§è¡Œå“åº”åå¤„ç†å±‚æµ‹è¯•
./test-runner.sh --category layer6-response-postprocessing

# æµ‹è¯•æ–‡ä»¶: test/single-layer/test-response-postprocessing-layer.js
```

**æµ‹è¯•è¦†ç›–**:
- å“åº”æ ¼å¼æ ‡å‡†åŒ–
- é”™è¯¯å¤„ç†ç»Ÿä¸€
- Finish reasonæ˜ å°„
- Tokenè®¡ç®—å‡†ç¡®æ€§

### âœ… é€šè¿‡æ ‡å‡†
- [ ] æ¯å±‚ç‹¬ç«‹åŠŸèƒ½éªŒè¯100%é€šè¿‡
- [ ] å±‚é—´æ¥å£æ ‡å‡†åŒ–éªŒè¯é€šè¿‡
- [ ] çœŸå®æ•°æ®æµè½¬éªŒè¯æ— è¯¯
- [ ] é”™è¯¯ä¼ é€’æœºåˆ¶æ­£ç¡®

---

## ğŸ”„ ç¬¬4å±‚ï¼šç«¯åˆ°ç«¯æ¨¡æ‹Ÿæµ‹è¯• (E2E Simulation Tests)

### ğŸ¯ æµ‹è¯•ç›®æ ‡
- æ¨¡æ‹Ÿç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼ˆåŸºäºçœŸå®æ•°æ®ï¼‰
- è¿›è¡Œæ¨¡æ‹Ÿå›ç¯ç«¯åˆ°ç«¯æµ‹è¯•
- éªŒè¯å®Œæ•´æµæ°´çº¿åŠŸèƒ½

### ğŸ“ æµ‹è¯•èŒƒå›´

#### A. æ¨¡æ‹ŸæœåŠ¡å™¨æ„å»º (Mock Server Construction)
```bash
# æ„å»ºæ¨¡æ‹ŸæœåŠ¡å™¨
./test-runner.sh --category mock-server-setup

# åŸºäºçœŸå®æ•°æ®æ„å»ºæ¨¡æ‹Ÿå“åº”
# æ•°æ®æº: database/pipeline-data-unified/
```

**æ¨¡æ‹ŸæœåŠ¡å™¨è§„æ ¼**:
- **Anthropicæ¨¡æ‹Ÿ**: åŸºäºçœŸå®Claude APIå“åº”æ ¼å¼
- **OpenAIæ¨¡æ‹Ÿ**: åŸºäºçœŸå®GPT APIå“åº”æ ¼å¼  
- **Geminiæ¨¡æ‹Ÿ**: åŸºäºçœŸå®Gemini APIå“åº”æ ¼å¼
- **CodeWhispereræ¨¡æ‹Ÿ**: åŸºäºçœŸå®AWS CodeWhispererå“åº”

#### B. å®Œæ•´é“¾è·¯æ¨¡æ‹Ÿæµ‹è¯• (Full Pipeline Simulation Tests)
```bash
# æ‰§è¡Œç«¯åˆ°ç«¯æ¨¡æ‹Ÿæµ‹è¯•
./test-runner.sh --category e2e-simulation

# æµ‹è¯•æ–‡ä»¶: test/e2e-simulation/test-full-pipeline-simulation.js
```

**æµ‹è¯•åœºæ™¯**:
- ç®€å•å¯¹è¯æµç¨‹æµ‹è¯•
- å·¥å…·è°ƒç”¨å®Œæ•´é“¾è·¯æµ‹è¯•
- å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡æµ‹è¯•
- æµå¼å“åº”å¤„ç†æµ‹è¯•
- é”™è¯¯æ¢å¤æœºåˆ¶æµ‹è¯•

#### C. Provideråˆ‡æ¢æµ‹è¯• (Provider Switching Tests)
```bash
# æ‰§è¡ŒProvideråˆ‡æ¢æµ‹è¯•
./test-runner.sh --category provider-switching-simulation

# æµ‹è¯•æ–‡ä»¶: test/e2e-simulation/test-provider-switching.js
```

**æµ‹è¯•è¦†ç›–**:
- Round Robinè´Ÿè½½å‡è¡¡
- æ•…éšœåˆ‡æ¢æœºåˆ¶
- å¤šè´¦å·åˆ‡æ¢
- å¥åº·çŠ¶æ€æ£€æŸ¥

### âœ… é€šè¿‡æ ‡å‡†
- [ ] æ¨¡æ‹ŸæœåŠ¡å™¨å“åº”æ ¼å¼100%ç¬¦åˆçœŸå®API
- [ ] å®Œæ•´é“¾è·¯åŠŸèƒ½éªŒè¯é€šè¿‡
- [ ] Provideråˆ‡æ¢æœºåˆ¶æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†å’Œæ¢å¤éªŒè¯æœ‰æ•ˆ

---

## ğŸŒ ç¬¬5å±‚ï¼šçœŸå®ç«¯åˆ°ç«¯æµ‹è¯• (Real E2E Tests)

### ğŸ¯ æµ‹è¯•ç›®æ ‡
- ä½¿ç”¨ `rcc code --port` è¿›è¡ŒçœŸå®è¿æ¥æµ‹è¯•
- éªŒè¯ä¸çœŸå®AIæœåŠ¡çš„å®Œæ•´äº¤äº’
- ç¡®ä¿ç”Ÿäº§ç¯å¢ƒå¯ç”¨æ€§

### âš ï¸ å®¢æˆ·ç«¯è¿æ¥é”™è¯¯è¯„åˆ†è§„åˆ™ (Client Connection Error Scoring Rules)

#### ğŸ” é”™è¯¯åˆ†ç±»æ ‡å‡†
- **å¯æ¢å¤é”™è¯¯**: 429(Rate Limit)ã€503(Service Unavailable)ç­‰ä¸´æ—¶æ€§é”™è¯¯
- **å®¢æˆ·ç«¯è¿æ¥é”™è¯¯**: é™¤å¯æ¢å¤é”™è¯¯å¤–çš„æ‰€æœ‰çŠ¶æ€é”™è¯¯(4xxã€5xx)
- **ç½‘ç»œè¿æ¥é”™è¯¯**: è¿æ¥è¶…æ—¶ã€DNSè§£æå¤±è´¥ã€ç½‘ç»œä¸­æ–­ç­‰

#### ğŸ“Š è¯„åˆ†æœºåˆ¶
- **æ­£å¸¸è¿æ¥**: Providerå®¢æˆ·ç«¯è¯„åˆ† = 100åˆ†
- **å¯æ¢å¤é”™è¯¯**: Providerå®¢æˆ·ç«¯è¯„åˆ†ä¸å˜ï¼Œè§¦å‘é‡è¯•æœºåˆ¶
- **å®¢æˆ·ç«¯è¿æ¥é”™è¯¯**: Providerå®¢æˆ·ç«¯è¯„åˆ† = 0åˆ†
- **è¿ç»­é”™è¯¯**: è¿ç»­3æ¬¡å®¢æˆ·ç«¯è¿æ¥é”™è¯¯ï¼ŒProvideræš‚æ—¶ç¦ç”¨

#### ğŸš¨ å¥åº·çŠ¶æ€å½±å“
```bash
# å®¢æˆ·ç«¯è¿æ¥é”™è¯¯å¤„ç†æµç¨‹
if [ "$error_type" == "client_connection_error" ]; then
    provider_score=0
    health_status="unhealthy"
    route_priority="disabled"
    log_level="ERROR"
fi
```

#### ğŸ’¡ å®æ–½è§„åˆ™
- **ç«‹å³ç”Ÿæ•ˆ**: æ£€æµ‹åˆ°å®¢æˆ·ç«¯è¿æ¥é”™è¯¯ç«‹å³å°†è¯„åˆ†ç½®é›¶
- **è·¯ç”±å½±å“**: é›¶åˆ†Providerä¸å‚ä¸è·¯ç”±é€‰æ‹©å’Œè´Ÿè½½å‡è¡¡
- **æ¢å¤æœºåˆ¶**: æˆåŠŸè¿æ¥åè¯„åˆ†æ¢å¤ï¼Œé‡æ–°å‚ä¸è·¯ç”±
- **ç›‘æ§å‘Šè­¦**: å®¢æˆ·ç«¯è¿æ¥é”™è¯¯è§¦å‘ç›‘æ§å‘Šè­¦

### ğŸ“ æµ‹è¯•èŒƒå›´

#### A. çœŸå®è¿æ¥å‡†å¤‡ (Real Connection Preparation)
```bash
# å‡†å¤‡çœŸå®è¿æ¥ç¯å¢ƒ
./test-runner.sh --category real-connection-setup

# éªŒè¯é…ç½®æ–‡ä»¶å¯ç”¨æ€§
ls ~/.route-claude-code/config/single-provider/
```

**å‡†å¤‡æ£€æŸ¥æ¸…å•**:
- [ ] æ‰€æœ‰Provideré…ç½®æ–‡ä»¶å­˜åœ¨
- [ ] APIå¯†é’¥å’Œè®¤è¯ä¿¡æ¯æœ‰æ•ˆ
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] ç«¯å£é…ç½®æ— å†²çª

#### B. å•ProviderçœŸå®æµ‹è¯• (Single Provider Real Tests)

##### B1. CodeWhispererçœŸå®æµ‹è¯•
```bash
# å¯åŠ¨CodeWhispereræœåŠ¡ (ç«¯å£5501)
rcc start --config ~/.route-claude-code/config/single-provider/config-codewhisperer-primary-5501.json --debug

# æ‰§è¡ŒçœŸå®è¿æ¥æµ‹è¯•
./test-runner.sh --category real-e2e-codewhisperer --port 5501
```

**æµ‹è¯•åœºæ™¯**:
- ç®€å•å¯¹è¯: Claude Sonnet 4æ¨¡å‹å¯¹è¯
- å·¥å…·è°ƒç”¨: grepã€bashå·¥å…·è°ƒç”¨æµ‹è¯•
- å¤šè½®å¯¹è¯: ä¸Šä¸‹æ–‡ä¿æŒéªŒè¯
- æµå¼å“åº”: å®æ—¶å“åº”å¤„ç†

##### B2. GeminiçœŸå®æµ‹è¯•
```bash
# å¯åŠ¨GeminiæœåŠ¡ (ç«¯å£5502)
rcc start --config ~/.route-claude-code/config/single-provider/config-google-gemini-5502.json --debug

# æ‰§è¡ŒçœŸå®è¿æ¥æµ‹è¯•
./test-runner.sh --category real-e2e-gemini --port 5502
```

**æµ‹è¯•åœºæ™¯**:
- ç®€å•å¯¹è¯: Gemini 2.5 Proæ¨¡å‹å¯¹è¯
- å·¥å…·è°ƒç”¨: å¤šå·¥å…·å¤æ‚è°ƒç”¨
- æµå¼å¤„ç†: Geminiæµå¼å“åº”éªŒè¯
- é”™è¯¯å¤„ç†: è¶…æ—¶å’Œé”™è¯¯æ¢å¤

##### B3. OpenAIå…¼å®¹æœåŠ¡çœŸå®æµ‹è¯•
```bash
# å¯åŠ¨LM StudioæœåŠ¡ (ç«¯å£5506)
rcc start --config ~/.route-claude-code/config/single-provider/config-openai-lmstudio-5506.json --debug

# å¯åŠ¨ShuaiHongæœåŠ¡ (ç«¯å£5508)
rcc start --config ~/.route-claude-code/config/single-provider/config-openai-shuaihong-5508.json --debug

# æ‰§è¡ŒçœŸå®è¿æ¥æµ‹è¯•
./test-runner.sh --category real-e2e-openai-compatible --port 5506,5508
```

#### C. ç”Ÿäº§ç¯å¢ƒå¤šProvideræµ‹è¯• (Production Multi-Provider Tests)
```bash
# å¯åŠ¨ç”Ÿäº§é…ç½®æœåŠ¡ (ç«¯å£3456)
rcc start --config ~/.route-claude-code/config/production-ready/config-production-3456.json --debug

# æ‰§è¡Œç”Ÿäº§ç¯å¢ƒçœŸå®æµ‹è¯•
./test-runner.sh --category real-e2e-production --port 3456
```

**æµ‹è¯•åœºæ™¯**:
- è´Ÿè½½å‡è¡¡éªŒè¯
- æ•…éšœè½¬ç§»æµ‹è¯•
- å¹¶å‘å¤„ç†èƒ½åŠ›
- é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•

#### D. å®¢æˆ·ç«¯çœŸå®è¿æ¥æµ‹è¯• (Client Real Connection Tests)
```bash
# æµ‹è¯•å‘½ä»¤ç¤ºä¾‹
rcc code --port 5501  # è¿æ¥CodeWhisperer
rcc code --port 5502  # è¿æ¥Gemini
rcc code --port 5508  # è¿æ¥ShuaiHong
rcc code --port 3456  # è¿æ¥ç”Ÿäº§ç¯å¢ƒ
```

**éªŒè¯å†…å®¹**:
- å®¢æˆ·ç«¯æˆåŠŸè¿æ¥å„ç«¯å£
- äº¤äº’å“åº”æ­£ç¡®æ€§
- å·¥å…·è°ƒç”¨æ‰§è¡ŒæˆåŠŸ
- é”™è¯¯å¤„ç†æœºåˆ¶æœ‰æ•ˆ

### âœ… é€šè¿‡æ ‡å‡†
- [ ] æ‰€æœ‰é…ç½®çš„Providerç«¯å£è¿æ¥æˆåŠŸ
- [ ] `rcc code --port` å®¢æˆ·ç«¯è¿æ¥100%æ­£å¸¸
- [ ] çœŸå®AIæœåŠ¡å“åº”æ ¼å¼æ­£ç¡®
- [ ] å·¥å…·è°ƒç”¨æˆåŠŸç‡ â‰¥ 99%
- [ ] æµå¼å“åº”å¤„ç†æ— å¼‚å¸¸
- [ ] å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ä¿æŒæ­£ç¡®

---

## ğŸ” æƒé™å®¡æ ¸æœºåˆ¶ (Permission Review System)

### ğŸ¯ è®¾è®¡ç›®æ ‡
- æ‰§è¡Œå‰è·å¾—ç”¨æˆ·å®Œæ•´æˆæƒï¼Œé¿å…ä¸­é€”æš‚åœ
- é¢„ç•™ä¿®å¤è„šæœ¬æœºåˆ¶ï¼Œé¿å…äºŒæ¬¡å®¡æ‰¹

### ğŸ“‹ æƒé™å®¡æ ¸æ¸…å• (Permission Checklist)

#### A. æµ‹è¯•æ‰§è¡Œæƒé™ (Test Execution Permissions)
```bash
# æƒé™å®¡æ ¸è„šæœ¬
./permission-review.sh --test-execution
```

**éœ€è¦ç”¨æˆ·ç¡®è®¤çš„æƒé™**:
- [ ] **ç½‘ç»œè¿æ¥æƒé™**: è¿æ¥çœŸå®AIæœåŠ¡API
- [ ] **ç«¯å£ä½¿ç”¨æƒé™**: ä½¿ç”¨5501-5509å’Œ3456-3457ç«¯å£
- [ ] **æ–‡ä»¶ç³»ç»Ÿæƒé™**: è¯»å†™æµ‹è¯•æŠ¥å‘Šå’Œæ—¥å¿—æ–‡ä»¶
- [ ] **è¿›ç¨‹ç®¡ç†æƒé™**: å¯åŠ¨å’Œåœæ­¢rccæœåŠ¡è¿›ç¨‹
- [ ] **é…ç½®æ–‡ä»¶è®¿é—®æƒé™**: è¯»å– `~/.route-claude-code/config/` é…ç½®
- [ ] **APIå¯†é’¥ä½¿ç”¨æƒé™**: ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„APIå‡­æ®

#### B. ä¿®å¤æ“ä½œæƒé™ (Fix Operation Permissions)
```bash
# ä¿®å¤æƒé™å®¡æ ¸è„šæœ¬
./permission-review.sh --fix-operations
```

**é¢„æˆæƒä¿®å¤æ“ä½œ**:
- [ ] **ä»£ç ä¿®å¤æƒé™**: ä¿®å¤P0/P1çº§ä»£ç é£é™©
- [ ] **é…ç½®è°ƒæ•´æƒé™**: è°ƒæ•´æµ‹è¯•ç›¸å…³é…ç½®
- [ ] **ä¾èµ–å®‰è£…æƒé™**: å®‰è£…æµ‹è¯•æ‰€éœ€ä¾èµ–
- [ ] **æœåŠ¡é‡å¯æƒé™**: é‡å¯å‡ºç°é—®é¢˜çš„æœåŠ¡
- [ ] **æ—¥å¿—æ¸…ç†æƒé™**: æ¸…ç†å’Œç®¡ç†æ—¥å¿—æ–‡ä»¶
- [ ] **æŠ¥å‘Šç”Ÿæˆæƒé™**: ç”Ÿæˆå’Œæ›´æ–°æµ‹è¯•æŠ¥å‘Š

#### C. ç´§æ€¥å¤„ç†æƒé™ (Emergency Handling Permissions)
```bash
# ç´§æ€¥æƒé™å®¡æ ¸è„šæœ¬
./permission-review.sh --emergency-handling
```

**ç´§æ€¥æƒ…å†µé¢„æˆæƒ**:
- [ ] **æœåŠ¡æ•…éšœæ¢å¤**: è‡ªåŠ¨é‡å¯å¼‚å¸¸æœåŠ¡
- [ ] **ç«¯å£å†²çªè§£å†³**: è‡ªåŠ¨å¤„ç†ç«¯å£å ç”¨é—®é¢˜
- [ ] **ç½‘ç»œå¼‚å¸¸å¤„ç†**: é‡è¯•ç½‘ç»œè¿æ¥å’ŒAPIè°ƒç”¨
- [ ] **å†…å­˜æ³„æ¼å¤„ç†**: é‡å¯å‡ºç°å†…å­˜é—®é¢˜çš„ç»„ä»¶
- [ ] **æ—¥å¿—ç©ºé—´ç®¡ç†**: è‡ªåŠ¨æ¸…ç†å ç”¨ç©ºé—´çš„æ—¥å¿—

### ğŸ› ï¸ é¢„ç•™ä¿®å¤è„šæœ¬æœºåˆ¶ (Reserved Fix Script System)

#### Script 1: è‡ªåŠ¨ä¿®å¤è„šæœ¬ (Auto-Fix Script)
```bash
# æ–‡ä»¶: ./scripts/auto-fix-delivery-issues.sh
./scripts/auto-fix-delivery-issues.sh

# åŠŸèƒ½è¦†ç›–:
- P0çº§ç¡¬ç¼–ç è‡ªåŠ¨ä¿®å¤
- Fallbackæœºåˆ¶è‡ªåŠ¨ç§»é™¤
- æ¶æ„è¿è§„è‡ªåŠ¨é‡æ„
- é‡å¤ä»£ç è‡ªåŠ¨åˆå¹¶
```

**è„šæœ¬èƒ½åŠ›**:
- æ£€æµ‹å’Œä¿®å¤ç¡¬ç¼–ç é—®é¢˜
- ç§»é™¤æ‰€æœ‰fallbackå’Œé»˜è®¤é™çº§
- é‡æ„è·¨èŠ‚ç‚¹è€¦åˆé—®é¢˜
- æ¶ˆé™¤é‡å¤å®ç°

#### Script 2: æµ‹è¯•ä¿®å¤è„šæœ¬ (Test-Fix Script)
```bash
# æ–‡ä»¶: ./scripts/fix-test-failures.sh
./scripts/fix-test-failures.sh

# åŠŸèƒ½è¦†ç›–:
- æµ‹è¯•ç¯å¢ƒé—®é¢˜è‡ªåŠ¨ä¿®å¤
- ä¾èµ–é—®é¢˜è‡ªåŠ¨è§£å†³
- é…ç½®æ–‡ä»¶é”™è¯¯è‡ªåŠ¨çº æ­£
- æœåŠ¡è¿æ¥é—®é¢˜è‡ªåŠ¨å¤„ç†
```

**è„šæœ¬èƒ½åŠ›**:
- è‡ªåŠ¨å®‰è£…ç¼ºå¤±ä¾èµ–
- ä¿®å¤é…ç½®æ–‡ä»¶æ ¼å¼é—®é¢˜
- å¤„ç†ç«¯å£å†²çªå’Œç½‘ç»œé—®é¢˜
- æ¢å¤æŸåçš„æµ‹è¯•ç¯å¢ƒ

### ğŸ’¼ æƒé™å®¡æ‰¹å·¥ä½œæµ (Permission Approval Workflow)

#### é˜¶æ®µ1: é¢„å®¡æ‰¹ (Pre-approval)
```bash
# ç”¨æˆ·æ‰§è¡Œæƒé™é¢„å®¡æ‰¹
./permission-review.sh --pre-approval
```
- ç”¨æˆ·ä¸€æ¬¡æ€§æˆæƒæ‰€æœ‰æµ‹è¯•å’Œä¿®å¤æƒé™
- ç”Ÿæˆæƒé™ä»¤ç‰Œï¼Œæœ‰æ•ˆæœŸ24å°æ—¶
- è®°å½•æˆæƒèŒƒå›´å’Œé™åˆ¶æ¡ä»¶

#### é˜¶æ®µ2: æ‰§è¡Œç¡®è®¤ (Execution Confirmation)
```bash
# æ‰§è¡Œå‰æœ€ç»ˆç¡®è®¤
./permission-review.sh --execution-confirmation
```
- å±•ç¤ºå³å°†æ‰§è¡Œçš„æ“ä½œæ¸…å•
- ç¡®è®¤æƒé™ä»¤ç‰Œæœ‰æ•ˆæ€§
- è·å¾—ç”¨æˆ·æœ€ç»ˆæ‰§è¡Œç¡®è®¤

#### é˜¶æ®µ3: è‡ªåŠ¨æ‰§è¡Œ (Automated Execution)
```bash
# è‡ªåŠ¨åŒ–æ‰§è¡Œå®Œæ•´æµ‹è¯•æµç¨‹
./comprehensive-delivery-test.sh --auto-execute
```
- ä½¿ç”¨é¢„æˆæƒæƒé™è‡ªåŠ¨æ‰§è¡Œ
- é‡åˆ°é—®é¢˜è‡ªåŠ¨è°ƒç”¨ä¿®å¤è„šæœ¬
- æ— éœ€ä¸­é€”æš‚åœç­‰å¾…ç”¨æˆ·ç¡®è®¤

---

## ğŸ” ä»£ç é£é™©å®¡æ ¸ä¸“å®¶éªŒæ”¶æ ‡å‡† (Code Risk Audit Expert Acceptance Criteria)

### ğŸ¯ å®¡æ ¸ç›®æ ‡
- é€šè¿‡ä¸“ä¸šçš„ä»£ç é£é™©å®¡æ ¸ä¸“å®¶éªŒæ”¶
- ç¡®ä¿äº¤ä»˜ä»£ç ç¬¦åˆæœ€é«˜è´¨é‡æ ‡å‡†

### ğŸ“Š å®¡æ ¸ç»´åº¦ (Audit Dimensions)

#### A. Fallbackæœºåˆ¶å®¡æ ¸ (Fallback Mechanism Audit)
```bash
# å¯åŠ¨ä¸“ä¸šå®¡æ ¸
code-risk-auditor --audit-fallback
```

**å®¡æ ¸æ ‡å‡†**:
- âŒ **é›¶å®¹å¿**: å‘ç°ä»»ä½•fallbackæœºåˆ¶ç«‹å³æ‹’ç»
- âŒ **é›¶é»˜è®¤å€¼**: ä¸å…è®¸ä»»ä½•é»˜è®¤å€¼é™çº§
- âŒ **é›¶å…œåº•é€»è¾‘**: ä¸å…è®¸å¼‚å¸¸æ—¶çš„å…œåº•å¤„ç†
- âœ… **æ˜ç¡®å¤±è´¥**: æ‰€æœ‰å¼‚å¸¸å¿…é¡»æ˜ç¡®æŠ›å‡º

**é‡ç‚¹å®¡æ ¸æ–‡ä»¶**:
- `src/providers/*/index.ts` - Provideråˆå§‹åŒ–é€»è¾‘
- `src/transformers/*.ts` - è½¬æ¢å™¨é™çº§é€»è¾‘
- `src/routing/*.ts` - è·¯ç”±å…œåº•æœºåˆ¶
- `src/server.ts` - æœåŠ¡å™¨é»˜è®¤å¤„ç†

#### B. é™é»˜å¤±è´¥å®¡æ ¸ (Silent Failure Audit)
```bash
# å¯åŠ¨é™é»˜å¤±è´¥å®¡æ ¸
code-risk-auditor --audit-silent-failure
```

**å®¡æ ¸æ ‡å‡†**:
- âŒ **é›¶é™é»˜**: æ‰€æœ‰é”™è¯¯å¿…é¡»æœ‰æ˜ç¡®æ—¥å¿—è®°å½•
- âŒ **é›¶å¿½ç•¥**: ä¸å…è®¸catchåä¸å¤„ç†çš„å¼‚å¸¸
- âŒ **é›¶åå™¬**: ä¸å…è®¸é”™è¯¯è¢«é™é»˜åå™¬
- âœ… **å…¨é€æ˜**: æ‰€æœ‰é”™è¯¯è·¯å¾„å¿…é¡»å¯è¿½è¸ª

**é‡ç‚¹å®¡æ ¸æ¨¡å¼**:
```javascript
// âŒ é™é»˜å¤±è´¥æ¨¡å¼ - ç«‹å³æ‹’ç»
try {
  dangerousOperation();
} catch (e) {
  // é™é»˜å¿½ç•¥é”™è¯¯
}

// âœ… æ­£ç¡®å¤„ç†æ¨¡å¼ - å®¡æ ¸é€šè¿‡
try {
  dangerousOperation();
} catch (e) {
  logger.error('Operation failed', { error: e, context });
  throw new OperationFailedError(e);
}
```

#### C. é‡å¤ä»£ç å®¡æ ¸ (Code Duplication Audit)
```bash
# å¯åŠ¨é‡å¤ä»£ç å®¡æ ¸
code-risk-auditor --audit-code-duplication
```

**å®¡æ ¸æ ‡å‡†**:
- **é‡å¤é˜ˆå€¼**: ç›¸ä¼¼ä»£ç å— â‰¤ 3è¡Œ
- **å‡½æ•°é‡å¤**: ç›¸ä¼¼å‡½æ•°é‡å¤ â‰¤ 0ä¸ª
- **é€»è¾‘é‡å¤**: ç›¸åŒé€»è¾‘å®ç° â‰¤ 0å¤„
- **ä»£ç å¤ç”¨ç‡**: â‰¥ 85%

**é‡ç‚¹å®¡æ ¸åŒºåŸŸ**:
- Providerå®ç°çš„ç›¸ä¼¼æ¨¡å¼
- è½¬æ¢å™¨çš„å…±åŒé€»è¾‘
- é”™è¯¯å¤„ç†çš„é‡å¤å®ç°
- é…ç½®åŠ è½½çš„ç›¸ä¼¼ä»£ç 

#### D. æ¶æ„è¿èƒŒå®¡æ ¸ (Architecture Violation Audit)
```bash
# å¯åŠ¨æ¶æ„è¿è§„å®¡æ ¸
code-risk-auditor --audit-architecture-violation
```

**å®¡æ ¸æ ‡å‡†**:
- **å…­å±‚æ¶æ„çº¯å‡€æ€§**: æ¯å±‚èŒè´£å•ä¸€æ˜ç¡®
- **è·¨å±‚è°ƒç”¨é›¶å®¹å¿**: ä¸å…è®¸è·¨å±‚ç›´æ¥è°ƒç”¨
- **æ¥å£æ ‡å‡†åŒ–**: å±‚é—´æ¥å£100%æ ‡å‡†åŒ–
- **ä¾èµ–æ–¹å‘æ­£ç¡®**: ä¾èµ–å…³ç³»ç¬¦åˆæ¶æ„è®¾è®¡

**é‡ç‚¹å®¡æ ¸é¡¹ç›®**:
- Transformerå±‚æ˜¯å¦åŒ…å«Provideré€»è¾‘
- Providerå±‚æ˜¯å¦åŒ…å«è·¯ç”±é€»è¾‘
- é¢„å¤„ç†å±‚æ˜¯å¦åŒ…å«è½¬æ¢é€»è¾‘
- è¾“å‡ºå±‚æ˜¯å¦åŒ…å«ä¸šåŠ¡é€»è¾‘

### ğŸ† ä¸“å®¶éªŒæ”¶æµç¨‹ (Expert Acceptance Process)

#### æ­¥éª¤1: è‡ªåŠ¨åŒ–é£é™©æ‰«æ
```bash
# æ‰§è¡Œå…¨é¢é£é™©æ‰«æ
./comprehensive-risk-scan.sh
```
- è¿è¡Œæ‰€æœ‰4ä¸ªç»´åº¦çš„è‡ªåŠ¨åŒ–å®¡æ ¸
- ç”Ÿæˆè¯¦ç»†çš„é£é™©æŠ¥å‘Š
- æ ‡è®°æ‰€æœ‰éœ€è¦äººå·¥å®¡æ ¸çš„ç–‘ç‚¹

#### æ­¥éª¤2: ä¸“å®¶äººå·¥å®¡æ ¸
```bash
# å¯åŠ¨ä¸“å®¶å®¡æ ¸ä¼šè¯
code-risk-auditor --expert-review-session
```
- ä¸“å®¶é€ä¸€å®¡æ ¸æ ‡è®°çš„ç–‘ç‚¹
- å¯¹è¾¹ç•Œæƒ…å†µè¿›è¡Œæ·±åº¦åˆ†æ
- éªŒè¯ä¿®å¤æ–¹æ¡ˆçš„æœ‰æ•ˆæ€§

#### æ­¥éª¤3: ä¿®å¤éªŒè¯å¾ªç¯
```bash
# ä¿®å¤åé‡æ–°å®¡æ ¸
code-risk-auditor --post-fix-verification
```
- éªŒè¯æ‰€æœ‰æ ‡è®°é—®é¢˜å·²ä¿®å¤
- ç¡®ä¿ä¿®å¤è¿‡ç¨‹æ²¡æœ‰å¼•å…¥æ–°é£é™©
- æœ€ç»ˆè´¨é‡è¯„åˆ†å’Œè®¤è¯

### âœ… ä¸“å®¶éªŒæ”¶é€šè¿‡æ ‡å‡†
- [ ] **Fallbackå®¡æ ¸**: 100%é€šè¿‡ï¼Œé›¶fallbackæœºåˆ¶
- [ ] **é™é»˜å¤±è´¥å®¡æ ¸**: 100%é€šè¿‡ï¼Œæ‰€æœ‰é”™è¯¯å¯è¿½è¸ª
- [ ] **é‡å¤ä»£ç å®¡æ ¸**: é‡å¤ç‡ â‰¤ 5%ï¼Œæ ¸å¿ƒé€»è¾‘é›¶é‡å¤
- [ ] **æ¶æ„è¿è§„å®¡æ ¸**: 100%é€šè¿‡ï¼Œå…­å±‚æ¶æ„çº¯å‡€
- [ ] **ä¸“å®¶è®¤è¯**: è·å¾—ä¸“å®¶ç­¾åç¡®è®¤äº¤ä»˜è´¨é‡

---

## ğŸ“ˆ ç»¼åˆäº¤ä»˜è¯„ä¼° (Comprehensive Delivery Assessment)

### ğŸ¯ æœ€ç»ˆäº¤ä»˜æ¡ä»¶ (Final Delivery Conditions)

#### å¿…é¡»æ¡ä»¶ (MUST HAVE)
- [ ] **5å±‚æµ‹è¯•100%é€šè¿‡**: å•å…ƒâ†’é»‘ç›’â†’å•å±‚â†’æ¨¡æ‹Ÿâ†’çœŸå®
- [ ] **æƒé™å®¡æ ¸å®Œæˆ**: ç”¨æˆ·é¢„æˆæƒæ‰€æœ‰æ‰§è¡Œæƒé™
- [ ] **ä¸“å®¶éªŒæ”¶é€šè¿‡**: 4ä¸ªç»´åº¦çš„ä¸“ä¸šå®¡æ ¸é€šè¿‡
- [ ] **çœŸå®è¿æ¥éªŒè¯**: `rcc code --port` æ‰€æœ‰ç«¯å£è¿æ¥æ­£å¸¸
- [ ] **é›¶é£é™©ä»£ç **: P0çº§é£é™©é—®é¢˜100%ä¿®å¤

#### å¯é€‰ä¼˜åŒ– (NICE TO HAVE)
- [ ] **æ€§èƒ½åŸºå‡†æµ‹è¯•**: å“åº”æ—¶é—´å’Œååé‡æµ‹è¯•
- [ ] **æ–‡æ¡£å®Œæ•´æ€§**: APIæ–‡æ¡£å’Œç”¨æˆ·æ‰‹å†Œæ›´æ–°
- [ ] **ç›‘æ§å‘Šè­¦**: ç”Ÿäº§ç¯å¢ƒç›‘æ§æŒ‡æ ‡é…ç½®

### ğŸ“Š äº¤ä»˜è¯„åˆ†ç³»ç»Ÿ (Delivery Scoring System)

#### è¯„åˆ†æƒé‡
- **æµ‹è¯•é€šè¿‡ç‡** (40%): 5å±‚æµ‹è¯•çš„ç»¼åˆé€šè¿‡æƒ…å†µ
- **ä»£ç è´¨é‡** (30%): ä¸“å®¶å®¡æ ¸çš„ç»¼åˆè¯„åˆ†
- **çœŸå®å¯ç”¨æ€§** (20%): ç«¯åˆ°ç«¯çœŸå®è¿æ¥æµ‹è¯•ç»“æœ
- **æƒé™åˆè§„** (10%): æƒé™ç®¡ç†å’Œå®¡æ‰¹æµç¨‹è§„èŒƒæ€§

#### è¯„åˆ†ç­‰çº§
- **Açº§ (90-100åˆ†)**: å“è¶Šäº¤ä»˜ï¼Œå¯ç›´æ¥ç”Ÿäº§éƒ¨ç½²
- **Bçº§ (80-89åˆ†)**: è‰¯å¥½äº¤ä»˜ï¼Œminoré—®é¢˜ä¿®å¤åå¯éƒ¨ç½²
- **Cçº§ (70-79åˆ†)**: åŸºæœ¬äº¤ä»˜ï¼Œéœ€è¦é‡è¦é—®é¢˜ä¿®å¤
- **Dçº§ (<70åˆ†)**: ä¸åˆæ ¼äº¤ä»˜ï¼Œéœ€è¦é‡å¤§ä¿®å¤æˆ–é‡æ„

### ğŸš€ æœ€ç»ˆäº¤ä»˜ç¡®è®¤ (Final Delivery Confirmation)

#### äº¤ä»˜æ¸…å•ç¡®è®¤
```bash
# æ‰§è¡Œæœ€ç»ˆäº¤ä»˜æ£€æŸ¥
./final-delivery-check.sh
```

**æ£€æŸ¥é¡¹ç›®**:
- [ ] æ‰€æœ‰5å±‚æµ‹è¯•æŠ¥å‘Šå­˜åœ¨ä¸”æœ€æ–°
- [ ] ä»£ç é£é™©å®¡æ ¸ä¸“å®¶ç­¾å­—ç¡®è®¤
- [ ] æƒé™å®¡æ‰¹æ–‡æ¡£å®Œæ•´
- [ ] çœŸå®è¿æ¥æµ‹è¯•æ—¥å¿—å®Œæ•´
- [ ] ä¿®å¤è„šæœ¬é¢„ç•™æœºåˆ¶å°±ç»ª

#### ç”¨æˆ·æœ€ç»ˆç¡®è®¤
```bash
# ç”¨æˆ·ç¡®è®¤äº¤ä»˜
./confirm-delivery.sh --final-approval
```

**ç¡®è®¤å†…å®¹**:
- [ ] ç”¨æˆ·éªŒè¯äº¤ä»˜è´¨é‡æ»¡æ„
- [ ] ç¡®è®¤æ‰€æœ‰æµ‹è¯•ç¯å¢ƒæ­£å¸¸
- [ ] æ‰¹å‡†ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [ ] æˆæƒç‰ˆæœ¬å‘å¸ƒå’Œæ ‡ç­¾

---

## ğŸ“ é™„å½•ï¼šè„šæœ¬å’Œå·¥å…·æ¸…å• (Appendix: Scripts and Tools List)

### ğŸ”§ æµ‹è¯•æ‰§è¡Œè„šæœ¬
```bash
./test-runner.sh                    # ç»Ÿä¸€æµ‹è¯•è¿è¡Œå™¨
./comprehensive-delivery-test.sh    # å®Œæ•´äº¤ä»˜æµ‹è¯•
./permission-review.sh              # æƒé™å®¡æ ¸å·¥å…·
./final-delivery-check.sh           # æœ€ç»ˆäº¤ä»˜æ£€æŸ¥
```

### ğŸ› ï¸ ä¿®å¤å·¥å…·è„šæœ¬
```bash
./scripts/auto-fix-delivery-issues.sh   # è‡ªåŠ¨ä¿®å¤è„šæœ¬
./scripts/fix-test-failures.sh          # æµ‹è¯•ä¿®å¤è„šæœ¬
./cleanup-delivery-reports.sh           # æŠ¥å‘Šæ¸…ç†å·¥å…·
```

### ğŸ” å®¡æ ¸ä¸“å®¶å·¥å…·
```bash
code-risk-auditor --audit-fallback          # Fallbackå®¡æ ¸
code-risk-auditor --audit-silent-failure    # é™é»˜å¤±è´¥å®¡æ ¸
code-risk-auditor --audit-code-duplication  # é‡å¤ä»£ç å®¡æ ¸
code-risk-auditor --audit-architecture-violation # æ¶æ„è¿è§„å®¡æ ¸
```

---

## ğŸ“… å®æ–½æ—¶é—´å®‰æ’ (Implementation Timeline)

### ğŸ—“ï¸ å®Œæ•´äº¤ä»˜å‘¨æœŸ: 3-5ä¸ªå·¥ä½œæ—¥

#### ç¬¬1å¤©: æƒé™å®¡æ ¸å’Œç¯å¢ƒå‡†å¤‡
- ä¸Šåˆ: æ‰§è¡Œæƒé™å®¡æ ¸ï¼Œè·å¾—ç”¨æˆ·é¢„æˆæƒ
- ä¸‹åˆ: å‡†å¤‡æµ‹è¯•ç¯å¢ƒï¼ŒéªŒè¯æ‰€æœ‰é…ç½®

#### ç¬¬2å¤©: å•å…ƒå’Œé»‘ç›’æµ‹è¯•
- ä¸Šåˆ: æ‰§è¡Œç¬¬1å±‚å•å…ƒæµ‹è¯•ï¼Œä¿®å¤å‘ç°é—®é¢˜
- ä¸‹åˆ: æ‰§è¡Œç¬¬2å±‚é»‘ç›’æµ‹è¯•ï¼ŒéªŒè¯å•å…ƒåŠŸèƒ½

#### ç¬¬3å¤©: æ¶æ„å’Œæ¨¡æ‹Ÿæµ‹è¯•  
- ä¸Šåˆ: æ‰§è¡Œç¬¬3å±‚å…­å±‚æ¶æ„å•å±‚æµ‹è¯•
- ä¸‹åˆ: æ‰§è¡Œç¬¬4å±‚ç«¯åˆ°ç«¯æ¨¡æ‹Ÿæµ‹è¯•

#### ç¬¬4å¤©: çœŸå®ç«¯åˆ°ç«¯æµ‹è¯•
- å…¨å¤©: æ‰§è¡Œç¬¬5å±‚çœŸå®ç«¯åˆ°ç«¯æµ‹è¯•
- è¦†ç›–æ‰€æœ‰Providerå’Œç«¯å£é…ç½®

#### ç¬¬5å¤©: ä¸“å®¶å®¡æ ¸å’Œæœ€ç»ˆäº¤ä»˜
- ä¸Šåˆ: ä»£ç é£é™©å®¡æ ¸ä¸“å®¶éªŒæ”¶
- ä¸‹åˆ: æœ€ç»ˆäº¤ä»˜ç¡®è®¤å’Œç”¨æˆ·éªŒæ”¶

---

**ğŸ“Œ æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**ğŸ‘¤ åˆ›å»ºè€…**: Jason Zhang  
**ğŸ“… åˆ›å»ºæ—¥æœŸ**: 2025-08-11  
**ğŸ”„ æœ€åæ›´æ–°**: 2025-08-11  
**âš¡ çŠ¶æ€**: ACTIVE - ç«‹å³ç”Ÿæ•ˆ