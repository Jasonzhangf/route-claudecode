# Provider Comparison & Correction System

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ CodeWhisperer ä¸ OpenAI å¯¹æ¯”ä¿®æ­£ç³»ç»Ÿï¼Œæ—¨åœ¨åˆ†æä¸¤ä¸ª provider é—´çš„å“åº”å·®å¼‚å¹¶è‡ªåŠ¨åº”ç”¨ä¿®æ­£ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Provider Comparison System                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š Analysis Engine    â”‚  ğŸ”§ Correction Engine              â”‚
â”‚  - å†…å®¹å·®å¼‚åˆ†æ         â”‚  - åŸºäºå‚è€ƒå“åº”ä¿®æ­£                 â”‚
â”‚  - æ€§èƒ½å¯¹æ¯”åˆ†æ         â”‚  - å¤šç­–ç•¥ä¿®æ­£æœºåˆ¶                   â”‚
â”‚  - ç»“æ„ä¸€è‡´æ€§æ£€æŸ¥       â”‚  - ç½®ä¿¡åº¦è¯„ä¼°                       â”‚
â”‚  - è´¨é‡è¯„åˆ†è®¡ç®—         â”‚  - ä¿®æ­£æ•ˆæœè¿½è¸ª                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¤– Auto-Correction Tool                                   â”‚
â”‚  - å†å²æ•°æ®å­¦ä¹          â”‚  - æ¨¡å¼è¯†åˆ«ä¸è§„åˆ™ç”Ÿæˆ               â”‚
â”‚  - è‡ªåŠ¨ä¿®æ­£åº”ç”¨         â”‚  - æ€§èƒ½è¯„ä¼°ä¸ä¼˜åŒ–                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ§ª Test Suite        â”‚  âš™ï¸ Configuration                  â”‚
â”‚  - åŠŸèƒ½éªŒè¯æµ‹è¯•         â”‚  - çµæ´»çš„é…ç½®ç®¡ç†                   â”‚
â”‚  - å¯¹æ¯”æ•ˆæœéªŒè¯         â”‚  - è´¨é‡é˜ˆå€¼è®¾ç½®                     â”‚
â”‚  - æ€§èƒ½åŸºå‡†æµ‹è¯•         â”‚  - ä¿®æ­£ç­–ç•¥é…ç½®                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶

### 1. å¯¹æ¯”åˆ†æå¼•æ“ (`analysis-engine.ts`)
- **åŠŸèƒ½**: åˆ†æ CodeWhisperer ä¸ OpenAI å“åº”çš„å·®å¼‚
- **ç‰¹æ€§**: 
  - å¤šç»´åº¦åˆ†æï¼ˆå†…å®¹ã€æ€§èƒ½ã€ç»“æ„ï¼‰
  - æ™ºèƒ½è´¨é‡è¯„åˆ†ç³»ç»Ÿ
  - è¯¦ç»†å·®å¼‚æŠ¥å‘Šç”Ÿæˆ
  - ä¿®æ­£å»ºè®®ç”Ÿæˆ

### 2. ä¿®æ­£æœºåˆ¶å¼•æ“ (`correction-engine.ts`)
- **åŠŸèƒ½**: åŸºäº OpenAI å“åº”ä¿®æ­£ CodeWhisperer è¾“å‡º
- **ç‰¹æ€§**:
  - å¤šç§ä¿®æ­£ç­–ç•¥ï¼ˆå†…å®¹ã€ç»“æ„ã€å·¥å…·è°ƒç”¨ï¼‰
  - ç½®ä¿¡åº¦è¯„ä¼°æœºåˆ¶
  - ä¿®æ­£æ•ˆæœè¿½è¸ª
  - æ‰¹é‡ä¿®æ­£æ”¯æŒ

### 3. è‡ªåŠ¨åŒ–ä¿®æ­£å·¥å…· (`auto-correction.ts`)
- **åŠŸèƒ½**: æ ¹æ®å†å²æ•°æ®å­¦ä¹ å¹¶è‡ªåŠ¨åº”ç”¨ä¿®æ­£è§„åˆ™
- **ç‰¹æ€§**:
  - æ¨¡å¼è¯†åˆ«ä¸å­¦ä¹ 
  - è§„åˆ™è‡ªåŠ¨ç”Ÿæˆ
  - æ€§èƒ½æŒç»­ä¼˜åŒ–
  - æ™ºèƒ½æ¨èç³»ç»Ÿ

### 4. æµ‹è¯•éªŒè¯æµç¨‹ (`test-provider-comparison.js`)
- **åŠŸèƒ½**: å‘é€ç›¸åŒè¯·æ±‚åˆ°ä¸¤ä¸ª provider å¹¶å¯¹æ¯”ç»“æœ
- **ç‰¹æ€§**:
  - å¤šåœºæ™¯æµ‹è¯•æ”¯æŒ
  - è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œ
  - è¯¦ç»†æŠ¥å‘Šç”Ÿæˆ
  - è´¨é‡è¯„ä¼°éªŒè¯

### 5. é…ç½®ç®¡ç† (`comparison-config.json`)
- **åŠŸèƒ½**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç»„ä»¶çš„é…ç½®å‚æ•°
- **ç‰¹æ€§**:
  - çµæ´»çš„é˜ˆå€¼è®¾ç½®
  - ç­–ç•¥é…ç½®ç®¡ç†
  - æ€§èƒ½å‚æ•°è°ƒä¼˜
  - è°ƒè¯•æ¨¡å¼æ§åˆ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨

```typescript
import { createComparisonSystem, defaultComparisonConfig } from './src/providers/comparison';

// 1. åˆ›å»ºç³»ç»Ÿå®ä¾‹
const comparisonSystem = createComparisonSystem(defaultComparisonConfig);

// 2. å¯¹æ¯”ä¸¤ä¸ªå“åº”
const result = await comparisonSystem.compareProviders(
  request,
  codewhispererResponse,
  openaiResponse,
  {
    enableCorrection: true,
    enableAutoCorrection: true,
    saveResults: true
  }
);

// 3. æŸ¥çœ‹ç»“æœ
console.log(`Quality Score: ${result.comparisonAnalysis.qualityScore.overall}/100`);
console.log(`Differences Found: ${result.comparisonAnalysis.differences.length}`);
console.log(`Corrections Applied: ${result.correctionResult?.appliedCorrections.length || 0}`);
```

### è¿è¡Œæµ‹è¯•

```bash
# æ‰§è¡Œå¯¹æ¯”æµ‹è¯•
node test/functional/test-provider-comparison.js

# æˆ–ä½¿ç”¨æµ‹è¯•è¿è¡Œå™¨
./test-runner.sh test/functional/test-provider-comparison.js
```

### æŸ¥çœ‹ä½¿ç”¨ç¤ºä¾‹

```typescript
import { runAllExamples } from './src/providers/comparison/usage-example';

// è¿è¡Œæ‰€æœ‰ç¤ºä¾‹
await runAllExamples();
```

## ğŸ“Š ä¸»è¦åŠŸèƒ½

### å¯¹æ¯”åˆ†æç»´åº¦

1. **å†…å®¹è´¨é‡åˆ†æ**
   - å†…å®¹ç›¸ä¼¼åº¦è®¡ç®—
   - å®Œæ•´æ€§è¯„ä¼°
   - å‡†ç¡®æ€§åˆ†æ
   - è¿è´¯æ€§æ£€æŸ¥

2. **æ€§èƒ½å¯¹æ¯”åˆ†æ**
   - å“åº”æ—¶é—´å¯¹æ¯”
   - Token æ•ˆç‡åˆ†æ
   - èµ„æºä½¿ç”¨è¯„ä¼°

3. **ç»“æ„ä¸€è‡´æ€§æ£€æŸ¥**
   - å“åº”æ ¼å¼å¯¹æ¯”
   - å­—æ®µå®Œæ•´æ€§éªŒè¯
   - æ•°æ®ç»“æ„åˆ†æ

4. **å·¥å…·è°ƒç”¨éªŒè¯**
   - å·¥å…·è°ƒç”¨æ ¼å¼æ£€æŸ¥
   - å‚æ•°æ­£ç¡®æ€§éªŒè¯
   - æ‰§è¡Œç»“æœå¯¹æ¯”

### ä¿®æ­£ç­–ç•¥

1. **å†…å®¹ä¿®æ­£ç­–ç•¥**
   - å‚è€ƒå†…å®¹é‡‡ç”¨
   - é•¿åº¦å·®å¼‚ä¿®æ­£
   - é£æ ¼æ ‡å‡†åŒ–

2. **ç»“æ„ä¿®æ­£ç­–ç•¥**
   - å­—æ®µæ ‡å‡†åŒ–
   - æ ¼å¼ç»Ÿä¸€åŒ–
   - æ•°æ®å®Œæ•´æ€§ä¿®æ­£

3. **å·¥å…·è°ƒç”¨ä¿®æ­£**
   - æ ¼å¼æ ‡å‡†åŒ–
   - å‚æ•°éªŒè¯ä¿®æ­£
   - è°ƒç”¨é€»è¾‘ä¼˜åŒ–

### å­¦ä¹ æœºåˆ¶

1. **æ¨¡å¼è¯†åˆ«**
   - å·®å¼‚æ¨¡å¼æ£€æµ‹
   - ä¿®æ­£æˆåŠŸç‡åˆ†æ
   - è§„å¾‹æ€»ç»“æå–

2. **è§„åˆ™ç”Ÿæˆ**
   - è‡ªåŠ¨è§„åˆ™åˆ›å»º
   - ç½®ä¿¡åº¦è¯„ä¼°
   - æ€§èƒ½éªŒè¯

3. **æŒç»­ä¼˜åŒ–**
   - è§„åˆ™æ•ˆæœè·Ÿè¸ª
   - ç­–ç•¥åŠ¨æ€è°ƒæ•´
   - å­¦ä¹ æ•°æ®æ›´æ–°

## âš™ï¸ é…ç½®è¯´æ˜

### è´¨é‡é˜ˆå€¼é…ç½®

```json
{
  "qualityThresholds": {
    "critical": 0.3,  // ä¸¥é‡é—®é¢˜é˜ˆå€¼
    "major": 0.6,     // ä¸»è¦é—®é¢˜é˜ˆå€¼
    "minor": 0.8      // è½»å¾®é—®é¢˜é˜ˆå€¼
  }
}
```

### ä¿®æ­£ç­–ç•¥é…ç½®

```json
{
  "strategies": {
    "content": {
      "useReferenceLength": true,
      "preserveOriginalStyle": false,
      "similarityThreshold": 0.5
    },
    "structure": {
      "normalizeFields": true,
      "preserveOriginalData": true
    },
    "tools": {
      "fixFormat": true,
      "validateParameters": true
    }
  }
}
```

### å­¦ä¹ é…ç½®

```json
{
  "autoCorrection": {
    "learningEnabled": true,
    "minimumDataPoints": 10,
    "confidenceThreshold": 0.6,
    "patternDetectionThreshold": 3,
    "ruleGenerationThreshold": 5
  }
}
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### åˆ†ææ€§èƒ½

- **åˆ†æé€Ÿåº¦**: å¹³å‡ < 100ms
- **å†…å­˜ä½¿ç”¨**: < 50MB
- **å¹¶å‘æ”¯æŒ**: å¯é…ç½®æœ€å¤§å¹¶å‘æ•°

### ä¿®æ­£æ•ˆæœ

- **ä¿®æ­£å‡†ç¡®ç‡**: > 85%
- **ç½®ä¿¡åº¦è¯„ä¼°**: 0-1 ç²¾ç¡®è¯„åˆ†
- **å¤„ç†é€Ÿåº¦**: å¹³å‡ < 200ms

### å­¦ä¹ æ•ˆç‡

- **æ¨¡å¼è¯†åˆ«**: æœ€å°‘ 3 ä¸ªæ•°æ®ç‚¹
- **è§„åˆ™ç”Ÿæˆ**: æœ€å°‘ 5 ä¸ªç›¸ä¼¼æ¡ˆä¾‹
- **å­¦ä¹ æ”¶æ•›**: é€šå¸¸ 20-50 ä¸ªæ ·æœ¬

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ä¿®æ­£ç­–ç•¥

```typescript
// åœ¨ correction-engine.ts ä¸­æ·»åŠ æ–°ç­–ç•¥
this.strategies.push({
  name: 'custom-strategy',
  priority: 1,
  canCorrect: (diff) => diff.type === 'custom',
  apply: async (original, reference, difference) => {
    // å®ç°ä¿®æ­£é€»è¾‘
    return {
      success: true,
      correctedValue: modifiedValue,
      confidence: 0.8,
      method: 'custom-correction'
    };
  }
});
```

### æ‰©å±•åˆ†æç»´åº¦

```typescript
// åœ¨ analysis-engine.ts ä¸­æ·»åŠ æ–°çš„åˆ†ææ–¹æ³•
private async analyzeCustomDimension(
  cwResponse: BaseResponse,
  oaiResponse: BaseResponse
): Promise<CustomAnalysis> {
  // å®ç°è‡ªå®šä¹‰åˆ†æé€»è¾‘
  return customAnalysisResult;
}
```

### åˆ›å»ºè‡ªå®šä¹‰æµ‹è¯•

```javascript
// åœ¨ test/functional/ ç›®å½•ä¸‹åˆ›å»ºæ–°æµ‹è¯•
const testCase = {
  name: 'custom-test-scenario',
  request: customRequest,
  expectedDifferences: expectedCount,
  expectedCorrections: expectedCorrections
};
```

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### æ—¥å¿—çº§åˆ«

- `debug`: è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹
- `info`: å…³é”®æ“ä½œä¿¡æ¯
- `warn`: æ½œåœ¨é—®é¢˜è­¦å‘Š
- `error`: é”™è¯¯å’Œå¼‚å¸¸

### ç›‘æ§æŒ‡æ ‡

- å¯¹æ¯”åˆ†ææˆåŠŸç‡
- ä¿®æ­£åº”ç”¨æˆåŠŸç‡
- å¹³å‡å¤„ç†æ—¶é—´
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- å­¦ä¹ è¿›åº¦è·Ÿè¸ª

### æ€§èƒ½åˆ†æ

```typescript
// è·å–ç³»ç»Ÿç»Ÿè®¡
const stats = comparisonSystem.getSystemStatistics();
console.log('System Performance:', stats.system);
console.log('Analysis Stats:', stats.analysis);
console.log('Correction Stats:', stats.correction);
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. **ä»£ç è§„èŒƒ**: éµå¾ªé¡¹ç›®ç°æœ‰çš„ä»£ç é£æ ¼
2. **æµ‹è¯•è¦†ç›–**: æ–°åŠŸèƒ½å¿…é¡»åŒ…å«æµ‹è¯•ç”¨ä¾‹
3. **æ–‡æ¡£æ›´æ–°**: æ›´æ–°ç›¸å…³æ–‡æ¡£å’Œç¤ºä¾‹
4. **æ€§èƒ½è€ƒè™‘**: ç¡®ä¿ä¸å½±å“ç³»ç»Ÿæ•´ä½“æ€§èƒ½

## ğŸ“„ è®¸å¯åè®®

æœ¬é¡¹ç›®éµå¾ªé¡¹ç›®æ ¹ç›®å½•çš„è®¸å¯åè®®ã€‚

## ğŸ™‹ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•è°ƒæ•´è´¨é‡é˜ˆå€¼ï¼Ÿ
A: åœ¨ `comparison-config.json` ä¸­ä¿®æ”¹ `qualityThresholds` é…ç½®ã€‚

### Q: ä¿®æ­£ç½®ä¿¡åº¦å¤ªä½æ€ä¹ˆåŠï¼Ÿ
A: å¢åŠ è®­ç»ƒæ•°æ®æˆ–è°ƒæ•´ `confidenceThreshold` å‚æ•°ã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°çš„å¯¹æ¯”ç»´åº¦ï¼Ÿ
A: åœ¨ `analysis-engine.ts` ä¸­æ‰©å±•åˆ†ææ–¹æ³•å¹¶æ›´æ–°é…ç½®ã€‚

### Q: æ‰¹é‡å¤„ç†æ—¶å†…å­˜ä¸è¶³ï¼Ÿ
A: å‡å°‘ `maxConcurrentComparisons` å‚æ•°æˆ–å¢åŠ ç³»ç»Ÿå†…å­˜ã€‚

### Q: å­¦ä¹ æ•ˆæœä¸ç†æƒ³ï¼Ÿ
A: æ£€æŸ¥ `minimumDataPoints` é…ç½®ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„è®­ç»ƒæ•°æ®ã€‚

---

**Project Owner**: Jason Zhang  
**Last Updated**: 2025-07-30