/**
 * æ—¥å¿—ç³»ç»Ÿé‡æ„å®ŒæˆæŠ¥å‘Š
 * è§£å†³æ‰€æœ‰unified-logsé—®é¢˜å¹¶å®ç°æŒ‰requestå•ç‹¬è®°å½•
 */

console.log('=== æ—¥å¿—ç³»ç»Ÿé‡æ„å®ŒæˆæŠ¥å‘Š ===\n');

console.log('\nğŸ¯ å·²è§£å†³çš„é—®é¢˜ï¼š');

console.log('\nâœ… 1. unified-logsç¼ºå°‘stop reasonè®°å½•');
console.log('   - æ·»åŠ äº†stop reasonè®°å½•åŠŸèƒ½');
console.log('   - æ”¯æŒæ—¶é—´æˆ³è®°å½•');
console.log('   - è®°å½•åˆ°ç»Ÿä¸€æ—¥å¿—å’Œå•ç‹¬æ–‡ä»¶');

console.log('\nâœ… 2. æ·»åŠ requestå‘é€æ—¶é—´å’Œå®Œæ•´å“åº”æ—¶é—´è®°å½•');
console.log('   - è®°å½•requestå¼€å§‹æ—¶é—´');
console.log('   - è®°å½•æ¯ä¸ªå¤„ç†é˜¶æ®µçš„æ—¶é—´');
console.log('   - è®°å½•requestç»“æŸæ—¶é—´å’Œæ€»è€—æ—¶');
console.log('   - æ”¯æŒæ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡');

console.log('\nâœ… 3. ä¸ºstop reasonè®°å½•æ·»åŠ æ—¶é—´æˆ³');
console.log('   - è®°å½•stop reasonå‘ç”Ÿçš„æ—¶é—´');
console.log('   - æ”¯æŒåŒ—äº¬æ—¶é—´æˆ³');
console.log('   - å¯ä»¥ä¸å“åº”æ—¶é—´å åŠ åˆ†æ');

console.log('\nâœ… 4. æ¸…ç†æ—§çš„è®°å½•æ–‡ä»¶');
console.log('   - å®ç°è‡ªåŠ¨æ¸…ç†åŠŸèƒ½');
console.log('   - å¯é…ç½®æ¸…ç†å‘¨æœŸ');
console.log('   - æ¸…ç†requestæ—¥å¿—å’Œæ—¶é—´å—æ—¥å¿—');

console.log('\nâœ… 5. é‡æ„è®°å½•æ–¹å¼ï¼šæŒ‰requestå•ç‹¬æ–‡ä»¶è®°å½•å…¨æµç¨‹');
console.log('   - æ¯ä¸ªrequestä¸€ä¸ªå•ç‹¬çš„JSONæ–‡ä»¶');
console.log('   - è®°å½•å®Œæ•´çš„æ—¶é—´çº¿');
console.log('   - åŒ…å«æ‰€æœ‰å¤„ç†é˜¶æ®µ');
console.log('   - åŒ…å«stop reasonå’Œå“åº”æ—¶é—´');

console.log('\nâœ… 6. å®ç°èŠ‚ç‚¹å“åº”æŒ‰æ—¶é—´åˆ†å—è®°å½•ï¼ˆ5åˆ†é’Ÿä¸€ä¸ªæ–‡ä»¶ï¼‰');
console.log('   - æ¯5åˆ†é’Ÿä¸€ä¸ªæ—¶é—´å—æ–‡ä»¶');
console.log('   - ä»¥å¼€å§‹æ—¶é—´ä¸ºå‘½ååŸºå‡†');
console.log('   - è®°å½•æ‰€æœ‰èŠ‚ç‚¹å“åº”');
console.log('   - æ”¯æŒå›¾å½¢ç•Œé¢è§£æ');

console.log('\nâœ… 7. å®ç°ç³»ç»Ÿæ—¥å¿—å•ç‹¬æ–‡ä»¶è®°å½•');
console.log('   - ç³»ç»Ÿäº‹ä»¶ç‹¬ç«‹è®°å½•');
console.log('   - æŒ‰ç«¯å£åˆ†ç»„');
console.log('   - åŒ…å«æ—¶é—´æˆ³å’Œåˆ†ç±»');

console.log('\nâœ… 8. å®ç°stop reasonå•ç‹¬æ–‡ä»¶è®°å½•');
console.log('   - stop reasonå•ç‹¬è®°å½•');
console.log('   - æŒ‰æ—¥æœŸåˆ†ç»„å­˜å‚¨');
console.log('   - åŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡ä¿¡æ¯');
console.log('   - æ”¯æŒæ—¶é—´å åŠ åˆ†æ');

console.log('\nğŸ“ æ–°çš„æ—¥å¿—ç›®å½•ç»“æ„ï¼š');
console.log('');
console.log('~/.route-claude-code/');
console.log('â”œâ”€â”€ request-logs/                    # requestå…¨æµç¨‹è®°å½•');
console.log('â”‚   â”œâ”€â”€ port-3456/');
console.log('â”‚   â”‚   â”œâ”€â”€ time-blocks/            # 5åˆ†é’Ÿæ—¶é—´å—');
console.log('â”‚   â”‚   â”‚   â”œâ”€â”€ node-responses-20250805-1530.json');
console.log('â”‚   â”‚   â”‚   â””â”€â”€ node-responses-20250805-1535.json');
console.log('â”‚   â”‚   â”œâ”€â”€ stop-reasons/           # stop reasonè®°å½•');
console.log('â”‚   â”‚   â”‚   â””â”€â”€ stop-reasons-2025-08-05.json');
console.log('â”‚   â”‚   â””â”€â”€ request-[requestId].json # æ¯ä¸ªrequestçš„å®Œæ•´æ—¶é—´çº¿');
console.log('â”‚   â””â”€â”€ port-6689/');
console.log('â”‚       â””â”€â”€ [ç›¸åŒçš„ç»“æ„]');
console.log('â”œâ”€â”€ unified-logs/                    # ç»Ÿä¸€æ—¥å¿—');
console.log('â”‚   â”œâ”€â”€ port-3456/');
console.log('â”‚   â”‚   â””â”€â”€ 2025-08-05_15-30-45/');
console.log('â”‚   â”‚       â”œâ”€â”€ request.log');
console.log('â”‚   â”‚       â”œâ”€â”€ response.log');
console.log('â”‚   â”‚       â”œâ”€â”€ pipeline.log');
console.log('â”‚   â”‚       â”œâ”€â”€ error.log');
console.log('â”‚   â”‚       â”œâ”€â”€ performance.log');
console.log('â”‚   â”‚       â”œâ”€â”€ system.log');
console.log('â”‚   â”‚       â””â”€â”€ stopreason.log');
console.log('â”‚   â””â”€â”€ port-6689/');
console.log('â””â”€â”€ logs/                          # ç«¯å£åˆ†ç»„è°ƒè¯•æ—¥å¿—');
console.log('    â”œâ”€â”€ port-3456/');
console.log('    â”‚   â”œâ”€â”€ finish-reason-debug.log');
console.log('    â”‚   â”œâ”€â”€ stop-reason-debug.log');
console.log('    â”‚   â”œâ”€â”€ tool-call-completion.log');
console.log('    â”‚   â”œâ”€â”€ api-errors.log');
console.log('    â”‚   â””â”€â”€ polling-retries.log');
console.log('    â””â”€â”€ port-6689/');

console.log('\nğŸ“ Requestæ—¶é—´çº¿è®°å½•æ ¼å¼ï¼š');
console.log('');
console.log('{');
console.log('  "requestId": "req-123456",');
console.log('  "startTime": 1725545643210,');
console.log('  "endTime": 1725545645678,');
console.log('  "totalDuration": 2468,');
console.log('  "port": 3456,');
console.log('  "provider": "openai",');
console.log('  "model": "gpt-4",');
console.log('  "stopReason": "tool_calls",');
console.log('  "stopReasonTime": 1725545645678,');
console.log('  "stages": [');
console.log('    {');
console.log('      "timestamp": 1725545643210,');
console.log('      "stage": "request-start",');
console.log('      "data": { "endpoint": "/v1/chat/completions" }');
console.log('    },');
console.log('    {');
console.log('      "timestamp": 1725545644321,');
console.log('      "stage": "routing",');
console.log('      "duration": 1111,');
console.log('      "data": { "provider": "openai" }');
console.log('    },');
console.log('    {');
console.log('      "timestamp": 1725545645000,');
console.log('      "stage": "provider-processing",');
console.log('      "duration": 679,');
console.log('      "data": { "tokensUsed": 150 }');
console.log('    },');
console.log('    {');
console.log('      "timestamp": 1725545645678,');
console.log('      "stage": "stop-reason",');
console.log('      "data": { "stopReason": "tool_calls" }');
console.log('    },');
console.log('    {');
console.log('      "timestamp": 1725545645678,');
console.log('      "stage": "request-end",');
console.log('      "duration": 2468');
console.log('    }');
console.log('  ]');
console.log('}');

console.log('\nğŸ”§ ä½¿ç”¨æ–¹å¼ï¼š');
console.log('');
console.log('// 1. åˆå§‹åŒ–requestè®°å½•');
console.log('await requestLogger.startRequest("req-123", 3456, "openai", "gpt-4", { prompt: "Hello" });');
console.log('');
console.log('// 2. è®°å½•å¤„ç†é˜¶æ®µ');
console.log('await requestLogger.logStage("req-123", "routing", 100, { selected: "openai" });');
console.log('await requestLogger.logStage("req-123", "provider-processing", 500, { tokens: 150 });');
console.log('');
console.log('// 3. è®°å½•stop reason');
console.log('await requestLogger.logStopReason("req-123", "tool_calls", "openai", "gpt-4");');
console.log('');
console.log('// 4. å®Œæˆrequest');
console.log('await requestLogger.completeRequest("req-123", undefined, { response: "Generated" });');
console.log('');
console.log('// 5. è¯»å–requestæ—¶é—´çº¿');
console.log('const timeline = await requestLogger.readRequestTimeline("req-123");');
console.log('');
console.log('// 6. æ¸…ç†æ—§æ—¥å¿—');
console.log('await requestLogger.cleanupOldRequests(7); // æ¸…ç†7å¤©å‰çš„æ—¥å¿—');

console.log('\nğŸ‰ æ—¥å¿—ç³»ç»Ÿé‡æ„å®Œæˆï¼');
console.log('ç°åœ¨å…·å¤‡å®Œæ•´çš„requestå…¨æµç¨‹è·Ÿè¸ªèƒ½åŠ›ï¼Œä¸ºå›¾å½¢ç•Œé¢è§£ææä¾›äº†åšå®çš„åŸºç¡€ã€‚');
