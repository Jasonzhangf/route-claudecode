# OpenAIé›†æˆè°ƒè¯•æµ‹è¯•å¥—ä»¶

## æµ‹è¯•ç”¨ä¾‹
æ•´åˆæ•°æ®æ•è·ã€Hookã€å›æ”¾å’Œè¯Šæ–­ç³»ç»Ÿçš„å®Œæ•´OpenAIè°ƒè¯•è§£å†³æ–¹æ¡ˆ

## æµ‹è¯•ç›®æ ‡
1. **ä¸€ç«™å¼è°ƒè¯•**: æä¾›å®Œæ•´çš„OpenAIè°ƒè¯•æµç¨‹ï¼Œä»æ•°æ®æ•è·åˆ°é—®é¢˜ä¿®å¤
2. **è‡ªåŠ¨åŒ–æµç¨‹**: è‡ªåŠ¨æ‰§è¡Œæ•è·â†’è¯Šæ–­â†’å›æ”¾â†’ä¿®å¤çš„å®Œæ•´è°ƒè¯•é“¾è·¯
3. **æ€§èƒ½åŸºå‡†**: é€šè¿‡å¤šç§æµ‹è¯•ç”¨ä¾‹è¯„ä¼°ç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§
4. **äº¤äº’å¼è°ƒè¯•**: æä¾›å‹å¥½çš„å‘½ä»¤è¡Œç•Œé¢è¿›è¡Œå®æ—¶è°ƒè¯•æ“ä½œ

## æœ€è¿‘æ‰§è¡Œè®°å½•

### 2025-07-30 18:20:15 - é›†æˆè°ƒè¯•å¥—ä»¶è®¾è®¡ âœ… SUCCESS
- **æ‰§è¡Œæ—¶é•¿**: æ¶æ„è®¾è®¡å’Œé›†æˆé˜¶æ®µ
- **çŠ¶æ€**: å®Œæ•´é›†æˆè°ƒè¯•å¥—ä»¶è®¾è®¡å®Œæˆ
- **æ—¥å¿—æ–‡ä»¶**: ä¸å„å­ç³»ç»Ÿå…±äº« `/tmp/openai-pipeline-captures/`
- **å‘ç°è¦ç‚¹**:
  - âœ… å››å¤§æ ¸å¿ƒç³»ç»Ÿçš„æ— ç¼é›†æˆï¼ˆæ•°æ®æ•è·ã€Hookã€å›æ”¾ã€è¯Šæ–­ï¼‰
  - âœ… è‡ªåŠ¨åŒ–çš„å®Œæ•´è°ƒè¯•æµç¨‹ï¼Œä»é—®é¢˜æ£€æµ‹åˆ°ä¿®å¤å»ºè®®
  - âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•ç³»ç»Ÿï¼Œæ”¯æŒå¤šåœºæ™¯å‹åŠ›æµ‹è¯•
  - âœ… äº¤äº’å¼è°ƒè¯•ç•Œé¢ï¼Œæä¾›å‹å¥½çš„ç”¨æˆ·ä½“éªŒ
  - âœ… ç»¼åˆå¥åº·è¯„åˆ†ç³»ç»Ÿï¼Œé‡åŒ–ç³»ç»Ÿè¿è¡ŒçŠ¶æ€

## æ ¸å¿ƒé›†æˆæ¶æ„

### 1. å››å¤§æ ¸å¿ƒç³»ç»Ÿé›†æˆ
- **æ•°æ®æ•è·ç³»ç»Ÿ**: è‡ªåŠ¨æ•è·6æ­¥æµæ°´çº¿çš„å®Œæ•´æ•°æ®
- **Hookç®¡ç†ç³»ç»Ÿ**: éä¾µå…¥å¼çš„å®æ—¶æ•°æ®æ‹¦æˆª
- **å›æ”¾éªŒè¯ç³»ç»Ÿ**: åŸºäºæ•è·æ•°æ®çš„æ–­ç‚¹è°ƒè¯•
- **é—®é¢˜è¯Šæ–­ç³»ç»Ÿ**: æ™ºèƒ½åŒ–çš„é—®é¢˜è¯†åˆ«å’Œä¿®å¤å»ºè®®

### 2. è‡ªåŠ¨åŒ–è°ƒè¯•æµç¨‹
```
ç”¨æˆ·è¯·æ±‚ â†’ Hookæ‹¦æˆª â†’ æ•°æ®æ•è· â†’ å®æ—¶è¯Šæ–­ â†’ é—®é¢˜æ£€æµ‹ â†’ è‡ªåŠ¨å›æ”¾ â†’ ä¿®å¤å»ºè®®
```

### 3. æ€§èƒ½åŸºå‡†æµ‹è¯•
æ”¯æŒå¤šç§æµ‹è¯•åœºæ™¯ï¼š
- **Simple Text**: åŸºç¡€æ–‡æœ¬å¤„ç†
- **With Tools**: å·¥å…·è°ƒç”¨å¤„ç†  
- **Multi-turn**: å¤šè½®å¯¹è¯å¤„ç†
- **Complex Tools**: å¤æ‚å·¥å…·ç»„åˆå¤„ç†

## ä½¿ç”¨æ–¹å¼

### åŸºç¡€ä½¿ç”¨
```javascript
const { OpenAIIntegratedDebugSuite } = require('./test-openai-integrated-debug-suite');

const debugSuite = new OpenAIIntegratedDebugSuite();
await debugSuite.initialize();

// è¿è¡Œå®Œæ•´è°ƒè¯•æµç¨‹
const result = await debugSuite.runCompleteDebugFlow();
```

### äº¤äº’å¼è°ƒè¯•
```bash
# å¯åŠ¨äº¤äº’å¼è°ƒè¯•ä¼šè¯
node test-openai-integrated-debug-suite.js

# é€‰æ‹©è°ƒè¯•é€‰é¡¹
[debug-suite] > 1  # è¿è¡Œå®Œæ•´è°ƒè¯•æµç¨‹
[debug-suite] > 2  # è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
[debug-suite] > 3  # è¯Šæ–­ç°æœ‰ä¼šè¯
```

### è‡ªå®šä¹‰æµ‹è¯•
```javascript
// åˆ›å»ºè‡ªå®šä¹‰æµ‹è¯•è¯·æ±‚
const customRequest = {
  model: 'claude-sonnet-4-20250514',
  messages: [
    { role: 'user', content: 'Your test scenario here' }
  ],
  metadata: {
    tools: [/* your tools */]
  }
};

// è¿è¡Œè°ƒè¯•æµç¨‹
await debugSuite.runCompleteDebugFlow(customRequest);
```

## è°ƒè¯•æµç¨‹è¯¦è§£

### å®Œæ•´è°ƒè¯•æµç¨‹ (runCompleteDebugFlow)
1. **è¯·æ±‚å‡†å¤‡**: åˆ›å»ºæˆ–æ¥æ”¶æµ‹è¯•è¯·æ±‚
2. **Hookå¯ç”¨**: å¯ç”¨æ•°æ®æ‹¦æˆªç³»ç»Ÿ
3. **æ•°æ®æ•è·**: è‡ªåŠ¨æ•è·6æ­¥æµæ°´çº¿æ•°æ®
4. **APIè°ƒç”¨**: å‘é€è¯·æ±‚åˆ°æœ¬åœ°è·¯ç”±å™¨
5. **å³æ—¶è¯Šæ–­**: è‡ªåŠ¨è¿è¡Œé—®é¢˜è¯Šæ–­
6. **å›æ”¾è°ƒè¯•**: å¦‚å‘ç°é—®é¢˜ï¼Œå¯åŠ¨å›æ”¾è°ƒè¯•
7. **æŠ¥å‘Šç”Ÿæˆ**: ç”Ÿæˆå®Œæ•´çš„è°ƒè¯•æŠ¥å‘Š

### æ€§èƒ½åŸºå‡†æµ‹è¯• (runPerformanceBenchmark)
```
ğŸ§ª Testing: Simple Text
âœ… Simple Text: 1234ms

ğŸ§ª Testing: With Tools  
âœ… With Tools: 2156ms

ğŸ§ª Testing: Multi-turn
âœ… Multi-turn: 1876ms

ğŸ§ª Testing: Complex Tools
âœ… Complex Tools: 2934ms

ğŸ“Š Average successful duration: 2050ms
```

### äº¤äº’å¼è°ƒè¯•ä¼šè¯
æ”¯æŒä»¥ä¸‹å‘½ä»¤ï¼š
- **1. Run complete debug flow** - æ‰§è¡Œå®Œæ•´è°ƒè¯•æµç¨‹
- **2. Run performance benchmark** - è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
- **3. Diagnose existing session** - è¯Šæ–­æŒ‡å®šä¼šè¯
- **4. Replay session** - å›æ”¾æŒ‡å®šä¼šè¯
- **5. Enable/disable debug mode** - åˆ‡æ¢è°ƒè¯•æ¨¡å¼
- **6. View recent sessions** - æŸ¥çœ‹æœ€è¿‘çš„ä¼šè¯
- **q. Quit** - é€€å‡ºç³»ç»Ÿ

## ç³»ç»Ÿé›†æˆç‰¹æ€§

### æ•°æ®æµè‡ªåŠ¨åŒ–
```
Request â†’ Step1 Capture â†’ Step2 Routing â†’ Step3 Transform â†’ 
Step4 API â†’ Step5 Input â†’ Step6 Output â†’ Diagnosis â†’ Replay
```

### Hookç³»ç»Ÿé›†æˆ
- **è‡ªåŠ¨æ‹¦æˆª**: åœ¨å…³é”®èŠ‚ç‚¹è‡ªåŠ¨æ•è·æ•°æ®
- **å®æ—¶ç›‘æ§**: ç›‘æ§æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡ŒçŠ¶æ€
- **é”™è¯¯æ£€æµ‹**: å®æ—¶æ£€æµ‹å’ŒæŠ¥å‘Šæ‰§è¡Œé”™è¯¯

### è¯Šæ–­ç³»ç»Ÿé›†æˆ
- **å³æ—¶è¯Šæ–­**: è¯·æ±‚å®Œæˆåç«‹å³è¿è¡Œè¯Šæ–­
- **é—®é¢˜åˆ†ç±»**: è‡ªåŠ¨åˆ†ç±»å’Œè¯„ä¼°é—®é¢˜ä¸¥é‡æ€§
- **ä¿®å¤å»ºè®®**: æä¾›å…·ä½“çš„ä»£ç ä¿®å¤å»ºè®®

### å›æ”¾ç³»ç»Ÿé›†æˆ
- **è‡ªåŠ¨è§¦å‘**: å‘ç°é—®é¢˜æ—¶è‡ªåŠ¨å¯åŠ¨å›æ”¾
- **æ–­ç‚¹è®¾ç½®**: åœ¨é—®é¢˜æ­¥éª¤è‡ªåŠ¨è®¾ç½®æ–­ç‚¹
- **ä¿®æ”¹éªŒè¯**: æ”¯æŒä¿®æ”¹æ•°æ®åé‡æ–°éªŒè¯

## å¥åº·è¯„åˆ†ç³»ç»Ÿ

### è¯„åˆ†ç®—æ³•
```javascript
// åŸºäºé—®é¢˜ä¸¥é‡æ€§çš„åŠ æƒè¯„åˆ†
const weightedScore = (critical * 4) + (high * 3) + (medium * 2) + (low * 1);
const healthScore = Math.max(0, 100 - (weightedScore / maxPossibleScore) * 100);
```

### è¯„åˆ†ç­‰çº§
- **90-100åˆ†**: ä¼˜ç§€ - ç³»ç»Ÿè¿è¡Œè‰¯å¥½
- **80-89åˆ†**: è‰¯å¥½ - æœ‰è½»å¾®é—®é¢˜ä½†ä¸å½±å“ä½¿ç”¨
- **70-79åˆ†**: ä¸€èˆ¬ - å­˜åœ¨ä¸€äº›éœ€è¦å…³æ³¨çš„é—®é¢˜  
- **60-69åˆ†**: è¾ƒå·® - æœ‰æ˜æ˜¾é—®é¢˜éœ€è¦ä¿®å¤
- **0-59åˆ†**: å±é™© - ç³»ç»Ÿå­˜åœ¨ä¸¥é‡é—®é¢˜

### ç³»ç»Ÿå»ºè®®ç”Ÿæˆ
```json
{
  "recommendations": [
    {
      "priority": "urgent",
      "action": "Address critical issues immediately",
      "description": "Critical issues prevent normal operation and must be fixed first"
    },
    {
      "priority": "high", 
      "action": "Fix recurring issue: toolCallLossIssue",
      "description": "This issue affects 80% of sessions"
    }
  ]
}
```

## æ€§èƒ½åŸºå‡†æŠ¥å‘Š

### åŸºå‡†æµ‹è¯•ç»“æœç¤ºä¾‹
```
ğŸ“ˆ Performance Benchmark Results:
   âœ… Simple Text: 1234ms
   âœ… With Tools: 2156ms  
   âœ… Multi-turn: 1876ms
   âŒ Complex Tools: Failed after 2934ms

ğŸ“Š Average successful duration: 1755ms
ğŸ“Š Success rate: 75% (3/4)
ğŸ“Š Health Score: 82/100
```

### æ€§èƒ½æŒ‡æ ‡
- **å“åº”æ—¶é—´**: æ¯ä¸ªæµ‹è¯•åœºæ™¯çš„æ‰§è¡Œæ—¶é—´
- **æˆåŠŸç‡**: æµ‹è¯•ç”¨ä¾‹çš„æˆåŠŸå®Œæˆç‡
- **é”™è¯¯æ¨¡å¼**: å¤±è´¥æµ‹è¯•ç”¨ä¾‹çš„é”™è¯¯ç±»å‹
- **èµ„æºä½¿ç”¨**: å†…å­˜å’ŒCPUä½¿ç”¨æƒ…å†µ

## ç»¼åˆè°ƒè¯•æŠ¥å‘Š

### æŠ¥å‘Šç»“æ„
```json
{
  "timestamp": "2025-07-30T18:20:15.123Z",
  "suiteVersion": "1.0.0",
  "overallHealth": {
    "sessionsAnalyzed": 12,
    "issuesSummary": {
      "critical": 2,
      "high": 1, 
      "medium": 3,
      "low": 1
    },
    "healthScore": 75
  },
  "commonIssues": [
    {
      "issueId": "formatConversion.openaiToAnthropic.toolCallLossIssue",
      "frequency": 8,
      "percentage": 67,
      "severity": "critical"
    }
  ],
  "systemStatus": {
    "captureSystemReady": true,
    "hookSystemEnabled": true,
    "debugModeActive": false,
    "lastSessionId": "capture-1753512345678"
  }
}
```

### æŠ¥å‘Šå†…å®¹
- **æ•´ä½“å¥åº·çŠ¶å†µ**: ç³»ç»Ÿè¿è¡Œçš„ç»¼åˆè¯„ä¼°
- **å¸¸è§é—®é¢˜åˆ†æ**: é¢‘ç¹å‡ºç°çš„é—®é¢˜æ¨¡å¼
- **ç³»ç»ŸçŠ¶æ€æ£€æŸ¥**: å„å­ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€
- **æ”¹è¿›å»ºè®®**: åŸºäºåˆ†æç»“æœçš„ç³»ç»Ÿä¼˜åŒ–å»ºè®®

## é›†æˆéƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒé›†æˆ
```javascript
// åœ¨å¼€å‘ç¯å¢ƒä¸­å¯ç”¨è‡ªåŠ¨è°ƒè¯•
if (process.env.NODE_ENV === 'development') {
  const debugSuite = new OpenAIIntegratedDebugSuite();
  await debugSuite.initialize();
  debugSuite.enableDebugMode();
}
```

### CI/CDé›†æˆ
```yaml
# GitHub Actions é›†æˆ
- name: Run OpenAI Debug Suite
  run: |
    npm run test:openai-debug-suite
    if [ $? -ne 0 ]; then
      echo "Debug suite detected critical issues"
      exit 1
    fi
```

### ç›‘æ§é›†æˆ
```javascript
// å®šæœŸå¥åº·æ£€æŸ¥
setInterval(async () => {
  const debugSuite = new OpenAIIntegratedDebugSuite();
  await debugSuite.initialize();
  
  const report = await debugSuite.generateComprehensiveReport();
  
  if (report.overallHealth.healthScore < 70) {
    await sendAlert(`System health score: ${report.overallHealth.healthScore}`);
  }
}, 3600000); // æ¯å°æ—¶æ£€æŸ¥
```

## ä½¿ç”¨åœºæ™¯

### 1. æ—¥å¸¸å¼€å‘è°ƒè¯•
```javascript
// å¿«é€Ÿé—®é¢˜è¯Šæ–­
const result = await debugSuite.runCompleteDebugFlow(testRequest);
if (result.hasIssues) {
  console.log('Issues detected, check debug report for details');
}
```

### 2. æ€§èƒ½ä¼˜åŒ–åˆ†æ
```javascript
// è¿è¡ŒåŸºå‡†æµ‹è¯•
const benchmarkResults = await debugSuite.runPerformanceBenchmark();
const avgTime = benchmarkResults.filter(r => r.success)
                               .reduce((sum, r) => sum + r.duration, 0) / 
                               benchmarkResults.filter(r => r.success).length;
```

### 3. ç³»ç»Ÿå¥åº·ç›‘æ§
```javascript
// ç”Ÿæˆå¥åº·æŠ¥å‘Š
const healthReport = await debugSuite.generateComprehensiveReport();
console.log(`System Health Score: ${healthReport.overallHealth.healthScore}/100`);
```

### 4. é—®é¢˜ä¿®å¤éªŒè¯
```javascript
// ä¿®å¤åéªŒè¯
debugSuite.replaySystem.modifyStepData('step3-transformation', 'openaiRequest.tools', []);
const verificationResult = await debugSuite.runCompleteDebugFlow();
```

## æ‰©å±•åŠŸèƒ½

### è‡ªå®šä¹‰æµ‹è¯•åœºæ™¯
```javascript
// æ·»åŠ è‡ªå®šä¹‰åŸºå‡†æµ‹è¯•
const customTestCases = [
  { name: 'Long Context', hasTools: false, messageCount: 1, contentLength: 50000 },
  { name: 'API Stress', hasTools: true, messageCount: 5, concurrent: true }
];
```

### æ’ä»¶ç³»ç»Ÿ
```javascript
// æ·»åŠ è‡ªå®šä¹‰è¯Šæ–­è§„åˆ™
debugSuite.diagnosisSystem.addCustomPattern('myCustomIssue', {
  pattern: (data) => /* custom logic */,
  severity: 'high',
  category: 'custom'
});
```

### æŠ¥å‘Šè‡ªå®šä¹‰
```javascript
// è‡ªå®šä¹‰æŠ¥å‘Šæ ¼å¼
const customReport = await debugSuite.generateComprehensiveReport();
customReport.customMetrics = {
  averageLatency: calculateAverageLatency(),
  errorRate: calculateErrorRate()
};
```

## æ€§èƒ½ä¼˜åŒ–

### å†…å­˜ç®¡ç†
- **åˆ†æ‰¹å¤„ç†**: å¤§é‡ä¼šè¯æ•°æ®åˆ†æ‰¹å¤„ç†
- **ç¼“å­˜ç­–ç•¥**: æ™ºèƒ½ç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®
- **èµ„æºæ¸…ç†**: åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ä¸´æ—¶æ•°æ®

### å¹¶å‘å¤„ç†
- **å¼‚æ­¥æ‰§è¡Œ**: éé˜»å¡çš„å¼‚æ­¥æ“ä½œ
- **å¹¶è¡Œè¯Šæ–­**: å¤šä¼šè¯å¹¶è¡Œè¯Šæ–­å¤„ç†
- **é˜Ÿåˆ—ç®¡ç†**: è¯·æ±‚æ’é˜Ÿé¿å…ç³»ç»Ÿè¿‡è½½

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **Hookç³»ç»Ÿæœªå¯ç”¨**: æ£€æŸ¥ `hookManager.isEnabled` çŠ¶æ€
2. **æ•è·ç›®å½•æƒé™**: ç¡®ä¿ `/tmp/openai-pipeline-captures/` å¯å†™
3. **æœ¬åœ°è·¯ç”±å™¨è¿æ¥**: éªŒè¯ `http://localhost:3456` å¯è®¿é—®
4. **ä¼šè¯æ•°æ®ç¼ºå¤±**: æ£€æŸ¥æ•°æ®æ•è·ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ

### è°ƒè¯•å»ºè®®
- å¯ç”¨è¯¦ç»†æ—¥å¿—æ¨¡å¼æŸ¥çœ‹æ‰§è¡Œç»†èŠ‚
- ä½¿ç”¨å•æ­¥è°ƒè¯•å®šä½å…·ä½“é—®é¢˜æ­¥éª¤
- æ£€æŸ¥å„å­ç³»ç»Ÿçš„åˆå§‹åŒ–çŠ¶æ€
- éªŒè¯æµ‹è¯•è¯·æ±‚æ ¼å¼çš„æ­£ç¡®æ€§

## ç›¸å…³æ–‡ä»¶
- **é›†æˆè°ƒè¯•å¥—ä»¶**: `/test/functional/test-openai-integrated-debug-suite.js`
- **æ•°æ®æ•è·ç³»ç»Ÿ**: `/test/functional/test-openai-pipeline-data-capture.js`
- **Hookç³»ç»Ÿ**: `/test/functional/test-openai-pipeline-hooks.js`
- **å›æ”¾ç³»ç»Ÿ**: `/test/functional/test-openai-pipeline-replay.js`
- **è¯Šæ–­ç³»ç»Ÿ**: `/test/functional/test-openai-problem-diagnosis.js`
- **ä½¿ç”¨æ–‡æ¡£**: æœ¬æ–‡ä»¶
- **è¾“å‡ºç›®å½•**: `/tmp/openai-pipeline-captures/`