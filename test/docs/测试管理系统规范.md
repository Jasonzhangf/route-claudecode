# 🧪 Claude Code Router 测试管理系统规范

## 📋 核心测试规则（四大原则）

### 1. 测试一定使用脚本
- ✅ 所有测试必须通过脚本执行，禁止手动测试
- 📄 统一使用 `./test-runner.sh` 工具

### 2. 用一句话总结测试用例
- ✅ 每个测试文件名必须能清楚表达测试目的
- 📄 格式：`test-[一句话描述].js`

### 3. 同名MD文档
- ✅ 每个测试文件(.js)都有对应的同名文档(.md)
- 📄 每次测试不论成功失败都必须更新MD文档

### 4. 先查看现有测试  
- ✅ 每次发现问题要测试，先去test文件夹查看是否已有类似文件
- 📄 使用 `./test-runner.sh --search <关键词>` 搜索

## 🗂️ 测试文件组织结构

```
test/
├── functional/     # 功能测试 (工具调用、多轮对话等)
├── integration/    # 集成测试 (端到端、供应商集成)  
├── pipeline/       # 流水线测试 (6步骤标准流程)
├── performance/    # 性能测试 (调试、解析性能)
└── docs/          # 测试文档总结
```

## 📝 测试命名规范

| 文件类型 | 命名格式 | 示例 |
|---------|----------|------|
| 测试文件 | `test-[一句话描述].js` | `test-cli-tool-issue.js` |
| 文档文件 | `test-[一句话描述].md` | `test-cli-tool-issue.md` |
| 日志文件 | `/tmp/test-[测试名]-[时间戳].log` | `/tmp/test-cli-tool-issue-20250727-074105.log` |

## 🛠️ 测试脚本统一工具

### 基本用法
```bash
# 列出所有测试
./test-runner.sh --list

# 搜索相关测试
./test-runner.sh --search token

# 按分类运行测试
./test-runner.sh --category functional

# 运行单个测试
./test-runner.sh test/functional/test-cli-tool-issue.js
```

### 测试分类说明
- **functional**: 功能测试 - 工具调用、多轮对话、简单功能验证
- **integration**: 集成测试 - 端到端测试、供应商集成、完整流程验证  
- **pipeline**: 流水线测试 - 6步骤标准测试流程
- **performance**: 性能测试 - 调试性能、解析性能、响应时间

## 📚 测试文档规范

每个MD文档必须包含以下部分：

### 必需部分
1. **测试用例** - 用一句话描述测试目的
2. **测试目标** - 具体要验证什么问题  
3. **最近执行记录** - 时间、状态、执行时长、日志文件
4. **历史执行记录** - 保留多次执行历史
5. **相关文件** - 测试脚本和日志文件路径

### 文档模板
```markdown
# test-[测试名称]

## 测试用例
[用一句话描述测试目的]

## 测试目标  
[具体要验证什么问题]

## 最近执行记录

### 2025-07-27 07:41:13
- **状态**: PASSED/FAILED
- **执行时间**: 8秒  
- **日志文件**: /tmp/test-xxx-timestamp.log

[测试结果摘要或错误信息]

## 历史执行记录
[之前的执行记录]

## 相关文件
- 测试脚本: `test/xxx/test-xxx.js`
- 最新日志: `/tmp/test-xxx-timestamp.log`
```

## 🔄 标准流程测试 (STD-6-STEP-PIPELINE)

专门用于调试复杂问题的6步测试流程：

1. **Step 1**: 输入处理验证 - API请求链路通畅性
2. **Step 2**: 模型路由验证 - 路由逻辑正确性  
3. **Step 3**: 格式转换验证 - Transformer转换逻辑
4. **Step 4**: 第三方API验证 - 真实API响应测试
5. **Step 5**: 数据传递验证 - Transformer输入数据验证
6. **Step 6**: 输出转换验证 - Transformer输出结果验证
7. **Step 7**: 最终响应验证 - 完整响应构建验证

## ✅ 最佳实践

### 测试前检查
1. 先查看 `项目CLAUDE.md` 中的测试规则
2. 检查 `test/` 目录下是否已有类似测试
3. 使用搜索功能查找相关测试文件

### 测试执行
1. 使用统一的 `./test-runner.sh` 工具
2. 确保每次测试都更新对应的MD文档
3. 保存详细的日志文件供后续分析

### 测试维护
1. 定期清理过时的测试文件
2. 更新测试文档中的历史记录
3. 确保测试脚本的可执行性和准确性

## 📊 当前测试状态统计

| 分类 | 文件数量 | 状态 |
|------|----------|------|
| functional | 11个文件 | ✅ 已整理 |
| integration | 11个文件 | ✅ 已整理 |
| pipeline | 7个文件 | ✅ 已整理 |
| performance | 4个文件 | ✅ 已整理 |

**总计**: 33个测试文件已成功整理并建立管理系统

---

*项目所有者: Jason Zhang*
*文档更新时间: 2025-07-27*